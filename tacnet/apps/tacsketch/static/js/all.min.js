var exports=exports||{},fabric=fabric||{version:"1.3.0"};exports.fabric=fabric;if(typeof document!=="undefined"&&typeof window!=="undefined"){fabric.document=document;fabric.window=window}else{fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>");fabric.window=fabric.document.createWindow()}fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement;fabric.isLikelyNode=typeof Buffer!=="undefined"&&typeof window==="undefined";
var Cufon=function(){function l(p){var o=this.face=p.face;this.glyphs=p.glyphs;this.w=p.w;this.baseSize=parseInt(o["units-per-em"],10);this.family=o["font-family"].toLowerCase();this.weight=o["font-weight"];this.style=o["font-style"]||"normal";this.viewBox=function(){var r=o.bbox.split(/\s+/);r={minX:parseInt(r[0],10),minY:parseInt(r[1],10),maxX:parseInt(r[2],10),maxY:parseInt(r[3],10)};r.width=r.maxX-r.minX;r.height=r.maxY-r.minY;r.toString=function(){return[this.minX,this.minY,this.width,this.height].join(" ")};
return r}();this.ascent=-parseInt(o.ascent,10);this.descent=-parseInt(o.descent,10);this.height=-this.ascent+this.descent}function e(){var p={},o={oblique:"italic",italic:"oblique"};this.add=function(r){(p[r.style]||(p[r.style]={}))[r.weight]=r};this.get=function(r,u){var x=p[r]||p[o[r]]||p.normal||p.italic||p.oblique;if(!x)return null;u={normal:400,bold:700}[u]||parseInt(u,10);if(x[u])return x[u];var z={1:1,99:0}[u%100],B=[],E,C;if(z===undefined)z=u>400;if(u==500)u=400;for(var A in x){A=parseInt(A,
10);if(!E||A<E)E=A;if(!C||A>C)C=A;B.push(A)}if(u<E)u=E;if(u>C)u=C;B.sort(function(D,F){return(z?D>u&&F>u?D<F:D>F:D<u&&F<u?D>F:D<F)?-1:1});return x[B[0]]}}function a(p){var o={},r={};this.get=function(u){return o[u]!=undefined?o[u]:p[u]};this.getSize=function(u,x){return r[u]||(r[u]=new k.Size(this.get(u),x))};this.extend=function(u){for(var x in u)o[x]=u[x];return this}}function f(p,o,r){if(p.addEventListener)p.addEventListener(o,r,false);else p.attachEvent&&p.attachEvent("on"+o,function(){return r.call(p,
fabric.window.event)})}function c(p){var o={};return function(r){o.hasOwnProperty(r)||(o[r]=p.apply(null,arguments));return o[r]}}function d(p){return fabric.document.getElementsByTagName(p)}function b(){for(var p={},o,r=0,u=arguments.length;r<u;++r)for(o in arguments[r])p[o]=arguments[r][o];return p}function g(p,o,r,u,x,z){var B=u.separate;if(B=="none")return w[u.engine].apply(null,arguments);var E=fabric.document.createDocumentFragment(),C=o.split(v[B]),A=B=="words";if(A&&m){/^\s/.test(o)&&C.unshift("");
/\s$/.test(o)&&C.push("")}for(var D=0,F=C.length;D<F;++D)(B=w[u.engine](p,A?k.textAlign(C[D],r,D,F):C[D],r,u,x,z,D<F-1))&&E.appendChild(B);return E}function h(p,o){var r,u,x,z;x=n.get(p);if(!x.options){o.hover&&o.hoverables[p.nodeName.toLowerCase()]&&q.attach(p);x.options=o}for(var B=p.firstChild;B;B=x){x=B.nextSibling;z=false;if(B.nodeType==1){if(!B.firstChild)continue;if(/cufon/.test(B.className))z=true;else{arguments.callee(B,o);continue}}u||(u=k.getStyle(p).extend(o));if(!r)a:{(r=u)||(r=k.getStyle(p));
for(var E=k.quotedList(r.get("fontFamily").toLowerCase()),C=void 0,A=0,D=E.length;A<D;++A){C=E[A];if(y[C]){r=y[C].get(r.get("fontStyle"),r.get("fontWeight"));break a}}r=null}if(r)if(z)w[o.engine](r,null,u,o,B,p);else{z=B.data;if(typeof G_vmlCanvasManager!="undefined")z=z.replace(/\r/g,"\n");if(z!=="")(z=g(r,z,u,o,B,p))?B.parentNode.replaceChild(z,B):B.parentNode.removeChild(B)}}}var j=function(){return j.replace.apply(null,arguments)},i=j.DOM={ready:function(){var p=false,o={loaded:1,complete:1},
r=[],u=function(){if(!p){p=true;for(var x;x=r.shift();x());}};if(fabric.document.addEventListener){fabric.document.addEventListener("DOMContentLoaded",u,false);fabric.window.addEventListener("pageshow",u,false)}!fabric.window.opera&&fabric.document.readyState&&function(){o[fabric.document.readyState]?u():setTimeout(arguments.callee,10)}();fabric.document.readyState&&fabric.document.createStyleSheet&&function(){try{fabric.document.body.doScroll("left");u()}catch(x){setTimeout(arguments.callee,1)}}();
f(fabric.window,"load",u);return function(x){if(arguments.length)p?x():r.push(x);else u()}}()},k=j.CSS={Size:function(p,o){this.value=parseFloat(p);this.unit=String(p).match(/[a-z%]*$/)[0]||"px";this.convert=function(r){return r/o*this.value};this.convertFrom=function(r){return r/this.value*o};this.toString=function(){return this.value+this.unit}},getStyle:function(p){return new a(p.style)},quotedList:c(function(p){for(var o=[],r=/\s*((["'])([\s\S]*?[^\\])\2|[^,]+)\s*/g,u;u=r.exec(p);)o.push(u[3]||
u[1]);return o}),ready:function(){var p=false,o=[],r=Object.prototype.propertyIsEnumerable?d("style"):{length:0},u=d("link");i.ready(function(){for(var x=0,z,B=0,E=u.length;z=u[B],B<E;++B)!z.disabled&&z.rel.toLowerCase()=="stylesheet"&&++x;if(fabric.document.styleSheets.length>=r.length+x)for(p=true;x=o.shift();x());else setTimeout(arguments.callee,10)});return function(x){p?x():o.push(x)}}(),supports:function(p,o){var r=fabric.document.createElement("span").style;if(r[p]===undefined)return false;
r[p]=o;return r[p]===o},textAlign:function(p,o,r,u){if(o.get("textAlign")=="right"){if(r>0)p=" "+p}else if(r<u-1)p+=" ";return p},textDecoration:function(p,o){o||(o=this.getStyle(p));for(var r={underline:null,overline:null,"line-through":null},u=p;u.parentNode&&u.parentNode.nodeType==1;){var x=true;for(var z in r)if(!r[z]){if(o.get("textDecoration").indexOf(z)!=-1)r[z]=o.get("color");x=false}if(x)break;o=this.getStyle(u=u.parentNode)}return r},textShadow:c(function(p){if(p=="none")return null;for(var o=
[],r={},u,x=0,z=/(#[a-f0-9]+|[a-z]+\(.*?\)|[a-z]+)|(-?[\d.]+[a-z%]*)|,/ig;u=z.exec(p);)if(u[0]==","){o.push(r);r={};x=0}else if(u[1])r.color=u[1];else r[["offX","offY","blur"][x++]]=u[2];o.push(r);return o}),color:c(function(p){var o={};o.color=p.replace(/^rgba\((.*?),\s*([\d.]+)\)/,function(r,u,x){o.opacity=parseFloat(x);return"rgb("+u+")"});return o}),textTransform:function(p,o){return p[{uppercase:"toUpperCase",lowercase:"toLowerCase"}[o.get("textTransform")]||"toString"]()}},m=" ".split(/\s+/).length==
0,n=new function(){var p={},o=0;this.get=function(r){r=r.cufid||(r.cufid=++o);return p[r]||(p[r]={})}},q=new (function(){function p(u){u=u.relatedTarget;var x;if(!(x=!u))x=this.contains?this.contains(u):this.compareDocumentPosition(u)&16;x||r(this)}function o(){r(this)}function r(u){setTimeout(function(){j.replace(u,n.get(u).options,true)},10)}this.attach=function(u){if(u.onmouseenter===undefined){f(u,"mouseover",p);f(u,"mouseout",p)}else{f(u,"mouseenter",o);f(u,"mouseleave",o)}}}),t=[],w={},y={},
s={engine:null,hover:false,hoverables:{a:true},printable:true,selector:fabric.window.Sizzle||fabric.window.jQuery&&function(p){return jQuery(p)}||fabric.window.dojo&&dojo.query||fabric.window.$$&&function(p){return $$(p)}||fabric.window.$&&function(p){return $(p)}||fabric.document.querySelectorAll&&function(p){return fabric.document.querySelectorAll(p)}||d,separate:"words",textShadow:"none"},v={words:/\s+/,characters:""};j.now=function(){i.ready();return j};j.refresh=function(){for(var p=t.splice(0,
t.length),o=0,r=p.length;o<r;++o)j.replace.apply(null,p[o]);return j};j.registerEngine=function(p,o){if(!o)return j;w[p]=o;return j.set("engine",p)};j.registerFont=function(p){p=new l(p);var o=p.family;y[o]||(y[o]=new e);y[o].add(p);return j.set("fontFamily",'"'+o+'"')};j.replace=function(p,o,r){o=b(s,o);if(!o.engine)return j;if(typeof o.textShadow=="string"&&o.textShadow)o.textShadow=k.textShadow(o.textShadow);r||t.push(arguments);if(p.nodeType||typeof p=="string")p=[p];k.ready(function(){for(var u=
0,x=p.length;u<x;++u){var z=p[u];typeof z=="string"?j.replace(o.selector(z),o,true):h(z,o)}});return j};j.replaceElement=function(p,o){o=b(s,o);if(typeof o.textShadow=="string"&&o.textShadow)o.textShadow=k.textShadow(o.textShadow);return h(p,o)};j.engines=w;j.fonts=y;j.getOptions=function(){return b(s)};j.set=function(p,o){s[p]=o;return j};return j}();
Cufon.registerEngine("canvas",function(){var l=Cufon.CSS.supports("display","inline-block"),e=!l&&(fabric.document.compatMode=="BackCompat"||/frameset|transitional/i.test(fabric.document.doctype.publicId)),a=fabric.document.createElement("style");a.type="text/css";e=fabric.document.createTextNode(".cufon-canvas{text-indent:0}@media screen,projection{.cufon-canvas{display:inline;display:inline-block;position:relative;vertical-align:middle"+(e?"":";font-size:1px;line-height:1px")+"}.cufon-canvas .cufon-alt{display:-moz-inline-box;display:inline-block;width:0;height:0;overflow:hidden}"+
(l?".cufon-canvas canvas{position:relative}":".cufon-canvas canvas{position:absolute}")+"}@media print{.cufon-canvas{padding:0 !important}.cufon-canvas canvas{display:none}.cufon-canvas .cufon-alt{display:inline}}");try{a.appendChild(e)}catch(f){a.setAttribute("type","text/css");a.styleSheet.cssText=e.data}fabric.document.getElementsByTagName("head")[0].appendChild(a);return function(c,d,b,g,h){function j(I){A.fillStyle=I||Cufon.textOptions.color||b.get("color");var H=I=0;if(g.textAlign==="right")A.translate(C[H],
0);else g.textAlign==="center"&&A.translate(C[H]/2,0);for(var J=0,P=u.length;J<P;++J)if(u[J]==="\n"){H++;var K=-c.ascent-c.ascent/5*g.lineHeight;if(g.textAlign==="right"){A.translate(-x,K);A.translate(C[H],0)}else if(g.textAlign==="center"){A.translate(-I-C[H-1]/2,K);A.translate(C[H]/2,0)}else A.translate(-I,K);I=0}else{var G=c.glyphs[u[J]]||c.missingGlyph;if(G){K=Number(G.w||c.w)+n;if(F){A.save();A.strokeStyle=A.fillStyle;A.lineWidth+=A.lineWidth;A.beginPath();if(F.underline){A.moveTo(0,-c.face["underline-position"]+
0.5);A.lineTo(K,-c.face["underline-position"]+0.5)}if(F.overline){A.moveTo(0,c.ascent+0.5);A.lineTo(K,c.ascent+0.5)}if(F["line-through"]){A.moveTo(0,-c.descent+0.5);A.lineTo(K,-c.descent+0.5)}A.stroke();A.restore()}if(L){A.save();A.transform(1,0,-0.25,1,0,0)}A.beginPath();if(G.d)if(G.code){var Q=G.code;G=A;for(var M=0,R=Q.length;M<R;++M){var O=Q[M];G[O.m].apply(G,O.a)}}else{Q=G;G="m"+G.d;M=A;O=R=0;var S=[],V=/([mrvxe])([^a-z]*)/g,U=void 0,T=0;a:for(;U=V.exec(G);++T){var N=U[2].split(",");switch(U[1]){case "v":S[T]=
{m:"bezierCurveTo",a:[R+~~N[0],O+~~N[1],R+~~N[2],O+~~N[3],R+=~~N[4],O+=~~N[5]]};break;case "r":S[T]={m:"lineTo",a:[R+=~~N[0],O+=~~N[1]]};break;case "m":S[T]={m:"moveTo",a:[R=~~N[0],O=~~N[1]]};break;case "x":S[T]={m:"closePath",a:[]};break;case "e":break a}M[S[T].m].apply(M,S[T].a)}Q.code=S}A.fill();if(g.strokeStyle){A.closePath();A.save();A.lineWidth=g.strokeWidth;A.strokeStyle=g.strokeStyle;A.stroke();A.restore()}L&&A.restore();A.translate(K,0);I+=K}}}var i=d===null,k=c.viewBox,m=b.getSize("fontSize",
c.baseSize),n=b.get("letterSpacing");n=n=="normal"?0:m.convertFrom(parseInt(n,10));var q=0,t=0,w=0,y=g.textShadow,s=[];Cufon.textOptions.shadowOffsets=[];Cufon.textOptions.shadows=null;if(y){Cufon.textOptions.shadows=y;for(var v=0,p=y.length;v<p;++v){var o=y[v],r=m.convertFrom(parseFloat(o.offX));o=m.convertFrom(parseFloat(o.offY));s[v]=[r,o]}}var u=Cufon.CSS.textTransform(i?h.alt:d,b).split(""),x=0;o=null;r=0;var z=1,B=[];v=0;for(p=u.length;v<p;++v)if(u[v]==="\n"){z++;if(x>r)r=x;B.push(x);x=0}else{var E=
c.glyphs[u[v]]||c.missingGlyph;if(E)x+=o=Number(E.w||c.w)+n}B.push(x);x=Math.max(r,x);var C=[];for(v=B.length;v--;)C[v]=x-B[v];if(o===null)return null;t+=k.width-o;w+=k.minX;if(i){i=h;h=h.firstChild}else{i=fabric.document.createElement("span");i.className="cufon cufon-canvas";i.alt=d;h=fabric.document.createElement("canvas");i.appendChild(h);if(g.printable){v=fabric.document.createElement("span");v.className="cufon-alt";v.appendChild(fabric.document.createTextNode(d));i.appendChild(v)}}d=i.style;
p=h.style||{};o=m.convert(k.height-q+0);v=Math.ceil(o);o=v/o;h.width=Math.ceil(m.convert(x+t-w)*o);h.height=v;q+=k.minY;p.top=Math.round(m.convert(q-c.ascent))+"px";p.left=Math.round(m.convert(w))+"px";t=Math.ceil(m.convert(x*o));p=t+"px";o=m.convert(c.height);m=(g.lineHeight-1)*m.convert(-c.ascent/5)*(z-1);Cufon.textOptions.width=t;Cufon.textOptions.height=o*z+m;Cufon.textOptions.lines=z;Cufon.textOptions.totalLineHeight=m;if(l){d.width=p;d.height=o+"px"}else{d.paddingLeft=p;d.paddingBottom=o-1+
"px"}var A=Cufon.textOptions.context||h.getContext("2d"),D=v/k.height;Cufon.textOptions.fontAscent=c.ascent*D;Cufon.textOptions.boundaries=null;k=Cufon.textOptions.shadowOffsets;for(v=s.length;v--;)k[v]=[s[v][0]*D,s[v][1]*D];A.save();A.scale(D,D);A.translate(-w-1/D*h.width/2+(Cufon.fonts[c.family].offsetLeft||0),-q-Cufon.textOptions.height/D/2+(Cufon.fonts[c.family].offsetTop||0));A.lineWidth=c.face["underline-thickness"];A.save();var F=Cufon.getTextDecoration(g),L=g.fontStyle==="italic";A.save();
(function(){A.save();var I=0,H=0,J=[{left:0}];if(g.backgroundColor){A.save();A.fillStyle=g.backgroundColor;A.translate(0,c.ascent);A.fillRect(0,0,x+10,(-c.ascent+c.descent)*z);A.restore()}if(g.textAlign==="right"){A.translate(C[H],0);J[0].left=C[H]*D}else if(g.textAlign==="center"){A.translate(C[H]/2,0);J[0].left=C[H]/2*D}for(var P=0,K=u.length;P<K;++P)if(u[P]==="\n"){H++;var G=-c.ascent-c.ascent/5*g.lineHeight,Q=J[J.length-1],M={left:0};Q.width=I*D;Q.height=(-c.ascent+c.descent)*D;if(g.textAlign===
"right"){A.translate(-x,G);A.translate(C[H],0);M.left=C[H]*D}else if(g.textAlign==="center"){A.translate(-I-C[H-1]/2,G);A.translate(C[H]/2,0);M.left=C[H]/2*D}else A.translate(-I,G);J.push(M);I=0}else if(G=c.glyphs[u[P]]||c.missingGlyph){G=Number(G.w||c.w)+n;if(g.textBackgroundColor){A.save();A.fillStyle=g.textBackgroundColor;A.translate(0,c.ascent);A.fillRect(0,0,G+10,-c.ascent+c.descent);A.restore()}A.translate(G,0);I+=G;if(P==K-1){J[J.length-1].width=I*D;J[J.length-1].height=(-c.ascent+c.descent)*
D}}A.restore();Cufon.textOptions.boundaries=J})();if(y){v=0;for(p=y.length;v<p;++v){o=y[v];A.save();A.translate.apply(A,s[v]);j(o.color);A.restore()}}j();A.restore();A.restore();A.restore();return i}}());
Cufon.registerEngine("vml",function(){function l(a,f){if(/px$/i.test(f))return parseFloat(f);var c=a.style.left,d=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;a.style.left=f;var b=a.style.pixelLeft;a.style.left=c;a.runtimeStyle.left=d;return b}if(fabric.document.namespaces){var e=fabric.document.createElement("canvas");if(!(e&&e.getContext&&e.getContext.apply)){fabric.document.namespaces.cvml==null&&fabric.document.namespaces.add("cvml","urn:schemas-microsoft-com:vml");e=fabric.document.createElement("cvml:shape");
e.style.behavior="url(#default#VML)";if(e.coordsize){e=null;fabric.document.write('<style type="text/css">.cufon-vml-canvas{text-indent:0}@media screen{cvml\\:shape,cvml\\:shadow{behavior:url(#default#VML);display:block;antialias:true;position:absolute}.cufon-vml-canvas{position:absolute;text-align:left}.cufon-vml{display:inline-block;position:relative;vertical-align:middle}.cufon-vml .cufon-alt{position:absolute;left:-10000in;font-size:1px}a .cufon-vml{cursor:pointer}}@media print{.cufon-vml *{display:none}.cufon-vml .cufon-alt{display:inline}}</style>');
return function(a,f,c,d,b,g,h){var j=f===null;if(j)f=b.alt;var i=a.viewBox,k;if(!(k=c.computedFontSize)){k=Cufon.CSS.Size;var m;m=c.get("fontSize");m=l(g,/(?:em|ex|%)$/i.test(m)?"1em":m);k=c.computedFontSize=new k(m+"px",a.baseSize)}k=k;m=c.computedLSpacing;if(m==undefined){m=c.get("letterSpacing");c.computedLSpacing=m=m=="normal"?0:~~k.convertFrom(l(g,m))}if(j){g=b;b=b.firstChild}else{g=fabric.document.createElement("span");g.className="cufon cufon-vml";g.alt=f;b=fabric.document.createElement("span");
b.className="cufon-vml-canvas";g.appendChild(b);if(d.printable){var n=fabric.document.createElement("span");n.className="cufon-alt";n.appendChild(fabric.document.createTextNode(f));g.appendChild(n)}h||g.appendChild(fabric.document.createElement("cvml:shape"))}h=g.style;var q=b.style,t=k.convert(i.height);n=Math.ceil(t);t=n/t;var w=i.minX,y=i.minY;q.height=n;q.top=Math.round(k.convert(y-a.ascent));q.left=Math.round(k.convert(w));h.height=k.convert(a.height)+"px";Cufon.getTextDecoration(d);q=c.get("color");
f=Cufon.CSS.textTransform(f,c).split("");var s=c=0,v=null,p;d=d.textShadow;for(var o=0,r=0,u=f.length;o<u;++o)if(p=a.glyphs[f[o]]||a.missingGlyph)c+=v=~~(p.w||a.w)+m;if(v===null)return null;p=-w+c+(i.width-v);o=k.convert(p*t);v=Math.round(o);var x=p+","+i.height,z,B="r"+x+"nsnf";for(o=0;o<u;++o)if(p=a.glyphs[f[o]]||a.missingGlyph){if(j){i=b.childNodes[r];i.firstChild&&i.removeChild(i.firstChild)}else{i=fabric.document.createElement("cvml:shape");b.appendChild(i)}i.stroked="f";i.coordsize=x;i.coordorigin=
z=w-s+","+y;i.path=(p.d?"m"+p.d+"xe":"")+"m"+z+B;i.fillcolor=q;z=i.style;z.width=v;z.height=n;if(d){z=d[0];var E=d[1],C=Cufon.CSS.color(z.color),A,D=fabric.document.createElement("cvml:shadow");D.on="t";D.color=C.color;D.offset=z.offX+","+z.offY;if(E){A=Cufon.CSS.color(E.color);D.type="double";D.color2=A.color;D.offset2=E.offX+","+E.offY}D.opacity=C.opacity||A&&A.opacity||1;i.appendChild(D)}s+=~~(p.w||a.w)+m;++r}h.width=Math.max(Math.ceil(k.convert(c*t)),0);return g}}}}}());
Cufon.getTextDecoration=function(l){return{underline:l.textDecoration==="underline",overline:l.textDecoration==="overline","line-through":l.textDecoration==="line-through"}};if(typeof exports!="undefined")exports.Cufon=Cufon;var JSON;JSON||(JSON={});
(function(){function l(j){return j<10?"0"+j:j}function e(j){c.lastIndex=0;return c.test(j)?'"'+j.replace(c,function(i){var k=g[i];return typeof k==="string"?k:"\\u"+("0000"+i.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+j+'"'}function a(j,i){var k,m,n,q,t=d,w,y=i[j];if(y&&typeof y==="object"&&typeof y.toJSON==="function")y=y.toJSON(j);if(typeof h==="function")y=h.call(i,j,y);switch(typeof y){case "string":return e(y);case "number":return isFinite(y)?String(y):"null";case "boolean":case "null":return String(y);
case "object":if(!y)return"null";d+=b;w=[];if(Object.prototype.toString.apply(y)==="[object Array]"){q=y.length;for(k=0;k<q;k+=1)w[k]=a(k,y)||"null";n=w.length===0?"[]":d?"[\n"+d+w.join(",\n"+d)+"\n"+t+"]":"["+w.join(",")+"]";d=t;return n}if(h&&typeof h==="object"){q=h.length;for(k=0;k<q;k+=1)if(typeof h[k]==="string"){m=h[k];if(n=a(m,y))w.push(e(m)+(d?": ":":")+n)}}else for(m in y)if(Object.prototype.hasOwnProperty.call(y,m))if(n=a(m,y))w.push(e(m)+(d?": ":":")+n);n=w.length===0?"{}":d?"{\n"+d+w.join(",\n"+
d)+"\n"+t+"}":"{"+w.join(",")+"}";d=t;return n}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+l(this.getUTCMonth()+1)+"-"+l(this.getUTCDate())+"T"+l(this.getUTCHours())+":"+l(this.getUTCMinutes())+":"+l(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,d,b,g={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;if(typeof JSON.stringify!=="function")JSON.stringify=function(j,i,k){var m;b=d="";if(typeof k==="number")for(m=0;m<k;m+=1)b+=" ";else if(typeof k==="string")b=k;if((h=i)&&typeof i!=="function"&&(typeof i!=="object"||typeof i.length!=="number"))throw Error("JSON.stringify");return a("",
{"":j})};if(typeof JSON.parse!=="function")JSON.parse=function(j,i){function k(n,q){var t,w,y=n[q];if(y&&typeof y==="object")for(t in y)if(Object.prototype.hasOwnProperty.call(y,t)){w=k(y,t);if(w!==undefined)y[t]=w;else delete y[t]}return i.call(n,q,y)}var m;j=String(j);f.lastIndex=0;if(f.test(j))j=j.replace(f,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(j.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){m=eval("("+j+")");return typeof i==="function"?k({"":m},""):m}throw new SyntaxError("JSON.parse");}})();if(typeof Event==="undefined")var Event={};if(typeof eventjs==="undefined")var eventjs=Event;
Event=function(l){l.modifyEventListener=false;l.modifySelectors=false;l.add=function(k,m,n,q){return a(k,m,n,q,"add")};l.remove=function(k,m,n,q){return a(k,m,n,q,"remove")};l.stop=function(k){k.stopPropagation&&k.stopPropagation();k.cancelBubble=true;k.bubble=0};l.prevent=function(k){k.preventDefault&&k.preventDefault();k.returnValue=false};l.cancel=function(k){l.stop(k);l.prevent(k)};l.supports=function(k,m){if(typeof k==="string"){m=k;k=window}m="on"+m;if(m in k)return true;k.setAttribute||(k=
document.createElement("div"));if(k.setAttribute&&k.removeAttribute){k.setAttribute(m,"");var n=typeof k[m]==="function";if(typeof k[m]!=="undefined")k[m]=null;k.removeAttribute(m);return n}};var e=function(k){if(!k||typeof k!=="object")return k;var m=new k.constructor;for(var n in k)m[n]=!k[n]||typeof k[n]!=="object"?k[n]:e(k[n]);return m},a=function(k,m,n,q,t,w){q=q||{};if(typeof k==="string"&&m==="ready")var y=(new Date).getTime(),s=q.timeout,v=window.setInterval(function(){(new Date).getTime()-
y>s&&window.clearInterval(v);if(document.querySelector(k)){window.clearInterval(v);n()}},q.interval||1E3/60);else{if(typeof k==="string"){k=document.querySelectorAll(k);if(k.length===0)return c("Missing target on listener!");if(k.length===1)k=k[0]}var p={};if(k.length>0){for(var o=0,r=k.length;o<r;o++)if(w=a(k[o],m,n,e(q),t))p[o]=w;return f(p)}if(m.indexOf&&m.indexOf(" ")!==-1)m=m.split(" ");if(m.indexOf&&m.indexOf(",")!==-1)m=m.split(",");if(typeof m!=="string"){if(typeof m.length==="number"){o=
0;for(r=m.length;o<r;o++)if(w=a(k,m[o],n,e(q),t))p[m[o]]=w}else for(o in m)if(w=typeof m[o]==="function"?a(k,o,m[o],e(q),t):a(k,o,m[o].listener,e(m[o]),t))p[o]=w;return f(p)}if(typeof n!=="function")return c("Listener is not a function!");p=q.useCapture||false;o=d(m)+h(k)+"."+h(n)+"."+(p?1:0);if(l.Gesture&&l.Gesture._gestureHandlers[m])if(t==="remove"){if(!b[o])return;b[o].remove();delete b[o]}else{if(t==="add"){if(b[o])return b[o];if(q.useCall&&!l.modifyEventListener){var u=n;n=function(x,z){for(var B in z)x[B]=
z[B];return u.call(k,x)}}q.gesture=m;q.target=k;q.listener=n;q.fromOverwrite=w;b[o]=l.proxy[m](q)}}else{m=d(m);if(t==="remove"){if(!b[o])return;k[i](m,n,p);delete b[o]}else if(t==="add"){if(b[o])return b[o];k[j](m,n,p);b[o]={type:m,target:k,listener:n,remove:function(){l.remove(k,m,n,q)}}}}return b[o]}},f=function(k){return{remove:function(){for(var m in k)k[m].remove()},add:function(){for(var m in k)k[m].add()}}},c=function(k){typeof console!=="undefined"&&typeof console.error!=="undefined"&&console.error(k)},
d=function(){var k={};return function(m){if(!l.pointerType)if(window.navigator.msPointerEnabled){l.pointerType="mspointer";k={mousedown:"MSPointerDown",mousemove:"MSPointerMove",mouseup:"MSPointerUp"}}else if(l.supports("touchstart")){l.pointerType="touch";k={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"}}else l.pointerType="mouse";if(k[m])m=k[m];return document.addEventListener?m:"on"+m}}(),b={},g=0,h=function(k){if(k===window)return"#window";if(k===document)return"#document";if(!k)return c("Missing target on listener!");
if(!k.uniqueID)k.uniqueID="id"+g++;return k.uniqueID},j=document.addEventListener?"addEventListener":"attachEvent",i=document.removeEventListener?"removeEventListener":"detachEvent";l.createPointerEvent=function(k,m,n){var q=m.gesture,t=m.target,w=k.changedTouches||l.proxy.getCoords(k);if(w.length){var y=w[0];m.pointers=n?[]:w;m.pageX=y.pageX;m.pageY=y.pageY;m.x=m.pageX;m.y=m.pageY}n=document.createEvent("Event");n.initEvent(q,true,true);n.originalEvent=k;for(var s in m)if(s!=="target")n[s]=m[s];
t.dispatchEvent(n)};l.modifyEventListener&&window.HTMLElement&&function(){var k=function(m){var n=function(q){var t=q+"EventListener",w=m[t];m[t]=function(y,s,v){if(l.Gesture&&l.Gesture._gestureHandlers[y]){var p=v;if(typeof v==="object")p.useCall=true;else p={useCall:true,useCapture:v};a(this,y,s,p,q,true);w.call(this,y,s,v)}else w.call(this,d(y),s,v)}};n("add");n("remove")};if(navigator.userAgent.match(/Firefox/)){k(HTMLDivElement.prototype);k(HTMLCanvasElement.prototype)}else k(HTMLElement.prototype);
k(document);k(window)}();l.modifySelectors&&function(){var k=NodeList.prototype;k.removeEventListener=function(m,n,q){for(var t=0,w=this.length;t<w;t++)this[t].removeEventListener(m,n,q)};k.addEventListener=function(m,n,q){for(var t=0,w=this.length;t<w;t++)this[t].addEventListener(m,n,q)}}();return l}(Event);if(typeof Event==="undefined")Event={};if(typeof Event.proxy==="undefined")Event.proxy={};
Event.proxy=function(l){l.pointerSetup=function(e,a){e.doc=e.target.ownerDocument||e.target;e.minFingers=e.minFingers||e.fingers||1;e.maxFingers=e.maxFingers||e.fingers||Infinity;e.position=e.position||"relative";delete e.fingers;a=a||{};a.gesture=e.gesture;a.target=e.target;a.pointerType=Event.pointerType;if(Event.modifyEventListener&&e.fromOverwrite)e.listener=Event.createPointerEvent;var f=0,c=a.gesture.indexOf("pointer")===0&&Event.modifyEventListener?"pointer":"mouse";a.listener=e.listener;a.proxy=
function(d){a.defaultListener=e.listener;e.listener=d;d(e.event,a)};a.remove=function(){e.onPointerDown&&Event.remove(e.target,c+"down",e.onPointerDown);e.onPointerMove&&Event.remove(e.doc,c+"move",e.onPointerMove);e.onPointerUp&&Event.remove(e.doc,c+"up",e.onPointerUp)};a.resume=function(d){if(e.onPointerMove&&(!d||d.move))Event.add(e.doc,c+"move",e.onPointerMove);if(e.onPointerUp&&(!d||d.move))Event.add(e.doc,c+"up",e.onPointerUp);e.fingers=f};a.pause=function(d){f=e.fingers;if(e.onPointerMove&&
(!d||d.move))Event.remove(e.doc,c+"move",e.onPointerMove);if(e.onPointerUp&&(!d||d.up))Event.remove(e.doc,c+"up",e.onPointerUp);e.fingers=0};return a};l.pointerStart=function(e,a,f){var c=function(n,q){var t=f.bbox,w=b[q]={};switch(f.position){case "absolute":w.offsetX=0;w.offsetY=0;break;case "difference":w.offsetX=n.pageX;w.offsetY=n.pageY;break;case "move":w.offsetX=n.pageX-t.x1;w.offsetY=n.pageY-t.y1;break;default:w.offsetX=t.x1;w.offsetY=t.y1;break}if(f.position==="relative"){var y=(n.pageX+
t.scrollLeft-w.offsetX)*t.scaleX;t=(n.pageY+t.scrollTop-w.offsetY)*t.scaleY}else{y=n.pageX-w.offsetX;t=n.pageY-w.offsetY}w.rotation=0;w.scale=1;w.startTime=w.moveTime=(new Date).getTime();w.move={x:y,y:t};w.start={x:y,y:t};f.fingers++};f.event=e;if(a.defaultListener){f.listener=a.defaultListener;delete a.defaultListener}var d=!f.fingers,b=f.tracker;e=e.changedTouches||l.getCoords(e);for(var g=e.length,h=0;h<g;h++){var j=e[h],i=j.identifier||Infinity;if(f.fingers){if(f.fingers>=f.maxFingers){c=[];
for(i in f.tracker)c.push(i);a.identifier=c.join(",");return d}var k=0;for(var m in b){if(b[m].up){delete b[m];c(j,i);f.cancel=true;break}k++}if(b[i])continue}else{b=f.tracker={};a.bbox=f.bbox=l.getBoundingBox(f.target);f.fingers=0;f.cancel=false}c(j,i)}c=[];for(i in f.tracker)c.push(i);a.identifier=c.join(",");return d};l.pointerEnd=function(e,a,f,c){var d=e.touches||[],b=d.length;e={};for(var g=0;g<b;g++){var h=d[g].identifier;e[h||Infinity]=true}for(h in f.tracker){d=f.tracker[h];if(!(e[h]||d.up)){if(c)c({pageX:d.pageX,
pageY:d.pageY,changedTouches:[{pageX:d.pageX,pageY:d.pageY,identifier:h==="Infinity"?Infinity:h}]},"up");d.up=true;f.fingers--}}if(f.fingers!==0)return false;c=[];f.gestureFingers=0;for(h in f.tracker){f.gestureFingers++;c.push(h)}a.identifier=c.join(",");return true};l.getCoords=function(e){l.getCoords=typeof e.pageX!=="undefined"?function(a){return Array({type:"mouse",x:a.pageX,y:a.pageY,pageX:a.pageX,pageY:a.pageY,identifier:Infinity})}:function(a){a=a||window.event;return Array({type:"mouse",
x:a.clientX+document.documentElement.scrollLeft,y:a.clientY+document.documentElement.scrollTop,pageX:a.clientX+document.documentElement.scrollLeft,pageY:a.clientY+document.documentElement.scrollTop,identifier:Infinity})};return l.getCoords(e)};l.getCoord=function(e){if("ontouchstart"in window){var a=0,f=0;l.getCoord=function(c){c=c.changedTouches;return c.length?{x:a=c[0].pageX,y:f=c[0].pageY}:{x:a,y:f}}}else l.getCoord=typeof e.pageX!=="undefined"&&typeof e.pageY!=="undefined"?function(c){return{x:c.pageX,
y:c.pageY}}:function(c){c=c||window.event;return{x:c.clientX+document.documentElement.scrollLeft,y:c.clientY+document.documentElement.scrollTop}};return l.getCoord(e)};l.getBoundingBox=function(e){if(e===window||e===document)e=document.body;var a={x1:0,y1:0,x2:0,y2:0,scrollLeft:0,scrollTop:0};if(e===document.body){a.height=window.innerHeight;a.width=window.innerWidth}else{a.height=e.offsetHeight;a.width=e.offsetWidth}a.scaleX=e.width/a.width||1;a.scaleY=e.height/a.height||1;for(var f=e;f!==null;){a.x1+=
f.offsetLeft;a.y1+=f.offsetTop;f=f.offsetParent}for(f=e.parentNode;f!==null;){if(f===document.body)break;if(f.scrollTop===undefined)break;a.scrollLeft+=f.scrollLeft;a.scrollTop+=f.scrollTop;f=f.parentNode}a.x2=a.x1+a.width;a.y2=a.y1+a.height;return a};(function(){var e=navigator.userAgent.toLowerCase(),a=e.indexOf("macintosh")!==-1,f=a&&e.indexOf("khtml")!==-1?{91:true,93:true}:a&&e.indexOf("firefox")!==-1?{224:true}:{17:true};l.isMetaKey=function(c){return!!f[c.keyCode]};l.metaTracker=function(c){if(f[c.keyCode])l.metaKey=
c.type==="keydown"}})();return l}(Event.proxy);if(typeof Event==="undefined")Event={};if(typeof Event.proxy==="undefined")Event.proxy={};
Event.proxy=function(l){l.click=function(e){e.maxFingers=e.maxFingers||e.fingers||1;var a;e.onPointerDown=function(c){if(l.pointerStart(c,f,e)){Event.add(e.doc,"mousemove",e.onPointerMove).listener(c);Event.add(e.doc,"mouseup",e.onPointerUp)}};e.onPointerMove=function(c){a=c};e.onPointerUp=function(c){if(l.pointerEnd(c,f,e)){Event.remove(e.doc,"mousemove",e.onPointerMove);Event.remove(e.doc,"mouseup",e.onPointerUp);if(!(a.cancelBubble&&++a.bubble>1)){var d=(a.changedTouches||l.getCoords(a))[0];c=
e.bbox;var b=l.getBoundingBox(e.target);if(e.position==="relative"){var g=(d.pageX+c.scrollLeft-c.x1)*c.scaleX;d=(d.pageY+c.scrollTop-c.y1)*c.scaleY}else{g=d.pageX-c.x1;d=d.pageY-c.y1}g>0&&g<c.width&&d>0&&d<c.height&&c.scrollTop===b.scrollTop&&e.listener(a,f)}}};var f=l.pointerSetup(e);f.state="click";Event.add(e.target,"mousedown",e.onPointerDown);return f};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.click=l.click;
return l}(Event.proxy);if(typeof Event==="undefined")Event={};if(typeof Event.proxy==="undefined")Event.proxy={};
Event.proxy=function(l){l.dbltap=l.dblclick=function(e){e.maxFingers=e.maxFingers||e.fingers||1;var a,f,c,d,b;e.onPointerDown=function(h){var j=h.changedTouches||l.getCoords(h);if(a&&!f){b=j[0];f=(new Date).getTime()-a}else{d=j[0];a=(new Date).getTime();f=0;clearTimeout(c);c=setTimeout(function(){a=0},700)}if(l.pointerStart(h,g,e)){Event.add(e.doc,"mousemove",e.onPointerMove).listener(h);Event.add(e.doc,"mouseup",e.onPointerUp)}};e.onPointerMove=function(h){if(a&&!f)b=(h.changedTouches||l.getCoords(h))[0];
h=e.bbox;if(e.position==="relative")var j=(b.pageX+h.scrollLeft-h.x1)*h.scaleX,i=(b.pageY+h.scrollTop-h.y1)*h.scaleY;else{j=b.pageX-h.x1;i=b.pageY-h.y1}if(!(j>0&&j<h.width&&i>0&&i<h.height&&Math.abs(b.pageX-d.pageX)<=25&&Math.abs(b.pageY-d.pageY)<=25)){Event.remove(e.doc,"mousemove",e.onPointerMove);clearTimeout(c);a=f=0}};e.onPointerUp=function(h){if(l.pointerEnd(h,g,e)){Event.remove(e.doc,"mousemove",e.onPointerMove);Event.remove(e.doc,"mouseup",e.onPointerUp)}if(a&&f){if(f<=700&&!(h.cancelBubble&&
++h.bubble>1)){g.state=e.gesture;e.listener(h,g)}clearTimeout(c);a=f=0}};var g=l.pointerSetup(e);g.state="dblclick";Event.add(e.target,"mousedown",e.onPointerDown);return g};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.dbltap=l.dbltap;Event.Gesture._gestureHandlers.dblclick=l.dblclick;return l}(Event.proxy);if(typeof Event==="undefined")Event={};if(typeof Event.proxy==="undefined")Event.proxy={};
Event.proxy=function(l){l.dragElement=function(e,a){l.drag({event:a,target:e,position:"move",listener:function(f,c){e.style.left=c.x+"px";e.style.top=c.y+"px";Event.prevent(f)}})};l.drag=function(e){e.gesture="drag";e.onPointerDown=function(f){if(l.pointerStart(f,a,e))if(!e.monitor){Event.add(e.doc,"mousemove",e.onPointerMove);Event.add(e.doc,"mouseup",e.onPointerUp)}e.onPointerMove(f,"down")};e.onPointerMove=function(f,c){if(!e.tracker)return e.onPointerDown(f);for(var d=e.bbox,b=f.changedTouches||
l.getCoords(f),g=b.length,h=0;h<g;h++){var j=b[h],i=j.identifier||Infinity,k=e.tracker[i];if(k){k.pageX=j.pageX;k.pageY=j.pageY;a.state=c||"move";a.identifier=i;a.start=k.start;a.fingers=e.fingers;if(e.position==="relative"){a.x=(k.pageX+d.scrollLeft-k.offsetX)*d.scaleX;a.y=(k.pageY+d.scrollTop-k.offsetY)*d.scaleY}else{a.x=k.pageX-k.offsetX;a.y=k.pageY-k.offsetY}e.listener(f,a)}}};e.onPointerUp=function(f){if(l.pointerEnd(f,a,e,e.onPointerMove))if(!e.monitor){Event.remove(e.doc,"mousemove",e.onPointerMove);
Event.remove(e.doc,"mouseup",e.onPointerUp)}};var a=l.pointerSetup(e);if(e.event)e.onPointerDown(e.event);else{Event.add(e.target,"mousedown",e.onPointerDown);if(e.monitor){Event.add(e.doc,"mousemove",e.onPointerMove);Event.add(e.doc,"mouseup",e.onPointerUp)}}return a};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.drag=l.drag;return l}(Event.proxy);if(typeof Event==="undefined")Event={};
if(typeof Event.proxy==="undefined")Event.proxy={};
Event.proxy=function(l){var e=Math.PI/180;l.gesture=function(a){a.minFingers=a.minFingers||a.fingers||2;a.onPointerDown=function(c){var d=a.fingers;if(l.pointerStart(c,f,a)){Event.add(a.doc,"mousemove",a.onPointerMove);Event.add(a.doc,"mouseup",a.onPointerUp)}if(a.fingers===a.minFingers&&d!==a.fingers){f.fingers=a.minFingers;f.scale=1;f.rotation=0;f.state="start";d="";for(var b in a.tracker)d+=b;f.identifier=parseInt(d);a.listener(c,f)}};a.onPointerMove=function(c){for(var d=a.bbox,b=a.tracker,g=
c.changedTouches||l.getCoords(c),h=g.length,j=0;j<h;j++){var i=g[j],k=i.identifier||Infinity,m=b[k];if(m)if(a.position==="relative"){m.move.x=(i.pageX+d.scrollLeft-d.x1)*d.scaleX;m.move.y=(i.pageY+d.scrollTop-d.y1)*d.scaleY}else{m.move.x=i.pageX-d.x1;m.move.y=i.pageY-d.y1}}if(!(a.fingers<a.minFingers)){g=[];var n=m=j=d=0;h=0;for(k in b){i=b[k];if(!i.up){m+=i.move.x;n+=i.move.y;h++}}m/=h;n/=h;for(k in b){i=b[k];if(!i.up){h=i.start;if(!h.distance){var q=h.x-m,t=h.y-n;h.distance=Math.sqrt(q*q+t*t);h.angle=
Math.atan2(q,t)/e}q=i.move.x-m;t=i.move.y-n;d+=Math.sqrt(q*q+t*t)/h.distance;h=(h.angle-Math.atan2(q,t)/e+360)%360-180;i.DEG2=i.DEG1;i.DEG1=h>0?h:-h;if(typeof i.DEG2!=="undefined"){if(h>0)i.rotation+=i.DEG1-i.DEG2;else i.rotation-=i.DEG1-i.DEG2;j+=i.rotation}g.push(i.move)}}f.touches=g;f.fingers=a.fingers;f.scale=d/a.fingers;f.rotation=j/a.fingers;f.state="change";a.listener(c,f)}};a.onPointerUp=function(c){var d=a.fingers;if(l.pointerEnd(c,f,a)){Event.remove(a.doc,"mousemove",a.onPointerMove);Event.remove(a.doc,
"mouseup",a.onPointerUp)}if(d===a.minFingers&&a.fingers<a.minFingers){f.fingers=a.fingers;f.state="end";a.listener(c,f)}};var f=l.pointerSetup(a);Event.add(a.target,"mousedown",a.onPointerDown);return f};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.gesture=l.gesture;return l}(Event.proxy);if(typeof Event==="undefined")Event={};if(typeof Event.proxy==="undefined")Event.proxy={};
Event.proxy=function(l){l.pointerdown=l.pointermove=l.pointerup=function(e){if(!e.target.isPointerEmitter){var a=true;e.onPointerDown=function(c){a=false;f.gesture="pointerdown";e.listener(c,f)};e.onPointerMove=function(c){f.gesture="pointermove";e.listener(c,f,a)};e.onPointerUp=function(c){a=true;f.gesture="pointerup";e.listener(c,f,true)};var f=l.pointerSetup(e);Event.add(e.target,"mousedown",e.onPointerDown);Event.add(e.target,"mousemove",e.onPointerMove);Event.add(e.doc,"mouseup",e.onPointerUp);
e.target.isPointerEmitter=true;return f}};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.pointerdown=l.pointerdown;Event.Gesture._gestureHandlers.pointermove=l.pointermove;Event.Gesture._gestureHandlers.pointerup=l.pointerup;return l}(Event.proxy);if(typeof Event==="undefined")Event={};if(typeof Event.proxy==="undefined")Event.proxy={};
Event.proxy=function(l){l.shake=function(e){var a={gesture:"devicemotion",acceleration:{},accelerationIncludingGravity:{},target:e.target,listener:e.listener,remove:function(){window.removeEventListener("devicemotion",b,false)}},f=(new Date).getTime(),c={x:0,y:0,z:0},d={x:{count:0,value:0},y:{count:0,value:0},z:{count:0,value:0}},b=function(g){var h=g.accelerationIncludingGravity;c.x=0.8*c.x+(1-0.8)*h.x;c.y=0.8*c.y+(1-0.8)*h.y;c.z=0.8*c.z+(1-0.8)*h.z;a.accelerationIncludingGravity=c;a.acceleration.x=
h.x-c.x;a.acceleration.y=h.y-c.y;a.acceleration.z=h.z-c.z;if(e.gesture==="devicemotion")e.listener(g,a);else{h=(new Date).getTime();for(var j=0;j<3;j++){var i="xyz"[j],k=a.acceleration[i];i=d[i];var m=Math.abs(k);if(!(h-f<1E3))if(m>4){k=h*k/m;m=Math.abs(k+i.value);if(i.value&&m<200){i.value=k;i.count++;if(i.count===3){e.listener(g,a);f=h;i.value=0;i.count=0}}else{i.value=k;i.count=1}}}}};if(window.addEventListener){window.addEventListener("devicemotion",b,false);return a}};Event.Gesture=Event.Gesture||
{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.shake=l.shake;return l}(Event.proxy);if(typeof Event==="undefined")Event={};if(typeof Event.proxy==="undefined")Event.proxy={};
Event.proxy=function(l){var e=Math.PI/180;l.swipe=function(a){a.snap=a.snap||90;a.threshold=a.threshold||1;a.onPointerDown=function(c){if(l.pointerStart(c,f,a)){Event.add(a.doc,"mousemove",a.onPointerMove).listener(c);Event.add(a.doc,"mouseup",a.onPointerUp)}};a.onPointerMove=function(c){c=c.changedTouches||l.getCoords(c);for(var d=c.length,b=0;b<d;b++){var g=c[b],h=a.tracker[g.identifier||Infinity];if(h){h.move.x=g.pageX;h.move.y=g.pageY;h.moveTime=(new Date).getTime()}}};a.onPointerUp=function(c){if(l.pointerEnd(c,
f,a)){Event.remove(a.doc,"mousemove",a.onPointerMove);Event.remove(a.doc,"mouseup",a.onPointerUp);var d,b,g,h,j={x:0,y:0},i=0,k=0,m=0;for(var n in a.tracker){var q=a.tracker[n];h=q.move.x-q.start.x;var t=q.move.y-q.start.y;i+=q.move.x;k+=q.move.y;j.x+=q.start.x;j.y+=q.start.y;m++;b=Math.sqrt(h*h+t*t);q=q.moveTime-q.startTime;h=Math.atan2(h,t)/e+180;b=q?b/q:0;if(typeof g==="undefined"){g=h;d=b}else if(Math.abs(h-g)<=20){g=(g+h)/2;d=(d+b)/2}else return}if(d>a.threshold){j.x/=m;j.y/=m;f.start=j;f.x=
i/m;f.y=k/m;f.angle=-(((g/a.snap+0.5>>0)*a.snap||360)-360);f.velocity=d;f.fingers=a.gestureFingers;f.state="swipe";a.listener(c,f)}}};var f=l.pointerSetup(a);Event.add(a.target,"mousedown",a.onPointerDown);return f};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.swipe=l.swipe;return l}(Event.proxy);if(typeof Event==="undefined")Event={};if(typeof Event.proxy==="undefined")Event.proxy={};
Event.proxy=function(l){l.tap=l.longpress=function(e){e.delay=e.delay||500;e.timeout=e.timeout||250;var a,f;e.onPointerDown=function(d){if(l.pointerStart(d,c,e)){a=(new Date).getTime();Event.add(e.doc,"mousemove",e.onPointerMove).listener(d);Event.add(e.doc,"mouseup",e.onPointerUp);if(e.gesture==="longpress")f=setTimeout(function(){if(!(d.cancelBubble&&++d.bubble>1)){var b=0;for(var g in e.tracker){if(e.tracker[g].end===true)return;if(e.cancel)return;b++}c.state="start";c.fingers=b;e.listener(d,c)}},
e.delay)}};e.onPointerMove=function(d){var b=e.bbox;d=d.changedTouches||l.getCoords(d);for(var g=d.length,h=0;h<g;h++){var j=d[h],i=e.tracker[j.identifier||Infinity];if(i){if(e.position==="relative"){var k=(j.pageX+b.scrollLeft-b.x1)*b.scaleX;j=(j.pageY+b.scrollTop-b.y1)*b.scaleY}else{k=j.pageX-b.x1;j=j.pageY-b.y1}if(!(k>0&&k<b.width&&j>0&&j<b.height&&Math.abs(k-i.start.x)<=25&&Math.abs(j-i.start.y)<=25)){Event.remove(e.doc,"mousemove",e.onPointerMove);e.cancel=true;return}}}};e.onPointerUp=function(d){if(l.pointerEnd(d,
c,e)){clearTimeout(f);Event.remove(e.doc,"mousemove",e.onPointerMove);Event.remove(e.doc,"mouseup",e.onPointerUp);if(!(d.cancelBubble&&++d.bubble>1))if(e.gesture==="longpress"){if(c.state==="start"){c.state="end";e.listener(d,c)}}else if(!e.cancel)if(!((new Date).getTime()-a>e.timeout)){c.state="tap";c.fingers=e.gestureFingers;e.listener(d,c)}}};var c=l.pointerSetup(e);Event.add(e.target,"mousedown",e.onPointerDown);return c};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||
{};Event.Gesture._gestureHandlers.tap=l.tap;Event.Gesture._gestureHandlers.longpress=l.longpress;return l}(Event.proxy);if(typeof Event==="undefined")Event={};if(typeof Event.proxy==="undefined")Event.proxy={};
Event.proxy=function(l){l.wheel=function(e){var a,f=e.timeout||150,c=0,d={gesture:"wheel",state:"start",wheelDelta:0,target:e.target,listener:e.listener,remove:function(){e.target[h](j,b,false)}},b=function(i){i=i||window.event;d.state=c++?"change":"start";d.wheelDelta=i.detail?i.detail*-20:i.wheelDelta;e.listener(i,d);clearTimeout(a);a=setTimeout(function(){c=0;d.state="end";d.wheelDelta=0;e.listener(i,d)},f)},g=document.addEventListener?"addEventListener":"attachEvent",h=document.removeEventListener?
"removeEventListener":"detachEvent",j=Event.supports("mousewheel")?"mousewheel":"DOMMouseScroll";e.target[g](j,b,false);return d};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.wheel=l.wheel;return l}(Event.proxy);fabric.log=function(){};fabric.warn=function(){};
if(typeof console!=="undefined"){if(typeof console.log!=="undefined"&&console.log.apply)fabric.log=function(){return console.log.apply(console,arguments)};if(typeof console.warn!=="undefined"&&console.warn.apply)fabric.warn=function(){return console.warn.apply(console,arguments)}}
(function(){function l(c,d){if(this.__eventListeners[c])if(d)fabric.util.removeFromArray(this.__eventListeners[c],d);else this.__eventListeners[c].length=0}function e(c,d){if(!this.__eventListeners)this.__eventListeners={};if(arguments.length===1)for(var b in c)this.on(b,c[b]);else{this.__eventListeners[c]||(this.__eventListeners[c]=[]);this.__eventListeners[c].push(d)}return this}function a(c,d){if(this.__eventListeners){if(arguments.length===1&&typeof arguments[0]==="object")for(var b in c)l.call(this,
b,c[b]);else l.call(this,c,d);return this}}function f(c,d){if(this.__eventListeners){var b=this.__eventListeners[c];if(b){for(var g=0,h=b.length;g<h;g++)b[g].call(this,d||{});return this}}}fabric.Observable={observe:e,stopObserving:a,fire:f,on:e,off:a,trigger:f}})();
fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var l=arguments.length;l--;)this._onObjectAdded(arguments[l]);this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(l,e,a){var f=this.getObjects();if(a)f[e]=l;else f.splice(e,0,l);this._onObjectAdded(l);this.renderOnAddRemove&&this.renderAll();return this},remove:function(l){var e=this.getObjects(),a=e.indexOf(l);if(a!==-1){e.splice(a,1);this._onObjectRemoved(l)}this.renderOnAddRemove&&this.renderAll();
return l},forEachObject:function(l,e){for(var a=this.getObjects(),f=a.length;f--;)l.call(e,a[f],f,a);return this},item:function(l){return this.getObjects()[l]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},contains:function(l){return this.getObjects().indexOf(l)>-1},complexity:function(){return this.getObjects().reduce(function(l,e){l+=e.complexity?e.complexity():0;return l},0)},toGrayscale:function(){return this.forEachObject(function(l){l.toGrayscale()})}};
(function(){function l(i){if(!i)return fabric;i=i.split(".");for(var k=i.length,m=fabric.window,n=0;n<k;++n)m=m[i[n]];return m}function e(i,k,m,n,q,t,w,y,s){j=h.call(arguments);if(b[j])return b[j];var v=w*(Math.PI/180),p=Math.sin(v);v=Math.cos(v);m=Math.abs(m);n=Math.abs(n);var o=v*(y-i)*0.5+p*(s-k)*0.5,r=v*(s-k)*0.5-p*(y-i)*0.5;o=o*o/(m*m)+r*r/(n*n);if(o>1){o=Math.sqrt(o);m*=o;n*=o}var u=v/m,x=p/m,z=-p/n,B=v/n;o=u*y+x*s;r=z*y+B*s;u=u*i+x*k;x=z*i+B*k;z=1/((u-o)*(u-o)+(x-r)*(x-r))-0.25;if(z<0)z=0;
B=Math.sqrt(z);if(t===q)B=-B;z=0.5*(o+u)-B*(x-r);B=0.5*(r+x)+B*(u-o);o=Math.atan2(r-B,o-z);r=Math.atan2(x-B,u-z)-o;if(r<0&&t===1)r+=2*Math.PI;else if(r>0&&t===0)r-=2*Math.PI;u=Math.ceil(Math.abs(r/(Math.PI*0.5+0.001)));x=[];for(var E=0;E<u;E++)x[E]=[z,B,o+E*r/u,o+(E+1)*r/u,m,n,p,v];return b[j]=x}function a(i,k,m,n,q,t,w,y){j=h.call(arguments);if(g[j])return g[j];var s=y*q,v=-w*t,p=w*q,o=y*t,r=0.5*(n-m),u=8/3*Math.sin(r*0.5)*Math.sin(r*0.5)/Math.sin(r);r=i+Math.cos(m)-u*Math.sin(m);var x=k+Math.sin(m)+
u*Math.cos(m),z=i+Math.cos(n),B=k+Math.sin(n),E=z+u*Math.sin(n);u=B-u*Math.cos(n);g[j]=[s*r+v*x,p*r+o*x,s*E+v*u,p*E+o*u,s*z+v*B,p*z+o*B];return g[j]}var f=Math.sqrt,c=Math.atan2;fabric.util={};var d=Math.PI/180,b={},g={},h=Array.prototype.join,j;fabric.util.removeFromArray=function(i,k){var m=i.indexOf(k);m!==-1&&i.splice(m,1);return i};fabric.util.degreesToRadians=function(i){return i*d};fabric.util.radiansToDegrees=function(i){return i/d};fabric.util.rotatePoint=function(i,k,m){var n=Math.sin(m);
m=Math.cos(m);i.subtractEquals(k);return(new fabric.Point(i.x*m-i.y*n,i.x*n+i.y*m)).addEquals(k)};fabric.util.toFixed=function(i,k){return parseFloat(Number(i).toFixed(k))};fabric.util.getRandomInt=function(i,k){return Math.floor(Math.random()*(k-i+1))+i};fabric.util.falseFunction=function(){return false};fabric.util.getKlass=function(i,k){return l(k)[fabric.util.string.camelize(fabric.util.string.capitalize(i))]};fabric.util.resolveNamespace=l;fabric.util.loadImage=function(i,k,m){if(i){var n=fabric.util.createImage();
n.onload=function(){k&&k.call(m,n);n=n.onload=null};n.src=i}else k&&k.call(m,i)};fabric.util.enlivenObjects=function(i,k,m,n){var q=[],t=0,w=i.length;i.forEach(function(y,s){if(y.type){var v=fabric.util.getKlass(y.type,m);if(v.async)v.fromObject(y,function(p,o){if(!o){q[s]=p;n&&n(y,q[s])}++t===w&&k&&k(q)});else{q[s]=v.fromObject(y);n&&n(y,q[s]);++t===w&&k&&k(q)}}})};fabric.util.groupSVGElements=function(i,k,m){i=i.length>1?new fabric.PathGroup(i,k):i[0];typeof m!=="undefined"&&i.setSourcePath(m);
return i};fabric.util.populateWithProperties=function(i,k,m){if(m&&Object.prototype.toString.call(m)==="[object Array]")for(var n=0,q=m.length;n<q;n++)if(m[n]in i)k[m[n]]=i[m[n]]};fabric.util.drawDashedLine=function(i,k,m,n,q,t){n=n-k;var w=q-m;q=f(n*n+w*w);n=c(w,n);w=t.length;var y=0,s=true;i.save();i.translate(k,m);i.moveTo(0,0);i.rotate(n);for(k=0;q>k;){k+=t[y++%w];if(k>q)k=q;i[s?"lineTo":"moveTo"](k,0);s=!s}i.restore()};fabric.util.createCanvasElement=function(i){i||(i=fabric.document.createElement("canvas"));
!i.getContext&&typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(i);return i};fabric.util.createImage=function(){return fabric.isLikelyNode?new (require("canvas").Image):fabric.document.createElement("img")};fabric.util.createAccessors=function(i){i=i.prototype;for(var k=i.stateProperties.length;k--;){var m=i.stateProperties[k],n=m.charAt(0).toUpperCase()+m.slice(1),q="set"+n;n="get"+n;i[n]||(i[n]=new Function('return this.get("'+m+'")'));i[q]||(i[q]=new Function("value",'return this.set("'+
m+'", value)'))}};fabric.util.clipContext=function(i,k){k.save();k.beginPath();i.clipTo(k);k.clip()};fabric.util.multiplyTransformMatrices=function(i,k){for(var m=[[i[0],i[2],i[4]],[i[1],i[3],i[5]],[0,0,1]],n=[[k[0],k[2],k[4]],[k[1],k[3],k[5]],[0,0,1]],q=[],t=0;t<3;t++){q[t]=[];for(var w=0;w<3;w++){for(var y=0,s=0;s<3;s++)y+=m[t][s]*n[s][w];q[t][w]=y}}return[q[0][0],q[1][0],q[0][1],q[1][1],q[0][2],q[1][2]]};fabric.util.getFunctionBody=function(i){return(String(i).match(/function[^{]*\{([\s\S]*)\}/)||
{})[1]};fabric.util.drawArc=function(i,k,m,n){k=e(n[5],n[6],n[0],n[1],n[3],n[4],n[2],k,m);for(m=0;m<k.length;m++){n=a.apply(this,k[m]);i.bezierCurveTo.apply(i,n)}}})();
(function(){var l=Array.prototype.slice;if(!Array.prototype.indexOf)Array.prototype.indexOf=function(e){if(this===void 0||this===null)throw new TypeError;var a=Object(this),f=a.length>>>0;if(f===0)return-1;var c=0;if(arguments.length>0){c=Number(arguments[1]);if(c!==c)c=0;else if(c!==0&&c!==Number.POSITIVE_INFINITY&&c!==Number.NEGATIVE_INFINITY)c=(c>0||-1)*Math.floor(Math.abs(c))}if(c>=f)return-1;for(c=c>=0?c:Math.max(f-Math.abs(c),0);c<f;c++)if(c in a&&a[c]===e)return c;return-1};if(!Array.prototype.forEach)Array.prototype.forEach=
function(e,a){for(var f=0,c=this.length>>>0;f<c;f++)f in this&&e.call(a,this[f],f,this)};if(!Array.prototype.map)Array.prototype.map=function(e,a){for(var f=[],c=0,d=this.length>>>0;c<d;c++)if(c in this)f[c]=e.call(a,this[c],c,this);return f};if(!Array.prototype.every)Array.prototype.every=function(e,a){for(var f=0,c=this.length>>>0;f<c;f++)if(f in this&&!e.call(a,this[f],f,this))return false;return true};if(!Array.prototype.some)Array.prototype.some=function(e,a){for(var f=0,c=this.length>>>0;f<
c;f++)if(f in this&&e.call(a,this[f],f,this))return true;return false};if(!Array.prototype.filter)Array.prototype.filter=function(e,a){for(var f=[],c,d=0,b=this.length>>>0;d<b;d++)if(d in this){c=this[d];e.call(a,c,d,this)&&f.push(c)}return f};if(!Array.prototype.reduce)Array.prototype.reduce=function(e){var a=this.length>>>0,f=0,c;if(arguments.length>1)c=arguments[1];else{do{if(f in this){c=this[f++];break}if(++f>=a)throw new TypeError;}while(1)}for(;f<a;f++)if(f in this)c=e.call(null,c,this[f],
f,this);return c};fabric.util.array={invoke:function(e,a){for(var f=l.call(arguments,2),c=[],d=0,b=e.length;d<b;d++)c[d]=f.length?e[d][a].apply(e[d],f):e[d][a].call(e[d]);return c},min:function(e,a){if(!(!e||e.length===0)){var f=e.length-1,c=a?e[f][a]:e[f];if(a)for(;f--;){if(e[f][a]<c)c=e[f][a]}else for(;f--;)if(e[f]<c)c=e[f];return c}},max:function(e,a){if(!(!e||e.length===0)){var f=e.length-1,c=a?e[f][a]:e[f];if(a)for(;f--;){if(e[f][a]>=c)c=e[f][a]}else for(;f--;)if(e[f]>=c)c=e[f];return c}}}})();
(function(){function l(e,a){for(var f in a)e[f]=a[f];return e}fabric.util.object={extend:l,clone:function(e){return l({},e)}}})();
(function(){if(!String.prototype.trim)String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")};fabric.util.string={camelize:function(l){return l.replace(/-+(.)?/g,function(e,a){return a?a.toUpperCase():""})},capitalize:function(l){return l.charAt(0).toUpperCase()+l.slice(1).toLowerCase()},escapeXml:function(l){return l.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();
(function(){var l=Array.prototype.slice,e=Function.prototype.apply,a=function(){};if(!Function.prototype.bind)Function.prototype.bind=function(f){var c=this,d=l.call(arguments,1),b;b=d.length?function(){return e.call(c,this instanceof a?this:f,d.concat(l.call(arguments)))}:function(){return e.call(c,this instanceof a?this:f,arguments)};a.prototype=this.prototype;b.prototype=new a;return b}})();
(function(){function l(){}function e(b){var g=this.constructor.superclass.prototype[b];return arguments.length>1?g.apply(this,a.call(arguments,1)):g.call(this)}var a=Array.prototype.slice,f=function(){},c=function(){for(var b in{toString:1})if(b==="toString")return false;return true}(),d=function(b,g,h){for(var j in g){b.prototype[j]=j in b.prototype&&typeof b.prototype[j]==="function"&&(g[j]+"").indexOf("callSuper")>-1?function(i){return function(){var k=this.constructor.superclass;this.constructor.superclass=
h;var m=g[i].apply(this,arguments);this.constructor.superclass=k;if(i!=="initialize")return m}}(j):g[j];if(c){if(g.toString!==Object.prototype.toString)b.prototype.toString=g.toString;if(g.valueOf!==Object.prototype.valueOf)b.prototype.valueOf=g.valueOf}}};fabric.util.createClass=function(){function b(){this.initialize.apply(this,arguments)}var g=null,h=a.call(arguments,0);if(typeof h[0]==="function")g=h.shift();b.superclass=g;b.subclasses=[];if(g){l.prototype=g.prototype;b.prototype=new l;g.subclasses.push(b)}for(var j=
0,i=h.length;j<i;j++)d(b,h[j],g);if(!b.prototype.initialize)b.prototype.initialize=f;b.prototype.constructor=b;b.prototype.callSuper=e;return b}})();
(function(){function l(m){var n=Array.prototype.slice.call(arguments,1),q,t,w=n.length;for(t=0;t<w;t++){q=typeof m[n[t]];if(!/^(?:function|object|unknown)$/.test(q))return false}return true}function e(m,n){return function(q){n.call(c(m),q||fabric.window.event)}}function a(m,n){return function(q){if(j[m]&&j[m][n])for(var t=j[m][n],w=0,y=t.length;w<y;w++)t[w].call(this,q||fabric.window.event)}}var f=function(){var m=0;return function(n){return n.__uniqueID||(n.__uniqueID="uniqueID__"+m++)}}(),c,d;(function(){var m=
{};c=function(n){return m[n]};d=function(n,q){m[n]=q}})();var b=l(fabric.document.documentElement,"addEventListener","removeEventListener")&&l(fabric.window,"addEventListener","removeEventListener"),g=l(fabric.document.documentElement,"attachEvent","detachEvent")&&l(fabric.window,"attachEvent","detachEvent"),h={},j={};if(b){b=function(m,n,q){m.addEventListener(n,q,false)};g=function(m,n,q){m.removeEventListener(n,q,false)}}else if(g){b=function(m,n,q){var t=f(m);d(t,m);h[t]||(h[t]={});h[t][n]||(h[t][n]=
[]);q={handler:q,wrappedHandler:e(t,q)};h[t][n].push(q);m.attachEvent("on"+n,q.wrappedHandler)};g=function(m,n,q){var t=f(m),w;if(h[t]&&h[t][n])for(var y=0,s=h[t][n].length;y<s;y++)if((w=h[t][n][y])&&w.handler===q){m.detachEvent("on"+n,w.wrappedHandler);h[t][n][y]=null}}}else{b=function(m,n,q){var t=f(m);j[t]||(j[t]={});if(!j[t][n]){j[t][n]=[];var w=m["on"+n];w&&j[t][n].push(w);m["on"+n]=a(t,n)}j[t][n].push(q)};g=function(m,n,q){m=f(m);if(j[m]&&j[m][n]){n=j[m][n];m=0;for(var t=n.length;m<t;m++)n[m]===
q&&n.splice(m,1)}}}fabric.util.addListener=b;fabric.util.removeListener=g;var i=function(m){return typeof m.clientX!=="unknown"?m.clientX:0},k=function(m){return typeof m.clientY!=="unknown"?m.clientY:0};if(fabric.isTouchSupported){i=function(m){if(m.type!=="touchend")return m.touches&&m.touches[0]?m.touches[0].pageX-(m.touches[0].pageX-m.touches[0].clientX)||m.clientX:m.clientX;return m.changedTouches&&m.changedTouches[0]?m.changedTouches[0].pageX-(m.changedTouches[0].pageX-m.changedTouches[0].clientX)||
m.clientX:m.clientX};k=function(m){if(m.type!=="touchend")return m.touches&&m.touches[0]?m.touches[0].pageY-(m.touches[0].pageY-m.touches[0].clientY)||m.clientY:m.clientY;return m.changedTouches&&m.changedTouches[0]?m.changedTouches[0].pageY-(m.changedTouches[0].pageY-m.changedTouches[0].clientY)||m.clientY:m.clientY}}fabric.util.getPointer=function(m,n){m||(m=fabric.window.event);for(var q=m.target||(typeof m.srcElement!=="unknown"?m.srcElement:null),t=fabric.document.body||{scrollLeft:0,scrollTop:0},
w=fabric.document.documentElement,y=q,s=0,v=0,p;q&&q.parentNode&&!p;){q=q.parentNode;if(q!==fabric.document&&fabric.util.getElementStyle(q,"position")==="fixed")p=q;if(q!==fabric.document&&y!==n&&fabric.util.getElementStyle(q,"position")==="absolute")v=s=0;else if(q===fabric.document){s=t.scrollLeft||w.scrollLeft||0;v=t.scrollTop||w.scrollTop||0}else{s+=q.scrollLeft||0;v+=q.scrollTop||0}}return{x:i(m)+s,y:k(m)+v}};fabric.util.object.extend(fabric.util,fabric.Observable)})();
(function(){var l=fabric.document.createElement("div"),e=typeof l.style.filter==="string",a=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,f=function(c){return c};if(typeof l.style.opacity==="string")f=function(c,d){c.style.opacity=d;return c};else if(e)f=function(c,d){var b=c.style;if(c.currentStyle&&!c.currentStyle.hasLayout)b.zoom=1;if(a.test(b.filter)){d=d>=0.9999?"":"alpha(opacity="+d*100+")";b.filter=b.filter.replace(a,d)}else b.filter+=" alpha(opacity="+d*100+")";return c};fabric.util.setStyle=function(c,
d){var b=c.style;if(!b)return c;if(typeof d==="string"){c.style.cssText+=";"+d;return d.indexOf("opacity")>-1?f(c,d.match(/opacity:\s*(\d?\.?\d*)/)[1]):c}for(var g in d)if(g==="opacity")f(c,d[g]);else b[g==="float"||g==="cssFloat"?typeof b.styleFloat==="undefined"?"cssFloat":"styleFloat":g]=d[g];return c}})();
(function(){function l(b,g){var h=fabric.document.createElement(b);for(var j in g)if(j==="class")h.className=g[j];else if(j==="for")h.htmlFor=g[j];else h.setAttribute(j,g[j]);return h}function e(b,g){if(!b.style)b.style={};if(fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle)return fabric.document.defaultView.getComputedStyle(b,null)[g];else{var h=b.style[g];if(!h&&b.currentStyle)h=b.currentStyle[g];return h}}var a=Array.prototype.slice,f=function(b){return a.call(b,0)},c;
try{c=f(fabric.document.childNodes)instanceof Array}catch(d){}c||(f=function(b){for(var g=Array(b.length),h=b.length;h--;)g[h]=b[h];return g});(function(){var b=fabric.document.documentElement.style,g="userSelect"in b?"userSelect":"MozUserSelect"in b?"MozUserSelect":"WebkitUserSelect"in b?"WebkitUserSelect":"KhtmlUserSelect"in b?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=function(h){if(typeof h.onselectstart!=="undefined")h.onselectstart=fabric.util.falseFunction;if(g)h.style[g]="none";
else if(typeof h.unselectable==="string")h.unselectable="on";return h};fabric.util.makeElementSelectable=function(h){if(typeof h.onselectstart!=="undefined")h.onselectstart=null;if(g)h.style[g]="";else if(typeof h.unselectable==="string")h.unselectable="";return h}})();(function(){fabric.util.getScript=function(b,g){var h=fabric.document.getElementsByTagName("head")[0],j=fabric.document.createElement("script"),i=true;j.onload=j.onreadystatechange=function(k){if(i)if(!(typeof this.readyState==="string"&&
this.readyState!=="loaded"&&this.readyState!=="complete")){i=false;g(k||fabric.window.event);j=j.onload=j.onreadystatechange=null}};j.src=b;h.appendChild(j)}})();fabric.util.getById=function(b){return typeof b==="string"?fabric.document.getElementById(b):b};fabric.util.toArray=f;fabric.util.makeElement=l;fabric.util.addClass=function(b,g){if((" "+b.className+" ").indexOf(" "+g+" ")===-1)b.className+=(b.className?" ":"")+g};fabric.util.wrapElement=function(b,g,h){if(typeof g==="string")g=l(g,h);b.parentNode&&
b.parentNode.replaceChild(g,b);g.appendChild(b);return g};fabric.util.getElementOffset=function(b){var g,h={left:0,top:0},j=b&&b.ownerDocument,i={left:0,top:0};g={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!j)return{left:0,top:0};for(var k in g)i[g[k]]+=parseInt(e(b,k),10)||0;g=j.documentElement;if(typeof b.getBoundingClientRect!=="undefined")h=b.getBoundingClientRect();b=j!=null&&j===j.window?j:j.nodeType===9&&(j.defaultView||j.parentWindow);return{left:h.left+
(b.pageXOffset||g.scrollLeft)-(g.clientLeft||0)+i.left,top:h.top+(b.pageYOffset||g.scrollTop)-(g.clientTop||0)+i.top}};fabric.util.getElementStyle=e})();
(function(){function l(){}var e=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],f=a.length;f--;)try{if(a[f]())return a[f]}catch(c){}}();fabric.util.request=function(a,f){f||(f={});var c=f.method?f.method.toUpperCase():"GET",d=f.onComplete||function(){},b=e(),g;b.onreadystatechange=function(){if(b.readyState===4){d(b);
b.onreadystatechange=l}};if(c==="GET"){g=null;if(typeof f.parameters==="string")a=a+(/\?/.test(a)?"&":"?")+f.parameters}b.open(c,a,true);if(c==="POST"||c==="PUT")b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.send(g);return b}})();
(function(){var l=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(a){fabric.window.setTimeout(a,1E3/60)},e=function(){return l.apply(fabric.window,arguments)};fabric.util.animate=function(a){a||(a={});var f=+new Date,c=a.duration||500,d=f+c,b,g=a.onChange||function(){},h=a.abort||function(){return false},j=a.easing||function(n,q,t,w){return-t*
Math.cos(n/w*(Math.PI/2))+t+q},i="startValue"in a?a.startValue:0,k="endValue"in a?a.endValue:100,m=a.byValue||k-i;a.onStart&&a.onStart();(function n(){b=+new Date;var q=b>d?c:b-f;if(h())a.onComplete&&a.onComplete();else{g(j(q,i,m,c));if(b>d)a.onComplete&&a.onComplete();else e(n)}})()};fabric.util.requestAnimFrame=e})();
(function(){function l(a,f,c,d){return c-e(d-a,0,c,d)+f}function e(a,f,c,d){return(a/=d)<1/2.75?c*7.5625*a*a+f:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+0.75)+f:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+0.9375)+f:c*(7.5625*(a-=2.625/2.75)*a+0.984375)+f}fabric.util.ease={easeInQuad:function(a,f,c,d){return c*(a/=d)*a+f},easeOutQuad:function(a,f,c,d){return-c*(a/=d)*(a-2)+f},easeInOutQuad:function(a,f,c,d){a/=d/2;if(a<1)return c/2*a*a+f;return-c/2*(--a*(a-2)-1)+f},easeInCubic:function(a,f,c,d){return c*(a/=d)*
a*a+f},easeOutCubic:function(a,f,c,d){return c*((a=a/d-1)*a*a+1)+f},easeInOutCubic:function(a,f,c,d){a/=d/2;if(a<1)return c/2*a*a*a+f;return c/2*((a-=2)*a*a+2)+f},easeInQuart:function(a,f,c,d){return c*(a/=d)*a*a*a+f},easeOutQuart:function(a,f,c,d){return-c*((a=a/d-1)*a*a*a-1)+f},easeInOutQuart:function(a,f,c,d){a/=d/2;if(a<1)return c/2*a*a*a*a+f;return-c/2*((a-=2)*a*a*a-2)+f},easeInQuint:function(a,f,c,d){return c*(a/=d)*a*a*a*a+f},easeOutQuint:function(a,f,c,d){return c*((a=a/d-1)*a*a*a*a+1)+f},
easeInOutQuint:function(a,f,c,d){a/=d/2;if(a<1)return c/2*a*a*a*a*a+f;return c/2*((a-=2)*a*a*a*a+2)+f},easeInSine:function(a,f,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+f},easeOutSine:function(a,f,c,d){return c*Math.sin(a/d*(Math.PI/2))+f},easeInOutSine:function(a,f,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+f},easeInExpo:function(a,f,c,d){return a===0?f:c*Math.pow(2,10*(a/d-1))+f},easeOutExpo:function(a,f,c,d){return a===d?f+c:c*(-Math.pow(2,-10*a/d)+1)+f},easeInOutExpo:function(a,f,c,d){if(a===0)return f;
if(a===d)return f+c;a/=d/2;if(a<1)return c/2*Math.pow(2,10*(a-1))+f;return c/2*(-Math.pow(2,-10*--a)+2)+f},easeInCirc:function(a,f,c,d){return-c*(Math.sqrt(1-(a/=d)*a)-1)+f},easeOutCirc:function(a,f,c,d){return c*Math.sqrt(1-(a=a/d-1)*a)+f},easeInOutCirc:function(a,f,c,d){a/=d/2;if(a<1)return-c/2*(Math.sqrt(1-a*a)-1)+f;return c/2*(Math.sqrt(1-(a-=2)*a)+1)+f},easeInElastic:function(a,f,c,d){var b=1.70158,g=0,h=c;if(a===0)return f;a/=d;if(a===1)return f+c;g||(g=d*0.3);if(h<Math.abs(c)){h=c;b=g/4}else b=
g/(2*Math.PI)*Math.asin(c/h);return-(h*Math.pow(2,10*(a-=1))*Math.sin((a*d-b)*2*Math.PI/g))+f},easeOutElastic:function(a,f,c,d){var b=1.70158,g=0,h=c;if(a===0)return f;a/=d;if(a===1)return f+c;g||(g=d*0.3);if(h<Math.abs(c)){h=c;b=g/4}else b=g/(2*Math.PI)*Math.asin(c/h);return h*Math.pow(2,-10*a)*Math.sin((a*d-b)*2*Math.PI/g)+c+f},easeInOutElastic:function(a,f,c,d){var b=1.70158,g=0,h=c;if(a===0)return f;a/=d/2;if(a===2)return f+c;g||(g=d*0.3*1.5);if(h<Math.abs(c)){h=c;b=g/4}else b=g/(2*Math.PI)*Math.asin(c/
h);if(a<1)return-0.5*h*Math.pow(2,10*(a-=1))*Math.sin((a*d-b)*2*Math.PI/g)+f;return h*Math.pow(2,-10*(a-=1))*Math.sin((a*d-b)*2*Math.PI/g)*0.5+c+f},easeInBack:function(a,f,c,d,b){if(b===undefined)b=1.70158;return c*(a/=d)*a*((b+1)*a-b)+f},easeOutBack:function(a,f,c,d,b){if(b===undefined)b=1.70158;return c*((a=a/d-1)*a*((b+1)*a+b)+1)+f},easeInOutBack:function(a,f,c,d,b){if(b===undefined)b=1.70158;a/=d/2;if(a<1)return c/2*a*a*(((b*=1.525)+1)*a-b)+f;return c/2*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)+f},easeInBounce:l,
easeOutBounce:e,easeInOutBounce:function(a,f,c,d){if(a<d/2)return l(a*2,0,c,d)*0.5+f;return e(a*2-d,0,c,d)*0.5+c*0.5+f}}})();
(function(l){function e(s){if(s in t)return t[s];return s}function a(s,v,p){if((s==="fill"||s==="stroke")&&v==="none")v="";else if(s==="fillRule")v=v==="evenodd"?"destination-over":v;else if(s==="strokeDashArray")v=v.replace(/,/g," ").split(/\s+/);else if(s==="transformMatrix")v=p&&p.transformMatrix?q(p.transformMatrix,j.parseTransformAttribute(v)):j.parseTransformAttribute(v);p=(s=Object.prototype.toString.call(v)==="[object Array]")?v.map(parseFloat):parseFloat(v);return!s&&isNaN(p)?v:p}function f(s){for(var v in w)if(!(!s[v]||
typeof s[w[v]]==="undefined"))if(s[v].indexOf("url(")!==0){var p=new j.Color(s[v]);s[v]=p.setAlpha(n(p.getAlpha()*s[w[v]],2)).toRgba();delete s[w[v]]}return s}function c(s,v){var p=s.match(/(normal|italic)?\s*(normal|small-caps)?\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\s*(\d+)px(?:\/(normal|[\d\.]+))?\s+(.*)/);if(p){var o=p[1],r=p[3],u=p[4],x=p[5];p=p[6];if(o)v.fontStyle=o;if(r)v.fontSize=isNaN(parseFloat(r))?r:parseFloat(r);if(u)v.fontSize=parseFloat(u);if(p)v.fontFamily=
p;if(x)v.lineHeight=x==="normal"?1:x}}function d(s){for(var v=s.length;v--;){var p=s[v].get("fill");if(/^url\(/.test(p)){p=p.slice(5,p.length-1);j.gradientDefs[p]&&s[v].set("fill",j.Gradient.fromElement(j.gradientDefs[p],s[v]))}}}function b(s){s=s.getElementsByTagName("style");for(var v={},p,o=0,r=s.length;o<r;o++){p=s[0].textContent;p=p.replace(/\/\*[\s\S]*?\*\//g,"");p=p.match(/[^{]*\{[\s\S]*?\}/g);p=p.map(function(u){return u.trim()});p.forEach(function(u){var x=u.match(/([\s\S]*?)\s*\{([^}]*)\}/);
u=x[1];x=x[2].trim().replace(/;$/,"").split(/\s*;\s*/);v[u]||(v[u]={});for(var z=0,B=x.length;z<B;z++){var E=x[z].split(/\s*:\s*/);v[u][E[0]]=E[1]}})}return v}function g(s){var v=s.nodeName,p=s.getAttribute("class");s=s.getAttribute("id");var o={};for(var r in j.cssRules)if(p&&RegExp("^\\."+p).test(r)||s&&RegExp("^#"+s).test(r)||RegExp("^"+v).test(r))for(var u in j.cssRules[r])o[u]=j.cssRules[r][u];return o}function h(s){var v=s.objects;s=s.options;v=v.map(function(p){return j[k(p.type)].fromObject(p)});
return{objects:v,options:s}}var j=l.fabric||(l.fabric={}),i=j.util.object.extend,k=j.util.string.capitalize,m=j.util.object.clone,n=j.util.toFixed,q=j.util.multiplyTransformMatrices;j.SHARED_ATTRIBUTES=["transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width"];var t={"fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle",
"font-weight":"fontWeight",cx:"left",x:"left",r:"radius","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration",cy:"top",y:"top",transform:"transformMatrix"},w={stroke:"strokeOpacity",fill:"fillOpacity"};j.parseTransformAttribute=function(){function s(x,z){var B=z[0];x[0]=Math.cos(B);x[1]=Math.sin(B);x[2]=-Math.sin(B);
x[3]=Math.cos(B)}function v(x,z){var B=z.length===2?z[1]:z[0];x[0]=z[0];x[3]=B}function p(x,z){x[4]=z[0];if(z.length===2)x[5]=z[1]}var o=[1,0,0,1,0,0],r=RegExp("^\\s*(?:(?:(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))(?:(?:\\s+,?\\s*|,\\s*)(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))))*)?)\\s*$"),
u=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))",
"g");return function(x){var z=o.concat(),B=[];if(!x||x&&!r.test(x))return z;x.replace(u,function(E){var C=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))").exec(E).filter(function(A){return A!==
""&&A!=null});E=C[1];C=C.slice(2).map(parseFloat);switch(E){case "translate":p(z,C);break;case "rotate":s(z,C);break;case "scale":v(z,C);break;case "skewX":z[2]=C[0];break;case "skewY":z[1]=C[0];break;case "matrix":z=C;break}B.push(z.concat());z=o.concat()});for(x=B[0];B.length>1;){B.shift();x=j.util.multiplyTransformMatrices(x,B[0])}return x}}();j.parseSVGDocument=function(){var s=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,v=RegExp("^\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*$");
return function(p,o,r){if(p){var u=new Date,x=j.util.toArray(p.getElementsByTagName("*"));if(x.length===0){x=p.selectNodes("//*[name(.)!='svg']");for(var z=[],B=0,E=x.length;B<E;B++)z[B]=x[B];x=z}x=x.filter(function(F){var L;if(L=s.test(F.tagName)){a:{F=F;for(L=/^(?:pattern|defs)$/;F&&(F=F.parentNode);)if(L.test(F.nodeName)){F=true;break a}F=false}L=!F}return L});if(!(!x||x&&!x.length)){z=p.getAttribute("viewBox");B=p.getAttribute("width");E=p.getAttribute("height");var C=null,A=null;if(z&&(z=z.match(v))){parseInt(z[1],
10);parseInt(z[2],10);C=parseInt(z[3],10);A=parseInt(z[4],10)}C=B?parseFloat(B):C;A=E?parseFloat(E):A;var D={width:C,height:A};j.gradientDefs=j.getGradientDefs(p);j.cssRules=b(p);j.parseElements(x,function(F){j.documentParsingTime=new Date-u;o&&o(F,D)},m(D),r)}}}}();var y={has:function(s,v){v(false)},get:function(){},set:function(){}};i(j,{parseAttributes:function(s,v){if(s){var p,o={};if(s.parentNode&&/^g$/i.test(s.parentNode.nodeName))o=j.parseAttributes(s.parentNode,v);var r=v.reduce(function(u,
x){if(p=s.getAttribute(x)){x=e(x);p=a(x,p,o);u[x]=p}return u},{});r=i(r,i(g(s),j.parseStyleAttribute(s)));return f(i(o,r))}},parseElements:function(s,v,p,o){function r(){if(--x===0){u=u.filter(function(F){return F!=null});d(u);v(u)}}for(var u=Array(s.length),x=s.length,z=0,B,E=s.length;z<E;z++){B=s[z];var C=j[k(B.tagName)];if(C&&C.fromElement)try{if(C.async)C.fromElement(B,function(F,L){return function(I){o&&o(L,I);u.splice(F,0,I);r()}}(z,B),p);else{var A=C.fromElement(B,p);o&&o(B,A);u.splice(z,0,
A);r()}}catch(D){j.log(D)}else r()}},parseStyleAttribute:function(s){var v={};s=s.getAttribute("style");var p,o;if(!s)return v;if(typeof s==="string")s.replace(/;$/,"").split(";").forEach(function(u){u=u.split(":");p=e(u[0].trim().toLowerCase());o=a(p,u[1].trim());if(p==="font")c(o,v);else v[p]=o});else for(var r in s)if(typeof s[r]!=="undefined"){p=e(r.toLowerCase());o=a(p,s[r]);if(p==="font")c(o,v);else v[p]=o}return v},parsePointsAttribute:function(s){if(!s)return null;s=s.trim();var v=s.indexOf(",")>
-1;s=s.split(/\s+/);var p=[],o;if(v){v=0;for(o=s.length;v<o;v++){var r=s[v].split(",");p.push({x:parseFloat(r[0]),y:parseFloat(r[1])})}}else{v=0;for(o=s.length;v<o;v+=2)p.push({x:parseFloat(s[v]),y:parseFloat(s[v+1])})}return p},getCSSRules:b,loadSVGFromURL:function(s,v,p){function o(r){var u=r.responseXML;if(!u.documentElement&&j.window.ActiveXObject&&r.responseText){u=new ActiveXObject("Microsoft.XMLDOM");u.async="false";u.loadXML(r.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))}u.documentElement&&
j.parseSVGDocument(u.documentElement,function(x,z){y.set(s,{objects:j.util.array.invoke(x,"toObject"),options:z});v(x,z)},p)}s=s.replace(/^\n\s*/,"").trim();y.has(s,function(r){if(r)y.get(s,function(u){u=h(u);v(u.objects,u.options)});else new j.util.request(s,{method:"get",onComplete:o})})},loadSVGFromString:function(s,v,p){s=s.trim();var o;if(typeof DOMParser!=="undefined"){var r=new DOMParser;if(r&&r.parseFromString)o=r.parseFromString(s,"text/xml")}else if(j.window.ActiveXObject){o=new ActiveXObject("Microsoft.XMLDOM");
o.async="false";o.loadXML(s.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))}j.parseSVGDocument(o.documentElement,function(u,x){v(u,x)},p)},createSVGFontFacesMarkup:function(s){for(var v="",p=0,o=s.length;p<o;p++)s[p].type!=="text"||!s[p].path||(v+=["@font-face {font-family: ",s[p].fontFamily,"; src: url('",s[p].path,"')}"].join(""));if(v)v=['<style type="text/css"><![CDATA[',v,"]]\></style>"].join("");return v},createSVGRefElementsMarkup:function(s){var v="";if(s.backgroundColor&&s.backgroundColor.source)v=
['<pattern x="0" y="0" id="backgroundColorPattern" width="',s.backgroundColor.source.width,'" height="',s.backgroundColor.source.height,'" patternUnits="userSpaceOnUse"><image x="0" y="0" width="',s.backgroundColor.source.width,'" height="',s.backgroundColor.source.height,'" xlink:href="',s.backgroundColor.source.src,'"></image></pattern>'].join("");return v},getGradientDefs:function(s){var v=s.getElementsByTagName("linearGradient");s=s.getElementsByTagName("radialGradient");var p,o,r={};for(o=v.length;o--;){p=
v[o];r[p.getAttribute("id")]=p}for(o=s.length;o--;){p=s[o];r[p.getAttribute("id")]=p}return r}})})(typeof exports!=="undefined"?exports:this);
(function(l){function e(a,f){this.x=a;this.y=f}l=l.fabric||(l.fabric={});if(l.Point)l.warn("fabric.Point is already defined");else{l.Point=e;e.prototype={constructor:e,add:function(a){return new e(this.x+a.x,this.y+a.y)},addEquals:function(a){this.x+=a.x;this.y+=a.y;return this},scalarAdd:function(a){return new e(this.x+a,this.y+a)},scalarAddEquals:function(a){this.x+=a;this.y+=a;return this},subtract:function(a){return new e(this.x-a.x,this.y-a.y)},subtractEquals:function(a){this.x-=a.x;this.y-=
a.y;return this},scalarSubtract:function(a){return new e(this.x-a,this.y-a)},scalarSubtractEquals:function(a){this.x-=a;this.y-=a;return this},multiply:function(a){return new e(this.x*a,this.y*a)},multiplyEquals:function(a){this.x*=a;this.y*=a;return this},divide:function(a){return new e(this.x/a,this.y/a)},divideEquals:function(a){this.x/=a;this.y/=a;return this},eq:function(a){return this.x===a.x&&this.y===a.y},lt:function(a){return this.x<a.x&&this.y<a.y},lte:function(a){return this.x<=a.x&&this.y<=
a.y},gt:function(a){return this.x>a.x&&this.y>a.y},gte:function(a){return this.x>=a.x&&this.y>=a.y},lerp:function(a,f){return new e(this.x+(a.x-this.x)*f,this.y+(a.y-this.y)*f)},distanceFrom:function(a){var f=this.x-a.x;a=this.y-a.y;return Math.sqrt(f*f+a*a)},midPointFrom:function(a){return new e(this.x+(a.x-this.x)/2,this.y+(a.y-this.y)/2)},min:function(a){return new e(Math.min(this.x,a.x),Math.min(this.y,a.y))},max:function(a){return new e(Math.max(this.x,a.x),Math.max(this.y,a.y))},toString:function(){return this.x+
","+this.y},setXY:function(a,f){this.x=a;this.y=f},setFromPoint:function(a){this.x=a.x;this.y=a.y},swap:function(a){var f=this.x,c=this.y;this.x=a.x;this.y=a.y;a.x=f;a.y=c}}}})(typeof exports!=="undefined"?exports:this);
(function(l){function e(f){this.status=f;this.points=[]}var a=l.fabric||(l.fabric={});if(a.Intersection)a.warn("fabric.Intersection is already defined");else{a.Intersection=e;a.Intersection.prototype={appendPoint:function(f){this.points.push(f)},appendPoints:function(f){this.points=this.points.concat(f)}};a.Intersection.intersectLineLine=function(f,c,d,b){var g,h=(b.x-d.x)*(f.y-d.y)-(b.y-d.y)*(f.x-d.x);g=(c.x-f.x)*(f.y-d.y)-(c.y-f.y)*(f.x-d.x);d=(b.y-d.y)*(c.x-f.x)-(b.x-d.x)*(c.y-f.y);if(d!==0){h=
h/d;g=g/d;if(0<=h&&h<=1&&0<=g&&g<=1){g=new e("Intersection");g.points.push(new a.Point(f.x+h*(c.x-f.x),f.y+h*(c.y-f.y)))}else g=new e}else g=h===0||g===0?new e("Coincident"):new e("Parallel");return g};a.Intersection.intersectLinePolygon=function(f,c,d){for(var b=new e,g=d.length,h=0;h<g;h++){var j=e.intersectLineLine(f,c,d[h],d[(h+1)%g]);b.appendPoints(j.points)}if(b.points.length>0)b.status="Intersection";return b};a.Intersection.intersectPolygonPolygon=function(f,c){for(var d=new e,b=f.length,
g=0;g<b;g++){var h=e.intersectLinePolygon(f[g],f[(g+1)%b],c);d.appendPoints(h.points)}if(d.points.length>0)d.status="Intersection";return d};a.Intersection.intersectPolygonRectangle=function(f,c,d){var b=c.min(d),g=c.max(d);d=new a.Point(g.x,b.y);var h=new a.Point(b.x,g.y);c=e.intersectLinePolygon(b,d,f);d=e.intersectLinePolygon(d,g,f);g=e.intersectLinePolygon(g,h,f);f=e.intersectLinePolygon(h,b,f);b=new e;b.appendPoints(c.points);b.appendPoints(d.points);b.appendPoints(g.points);b.appendPoints(f.points);
if(b.points.length>0)b.status="Intersection";return b}}})(typeof exports!=="undefined"?exports:this);
(function(l){function e(c){c?this._tryParsingColor(c):this.setSource([0,0,0,1])}function a(c,d,b){if(b<0)b+=1;if(b>1)b-=1;if(b<1/6)return c+(d-c)*6*b;if(b<0.5)return d;if(b<2/3)return c+(d-c)*(2/3-b)*6;return c}var f=l.fabric||(l.fabric={});if(f.Color)f.warn("fabric.Color is already defined.");else{f.Color=e;f.Color.prototype={_tryParsingColor:function(c){var d;if(c in e.colorNameMap)c=e.colorNameMap[c];(d=e.sourceFromHex(c))||(d=e.sourceFromRgb(c));d||(d=e.sourceFromHsl(c));d&&this.setSource(d)},
_rgbToHsl:function(c,d,b){c/=255;d/=255;b/=255;var g,h,j,i=f.util.array.max([c,d,b]);h=f.util.array.min([c,d,b]);j=(i+h)/2;if(i===h)g=h=0;else{var k=i-h;h=j>0.5?k/(2-i-h):k/(i+h);switch(i){case c:g=(d-b)/k+(d<b?6:0);break;case d:g=(b-c)/k+2;break;case b:g=(c-d)/k+4;break}g/=6}return[Math.round(g*360),Math.round(h*100),Math.round(j*100)]},getSource:function(){return this._source},setSource:function(c){this._source=c},toRgb:function(){var c=this.getSource();return"rgb("+c[0]+","+c[1]+","+c[2]+")"},
toRgba:function(){var c=this.getSource();return"rgba("+c[0]+","+c[1]+","+c[2]+","+c[3]+")"},toHsl:function(){var c=this.getSource();c=this._rgbToHsl(c[0],c[1],c[2]);return"hsl("+c[0]+","+c[1]+"%,"+c[2]+"%)"},toHsla:function(){var c=this.getSource(),d=this._rgbToHsl(c[0],c[1],c[2]);return"hsla("+d[0]+","+d[1]+"%,"+d[2]+"%,"+c[3]+")"},toHex:function(){var c=this.getSource(),d=c[0].toString(16);d=d.length===1?"0"+d:d;var b=c[1].toString(16);b=b.length===1?"0"+b:b;c=c[2].toString(16);c=c.length===1?"0"+
c:c;return d.toUpperCase()+b.toUpperCase()+c.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(c){var d=this.getSource();d[3]=c;this.setSource(d);return this},toGrayscale:function(){var c=this.getSource(),d=parseInt((c[0]*0.3+c[1]*0.59+c[2]*0.11).toFixed(0),10);this.setSource([d,d,d,c[3]]);return this},toBlackWhite:function(c){var d=this.getSource(),b=(d[0]*0.3+d[1]*0.59+d[2]*0.11).toFixed(0);d=d[3];c=c||127;b=Number(b)<Number(c)?0:255;this.setSource([b,b,b,d]);return this},
overlayWith:function(c){c instanceof e||(c=new e(c));var d=[],b=this.getAlpha(),g=this.getSource();c=c.getSource();for(var h=0;h<3;h++)d.push(Math.round(g[h]*0.5+c[h]*0.5));d[3]=b;this.setSource(d);return this}};f.Color.reRGBa=/^rgba?\(\s*(\d{1,3}\%?)\s*,\s*(\d{1,3}\%?)\s*,\s*(\d{1,3}\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;f.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;f.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;f.Color.colorNameMap=
{aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"};f.Color.fromRgb=function(c){return e.fromSource(e.sourceFromRgb(c))};f.Color.sourceFromRgb=function(c){if(c=c.match(e.reRGBa)){var d=parseInt(c[1],10)/(/%$/.test(c[1])?100:1)*(/%$/.test(c[1])?255:1),b=parseInt(c[2],10)/(/%$/.test(c[2])?
100:1)*(/%$/.test(c[2])?255:1),g=parseInt(c[3],10)/(/%$/.test(c[3])?100:1)*(/%$/.test(c[3])?255:1);return[parseInt(d,10),parseInt(b,10),parseInt(g,10),c[4]?parseFloat(c[4]):1]}};f.Color.fromRgba=e.fromRgb;f.Color.fromHsl=function(c){return e.fromSource(e.sourceFromHsl(c))};f.Color.sourceFromHsl=function(c){if(c=c.match(e.reHSLa)){var d=(parseFloat(c[1])%360+360)%360/360,b=parseFloat(c[2])/(/%$/.test(c[2])?100:1),g=parseFloat(c[3])/(/%$/.test(c[3])?100:1);if(b===0)g=b=d=g;else{var h=g<=0.5?g*(b+1):
g+b-g*b,j=g*2-h;g=a(j,h,d+1/3);b=a(j,h,d);d=a(j,h,d-1/3)}return[Math.round(g*255),Math.round(b*255),Math.round(d*255),c[4]?parseFloat(c[4]):1]}};f.Color.fromHsla=e.fromHsl;f.Color.fromHex=function(c){return e.fromSource(e.sourceFromHex(c))};f.Color.sourceFromHex=function(c){if(c.match(e.reHex)){var d=c.slice(c.indexOf("#")+1),b=d.length===3;c=b?d.charAt(0)+d.charAt(0):d.substring(0,2);var g=b?d.charAt(1)+d.charAt(1):d.substring(2,4);d=b?d.charAt(2)+d.charAt(2):d.substring(4,6);return[parseInt(c,16),
parseInt(g,16),parseInt(d,16),1]}};f.Color.fromSource=function(c){var d=new e;d.setSource(c);return d}}})(typeof exports!=="undefined"?exports:this);
(function(){function l(f){var c=f.getAttribute("style"),d=f.getAttribute("offset"),b,g;d=parseFloat(d)/(/%$/.test(d)?100:1);if(c){c=c.split(/\s*;\s*/);c[c.length-1]===""&&c.pop();for(var h=c.length;h--;){var j=c[h].split(/\s*:\s*/),i=j[0].trim();j=j[1].trim();if(i==="stop-color")b=j;else if(i==="stop-opacity")g=j}}b||(b=f.getAttribute("stop-color")||"rgb(0,0,0)");g||(g=f.getAttribute("stop-opacity"));b=(new fabric.Color(b)).toRgb();return{offset:d,color:b,opacity:isNaN(parseFloat(g))?1:parseFloat(g)}}
function e(f,c){for(var d in c){if(typeof c[d]==="string"&&/^\d+%$/.test(c[d])){var b=parseFloat(c[d],10);if(d==="x1"||d==="x2"||d==="r2")c[d]=fabric.util.toFixed(f.width*b/100,2);else if(d==="y1"||d==="y2")c[d]=fabric.util.toFixed(f.height*b/100,2)}if(d==="x1"||d==="x2")c[d]-=fabric.util.toFixed(f.width/2,2);else if(d==="y1"||d==="y2")c[d]-=fabric.util.toFixed(f.height/2,2)}}function a(f,c){for(var d in c){if(d==="x1"||d==="x2")c[d]+=fabric.util.toFixed(f.width/2,2);else if(d==="y1"||d==="y2")c[d]+=
fabric.util.toFixed(f.height/2,2);if(d==="x1"||d==="x2"||d==="r2")c[d]=fabric.util.toFixed(c[d]/f.width*100,2)+"%";else if(d==="y1"||d==="y2")c[d]=fabric.util.toFixed(c[d]/f.height*100,2)+"%"}}fabric.Gradient=fabric.util.createClass({initialize:function(f){f||(f={});var c={};this.id=fabric.Object.__uid++;this.type=f.type||"linear";c={x1:f.coords.x1||0,y1:f.coords.y1||0,x2:f.coords.x2||0,y2:f.coords.y2||0};if(this.type==="radial"){c.r1=f.coords.r1||0;c.r2=f.coords.r2||0}this.coords=c;this.gradientUnits=
f.gradientUnits||"objectBoundingBox";this.colorStops=f.colorStops.slice()},addColorStop:function(f){for(var c in f){var d=new fabric.Color(f[c]);this.colorStops.push({offset:c,color:d.toRgb(),opacity:d.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,gradientUnits:this.gradientUnits,colorStops:this.colorStops}},toSVG:function(f,c){var d=fabric.util.object.clone(this.coords),b;this.colorStops.sort(function(g,h){return g.offset-h.offset});if(c&&this.gradientUnits===
"userSpaceOnUse"){d.x1+=f.width/2;d.y1+=f.height/2;d.x2+=f.width/2;d.y2+=f.height/2}else this.gradientUnits==="objectBoundingBox"&&a(f,d);if(this.type==="linear")b=["<linearGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" x1="',d.x1,'" y1="',d.y1,'" x2="',d.x2,'" y2="',d.y2,'">'];else if(this.type==="radial")b=["<radialGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" cx="',d.x2,'" cy="',d.y2,'" r="',d.r2,'" fx="',d.x1,'" fy="',d.y1,'">'];for(d=0;d<
this.colorStops.length;d++)b.push("<stop ",'offset="',this.colorStops[d].offset*100+"%",'" style="stop-color:',this.colorStops[d].color,this.colorStops[d].opacity?";stop-opacity: "+this.colorStops[d].opacity:";",'"/>');b.push(this.type==="linear"?"</linearGradient>":"</radialGradient>");return b.join("")},toLive:function(f){var c;if(this.type){if(this.type==="linear")c=f.createLinearGradient(this.coords.x1,this.coords.y1,this.coords.x2,this.coords.y2);else if(this.type==="radial")c=f.createRadialGradient(this.coords.x1,
this.coords.y1,this.coords.r1,this.coords.x2,this.coords.y2,this.coords.r2);f=0;for(var d=this.colorStops.length;f<d;f++){var b=this.colorStops[f].color,g=this.colorStops[f].opacity,h=this.colorStops[f].offset;if(typeof g!=="undefined")b=(new fabric.Color(b)).setAlpha(g).toRgba();c.addColorStop(parseFloat(h),b)}return c}}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(f,c){var d=f.getElementsByTagName("stop"),b=f.nodeName==="linearGradient"?"linear":"radial",g=f.getAttribute("gradientUnits")||
"objectBoundingBox",h=[],j={};if(b==="linear")j={x1:f.getAttribute("x1")||0,y1:f.getAttribute("y1")||0,x2:f.getAttribute("x2")||"100%",y2:f.getAttribute("y2")||0};else if(b==="radial")j={x1:f.getAttribute("fx")||f.getAttribute("cx")||"50%",y1:f.getAttribute("fy")||f.getAttribute("cy")||"50%",r1:0,x2:f.getAttribute("cx")||"50%",y2:f.getAttribute("cy")||"50%",r2:f.getAttribute("r")||"50%"};for(var i=d.length;i--;)h.push(l(d[i]));e(c,j);return new fabric.Gradient({type:b,coords:j,gradientUnits:g,colorStops:h})},
forObject:function(f,c){c||(c={});e(f,c);return new fabric.Gradient(c)}})})();
fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(l){l||(l={});this.id=fabric.Object.__uid++;if(l.source)if(typeof l.source==="string")if(typeof fabric.util.getFunctionBody(l.source)!=="undefined")this.source=new Function(fabric.util.getFunctionBody(l.source));else{var e=this;this.source=fabric.util.createImage();fabric.util.loadImage(l.source,function(a){e.source=a})}else this.source=l.source;if(l.repeat)this.repeat=l.repeat;if(l.offsetX)this.offsetX=
l.offsetX;if(l.offsetY)this.offsetY=l.offsetY},toObject:function(){var l;if(typeof this.source==="function")l=String(this.source);else if(typeof this.source.src==="string")l=this.source.src;return{source:l,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(l){var e=typeof this.source==="function"?this.source():this.source,a=e.width/l.getWidth();l=e.height/l.getHeight();var f="";if(e.src)f=e.src;else if(e.toDataURL)f=e.toDataURL();return'<pattern id="SVGID_'+this.id+'" x="'+
this.offsetX+'" y="'+this.offsetY+'" width="'+a+'" height="'+l+'"><image x="0" y="0" width="'+e.width+'" height="'+e.height+'" xlink:href="'+f+'"></image></pattern>'},toLive:function(l){var e=typeof this.source==="function"?this.source():this.source;return l.createPattern(e,this.repeat)}});
(function(l){var e=l.fabric||(l.fabric={});if(e.Shadow)e.warn("fabric.Shadow is already defined.");else{e.Shadow=e.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:false,initialize:function(a){if(typeof a==="string")a=this._parseShadow(a);for(var f in a)this[f]=a[f];this.id=e.Object.__uid++},_parseShadow:function(a){a=a.trim();var f=e.Shadow.reOffsetsAndBlur.exec(a)||[];return{color:(a.replace(e.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseInt(f[1],10)||
0,offsetY:parseInt(f[2],10)||0,blur:parseInt(f[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(a){var f="SourceAlpha";if(a&&(a.fill===this.color||a.stroke===this.color))f="SourceGraphic";return'<filter id="SVGID_'+this.id+'" y="-40%" height="180%"><feGaussianBlur in="'+f+'" stdDeviation="'+(this.blur?this.blur/3:0)+'"></feGaussianBlur><feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"></feOffset><feMerge><feMergeNode></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter>'},
toObject:function(){return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY}}});e.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/}})(typeof exports!=="undefined"?exports:this);
(function(){if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var l=fabric.util.object.extend,e=fabric.util.getElementOffset,a=fabric.util.removeFromArray,f=fabric.util.removeListener,c=Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(d,b){b||(b={});this._initStatic(d,b);fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:"",backgroundImageOpacity:1,backgroundImageStretch:true,overlayImage:"",
overlayImageLeft:0,overlayImageTop:0,includeDefaultValues:true,stateful:true,renderOnAddRemove:true,clipTo:null,controlsAboveOverlay:false,allowTouchScrolling:false,onBeforeScaleRotate:function(){},_initStatic:function(d,b){this._objects=[];this._createLowerCanvas(d);this._initOptions(b);b.overlayImage&&this.setOverlayImage(b.overlayImage,this.renderAll.bind(this));b.backgroundImage&&this.setBackgroundImage(b.backgroundImage,this.renderAll.bind(this));b.backgroundColor&&this.setBackgroundColor(b.backgroundColor,
this.renderAll.bind(this));this.calcOffset()},calcOffset:function(){this._offset=e(this.lowerCanvasEl);return this},setOverlayImage:function(d,b,g){fabric.util.loadImage(d,function(h){this.overlayImage=h;if(g&&"overlayImageLeft"in g)this.overlayImageLeft=g.overlayImageLeft;if(g&&"overlayImageTop"in g)this.overlayImageTop=g.overlayImageTop;b&&b()},this);return this},setBackgroundImage:function(d,b,g){fabric.util.loadImage(d,function(h){this.backgroundImage=h;if(g&&"backgroundImageOpacity"in g)this.backgroundImageOpacity=
g.backgroundImageOpacity;if(g&&"backgroundImageStretch"in g)this.backgroundImageStretch=g.backgroundImageStretch;b&&b()},this);return this},setBackgroundColor:function(d,b){if(d.source){var g=this;fabric.util.loadImage(d.source,function(h){g.backgroundColor=new fabric.Pattern({source:h,repeat:d.repeat});b&&b()})}else{this.backgroundColor=d;b&&b()}return this},_createCanvasElement:function(){var d=fabric.document.createElement("canvas");if(!d.style)d.style={};if(!d)throw c;this._initCanvasElement(d);
return d},_initCanvasElement:function(d){fabric.util.createCanvasElement(d);if(typeof d.getContext==="undefined")throw c;},_initOptions:function(d){for(var b in d)this[b]=d[b];this.width=parseInt(this.lowerCanvasEl.width,10)||0;this.height=parseInt(this.lowerCanvasEl.height,10)||0;if(this.lowerCanvasEl.style){this.lowerCanvasEl.style.width=this.width+"px";this.lowerCanvasEl.style.height=this.height+"px"}},_createLowerCanvas:function(d){this.lowerCanvasEl=fabric.util.getById(d)||this._createCanvasElement();
this._initCanvasElement(this.lowerCanvasEl);fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(d){return this._setDimension("width",d)},setHeight:function(d){return this._setDimension("height",d)},setDimensions:function(d){for(var b in d)this._setDimension(b,d[b]);return this},
_setDimension:function(d,b){this.lowerCanvasEl[d]=b;this.lowerCanvasEl.style[d]=b+"px";if(this.upperCanvasEl){this.upperCanvasEl[d]=b;this.upperCanvasEl.style[d]=b+"px"}if(this.cacheCanvasEl)this.cacheCanvasEl[d]=b;if(this.wrapperEl)this.wrapperEl.style[d]=b+"px";this[d]=b;this.calcOffset();this.renderAll();return this},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(d,b){if(b)if(this.controlsAboveOverlay){var g=
b.hasBorders,h=b.hasControls;b.hasBorders=b.hasControls=false;b.render(d);b.hasBorders=g;b.hasControls=h}else b.render(d)},_onObjectAdded:function(d){this.stateful&&d.setupState();d.setCoords();d.canvas=this;this.fire("object:added",{target:d});d.fire("added")},_onObjectRemoved:function(d){this.fire("object:removed",{target:d});d.fire("removed")},getObjects:function(){return this._objects},clearContext:function(d){d.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},
clear:function(){this._objects.length=0;this.discardActiveGroup&&this.discardActiveGroup();this.discardActiveObject&&this.discardActiveObject();this.clearContext(this.contextContainer);this.contextTop&&this.clearContext(this.contextTop);this.fire("canvas:cleared");this.renderAll();return this},renderAll:function(d){var b=this[d===true&&this.interactive?"contextTop":"contextContainer"];this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop);d||this.clearContext(b);
this.fire("before:render");this.clipTo&&fabric.util.clipContext(this,b);if(this.backgroundColor){b.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(b):this.backgroundColor;b.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height)}typeof this.backgroundImage==="object"&&this._drawBackroundImage(b);var g=this.getActiveGroup();d=0;for(var h=this._objects.length;d<h;++d)if(!g||g&&this._objects[d]&&!g.contains(this._objects[d]))this._draw(b,this._objects[d]);
if(g){var j=[];this.forEachObject(function(i){g.contains(i)&&j.push(i)});g._set("objects",j);this._draw(b,g)}this.clipTo&&b.restore();this.overlayImage&&b.drawImage(this.overlayImage,this.overlayImageLeft,this.overlayImageTop);this.controlsAboveOverlay&&this.interactive&&this.drawControls(b);this.fire("after:render");return this},_drawBackroundImage:function(d){d.save();d.globalAlpha=this.backgroundImageOpacity;this.backgroundImageStretch?d.drawImage(this.backgroundImage,0,0,this.width,this.height):
d.drawImage(this.backgroundImage,0,0);d.restore()},renderTop:function(){var d=this.contextTop||this.contextContainer;this.clearContext(d);this.selection&&this._groupSelector&&this._drawSelection();var b=this.getActiveGroup();b&&b.render(d);this.overlayImage&&d.drawImage(this.overlayImage,this.overlayImageLeft,this.overlayImageTop);this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(d){d.set("left",this.getCenter().left);
this.renderAll();return this},centerObjectV:function(d){d.set("top",this.getCenter().top);this.renderAll();return this},centerObject:function(d){return this.centerObjectH(d).centerObjectV(d)},toDatalessJSON:function(d){return this.toDatalessObject(d)},toObject:function(d){return this._toObjectMethod("toObject",d)},toDatalessObject:function(d){return this._toObjectMethod("toDatalessObject",d)},_toObjectMethod:function(d,b){var g=this.getActiveGroup();g&&this.discardActiveGroup();var h={objects:this.getObjects().map(function(j){var i;
if(!this.includeDefaultValues){i=j.includeDefaultValues;j.includeDefaultValues=false}var k=j[d](b);if(!this.includeDefaultValues)j.includeDefaultValues=i;return k},this),background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};if(this.backgroundImage){h.backgroundImage=this.backgroundImage.src;h.backgroundImageOpacity=this.backgroundImageOpacity;h.backgroundImageStretch=this.backgroundImageStretch}if(this.overlayImage){h.overlayImage=this.overlayImage.src;
h.overlayImageLeft=this.overlayImageLeft;h.overlayImageTop=this.overlayImageTop}fabric.util.populateWithProperties(this,h,b);if(g){this.setActiveGroup(new fabric.Group(g.getObjects()));g.forEachObject(function(j){j.set("active",true)})}return h},toSVG:function(d){d||(d={});var b=[];d.suppressPreamble||b.push('<?xml version="1.0" encoding="',d.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n');b.push("<svg ",
'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',d.viewBox?d.viewBox.width:this.width,'" ','height="',d.viewBox?d.viewBox.height:this.height,'" ',this.backgroundColor&&!this.backgroundColor.source?'style="background-color: '+this.backgroundColor+'" ':null,d.viewBox?'viewBox="'+d.viewBox.x+" "+d.viewBox.y+" "+d.viewBox.width+" "+d.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>","<defs>",
fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>");if(this.backgroundColor&&this.backgroundColor.source)b.push('<rect x="0" y="0" ','width="',this.backgroundColor.repeat==="repeat-y"||this.backgroundColor.repeat==="no-repeat"?this.backgroundColor.source.width:this.width,'" height="',this.backgroundColor.repeat==="repeat-x"||this.backgroundColor.repeat==="no-repeat"?this.backgroundColor.source.height:this.height,'" fill="url(#backgroundColorPattern)"',
"></rect>");if(this.backgroundImage)b.push('<image x="0" y="0" ','width="',this.backgroundImageStretch?this.width:this.backgroundImage.width,'" height="',this.backgroundImageStretch?this.height:this.backgroundImage.height,'" preserveAspectRatio="',this.backgroundImageStretch?"none":"defer",'" xlink:href="',this.backgroundImage.src,'" style="opacity:',this.backgroundImageOpacity,'"></image>');this.overlayImage&&b.push('<image x="',this.overlayImageLeft,'" y="',this.overlayImageTop,'" width="',this.overlayImage.width,
'" height="',this.overlayImage.height,'" xlink:href="',this.overlayImage.src,'"></image>');(d=this.getActiveGroup())&&this.discardActiveGroup();for(var g=0,h=this.getObjects(),j=h.length;g<j;g++)b.push(h[g].toSVG());if(d){this.setActiveGroup(new fabric.Group(d.getObjects()));d.forEachObject(function(i){i.set("active",true)})}b.push("</svg>");return b.join("")},remove:function(d){if(this.getActiveObject()===d){this.fire("before:selection:cleared",{target:d});this.discardActiveObject();this.fire("selection:cleared")}return fabric.Collection.remove.call(this,
d)},sendToBack:function(d){a(this._objects,d);this._objects.unshift(d);return this.renderAll&&this.renderAll()},bringToFront:function(d){a(this._objects,d);this._objects.push(d);return this.renderAll&&this.renderAll()},sendBackwards:function(d,b){var g=this._objects.indexOf(d);if(g!==0){var h;if(b){h=g;for(g=g-1;g>=0;--g)if(d.intersectsWithObject(this._objects[g])||d.isContainedWithinObject(this._objects[g])||this._objects[g].isContainedWithinObject(d)){h=g;break}}else h=g-1;a(this._objects,d);this._objects.splice(h,
0,d);this.renderAll&&this.renderAll()}return this},bringForward:function(d,b){var g=this._objects.indexOf(d);if(g!==this._objects.length-1){var h;if(b){h=g;for(g=g+1;g<this._objects.length;++g)if(d.intersectsWithObject(this._objects[g])||d.isContainedWithinObject(this._objects[g])||this._objects[g].isContainedWithinObject(d)){h=g;break}}else h=g+1;a(this._objects,d);this._objects.splice(h,0,d);this.renderAll&&this.renderAll()}return this},moveTo:function(d,b){a(this._objects,d);this._objects.splice(b,
0,d);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();if(!this.interactive)return this;if(fabric.isTouchSupported){f(this.upperCanvasEl,"touchstart",this._onMouseDown);f(this.upperCanvasEl,"touchmove",this._onMouseMove);typeof Event!=="undefined"&&"remove"in Event&&Event.remove(this.upperCanvasEl,"gesture",this._onGesture)}else{f(this.upperCanvasEl,"mousedown",this._onMouseDown);f(this.upperCanvasEl,"mousemove",this._onMouseMove);f(fabric.window,"resize",this._onResize)}return this},
toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});l(fabric.StaticCanvas.prototype,fabric.Observable);l(fabric.StaticCanvas.prototype,fabric.Collection);l(fabric.StaticCanvas.prototype,fabric.DataURLExporter);l(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',toGrayscale:function(d){var b=d.getContext("2d");d=b.getImageData(0,0,d.width,d.height);var g=d.data,h=d.width,j=d.height,i,k,m,n;for(m=0;m<h;m++)for(n=0;n<
j;n++){i=m*4*j+n*4;k=(g[i]+g[i+1]+g[i+2])/3;g[i]=k;g[i+1]=k;g[i+2]=k}b.putImageData(d,0,0)},supports:function(d){var b=fabric.util.createCanvasElement();if(!b||!b.getContext)return null;var g=b.getContext("2d");if(!g)return null;switch(d){case "getImageData":return typeof g.getImageData!=="undefined";case "setLineDash":return typeof g.setLineDash!=="undefined";case "toDataURL":return typeof b.toDataURL!=="undefined";case "toDataURLWithQuality":try{b.toDataURL("image/jpeg",0);return true}catch(h){}return false;
default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}})();
fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",setShadow:function(l){this.shadow=new fabric.Shadow(l);return this},_setBrushStyles:function(){var l=this.canvas.contextTop;l.strokeStyle=this.color;l.lineWidth=this.width;l.lineCap=this.strokeLineCap;l.lineJoin=this.strokeLineJoin},_setShadow:function(){if(this.shadow){var l=this.canvas.contextTop;l.shadowColor=this.shadow.color;l.shadowBlur=this.shadow.blur;l.shadowOffsetX=
this.shadow.offsetX;l.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var l=this.canvas.contextTop;l.shadowColor="";l.shadowBlur=l.shadowOffsetX=l.shadowOffsetY=0}});
(function(){var l=fabric.util.array.min,e=fabric.util.array.max;fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(a){this.canvas=a;this._points=[]},onMouseDown:function(a){this._prepareForDrawing(a);this._captureDrawingPath(a);this._render()},onMouseMove:function(a){this._captureDrawingPath(a);this.canvas.clearContext(this.canvas.contextTop);this._render();this._finalizeAndAddPath()},_prepareForDrawing:function(a){a=new fabric.Point(a.x,a.y);this._reset();this._addPoint(a);
this.canvas.contextTop.moveTo(a.x,a.y)},_addPoint:function(a){this._points.push(a)},_reset:function(){this._points.length=0;this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(a){this._addPoint(new fabric.Point(a.x,a.y))},_render:function(){var a=this.canvas.contextTop;a.beginPath();var f=this._points[0],c=this._points[1];if(this._points.length===2&&f.x===c.x&&f.y===c.y){f.x-=0.5;c.x+=0.5}a.moveTo(f.x,f.y);for(var d=1,b=this._points.length;d<b;d++){c=f.midPointFrom(c);a.quadraticCurveTo(f.x,
f.y,c.x,c.y);f=this._points[d];c=this._points[d+1]}a.lineTo(f.x,f.y);a.stroke()},_getSVGPathData:function(){this.box=this.getPathBoundingBox(this._points);return this.convertPointsToSVGPath(this._points,this.box.minx,this.box.maxx,this.box.miny,this.box.maxy)},getPathBoundingBox:function(a){for(var f=[],c=[],d=a[0],b=a[1],g=d,h=1,j=a.length;h<j;h++){var i=d.midPointFrom(b);f.push(g.x);f.push(i.x);c.push(g.y);c.push(i.y);d=a[h];b=a[h+1];g=i}f.push(d.x);c.push(d.y);return{minx:l(f),miny:l(c),maxx:e(f),
maxy:e(c)}},convertPointsToSVGPath:function(a,f,c,d){c=[];var b=new fabric.Point(a[0].x-f,a[0].y-d),g=new fabric.Point(a[1].x-f,a[1].y-d);c.push("M ",a[0].x-f," ",a[0].y-d," ");for(var h=1,j=a.length;h<j;h++){var i=b.midPointFrom(g);c.push("Q ",b.x," ",b.y," ",i.x," ",i.y," ");b=new fabric.Point(a[h].x-f,a[h].y-d);if(h+1<a.length)g=new fabric.Point(a[h+1].x-f,a[h+1].y-d)}c.push("L ",b.x," ",b.y," ");return c},createPath:function(a){a=new fabric.Path(a);a.fill=null;a.stroke=this.color;a.strokeWidth=
this.width;a.strokeLineCap=this.strokeLineCap;a.strokeLineJoin=this.strokeLineJoin;if(this.shadow){this.shadow.affectStroke=true;a.setShadow(this.shadow)}return a},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var a=this._getSVGPathData().join("");if(a==="M 0 0 Q 0 0 0 0 L 0 0")this.canvas.renderAll();else{var f=this.box.minx+(this.box.maxx-this.box.minx)/2,c=this.box.miny+(this.box.maxy-this.box.miny)/2;this.canvas.contextTop.arc(f,c,3,0,Math.PI*2,false);a=this.createPath(a);
a.set({left:f,top:c});this.canvas.add(a);a.setCoords();this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderAll();this.canvas.fire("path:created",{path:a})}}})})();
fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(l){this.canvas=l;this.points=[]},drawDot:function(l){l=this.addPoint(l);var e=this.canvas.contextTop;e.fillStyle=l.fill;e.beginPath();e.arc(l.x,l.y,l.radius,0,Math.PI*2,false);e.closePath();e.fill()},onMouseDown:function(l){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(l)},onMouseMove:function(l){this.drawDot(l)},onMouseUp:function(){var l=this.canvas.renderOnAddRemove;
this.canvas.renderOnAddRemove=false;for(var e=[],a=0,f=this.points.length;a<f;a++){var c=this.points[a];c=new fabric.Circle({radius:c.radius,left:c.x,top:c.y,fill:c.fill});this.shadow&&c.setShadow(this.shadow);e.push(c)}e=new fabric.Group(e);this.canvas.add(e);this.canvas.fire("path:created",{path:e});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=l;this.canvas.renderAll()},addPoint:function(l){l=new fabric.Point(l.x,l.y);var e=fabric.util.getRandomInt(Math.max(0,
this.width-20),this.width+20)/2,a=(new fabric.Color(this.color)).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();l.radius=e;l.fill=a;this.points.push(l);return l}});
fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:false,initialize:function(l){this.canvas=l;this.sprayChunks=[]},onMouseDown:function(l){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(l);this.render()},onMouseMove:function(l){this.addSprayChunk(l);this.render()},onMouseUp:function(){var l=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=false;for(var e=
[],a=0,f=this.sprayChunks.length;a<f;a++)for(var c=this.sprayChunks[a],d=0,b=c.length;d<b;d++){var g=new fabric.Rect({width:c[d].width,height:c[d].width,left:c[d].x+1,top:c[d].y+1,fill:this.color});this.shadow&&g.setShadow(this.shadow);e.push(g)}e=new fabric.Group(e);this.canvas.add(e);this.canvas.fire("path:created",{path:e});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=l;this.canvas.renderAll()},render:function(){var l=this.canvas.contextTop;
l.fillStyle=this.color;l.save();for(var e=0,a=this.sprayChunkPoints.length;e<a;e++){var f=this.sprayChunkPoints[e];if(typeof f.opacity!=="undefined")l.globalAlpha=f.opacity;l.fillRect(f.x,f.y,f.width,f.width)}l.restore()},addSprayChunk:function(l){this.sprayChunkPoints=[];for(var e,a,f,c=this.width/2,d=0;d<this.density;d++){e=fabric.util.getRandomInt(l.x-c,l.x+c);a=fabric.util.getRandomInt(l.y-c,l.y+c);f=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),
this.dotWidth+this.dotWidthVariance):this.dotWidth;e={x:e,y:a,width:f};if(this.randomOpacity)e.opacity=fabric.util.getRandomInt(0,100)/100;this.sprayChunkPoints.push(e)}this.sprayChunks.push(this.sprayChunkPoints)}});
fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var l=fabric.document.createElement("canvas"),e=l.getContext("2d");l.width=l.height=25;e.fillStyle=this.color;e.beginPath();e.arc(10,10,10,0,Math.PI*2,false);e.closePath();e.fill();return l},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");
this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(l){l=this.callSuper("createPath",l);l.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()});return l}});
(function(){var l=fabric.util.getPointer,e=fabric.util.degreesToRadians,a=fabric.util.radiansToDegrees,f=Math.atan2,c=Math.abs,d=Math.min,b=Math.max;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(h,j){j||(j={});this._initStatic(h,j);this._initInteractive();this._createCacheCanvas();fabric.Canvas.activeInstance=this},uniScaleTransform:false,centerTransform:false,interactive:true,selection:true,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",
selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:false,targetFindTolerance:0,skipTargetFind:false,_initInteractive:function(){this._groupSelector=this._currentTransform=null;this._initWrapperElement();this._createUpperCanvas();this._initEvents();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(h){var j=
this._currentTransform;j.target.set("scaleX",j.original.scaleX);j.target.set("scaleY",j.original.scaleY);j.target.set("left",j.original.left);j.target.set("top",j.original.top);if(h.altKey||this.centerTransform||j.target.centerTransform){if(j.originX!=="center")j.mouseXSign=j.originX==="right"?-1:1;if(j.originY!=="center")j.mouseYSign=j.originY==="bottom"?-1:1;j.originX="center";j.originY="center"}else{j.originX=j.original.originX;j.originY=j.original.originY}},containsPoint:function(h,j){var i=this.getPointer(h);
i=this._normalizePointer(j,i);return j.containsPoint(i)||j._findTargetCorner(h,this._offset)},_normalizePointer:function(h,j){var i=this.getActiveGroup(),k=j.x,m=j.y;if(i&&h.type!=="group"&&i.contains(h)){k-=i.left;m-=i.top}return{x:k,y:m}},isTargetTransparent:function(h,j,i){var k=this.contextCache,m=h.hasBorders,n=h.transparentCorners;h.hasBorders=h.transparentCorners=false;this._draw(k,h);h.hasBorders=m;h.transparentCorners=n;if(this.targetFindTolerance>0){if(j>this.targetFindTolerance)j-=this.targetFindTolerance;
else j=0;if(i>this.targetFindTolerance)i-=this.targetFindTolerance;else i=0}h=true;j=k.getImageData(j,i,this.targetFindTolerance*2||1,this.targetFindTolerance*2||1);i=3;for(m=j.data.length;i<m;i+=4){h=j.data[i]<=0;if(h===false)break}this.clearContext(k);return h},_shouldClearSelection:function(h,j){var i=this.getActiveGroup();return!j||j&&i&&!i.contains(j)&&i!==j&&!h.shiftKey||j&&!j.selectable},_setupCurrentTransform:function(h,j){if(j){var i="drag",k,m=l(h,j.canvas.upperCanvasEl);if(k=j._findTargetCorner(h,
this._offset))i=k==="ml"||k==="mr"?"scaleX":k==="mt"||k==="mb"?"scaleY":k==="mtr"?"rotate":"scale";var n=j.originX,q=j.originY;if(k==="ml"||k==="tl"||k==="bl")n="right";else if(k==="mr"||k==="tr"||k==="br")n="left";if(k==="tl"||k==="mt"||k==="tr")q="bottom";else if(k==="bl"||k==="mb"||k==="br")q="top";this._currentTransform={target:j,action:i,scaleX:j.scaleX,scaleY:j.scaleY,offsetX:m.x-j.left,offsetY:m.y-j.top,originX:n,originY:q,ex:m.x,ey:m.y,left:j.left,top:j.top,theta:e(j.angle),width:j.width*
j.scaleX,mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:j.left,top:j.top,scaleX:j.scaleX,scaleY:j.scaleY,originX:n,originY:q};this._resetCurrentTransform(h)}},_shouldHandleGroupLogic:function(h,j){var i=this.getActiveObject();return h.shiftKey&&(this.getActiveGroup()||i&&i!==j)&&this.selection},_handleGroupLogic:function(h,j){if(j===this.getActiveGroup()){j=this.findTarget(h,true);if(!j||j.isType("group"))return}var i=this.getActiveGroup();if(i){if(i.contains(j)){i.removeWithUpdate(j);
this._resetObjectTransform(i);j.set("active",false);i.size()===1&&this.discardActiveGroup()}else{i.addWithUpdate(j);this._resetObjectTransform(i)}this.fire("selection:created",{target:i,e:h});i.set("active",true)}else{if(this._activeObject)if(j!==this._activeObject){i=this.getObjects();i=i.indexOf(this._activeObject)<i.indexOf(j);this.setActiveGroup(new fabric.Group(i?[j,this._activeObject]:[this._activeObject,j]));this._activeObject=null;i=this.getActiveGroup();this.fire("selection:created",{target:i,
e:h})}j.set("active",true)}i&&i.saveCoords()},_translateObject:function(h,j){var i=this._currentTransform.target;i.get("lockMovementX")||i.set("left",h-this._currentTransform.offsetX);i.get("lockMovementY")||i.set("top",j-this._currentTransform.offsetY)},_scaleObject:function(h,j,i){var k=this._currentTransform,m=this._offset,n=k.target,q=n.get("lockScalingX"),t=n.get("lockScalingY");if(!(q&&t)){var w=n.translateToOriginPoint(n.getCenterPoint(),k.originX,k.originY);j=n.toLocalPoint(new fabric.Point(h-
m.left,j-m.top),k.originX,k.originY);if(k.originX==="right")j.x*=-1;else if(k.originX==="center"){j.x*=k.mouseXSign*2;if(j.x<0)k.mouseXSign=-k.mouseXSign}if(k.originY==="bottom")j.y*=-1;else if(k.originY==="center"){j.y*=k.mouseYSign*2;if(j.y<0)k.mouseYSign=-k.mouseYSign}if(c(j.x)>n.padding)if(j.x<0)j.x+=n.padding;else j.x-=n.padding;else j.x=0;if(c(j.y)>n.padding)if(j.y<0)j.y+=n.padding;else j.y-=n.padding;else j.y=0;h=n.scaleX;m=n.scaleY;if(i==="equally"&&!q&&!t){i=j.y+j.x;q=(n.height+n.strokeWidth)*
k.original.scaleY+(n.width+n.strokeWidth)*k.original.scaleX;h=k.original.scaleX*i/q;m=k.original.scaleY*i/q;n.set("scaleX",h);n.set("scaleY",m)}else if(i)if(i==="x"&&!n.get("lockUniScaling")){h=j.x/(n.width+n.strokeWidth);q||n.set("scaleX",h)}else{if(i==="y"&&!n.get("lockUniScaling")){m=j.y/(n.height+n.strokeWidth);t||n.set("scaleY",m)}}else{h=j.x/(n.width+n.strokeWidth);m=j.y/(n.height+n.strokeWidth);q||n.set("scaleX",h);t||n.set("scaleY",m)}if(h<0)if(k.originX==="left")k.originX="right";else if(k.originX===
"right")k.originX="left";if(m<0)if(k.originY==="top")k.originY="bottom";else if(k.originY==="bottom")k.originY="top";n.setPositionByOrigin(w,k.originX,k.originY)}},_rotateObject:function(h,j){var i=this._currentTransform,k=this._offset;if(!i.target.get("lockRotation")){var m=f(i.ey-i.top-k.top,i.ex-i.left-k.left);k=f(j-i.top-k.top,h-i.left-k.left);m=a(k-m+i.theta);if(m<0)m=360+m;i.target.angle=m}},_setCursor:function(h){this.upperCanvasEl.style.cursor=h},_resetObjectTransform:function(h){h.scaleX=
1;h.scaleY=1;h.setAngle(0)},_drawSelection:function(){var h=this.contextTop,j=this._groupSelector,i=j.left,k=j.top,m=c(i),n=c(k);h.fillStyle=this.selectionColor;h.fillRect(j.ex-(i>0?0:-i),j.ey-(k>0?0:-k),m,n);h.lineWidth=this.selectionLineWidth;h.strokeStyle=this.selectionBorderColor;if(this.selectionDashArray.length>1){i=j.ex+0.5-(i>0?0:m);j=j.ey+0.5-(k>0?0:n);h.beginPath();fabric.util.drawDashedLine(h,i,j,i+m,j,this.selectionDashArray);fabric.util.drawDashedLine(h,i,j+n-1,i+m,j+n-1,this.selectionDashArray);
fabric.util.drawDashedLine(h,i,j,i,j+n,this.selectionDashArray);fabric.util.drawDashedLine(h,i+m-1,j,i+m-1,j+n,this.selectionDashArray);h.closePath();h.stroke()}else h.strokeRect(j.ex+0.5-(i>0?0:m),j.ey+0.5-(k>0?0:n),m,n)},_findSelectedObjects:function(h){var j=[],i=this._groupSelector.ex,k=this._groupSelector.ey,m=i+this._groupSelector.left,n=k+this._groupSelector.top,q=new fabric.Point(d(i,m),d(k,n)),t=new fabric.Point(b(i,m),b(k,n));k=i===m&&k===n;for(m=this._objects.length;m--;)if(i=this._objects[m])if(i.intersectsWithRect(q,
t)||i.isContainedWithinRect(q,t)||i.containsPoint(q)||i.containsPoint(t))if(this.selection&&i.selectable){i.set("active",true);j.push(i);if(k)break}if(j.length===1)this.setActiveObject(j[0],h);else if(j.length>1){j=new fabric.Group(j.reverse());this.setActiveGroup(j);j.saveCoords();this.fire("selection:created",{target:j});this.renderAll()}},findTarget:function(h,j){if(!this.skipTargetFind){var i,k=this.getPointer(h);if(this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&
this.containsPoint(h,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(h,this._offset))return i=this.lastRenderedObjectWithControlsAboveOverlay;var m=this.getActiveGroup();if(m&&!j&&this.containsPoint(h,m))return i=m;m=[];for(k=this._objects.length;k--;)if(this._objects[k]&&this._objects[k].visible&&this._objects[k].selectable&&this.containsPoint(h,this._objects[k]))if(this.perPixelTargetFind||this._objects[k].perPixelTargetFind)m[m.length]=
this._objects[k];else{this.relatedTarget=i=this._objects[k];break}for(var n=0,q=m.length;n<q;n++){k=this.getPointer(h);if(!this.isTargetTransparent(m[n],k.x,k.y)){this.relatedTarget=i=m[n];break}}return i}},getPointer:function(h){h=l(h,this.upperCanvasEl);return{x:h.x-this._offset.left,y:h.y-this._offset.top}},_createUpperCanvas:function(){var h=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+
h);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,
"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"absolute"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(h){var j=this.getWidth()||h.width,i=this.getHeight()||h.height;fabric.util.setStyle(h,{position:"absolute",width:j+"px",height:i+"px",left:0,top:0});h.width=j;h.height=i;fabric.util.makeElementUnselectable(h)},_copyCanvasStyle:function(h,j){j.style.cssText=h.style.cssText},
getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},setActiveObject:function(h,j){this._activeObject&&this._activeObject.set("active",false);this._activeObject=h;h.set("active",true);this.renderAll();this.fire("object:selected",{target:h,e:j});h.fire("selected",{e:j});return this},getActiveObject:function(){return this._activeObject},discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",false);this._activeObject=
null;return this},setActiveGroup:function(h){if(this._activeGroup=h){h.canvas=this;h.set("active",true)}return this},getActiveGroup:function(){return this._activeGroup},discardActiveGroup:function(){var h=this.getActiveGroup();h&&h.destroy();return this.setActiveGroup(null)},deactivateAll:function(){for(var h=this.getObjects(),j=0,i=h.length;j<i;j++)h[j].set("active",false);this.discardActiveGroup();this.discardActiveObject();return this},deactivateAllWithDispatch:function(){var h=this.getActiveGroup()||
this.getActiveObject();h&&this.fire("before:selection:cleared",{target:h});this.deactivateAll();h&&this.fire("selection:cleared");return this},drawControls:function(h){var j=this.getActiveGroup();if(j){h.save();fabric.Group.prototype.transform.call(j,h);j.drawBorders(h).drawControls(h);h.restore()}else{j=0;for(var i=this._objects.length;j<i;++j)if(this._objects[j]&&this._objects[j].active){h.save();fabric.Object.prototype.transform.call(this._objects[j],h);this._objects[j].drawBorders(h).drawControls(h);
h.restore();this.lastRenderedObjectWithControlsAboveOverlay=this._objects[j]}}}});for(var g in fabric.StaticCanvas)if(g!=="prototype")fabric.Canvas[g]=fabric.StaticCanvas[g];if(fabric.isTouchSupported)fabric.Canvas.prototype._setCursorFromEvent=function(){};fabric.Element=fabric.Canvas})();
(function(){var l=["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],e={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},a=fabric.util.addListener,f=fabric.util.removeListener,c=fabric.util.getPointer;fabric.util.object.extend(fabric.Canvas.prototype,{_initEvents:function(){var d=this;this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=
function(b,g){d.__onTransformGesture(b,g)};a(fabric.window,"resize",this._onResize);if(fabric.isTouchSupported){a(this.upperCanvasEl,"touchstart",this._onMouseDown);a(this.upperCanvasEl,"touchmove",this._onMouseMove);typeof Event!=="undefined"&&"add"in Event&&Event.add(this.upperCanvasEl,"gesture",this._onGesture)}else{a(this.upperCanvasEl,"mousedown",this._onMouseDown);a(this.upperCanvasEl,"mousemove",this._onMouseMove)}},_onMouseDown:function(d){this.__onMouseDown(d);!fabric.isTouchSupported&&a(fabric.document,
"mouseup",this._onMouseUp);fabric.isTouchSupported&&a(fabric.document,"touchend",this._onMouseUp);!fabric.isTouchSupported&&a(fabric.document,"mousemove",this._onMouseMove);fabric.isTouchSupported&&a(fabric.document,"touchmove",this._onMouseMove);!fabric.isTouchSupported&&f(this.upperCanvasEl,"mousemove",this._onMouseMove);fabric.isTouchSupported&&f(this.upperCanvasEl,"touchmove",this._onMouseMove)},_onMouseUp:function(d){this.__onMouseUp(d);!fabric.isTouchSupported&&f(fabric.document,"mouseup",this._onMouseUp);
fabric.isTouchSupported&&f(fabric.document,"touchend",this._onMouseUp);!fabric.isTouchSupported&&f(fabric.document,"mousemove",this._onMouseMove);fabric.isTouchSupported&&f(fabric.document,"touchmove",this._onMouseMove);!fabric.isTouchSupported&&a(this.upperCanvasEl,"mousemove",this._onMouseMove);fabric.isTouchSupported&&a(this.upperCanvasEl,"touchmove",this._onMouseMove)},_onMouseMove:function(d){!this.allowTouchScrolling&&d.preventDefault&&d.preventDefault();this.__onMouseMove(d)},_onResize:function(){this.calcOffset()},
_shouldRender:function(d,b){var g=this.getActiveGroup()||this.getActiveObject();return d&&(d.isMoving||d!==g)||!d&&g||b&&this._previousPointer&&this.selection&&(b.x!==this._previousPointer.x||b.y!==this._previousPointer.y)},__onMouseUp:function(d){var b,g;if(this.isDrawingMode&&this._isCurrentlyDrawing){this._isCurrentlyDrawing=false;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:d})}else{if(this._currentTransform){b=this._currentTransform.target;
if(b._scaling)b._scaling=false;b.setCoords();if(this.stateful&&b.hasStateChanged()){this.fire("object:modified",{target:b});b.fire("modified")}if(this._previousOriginX&&this._previousOriginY){var h=b.translateToOriginPoint(b.getCenterPoint(),this._previousOriginX,this._previousOriginY);b.originX=this._previousOriginX;b.originY=this._previousOriginY;b.left=h.x;b.top=h.y;this._previousOriginY=this._previousOriginX=null}}else g=this.getPointer(d);g=this._shouldRender(b,g);this.selection&&this._groupSelector&&
this._findSelectedObjects(d);if(h=this.getActiveGroup()){h.setObjectsCoords();h.isMoving=false;this._setCursor(this.defaultCursor)}this._currentTransform=this._groupSelector=null;if(b)b.isMoving=false;g&&this.renderAll();this._setCursorFromEvent(d,b);var j=this;setTimeout(function(){j._setCursorFromEvent(d,b)},50);this.fire("mouse:up",{target:b,e:d});b&&b.fire("mouseup",{e:d})}},_onMouseDownInDrawingMode:function(d){this._isCurrentlyDrawing=true;this.discardActiveObject().renderAll();this.clipTo&&
fabric.util.clipContext(this,this.contextTop);this.freeDrawingBrush.onMouseDown(this.getPointer(d));this.fire("mouse:down",{e:d})},__onMouseDown:function(d){if(("which"in d?d.which===1:d.button===1)||fabric.isTouchSupported)if(this.isDrawingMode)this._onMouseDownInDrawingMode(d);else if(!this._currentTransform){var b=this.findTarget(d),g=this.getPointer(d),h,j;this._previousPointer=g;j=this._shouldRender(b,g);if(this._shouldClearSelection(d,b)){if(this.selection)this._groupSelector={ex:g.x,ey:g.y,
top:0,left:0};this.deactivateAllWithDispatch();b&&b.selectable&&this.setActiveObject(b,d)}else if(this._shouldHandleGroupLogic(d,b)){this._handleGroupLogic(d,b);b=this.getActiveGroup()}else{this.stateful&&b.saveState();if(h=b._findTargetCorner(d,this._offset))this.onBeforeScaleRotate(b);if(b!==this.getActiveGroup()&&b!==this.getActiveObject()){this.deactivateAll();this.setActiveObject(b,d)}this._setupCurrentTransform(d,b)}j&&this.renderAll();this.fire("mouse:down",{target:b,e:d});b&&b.fire("mousedown",
{e:d});h==="mtr"&&b.centerTransform&&this._setOriginToCenter(b)}},_setOriginToCenter:function(d){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var b=d.getCenterPoint();d.originX="center";d.originY="center";d.left=b.x;d.top=b.y;this._currentTransform.left=d.left;this._currentTransform.top=d.top},__onMouseMove:function(d){var b,g;if(this.isDrawingMode){if(this._isCurrentlyDrawing){g=this.getPointer(d);this.freeDrawingBrush.onMouseMove(g)}this.upperCanvasEl.style.cursor=
this.freeDrawingCursor;this.fire("mouse:move",{e:d})}else{var h=this._groupSelector;if(h){g=c(d,this.upperCanvasEl);h.left=g.x-this._offset.left-h.ex;h.top=g.y-this._offset.top-h.ey;this.renderTop()}else if(this._currentTransform){g=c(d,this.upperCanvasEl);h=g.x;g=g.y;var j=false,i=this._currentTransform;b=i.target;b.isMoving=true;if((i.action==="scale"||i.action==="scaleX"||i.action==="scaleY")&&(d.altKey&&(i.originX!=="center"||i.originY!=="center")||!d.altKey&&i.originX==="center"&&i.originY===
"center")){this._resetCurrentTransform(d);j=true}if(i.action==="rotate"){this._rotateObject(h,g);this.fire("object:rotating",{target:b,e:d});b.fire("rotating",{e:d})}else if(i.action==="scale"){if((d.shiftKey||this.uniScaleTransform)&&!b.get("lockUniScaling")){i.currentAction="scale";this._scaleObject(h,g)}else{!j&&i.currentAction==="scale"&&this._resetCurrentTransform(d);i.currentAction="scaleEqually";this._scaleObject(h,g,"equally")}this.fire("object:scaling",{target:b,e:d});b.fire("scaling",{e:d})}else if(i.action===
"scaleX"){this._scaleObject(h,g,"x");this.fire("object:scaling",{target:b,e:d});b.fire("scaling",{e:d})}else if(i.action==="scaleY"){this._scaleObject(h,g,"y");this.fire("object:scaling",{target:b,e:d});b.fire("scaling",{e:d})}else{this._translateObject(h,g);this.fire("object:moving",{target:b,e:d});b.fire("moving",{e:d});this._setCursor(this.moveCursor)}this.renderAll()}else{h=this.upperCanvasEl.style;b=this.findTarget(d);if(!b||b&&!b.selectable)h.cursor=this.defaultCursor;else this._setCursorFromEvent(d,
b)}this.fire("mouse:move",{target:b,e:d});b&&b.fire("mousemove",{e:d})}},_setCursorFromEvent:function(d,b){var g=this.upperCanvasEl.style;if(b){var h=this.getActiveGroup();if(h=b._findTargetCorner&&(!h||!h.contains(b))&&b._findTargetCorner(d,this._offset))if(h in e){var j=Math.round(b.getAngle()%360/45);if(j<0)j+=8;j+=e[h];j%=8;g.cursor=l[j]}else if(h==="mtr"&&b.hasRotatingPoint)g.cursor=this.rotationCursor;else{g.cursor=this.defaultCursor;return false}else g.cursor=b.hoverCursor||this.hoverCursor}else{g.cursor=
this.defaultCursor;return false}return true}})})();
fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(l){l||(l={});var e=l.format||"png",a=l.quality||1,f=l.multiplier||1;l={left:l.left,top:l.top,width:l.width,height:l.height};return f!==1?this.__toDataURLWithMultiplier(e,a,l,f):this.__toDataURL(e,a,l)},__toDataURL:function(l,e,a){this.renderAll(true);var f=this.upperCanvasEl||this.lowerCanvasEl;a=this.__getCroppedCanvas(f,a);if(l==="jpg")l="jpeg";l=fabric.StaticCanvas.supports("toDataURLWithQuality")?(a||f).toDataURL("image/"+
l,e):(a||f).toDataURL("image/"+l);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return l},__getCroppedCanvas:function(l,e){var a,f;if("left"in e||"top"in e||"width"in e||"height"in e){a=fabric.util.createCanvasElement();f=a.getContext("2d");a.width=e.width||this.width;a.height=e.height||this.height;f.drawImage(l,-e.left||0,-e.top||0)}return a},__toDataURLWithMultiplier:function(l,e,a,f){var c=this.getWidth(),d=this.getHeight(),b=c*f,g=d*f,h=this.getActiveObject(),j=this.getActiveGroup(),
i=this.contextTop||this.contextContainer;this.setWidth(b).setHeight(g);i.scale(f,f);if(a.left)a.left*=f;if(a.top)a.top*=f;if(a.width)a.width*=f;if(a.height)a.height*=f;if(j)this._tempRemoveBordersControlsFromGroup(j);else h&&this.deactivateAll&&this.deactivateAll();this.width=c;this.height=d;this.renderAll(true);l=this.__toDataURL(l,e,a);i.scale(1/f,1/f);this.setWidth(c).setHeight(d);if(j)this._restoreBordersControlsOnGroup(j);else h&&this.setActiveObject&&this.setActiveObject(h);this.contextTop&&
this.clearContext(this.contextTop);this.renderAll();return l},toDataURLWithMultiplier:function(l,e,a){return this.toDataURL({format:l,multiplier:e,quality:a})},_tempRemoveBordersControlsFromGroup:function(l){l.origHasControls=l.hasControls;l.origBorderColor=l.borderColor;l.hasControls=true;l.borderColor="rgba(0,0,0,0)";l.forEachObject(function(e){e.origBorderColor=e.borderColor;e.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(l){l.hideControls=l.origHideControls;l.borderColor=
l.origBorderColor;l.forEachObject(function(e){e.borderColor=e.origBorderColor;delete e.origBorderColor})}});
fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(l,e,a){return this.loadFromJSON(l,e,a)},loadFromJSON:function(l,e,a){if(l){var f=typeof l==="string"?JSON.parse(l):l;this.clear();var c=this;this._enlivenObjects(f.objects,function(){c._setBgOverlayImages(f,e)},a);return this}},_setBgOverlayImages:function(l,e){var a=this,f,c,d,b=function(){e&&c&&d&&f&&e()};if(l.backgroundImage)this.setBackgroundImage(l.backgroundImage,function(){a.backgroundImageOpacity=l.backgroundImageOpacity;
a.backgroundImageStretch=l.backgroundImageStretch;a.renderAll();c=true;b()});else c=true;if(l.overlayImage)this.setOverlayImage(l.overlayImage,function(){a.overlayImageLeft=l.overlayImageLeft||0;a.overlayImageTop=l.overlayImageTop||0;a.renderAll();d=true;b()});else d=true;if(l.background)this.setBackgroundColor(l.background,function(){a.renderAll();f=true;b()});else f=true;!l.backgroundImage&&!l.overlayImage&&!l.background&&e&&e()},_enlivenObjects:function(l,e,a){var f=this;l.length===0&&e&&e();var c=
this.renderOnAddRemove;this.renderOnAddRemove=false;fabric.util.enlivenObjects(l,function(d){d.forEach(function(b,g){f.insertAt(b,g,true)});f.renderOnAddRemove=c;e&&e()},null,a)},_toDataURL:function(l,e){this.clone(function(a){e(a.toDataURL(l))})},_toDataURLWithMultiplier:function(l,e,a){this.clone(function(f){a(f.toDataURLWithMultiplier(l,e))})},clone:function(l){var e=JSON.stringify(this);this.cloneWithoutData(function(a){a.loadFromJSON(e,function(){l&&l(a)})})},cloneWithoutData:function(l){var e=
fabric.document.createElement("canvas");e.width=this.getWidth();e.height=this.getHeight();var a=new fabric.Canvas(e);a.clipTo=this.clipTo;if(this.backgroundImage){a.setBackgroundImage(this.backgroundImage.src,function(){a.renderAll();l&&l(a)});a.backgroundImageOpacity=this.backgroundImageOpacity;a.backgroundImageStretch=this.backgroundImageStretch}else l&&l(a)}});
(function(){var l=fabric.util.degreesToRadians,e=fabric.util.radiansToDegrees;fabric.util.object.extend(fabric.Canvas.prototype,{__onTransformGesture:function(a,f){if(!(this.isDrawingMode||a.touches.length!==2||"gesture"!==f.gesture)){var c=this.findTarget(a);if("undefined"!==typeof c){this.onBeforeScaleRotate(c);this._rotateObjectByAngle(f.rotation);this._scaleObjectBy(f.scale)}this.fire("touch:gesture",{target:c,e:a,self:f})}},_scaleObjectBy:function(a,f){var c=this._currentTransform,d=c.target,
b=d.get("lockScalingX"),g=d.get("lockScalingY");if(!(b&&g)){d._scaling=true;if(f)if(f==="x"&&!d.get("lockUniScaling"))b||d.set("scaleX",c.scaleX*a);else{if(f==="y"&&!d.get("lockUniScaling"))g||d.set("scaleY",c.scaleY*a)}else{b||d.set("scaleX",c.scaleX*a);g||d.set("scaleY",c.scaleY*a)}}},_rotateObjectByAngle:function(a){var f=this._currentTransform;if(!f.target.get("lockRotation"))f.target.angle=e(l(a)+f.theta)}})})();
(function(l){var e=l.fabric||(l.fabric={});l=e.util.object.extend;var a=e.util.toFixed,f=e.util.string.capitalize,c=e.util.degreesToRadians,d=e.StaticCanvas.supports("setLineDash");if(!e.Object){e.Object=e.util.createClass({type:"object",originX:"center",originY:"center",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:false,flipY:false,opacity:1,angle:0,cornerSize:12,transparentCorners:true,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centerTransform:false,
fill:"rgb(0,0,0)",fillRule:"source-over",overlayFill:null,stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0.01,selectable:true,visible:true,hasControls:true,hasBorders:true,hasRotatingPoint:true,rotatingPointOffset:40,perPixelTargetFind:false,includeDefaultValues:true,clipTo:null,lockMovementX:false,lockMovementY:false,lockRotation:false,lockScalingX:false,
lockScalingY:false,lockUniScaling:false,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule overlayFill shadow clipTo visible".split(" "),initialize:function(b){b&&this.setOptions(b)},_initGradient:function(b){b.fill&&b.fill.colorStops&&!(b.fill instanceof e.Gradient)&&this.set("fill",new e.Gradient(b.fill))},_initPattern:function(b){b.fill&&b.fill.source&&
!(b.fill instanceof e.Pattern)&&this.set("fill",new e.Pattern(b.fill));b.stroke&&b.stroke.source&&!(b.stroke instanceof e.Pattern)&&this.set("stroke",new e.Pattern(b.stroke))},_initClipping:function(b){if(!(!b.clipTo||typeof b.clipTo!=="string")){b=e.util.getFunctionBody(b.clipTo);if(typeof b!=="undefined")this.clipTo=new Function("ctx",b)}},setOptions:function(b){for(var g in b)this.set(g,b[g]);this._initGradient(b);this._initPattern(b);this._initClipping(b)},transform:function(b,g){b.globalAlpha=
this.opacity;var h=g?this._getLeftTopCoords():this.getCenterPoint();b.translate(h.x,h.y);b.rotate(c(this.angle));b.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(b){var g=e.Object.NUM_FRACTION_DIGITS;g={type:this.type,originX:this.originX,originY:this.originY,left:a(this.left,g),top:a(this.top,g),width:a(this.width,g),height:a(this.height,g),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,overlayFill:this.overlayFill,stroke:this.stroke&&this.stroke.toObject?
this.stroke.toObject():this.stroke,strokeWidth:a(this.strokeWidth,g),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:a(this.strokeMiterLimit,g),scaleX:a(this.scaleX,g),scaleY:a(this.scaleY,g),angle:a(this.getAngle(),g),flipX:this.flipX,flipY:this.flipY,opacity:a(this.opacity,g),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo)};this.includeDefaultValues||
(g=this._removeDefaultValues(g));e.util.populateWithProperties(this,g,b);return g},toDatalessObject:function(b){return this.toObject(b)},getSvgStyles:function(){var b=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",g=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",h=this.strokeWidth?this.strokeWidth:"0",j=this.strokeDashArray?this.strokeDashArray.join(" "):"";return["stroke: ",g,"; stroke-width: ",h,"; stroke-dasharray: ",j,"; stroke-linecap: ",
this.strokeLineCap?this.strokeLineCap:"butt","; stroke-linejoin: ",this.strokeLineJoin?this.strokeLineJoin:"miter","; stroke-miterlimit: ",this.strokeMiterLimit?this.strokeMiterLimit:"4","; fill: ",b,"; opacity: ",typeof this.opacity!=="undefined"?this.opacity:"1",";",this.shadow&&this.type!=="text"?"filter: url(#SVGID_"+this.shadow.id+");":"",this.visible?"":" visibility: hidden;"].join("")},getSvgTransform:function(){var b=this.getAngle(),g=this.getCenterPoint(),h=e.Object.NUM_FRACTION_DIGITS;g=
"translate("+a(g.x,h)+" "+a(g.y,h)+")";b=b!==0?" rotate("+a(b,h)+")":"";h=this.scaleX===1&&this.scaleY===1?"":" scale("+a(this.scaleX,h)+" "+a(this.scaleY,h)+")";return[g,b,h,this.flipX?"matrix(-1 0 0 1 0 0) ":"",this.flipY?"matrix(1 0 0 -1 0 0)":""].join("")},_createBaseSVGMarkup:function(){var b=[];this.fill&&this.fill.toLive&&b.push(this.fill.toSVG(this,false));this.stroke&&this.stroke.toLive&&b.push(this.stroke.toSVG(this,false));this.shadow&&b.push(this.shadow.toSVG(this));return b},_removeDefaultValues:function(b){this.stateProperties.forEach(function(g){b[g]===
this.constructor.prototype[g]&&delete b[g]},this);return b},toString:function(){return"#<fabric."+f(this.type)+">"},get:function(b){return this[b]},set:function(b,g){if(typeof b==="object")for(var h in b)this._set(h,b[h]);else typeof g==="function"&&b!=="clipTo"?this._set(b,g(this.get(b))):this._set(b,g);return this},_set:function(b,g){if(b==="scaleX"||b==="scaleY")g=this._constrainScale(g);if(b==="scaleX"&&g<0){this.flipX=!this.flipX;g*=-1}else if(b==="scaleY"&&g<0){this.flipY=!this.flipY;g*=-1}else if(b===
"width"||b==="height")this.minScaleLimit=a(Math.min(0.1,1/Math.max(this.width,this.height)),2);else if(b==="shadow"&&g&&!(g instanceof e.Shadow))g=new e.Shadow(g);this[b]=g;return this},toggle:function(b){var g=this.get(b);typeof g==="boolean"&&this.set(b,!g);return this},setSourcePath:function(b){this.sourcePath=b;return this},render:function(b,g){if(!(this.width===0||this.height===0||!this.visible)){b.save();var h=this.transformMatrix;h&&!this.group&&b.setTransform(h[0],h[1],h[2],h[3],h[4],h[5]);
g||this.transform(b);if(this.stroke){b.lineWidth=this.strokeWidth;b.lineCap=this.strokeLineCap;b.lineJoin=this.strokeLineJoin;b.miterLimit=this.strokeMiterLimit;b.strokeStyle=this.stroke.toLive?this.stroke.toLive(b):this.stroke}if(this.overlayFill)b.fillStyle=this.overlayFill;else if(this.fill)b.fillStyle=this.fill.toLive?this.fill.toLive(b):this.fill;if(h&&this.group){b.translate(-this.group.width/2,-this.group.height/2);b.transform(h[0],h[1],h[2],h[3],h[4],h[5])}this._setShadow(b);this.clipTo&&
e.util.clipContext(this,b);this._render(b,g);this.clipTo&&b.restore();this._removeShadow(b);if(this.active&&!g){this.drawBorders(b);this.drawControls(b)}b.restore()}},_setShadow:function(b){if(this.shadow){b.shadowColor=this.shadow.color;b.shadowBlur=this.shadow.blur;b.shadowOffsetX=this.shadow.offsetX;b.shadowOffsetY=this.shadow.offsetY}},_removeShadow:function(b){b.shadowColor="";b.shadowBlur=b.shadowOffsetX=b.shadowOffsetY=0},_renderFill:function(b){if(this.fill){if(this.fill.toLive){b.save();
b.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0)}b.fill();this.fill.toLive&&b.restore();this.shadow&&!this.shadow.affectStroke&&this._removeShadow(b)}},_renderStroke:function(b){if(this.stroke){b.save();if(this.strokeDashArray){1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray);if(d){b.setLineDash(this.strokeDashArray);this._stroke&&this._stroke(b)}else this._renderDashedStroke&&this._renderDashedStroke(b);b.stroke()}else this._stroke?
this._stroke(b):b.stroke();this._removeShadow(b);b.restore()}},clone:function(b,g){if(this.constructor.fromObject)return this.constructor.fromObject(this.toObject(g),b);return new e.Object(this.toObject(g))},cloneAsImage:function(b){var g=this.toDataURL();e.util.loadImage(g,function(h){b&&b(new e.Image(h))});return this},toDataURL:function(b){b||(b={});var g=e.util.createCanvasElement(),h=this.getBoundingRect();g.width=h.width;g.height=h.height;e.util.wrapElement(g,"div");h=new e.Canvas(g);if(b.format===
"jpg")b.format="jpeg";if(b.format==="jpeg")h.backgroundColor="#fff";var j={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",false);this.setPositionByOrigin(new e.Point(g.width/2,g.height/2),"center","center");h.add(this);b=h.toDataURL(b);this.set(j).setCoords();h.dispose();return b},isType:function(b){return this.type===b},toGrayscale:function(){var b=this.get("fill");b&&this.set("overlayFill",(new e.Color(b)).toGrayscale().toRgb());return this},complexity:function(){return 0},
toJSON:function(b){return this.toObject(b)},setGradient:function(b,g){g||(g={});var h={colorStops:[]};h.type=g.type||(g.r1||g.r2?"radial":"linear");h.coords={x1:g.x1,y1:g.y1,x2:g.x2,y2:g.y2};if(g.r1||g.r2){h.coords.r1=g.r1;h.coords.r2=g.r2}for(var j in g.colorStops){var i=new e.Color(g.colorStops[j]);h.colorStops.push({offset:j,color:i.toRgb(),opacity:i.getAlpha()})}return this.set(b,e.Gradient.forObject(this,h))},setPatternFill:function(b){return this.set("fill",new e.Pattern(b))},setShadow:function(b){return this.set("shadow",
new e.Shadow(b))},setColor:function(b){this.set("fill",b);return this},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){return this.centerH().centerV()},remove:function(){return this.canvas.remove(this)},sendToBack:function(){this.group?e.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this);return this},bringToFront:function(){this.group?e.StaticCanvas.prototype.bringToFront.call(this.group,
this):this.canvas.bringToFront(this);return this},sendBackwards:function(b){this.group?e.StaticCanvas.prototype.sendBackwards.call(this.group,this,b):this.canvas.sendBackwards(this,b);return this},bringForward:function(b){this.group?e.StaticCanvas.prototype.bringForward.call(this.group,this,b):this.canvas.bringForward(this,b);return this},moveTo:function(b){this.group?e.StaticCanvas.prototype.moveTo.call(this.group,this,b):this.canvas.moveTo(this,b);return this}});e.util.createAccessors(e.Object);
e.Object.prototype.rotate=e.Object.prototype.setAngle;l(e.Object.prototype,e.Observable);e.Object.NUM_FRACTION_DIGITS=2;e.Object.__uid=0}})(typeof exports!=="undefined"?exports:this);
(function(){var l=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(e,a,f){var c=e.x,d=e.y;if(a==="left")c=e.x+(this.getWidth()+this.strokeWidth*this.scaleX)/2;else if(a==="right")c=e.x-(this.getWidth()+this.strokeWidth*this.scaleX)/2;if(f==="top")d=e.y+(this.getHeight()+this.strokeWidth*this.scaleY)/2;else if(f==="bottom")d=e.y-(this.getHeight()+this.strokeWidth*this.scaleY)/2;return fabric.util.rotatePoint(new fabric.Point(c,d),e,l(this.angle))},
translateToOriginPoint:function(e,a,f){var c=e.x,d=e.y;if(a==="left")c=e.x-(this.getWidth()+this.strokeWidth*this.scaleX)/2;else if(a==="right")c=e.x+(this.getWidth()+this.strokeWidth*this.scaleX)/2;if(f==="top")d=e.y-(this.getHeight()+this.strokeWidth*this.scaleY)/2;else if(f==="bottom")d=e.y+(this.getHeight()+this.strokeWidth*this.scaleY)/2;return fabric.util.rotatePoint(new fabric.Point(c,d),e,l(this.angle))},getCenterPoint:function(){return this.translateToCenterPoint(new fabric.Point(this.left,
this.top),this.originX,this.originY)},getPointByOrigin:function(e,a){return this.translateToOriginPoint(this.getCenterPoint(),e,a)},toLocalPoint:function(e,a,f){var c=this.getCenterPoint();if(a!==undefined&&f!==undefined){a=a==="left"?c.x-(this.getWidth()+this.strokeWidth*this.scaleX)/2:a==="right"?c.x+(this.getWidth()+this.strokeWidth*this.scaleX)/2:c.x;f=f==="top"?c.y-(this.getHeight()+this.strokeWidth*this.scaleY)/2:f==="bottom"?c.y+(this.getHeight()+this.strokeWidth*this.scaleY)/2:c.y}else{a=
this.left;f=this.top}return fabric.util.rotatePoint(new fabric.Point(e.x,e.y),c,-l(this.angle)).subtractEquals(new fabric.Point(a,f))},setPositionByOrigin:function(e,a,f){e=this.translateToOriginPoint(this.translateToCenterPoint(e,a,f),this.originX,this.originY);this.set("left",e.x);this.set("top",e.y)},adjustPosition:function(e){var a=l(this.angle),f=this.getWidth()/2,c=Math.cos(a)*f;f=Math.sin(a)*f;var d=this.getWidth(),b=Math.cos(a)*d;a=Math.sin(a)*d;if(this.originX==="center"&&e==="left"||this.originX===
"right"&&e==="center"){this.left-=c;this.top-=f}else if(this.originX==="left"&&e==="center"||this.originX==="center"&&e==="right"){this.left+=c;this.top+=f}else if(this.originX==="left"&&e==="right"){this.left+=b;this.top+=a}else if(this.originX==="right"&&e==="left"){this.left-=b;this.top-=a}this.setCoords();this.originX=e},_getLeftTopCoords:function(){var e=l(this.angle),a=this.getWidth()/2,f=Math.cos(e)*a;e=Math.sin(e)*a;a=this.left;var c=this.top;if(this.originX==="center"||this.originX==="right")a-=
f;if(this.originY==="center"||this.originY==="bottom")c-=e;return{x:a,y:c}}})})();
(function(){var l=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(e,a){var f=this.oCoords,c=new fabric.Point(f.tl.x,f.tl.y),d=new fabric.Point(f.tr.x,f.tr.y),b=new fabric.Point(f.bl.x,f.bl.y);f=new fabric.Point(f.br.x,f.br.y);return fabric.Intersection.intersectPolygonRectangle([c,d,f,b],e,a).status==="Intersection"},intersectsWithObject:function(e){function a(c){return{tl:new fabric.Point(c.tl.x,c.tl.y),tr:new fabric.Point(c.tr.x,
c.tr.y),bl:new fabric.Point(c.bl.x,c.bl.y),br:new fabric.Point(c.br.x,c.br.y)}}var f=a(this.oCoords);e=a(e.oCoords);return fabric.Intersection.intersectPolygonPolygon([f.tl,f.tr,f.br,f.bl],[e.tl,e.tr,e.br,e.bl]).status==="Intersection"},isContainedWithinObject:function(e){var a=e.getBoundingRect();e=new fabric.Point(a.left,a.top);a=new fabric.Point(a.left+a.width,a.top+a.height);return this.isContainedWithinRect(e,a)},isContainedWithinRect:function(e,a){var f=this.getBoundingRect();return f.left>
e.x&&f.left+f.width<a.x&&f.top>e.y&&f.top+f.height<a.y},containsPoint:function(e){var a=this._getImageLines(this.oCoords);e=this._findCrossPoints(e,a);return e!==0&&e%2===1},_getImageLines:function(e){return{topline:{o:e.tl,d:e.tr},rightline:{o:e.tr,d:e.br},bottomline:{o:e.br,d:e.bl},leftline:{o:e.bl,d:e.tl}}},_findCrossPoints:function(e,a){var f,c,d,b=0;for(var g in a){d=a[g];if(!(d.o.y<e.y&&d.d.y<e.y))if(!(d.o.y>=e.y&&d.d.y>=e.y)){if(d.o.x===d.d.x&&d.o.x>=e.x)f=d.o.x;else{f=(d.d.y-d.o.y)/(d.d.x-
d.o.x);c=e.y-0*e.x;d=d.o.y-f*d.o.x;f=-(c-d)/(0-f)}if(f>=e.x)b+=1;if(b===2)break}}return b},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var e=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],a=fabric.util.array.min(e);e=fabric.util.array.max(e);e=Math.abs(a-e);var f=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],
c=fabric.util.array.min(f);f=fabric.util.array.max(f);return{left:a,top:c,width:e,height:Math.abs(c-f)}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(e){if(Math.abs(e)<this.minScaleLimit)return e<0?-this.minScaleLimit:this.minScaleLimit;return e},scale:function(e){e=this._constrainScale(e);if(e<0){this.flipX=!this.flipX;this.flipY=!this.flipY;e*=-1}this.scaleY=this.scaleX=e;this.setCoords();return this},scaleToWidth:function(e){var a=
this.getBoundingRectWidth()/this.getWidth();return this.scale(e/this.width/a)},scaleToHeight:function(e){var a=this.getBoundingRectHeight()/this.getHeight();return this.scale(e/this.height/a)},setCoords:function(){var e=this.strokeWidth>1?this.strokeWidth:0,a=this.padding,f=l(this.angle);this.currentWidth=(this.width+e)*this.scaleX+a*2;this.currentHeight=(this.height+e)*this.scaleY+a*2;if(this.currentWidth<0)this.currentWidth=Math.abs(this.currentWidth);e=Math.sqrt(Math.pow(this.currentWidth/2,2)+
Math.pow(this.currentHeight/2,2));var c=Math.atan(isFinite(this.currentHeight/this.currentWidth)?this.currentHeight/this.currentWidth:0);a=Math.cos(c+f)*e;c=Math.sin(c+f)*e;e=Math.sin(f);f=Math.cos(f);var d=this.getCenterPoint();a={x:d.x-a,y:d.y-c};c={x:a.x+this.currentWidth*f,y:a.y+this.currentWidth*e};d={x:a.x-this.currentHeight*e,y:a.y+this.currentHeight*f};var b={x:a.x+this.currentWidth/2*f,y:a.y+this.currentWidth/2*e};this.oCoords={tl:a,tr:c,br:{x:c.x-this.currentHeight*e,y:c.y+this.currentHeight*
f},bl:d,ml:{x:a.x-this.currentHeight/2*e,y:a.y+this.currentHeight/2*f},mt:b,mr:{x:c.x-this.currentHeight/2*e,y:c.y+this.currentHeight/2*f},mb:{x:d.x+this.currentWidth/2*f,y:d.y+this.currentWidth/2*e},mtr:{x:b.x,y:b.y}};this._setCornerCoords&&this._setCornerCoords();return this}})})();
fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(l){return this.get(l)!==this.originalState[l]},this)},saveState:function(l){this.stateProperties.forEach(function(e){this.originalState[e]=this.get(e)},this);l&&l.stateProperties&&l.stateProperties.forEach(function(e){this.originalState[e]=this.get(e)},this);return this},setupState:function(){this.originalState={};this.saveState();return this}});
(function(){var l=fabric.util.getPointer,e=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_findTargetCorner:function(a,f){if(!this.hasControls||!this.active)return false;var c=l(a,this.canvas.upperCanvasEl),d=c.x-f.left;c=c.y-f.top;var b;for(var g in this.oCoords)if(!(g==="mtr"&&!this.hasRotatingPoint))if(!(this.get("lockUniScaling")&&(g==="mt"||g==="mr"||g==="mb"||g==="ml"))){b=this._getImageLines(this.oCoords[g].corner);b=this._findCrossPoints({x:d,y:c},b);if(b!==
0&&b%2===1)return this.__corner=g}return false},_setCornerCoords:function(){var a=this.oCoords,f=e(this.angle),c=e(45-this.angle),d=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,b=d*Math.cos(c);c=d*Math.sin(c);d=Math.sin(f);f=Math.cos(f);a.tl.corner={tl:{x:a.tl.x-c,y:a.tl.y-b},tr:{x:a.tl.x+b,y:a.tl.y-c},bl:{x:a.tl.x-b,y:a.tl.y+c},br:{x:a.tl.x+c,y:a.tl.y+b}};a.tr.corner={tl:{x:a.tr.x-c,y:a.tr.y-b},tr:{x:a.tr.x+b,y:a.tr.y-c},br:{x:a.tr.x+c,y:a.tr.y+b},bl:{x:a.tr.x-b,y:a.tr.y+c}};a.bl.corner={tl:{x:a.bl.x-
c,y:a.bl.y-b},bl:{x:a.bl.x-b,y:a.bl.y+c},br:{x:a.bl.x+c,y:a.bl.y+b},tr:{x:a.bl.x+b,y:a.bl.y-c}};a.br.corner={tr:{x:a.br.x+b,y:a.br.y-c},bl:{x:a.br.x-b,y:a.br.y+c},br:{x:a.br.x+c,y:a.br.y+b},tl:{x:a.br.x-c,y:a.br.y-b}};a.ml.corner={tl:{x:a.ml.x-c,y:a.ml.y-b},tr:{x:a.ml.x+b,y:a.ml.y-c},bl:{x:a.ml.x-b,y:a.ml.y+c},br:{x:a.ml.x+c,y:a.ml.y+b}};a.mt.corner={tl:{x:a.mt.x-c,y:a.mt.y-b},tr:{x:a.mt.x+b,y:a.mt.y-c},bl:{x:a.mt.x-b,y:a.mt.y+c},br:{x:a.mt.x+c,y:a.mt.y+b}};a.mr.corner={tl:{x:a.mr.x-c,y:a.mr.y-b},
tr:{x:a.mr.x+b,y:a.mr.y-c},bl:{x:a.mr.x-b,y:a.mr.y+c},br:{x:a.mr.x+c,y:a.mr.y+b}};a.mb.corner={tl:{x:a.mb.x-c,y:a.mb.y-b},tr:{x:a.mb.x+b,y:a.mb.y-c},bl:{x:a.mb.x-b,y:a.mb.y+c},br:{x:a.mb.x+c,y:a.mb.y+b}};a.mtr.corner={tl:{x:a.mtr.x-c+d*this.rotatingPointOffset,y:a.mtr.y-b-f*this.rotatingPointOffset},tr:{x:a.mtr.x+b+d*this.rotatingPointOffset,y:a.mtr.y-c-f*this.rotatingPointOffset},bl:{x:a.mtr.x-b+d*this.rotatingPointOffset,y:a.mtr.y+c-f*this.rotatingPointOffset},br:{x:a.mtr.x+c+d*this.rotatingPointOffset,
y:a.mtr.y+b-f*this.rotatingPointOffset}}},drawBorders:function(a){if(!this.hasBorders)return this;var f=this.padding,c=f*2,d=~~(this.strokeWidth/2)*2;a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=this.borderColor;var b=1/this._constrainScale(this.scaleX),g=1/this._constrainScale(this.scaleY);a.lineWidth=1/this.borderScaleFactor;a.scale(b,g);b=this.getWidth();g=this.getHeight();a.strokeRect(~~(-(b/2)-f-d/2*this.scaleX)-0.5,~~(-(g/2)-f-d/2*this.scaleY)-0.5,~~(b+c+
d*this.scaleX)+1,~~(g+c+d*this.scaleY)+1);if(this.hasRotatingPoint&&!this.get("lockRotation")&&this.hasControls){f=(this.flipY?g+d*this.scaleY+f*2:-g-d*this.scaleY-f*2)/2;a.beginPath();a.moveTo(0,f);a.lineTo(0,f+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset));a.closePath();a.stroke()}a.restore();return this},drawControls:function(a){if(!this.hasControls)return this;var f=this.cornerSize,c=f/2,d=~~(this.strokeWidth/2),b=-(this.width/2),g=-(this.height/2),h=f/this.scaleX,j=f/this.scaleY,
i=this.padding/this.scaleX,k=this.padding/this.scaleY,m=c/this.scaleY,n=c/this.scaleX,q=(c-f)/this.scaleX,t=(c-f)/this.scaleY,w=this.height,y=this.width,s=this.transparentCorners?"strokeRect":"fillRect",v=this.transparentCorners,p=typeof G_vmlCanvasManager!=="undefined";a.save();a.lineWidth=1/Math.max(this.scaleX,this.scaleY);a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=a.fillStyle=this.cornerColor;f=b-n-d-i;c=g-m-d-k;p||v||a.clearRect(f,c,h,j);a[s](f,c,h,j);f=b+y-n+d+
i;c=g-m-d-k;p||v||a.clearRect(f,c,h,j);a[s](f,c,h,j);f=b-n-d-i;c=g+w+t+d+k;p||v||a.clearRect(f,c,h,j);a[s](f,c,h,j);f=b+y+q+d+i;c=g+w+t+d+k;p||v||a.clearRect(f,c,h,j);a[s](f,c,h,j);if(!this.get("lockUniScaling")){f=b+y/2-n;c=g-m-d-k;p||v||a.clearRect(f,c,h,j);a[s](f,c,h,j);f=b+y/2-n;c=g+w+t+d+k;p||v||a.clearRect(f,c,h,j);a[s](f,c,h,j);f=b+y+q+d+i;c=g+w/2-m;p||v||a.clearRect(f,c,h,j);a[s](f,c,h,j);f=b-n-d-i;c=g+w/2-m;p||v||a.clearRect(f,c,h,j);a[s](f,c,h,j)}if(this.hasRotatingPoint){f=b+y/2-n;c=this.flipY?
g+w+this.rotatingPointOffset/this.scaleY-j/2+d+k:g-this.rotatingPointOffset/this.scaleY-j/2-d-k;p||v||a.clearRect(f,c,h,j);a[s](f,c,h,j)}a.restore();return this}})})();
fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(l,e){e=e||{};var a=function(){},f=e.onComplete||a,c=e.onChange||a,d=this;fabric.util.animate({startValue:l.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(b){l.set("left",b);d.renderAll();c()},onComplete:function(){l.setCoords();f()}});return this},fxCenterObjectV:function(l,e){e=e||{};var a=function(){},f=e.onComplete||a,c=e.onChange||a,d=this;fabric.util.animate({startValue:l.get("top"),
endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(b){l.set("top",b);d.renderAll();c()},onComplete:function(){l.setCoords();f()}});return this},fxRemove:function(l,e){e=e||{};var a=function(){},f=e.onComplete||a,c=e.onChange||a,d=this;fabric.util.animate({startValue:l.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){l.set("active",false)},onChange:function(b){l.set("opacity",b);d.renderAll();c()},onComplete:function(){d.remove(l);f()}});return this}});
fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]==="object"){var l=[],e,a;for(e in arguments[0])l.push(e);for(var f=0,c=l.length;f<c;f++){e=l[f];a=f!==c-1;this._animate(e,arguments[0][e],arguments[1],a)}}else this._animate.apply(this,arguments);return this},_animate:function(l,e,a,f){var c=this,d;e=e.toString();a=a?fabric.util.object.clone(a):{};if(~l.indexOf("."))d=l.split(".");var b=d?this.get(d[0])[d[1]]:this.get(l);if(!("from"in a))a.from=
b;e=~e.indexOf("=")?b+parseFloat(e.replace("=","")):parseFloat(e);fabric.util.animate({startValue:a.from,endValue:e,byValue:a.by,easing:a.easing,duration:a.duration,abort:a.abort&&function(){return a.abort.call(c)},onChange:function(g){if(d)c[d[0]][d[1]]=g;else c.set(l,g);f||a.onChange&&a.onChange()},onComplete:function(){if(!f){c.setCoords();a.onComplete&&a.onComplete()}}})}});
(function(l){var e=l.fabric||(l.fabric={}),a=e.util.object.extend,f={x1:1,x2:1,y1:1,y2:1},c=e.StaticCanvas.supports("setLineDash");if(e.Line)e.warn("fabric.Line is already defined");else{e.Line=e.util.createClass(e.Object,{type:"line",initialize:function(d,b){b=b||{};d||(d=[0,0,0,0]);this.callSuper("initialize",b);this.set("x1",d[0]);this.set("y1",d[1]);this.set("x2",d[2]);this.set("y2",d[3]);this._setWidthHeight(b)},_setWidthHeight:function(d){d||(d={});this.set("width",Math.abs(this.x2-this.x1)||
1);this.set("height",Math.abs(this.y2-this.y1)||1);this.set("left","left"in d?d.left:Math.min(this.x1,this.x2)+this.width/2);this.set("top","top"in d?d.top:Math.min(this.y1,this.y2)+this.height/2)},_set:function(d,b){this[d]=b;d in f&&this._setWidthHeight();return this},_render:function(d){d.beginPath();this.group&&this.group.type!=="group"&&!this.transformMatrix&&d.translate(-this.group.width/2+this.left,-this.group.height/2+this.top);if(!this.strokeDashArray||this.strokeDashArray&&c){var b=this.x1<=
this.x2?-1:1,g=this.y1<=this.y2?-1:1;d.moveTo(this.width===1?0:b*this.width/2,this.height===1?0:g*this.height/2);d.lineTo(this.width===1?0:b*-1*this.width/2,this.height===1?0:g*-1*this.height/2)}d.lineWidth=this.strokeWidth;b=d.strokeStyle;d.strokeStyle=this.stroke||d.fillStyle;this._renderStroke(d);d.strokeStyle=b},_renderDashedStroke:function(d){var b=this.x1<=this.x2?-1:1,g=this.y1<=this.y2?-1:1;b=this.width===1?0:b*this.width/2;g=this.height===1?0:g*this.height/2;d.beginPath();e.util.drawDashedLine(d,
b,g,-b,-g,this.strokeDashArray);d.closePath()},toObject:function(d){return a(this.callSuper("toObject",d),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},toSVG:function(){var d=this._createBaseSVGMarkup();d.push("<line ",'x1="',this.get("x1"),'" y1="',this.get("y1"),'" x2="',this.get("x2"),'" y2="',this.get("y2"),'" style="',this.getSvgStyles(),'"/>');return d.join("")},complexity:function(){return 1}});e.Line.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" "));
e.Line.fromElement=function(d,b){var g=e.parseAttributes(d,e.Line.ATTRIBUTE_NAMES);return new e.Line([g.x1||0,g.y1||0,g.x2||0,g.y2||0],a(g,b))};e.Line.fromObject=function(d){return new e.Line([d.x1,d.y1,d.x2,d.y2],d)}}})(typeof exports!=="undefined"?exports:this);
(function(l){var e=l.fabric||(l.fabric={}),a=Math.PI*2,f=e.util.object.extend;if(e.Circle)e.warn("fabric.Circle is already defined.");else{e.Circle=e.util.createClass(e.Object,{type:"circle",initialize:function(c){c=c||{};this.set("radius",c.radius||0);this.callSuper("initialize",c)},_set:function(c,d){this.callSuper("_set",c,d);c==="radius"&&this.setRadius(d);return this},toObject:function(c){return f(this.callSuper("toObject",c),{radius:this.get("radius")})},toSVG:function(){var c=this._createBaseSVGMarkup();
c.push("<circle ",'cx="0" cy="0" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return c.join("")},_render:function(c,d){c.beginPath();c.globalAlpha=this.group?c.globalAlpha*this.opacity:this.opacity;c.arc(d?this.left:0,d?this.top:0,this.radius,0,a,false);c.closePath();this._renderFill(c);this._renderStroke(c)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(c){this.radius=
c;this.set("width",c*2).set("height",c*2)},complexity:function(){return 1}});e.Circle.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy r".split(" "));e.Circle.fromElement=function(c,d){d||(d={});var b=e.parseAttributes(c,e.Circle.ATTRIBUTE_NAMES);if(!("radius"in b&&b.radius>0))throw Error("value of `r` attribute is required and can not be negative");if("left"in b)b.left-=d.width/2||0;if("top"in b)b.top-=d.height/2||0;b=new e.Circle(f(b,d));b.cx=parseFloat(c.getAttribute("cx"))||0;b.cy=parseFloat(c.getAttribute("cy"))||
0;return b};e.Circle.fromObject=function(c){return new e.Circle(c)}}})(typeof exports!=="undefined"?exports:this);
(function(l){var e=l.fabric||(l.fabric={});if(e.Triangle)e.warn("fabric.Triangle is already defined");else{e.Triangle=e.util.createClass(e.Object,{type:"triangle",initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("width",a.width||100).set("height",a.height||100)},_render:function(a){var f=this.width/2,c=this.height/2;a.beginPath();a.moveTo(-f,c);a.lineTo(0,-c);a.lineTo(f,c);a.closePath();this._renderFill(a);this._renderStroke(a)},_renderDashedStroke:function(a){var f=this.width/
2,c=this.height/2;a.beginPath();e.util.drawDashedLine(a,-f,c,0,-c,this.strokeDashArray);e.util.drawDashedLine(a,0,-c,f,c,this.strokeDashArray);e.util.drawDashedLine(a,f,c,-f,c,this.strokeDashArray);a.closePath()},toSVG:function(){var a=this._createBaseSVGMarkup(),f=this.width/2,c=this.height/2;f=[-f+" "+c,"0 "+-c,f+" "+c].join(",");a.push("<polygon ",'points="',f,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a.join("")},complexity:function(){return 1}});e.Triangle.fromObject=
function(a){return new e.Triangle(a)}}})(typeof exports!=="undefined"?exports:this);
(function(l){var e=l.fabric||(l.fabric={}),a=Math.PI*2,f=e.util.object.extend;if(e.Ellipse)e.warn("fabric.Ellipse is already defined.");else{e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",rx:0,ry:0,initialize:function(c){c=c||{};this.callSuper("initialize",c);this.set("rx",c.rx||0);this.set("ry",c.ry||0);this.set("width",this.get("rx")*2);this.set("height",this.get("ry")*2)},toObject:function(c){return f(this.callSuper("toObject",c),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(){var c=
this._createBaseSVGMarkup();c.push("<ellipse ",'rx="',this.get("rx"),'" ry="',this.get("ry"),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return c.join("")},render:function(c,d){if(!(this.rx===0||this.ry===0))return this.callSuper("render",c,d)},_render:function(c,d){c.beginPath();c.save();c.globalAlpha=this.group?c.globalAlpha*this.opacity:this.opacity;this.transformMatrix&&this.group&&c.translate(this.cx,this.cy);c.transform(1,0,0,this.ry/this.rx,0,0);c.arc(d?this.left:
0,d?this.top:0,this.rx,0,a,false);this._renderFill(c);this._renderStroke(c);c.restore()},complexity:function(){return 1}});e.Ellipse.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" "));e.Ellipse.fromElement=function(c,d){d||(d={});var b=e.parseAttributes(c,e.Ellipse.ATTRIBUTE_NAMES),g=b.left,h=b.top;if("left"in b)b.left-=d.width/2||0;if("top"in b)b.top-=d.height/2||0;b=new e.Ellipse(f(b,d));b.cx=g||0;b.cy=h||0;return b};e.Ellipse.fromObject=function(c){return new e.Ellipse(c)}}})(typeof exports!==
"undefined"?exports:this);
(function(l){var e=l.fabric||(l.fabric={}),a=e.util.object.extend;if(e.Rect)console.warn("fabric.Rect is already defined");else{l=e.Object.prototype.stateProperties.concat();l.push("rx","ry");e.Rect=e.util.createClass(e.Object,{stateProperties:l,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(f){f=f||{};this.callSuper("initialize",f);this._initRxRy();this.x=f.x||0;this.y=f.y||0},_initRxRy:function(){if(this.rx&&!this.ry)this.ry=this.rx;else if(this.ry&&!this.rx)this.rx=this.ry},_render:function(f){var c=
this.rx||0,d=this.ry||0,b=-this.width/2,g=-this.height/2,h=this.width,j=this.height,i=this.group&&this.group.type!=="group";f.beginPath();f.globalAlpha=i?f.globalAlpha*this.opacity:this.opacity;this.transformMatrix&&i&&f.translate(this.width/2+this.x,this.height/2+this.y);!this.transformMatrix&&i&&f.translate(-this.group.width/2+this.width/2+this.x,-this.group.height/2+this.height/2+this.y);i=c!==0||d!==0;f.moveTo(b+c,g);f.lineTo(b+h-c,g);i&&f.quadraticCurveTo(b+h,g,b+h,g+d,b+h,g+d);f.lineTo(b+h,
g+j-d);i&&f.quadraticCurveTo(b+h,g+j,b+h-c,g+j,b+h-c,g+j);f.lineTo(b+c,g+j);i&&f.quadraticCurveTo(b,g+j,b,g+j-d,b,g+j-d);f.lineTo(b,g+d);i&&f.quadraticCurveTo(b,g,b+c,g,b+c,g);f.closePath();this._renderFill(f);this._renderStroke(f)},_renderDashedStroke:function(f){var c=-this.width/2,d=-this.height/2,b=this.width,g=this.height;f.beginPath();e.util.drawDashedLine(f,c,d,c+b,d,this.strokeDashArray);e.util.drawDashedLine(f,c+b,d,c+b,d+g,this.strokeDashArray);e.util.drawDashedLine(f,c+b,d+g,c,d+g,this.strokeDashArray);
e.util.drawDashedLine(f,c,d+g,c,d,this.strokeDashArray);f.closePath()},_normalizeLeftTopProperties:function(f){"left"in f&&this.set("left",f.left+this.getWidth()/2);this.set("x",f.left||0);"top"in f&&this.set("top",f.top+this.getHeight()/2);this.set("y",f.top||0);return this},toObject:function(f){return a(this.callSuper("toObject",f),{rx:this.get("rx")||0,ry:this.get("ry")||0,x:this.get("x"),y:this.get("y")})},toSVG:function(){var f=this._createBaseSVGMarkup();f.push("<rect ",'x="',-1*this.width/
2,'" y="',-1*this.height/2,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return f.join("")},complexity:function(){return 1}});e.Rect.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" "));e.Rect.fromElement=function(f,c){if(!f)return null;var d=e.parseAttributes(f,e.Rect.ATTRIBUTE_NAMES);d=d;d.left=d.left||0;d.top=d.top||0;d=d;var b=new e.Rect(a(c?
e.util.object.clone(c):{},d));b._normalizeLeftTopProperties(d);return b};e.Rect.fromObject=function(f){return new e.Rect(f)}}})(typeof exports!=="undefined"?exports:this);
(function(l){var e=l.fabric||(l.fabric={}),a=e.util.toFixed,f=e.util.array.min;if(e.Polyline)e.warn("fabric.Polyline is already defined");else{e.Polyline=e.util.createClass(e.Object,{type:"polyline",initialize:function(c,d,b){d=d||{};this.set("points",c);this.callSuper("initialize",d);this._calcDimensions(b)},_calcDimensions:function(c){return e.Polygon.prototype._calcDimensions.call(this,c)},toObject:function(c){return e.Polygon.prototype.toObject.call(this,c)},toSVG:function(){for(var c=[],d=this._createBaseSVGMarkup(),
b=0,g=this.points.length;b<g;b++)c.push(a(this.points[b].x,2),",",a(this.points[b].y,2)," ");d.push("<polyline ",'points="',c.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return d.join("")},_render:function(c){var d;c.beginPath();c.moveTo(this.points[0].x,this.points[0].y);for(var b=0,g=this.points.length;b<g;b++){d=this.points[b];c.lineTo(d.x,d.y)}this._renderFill(c);this._renderStroke(c)},_renderDashedStroke:function(c){var d,b;c.beginPath();for(var g=0,
h=this.points.length;g<h;g++){d=this.points[g];b=this.points[g+1]||d;e.util.drawDashedLine(c,d.x,d.y,b.x,b.y,this.strokeDashArray)}},complexity:function(){return this.get("points").length}});e.Polyline.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat();e.Polyline.fromElement=function(c,d){if(!c)return null;d||(d={});var b=e.parsePointsAttribute(c.getAttribute("points")),g=e.parseAttributes(c,e.Polyline.ATTRIBUTE_NAMES),h=f(b,"x"),j=f(b,"y");h=h<0?h:0;j=h<0?j:0;for(var i=0,k=b.length;i<k;i++){b[i].x-=d.width/
2+h||0;b[i].y-=d.height/2+j||0}return new e.Polyline(b,e.util.object.extend(g,d),true)};e.Polyline.fromObject=function(c){return new e.Polyline(c.points,c,true)}}})(typeof exports!=="undefined"?exports:this);
(function(l){var e=l.fabric||(l.fabric={}),a=e.util.object.extend,f=e.util.array.min,c=e.util.array.max,d=e.util.toFixed;if(e.Polygon)e.warn("fabric.Polygon is already defined");else{e.Polygon=e.util.createClass(e.Object,{type:"polygon",initialize:function(b,g,h){g=g||{};this.points=b;this.callSuper("initialize",g);this._calcDimensions(h)},_calcDimensions:function(b){var g=this.points,h=f(g,"x"),j=f(g,"y"),i=c(g,"x");g=c(g,"y");this.width=i-h||1;this.height=g-j||1;this.minX=h;this.minY=j;if(!b){var k=
this.width/2+this.minX,m=this.height/2+this.minY;this.points.forEach(function(n){n.x-=k;n.y-=m},this)}},toObject:function(b){return a(this.callSuper("toObject",b),{points:this.points.concat()})},toSVG:function(){for(var b=[],g=this._createBaseSVGMarkup(),h=0,j=this.points.length;h<j;h++)b.push(d(this.points[h].x,2),",",d(this.points[h].y,2)," ");g.push("<polygon ",'points="',b.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return g.join("")},_render:function(b){var g;
b.beginPath();b.moveTo(this.points[0].x,this.points[0].y);for(var h=0,j=this.points.length;h<j;h++){g=this.points[h];b.lineTo(g.x,g.y)}this._renderFill(b);if(this.stroke||this.strokeDashArray){b.closePath();this._renderStroke(b)}},_renderDashedStroke:function(b){var g,h;b.beginPath();for(var j=0,i=this.points.length;j<i;j++){g=this.points[j];h=this.points[j+1]||this.points[0];e.util.drawDashedLine(b,g.x,g.y,h.x,h.y,this.strokeDashArray)}b.closePath()},complexity:function(){return this.points.length}});
e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat();e.Polygon.fromElement=function(b,g){if(!b)return null;g||(g={});var h=e.parsePointsAttribute(b.getAttribute("points")),j=e.parseAttributes(b,e.Polygon.ATTRIBUTE_NAMES),i=f(h,"x"),k=f(h,"y");i=i<0?i:0;k=i<0?k:0;for(var m=0,n=h.length;m<n;m++){h[m].x-=g.width/2+i||0;h[m].y-=g.height/2+k||0}return new e.Polygon(h,a(j,g),true)};e.Polygon.fromObject=function(b){return new e.Polygon(b.points,b,true)}}})(typeof exports!=="undefined"?exports:this);
(function(l){function e(i){if(i[0]==="H")return i[1];return i[i.length-2]}function a(i){if(i[0]==="V")return i[1];return i[i.length-1]}var f={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},c=l.fabric||(l.fabric={}),d=c.util.array.min,b=c.util.array.max,g=c.util.object.extend,h=Object.prototype.toString,j=c.util.drawArc;if(c.Path)c.warn("fabric.Path is already defined");else{c.Path=c.util.createClass(c.Object,{type:"path",initialize:function(i,k){k=k||{};this.setOptions(k);if(!i)throw Error("`path` argument is required");
var m=h.call(i)==="[object Array]";if(this.path=m?i:i.match&&i.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)){if(!m)this.path=this._parsePath();this._initializePath(k);k.sourcePath&&this.setSourcePath(k.sourcePath)}},_initializePath:function(i){var k="width"in i&&i.width!=null,m="height"in i&&i.width!=null,n="left"in i,q="top"in i,t=n?this.left:0,w=q?this.top:0;if(!k||!m){g(this,this._parseDimensions());if(k)this.width=i.width;if(m)this.height=i.height}else{if(!q)this.top=this.height/2;if(!n)this.left=this.width/
2}this.pathOffset=this.pathOffset||this._calculatePathOffset(t,w)},_calculatePathOffset:function(i,k){return{x:this.left-i-this.width/2,y:this.top-k-this.height/2}},_render:function(i){for(var k,m=null,n=0,q=0,t=0,w=0,y,s,v,p,o=-(this.width/2+this.pathOffset.x),r=-(this.height/2+this.pathOffset.y),u=0,x=this.path.length;u<x;++u){k=this.path[u];switch(k[0]){case "l":n+=k[1];q+=k[2];i.lineTo(n+o,q+r);break;case "L":n=k[1];q=k[2];i.lineTo(n+o,q+r);break;case "h":n+=k[1];i.lineTo(n+o,q+r);break;case "H":n=
k[1];i.lineTo(n+o,q+r);break;case "v":q+=k[1];i.lineTo(n+o,q+r);break;case "V":q=k[1];i.lineTo(n+o,q+r);break;case "m":n+=k[1];q+=k[2];i[m&&(m[0]==="m"||m[0]==="M")?"lineTo":"moveTo"](n+o,q+r);break;case "M":n=k[1];q=k[2];i[m&&(m[0]==="m"||m[0]==="M")?"lineTo":"moveTo"](n+o,q+r);break;case "c":y=n+k[5];s=q+k[6];t=n+k[3];w=q+k[4];i.bezierCurveTo(n+k[1]+o,q+k[2]+r,t+o,w+r,y+o,s+r);n=y;q=s;break;case "C":n=k[5];q=k[6];t=k[3];w=k[4];i.bezierCurveTo(k[1]+o,k[2]+r,t+o,w+r,n+o,q+r);break;case "s":y=n+k[3];
s=q+k[4];t=t?2*n-t:n;w=w?2*q-w:q;i.bezierCurveTo(t+o,w+r,n+k[1]+o,q+k[2]+r,y+o,s+r);t=n+k[1];w=q+k[2];n=y;q=s;break;case "S":y=k[3];s=k[4];t=2*n-t;w=2*q-w;i.bezierCurveTo(t+o,w+r,k[1]+o,k[2]+r,y+o,s+r);n=y;q=s;t=k[1];w=k[2];break;case "q":y=n+k[3];s=q+k[4];t=n+k[1];w=q+k[2];i.quadraticCurveTo(t+o,w+r,y+o,s+r);n=y;q=s;break;case "Q":y=k[3];s=k[4];i.quadraticCurveTo(k[1]+o,k[2]+r,y+o,s+r);n=y;q=s;t=k[1];w=k[2];break;case "t":y=n+k[1];s=q+k[2];if(m[0].match(/[QqTt]/)===null){t=n;w=q}else if(m[0]==="t"){t=
2*n-v;w=2*q-p}else if(m[0]==="q"){t=2*n-t;w=2*q-w}v=t;p=w;i.quadraticCurveTo(t+o,w+r,y+o,s+r);n=y;q=s;t=n+k[1];w=q+k[2];break;case "T":y=k[1];s=k[2];t=2*n-t;w=2*q-w;i.quadraticCurveTo(t+o,w+r,y+o,s+r);n=y;q=s;break;case "a":j(i,n+o,q+r,[k[1],k[2],k[3],k[4],k[5],k[6]+n+o,k[7]+q+r]);n+=k[6];q+=k[7];break;case "A":j(i,n+o,q+r,[k[1],k[2],k[3],k[4],k[5],k[6]+o,k[7]+r]);n=k[6];q=k[7];break;case "z":case "Z":i.closePath();break}m=k}},render:function(i,k){if(this.visible){i.save();var m=this.transformMatrix;
m&&i.transform(m[0],m[1],m[2],m[3],m[4],m[5]);k||this.transform(i);if(this.overlayFill)i.fillStyle=this.overlayFill;else if(this.fill)i.fillStyle=this.fill.toLive?this.fill.toLive(i):this.fill;if(this.stroke){i.lineWidth=this.strokeWidth;i.lineCap=this.strokeLineCap;i.lineJoin=this.strokeLineJoin;i.miterLimit=this.strokeMiterLimit;i.strokeStyle=this.stroke.toLive?this.stroke.toLive(i):this.stroke}this._setShadow(i);this.clipTo&&c.util.clipContext(this,i);i.beginPath();this._render(i);this._renderFill(i);
this._renderStroke(i);this.clipTo&&i.restore();this._removeShadow(i);if(!k&&this.active){this.drawBorders(i);this.drawControls(i)}i.restore()}},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(i){i=g(this.callSuper("toObject",i),{path:this.path,pathOffset:this.pathOffset});if(this.sourcePath)i.sourcePath=this.sourcePath;if(this.transformMatrix)i.transformMatrix=this.transformMatrix;return i},toDatalessObject:function(i){i=
this.toObject(i);if(this.sourcePath)i.path=this.sourcePath;delete i.sourcePath;return i},toSVG:function(){for(var i=[],k=this._createBaseSVGMarkup(),m=0,n=this.path.length;m<n;m++)i.push(this.path[m].join(" "));i=i.join(" ");k.push('<g transform="',this.group?"":this.getSvgTransform(),'">',"<path ",'d="',i,'" style="',this.getSvgStyles(),'" transform="translate(',-this.width/2," ",-this.height/2,")",'" stroke-linecap="round" ',"/>","</g>");return k.join("")},complexity:function(){return this.path.length},
_parsePath:function(){for(var i=[],k=[],m,n,q=/(-?\.\d+)|(-?\d+(\.\d+)?)/g,t,w=0,y=this.path.length;w<y;w++){m=this.path[w];t=m.slice(1).trim();for(k.length=0;n=q.exec(t);)k.push(n[0]);m=[m.charAt(0)];t=0;for(var s=k.length;t<s;t++){n=parseFloat(k[t]);isNaN(n)||m.push(n)}n=m[0].toLowerCase();n=f[n];if(m.length-1>n){t=1;for(s=m.length;t<s;t+=n)i.push([m[0]].concat(m.slice(t,t+n)))}else i.push(m)}return i},_parseDimensions:function(){var i=[],k=[],m,n,q=false,t,w;this.path.forEach(function(o,r){if(o[0]!==
"H")m=r===0?e(o):e(this.path[r-1]);if(o[0]!=="V")n=r===0?a(o):a(this.path[r-1]);if(o[0]===o[0].toLowerCase())q=true;t=q?m+e(o):o[0]==="V"?m:e(o);w=q?n+a(o):o[0]==="H"?n:a(o);var u=parseInt(t,10);isNaN(u)||i.push(u);u=parseInt(w,10);isNaN(u)||k.push(u)},this);var y=d(i),s=d(k),v=b(i),p=b(k);v=v-y;p=p-s;return{left:this.left+(y+v/2),top:this.top+(s+p/2),width:v,height:p}}});c.Path.fromObject=function(i,k){typeof i.path==="string"?c.loadSVGFromURL(i.path,function(m){m=m[0];var n=i.path;delete i.path;
c.util.object.extend(m,i);m.setSourcePath(n);k(m)}):k(new c.Path(i.path,i))};c.Path.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["d"]);c.Path.fromElement=function(i,k,m){i=c.parseAttributes(i,c.Path.ATTRIBUTE_NAMES);k&&k(new c.Path(i.d,g(i,m)))};c.Path.async=true}})(typeof exports!=="undefined"?exports:this);
(function(l){var e=l.fabric||(l.fabric={}),a=e.util.object.extend,f=e.util.array.invoke,c=e.Object.prototype.toObject;if(e.PathGroup)e.warn("fabric.PathGroup is already defined");else{e.PathGroup=e.util.createClass(e.Path,{type:"path-group",fill:"",initialize:function(d,b){b=b||{};this.paths=d||[];for(var g=this.paths.length;g--;)this.paths[g].group=this;this.setOptions(b);this.setCoords();b.sourcePath&&this.setSourcePath(b.sourcePath)},render:function(d){if(this.visible){d.save();var b=this.transformMatrix;
b&&d.transform(b[0],b[1],b[2],b[3],b[4],b[5]);this.transform(d);this._setShadow(d);this.clipTo&&e.util.clipContext(this,d);b=0;for(var g=this.paths.length;b<g;++b)this.paths[b].render(d,true);this.clipTo&&d.restore();this._removeShadow(d);if(this.active){this.drawBorders(d);this.drawControls(d)}d.restore()}},_set:function(d,b){if((d==="fill"||d==="overlayFill")&&b&&this.isSameColor())for(var g=this.paths.length;g--;)this.paths[g]._set(d,b);return this.callSuper("_set",d,b)},toObject:function(d){return a(c.call(this,
d),{paths:f(this.getObjects(),"toObject",d),sourcePath:this.sourcePath})},toDatalessObject:function(d){d=this.toObject(d);if(this.sourcePath)d.paths=this.sourcePath;return d},toSVG:function(){for(var d=this.getObjects(),b=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',">"],g=0,h=d.length;g<h;g++)b.push(d[g].toSVG());b.push("</g>");return b.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},
isSameColor:function(){var d=this.getObjects()[0].get("fill");return this.getObjects().every(function(b){return b.get("fill")===d})},complexity:function(){return this.paths.reduce(function(d,b){return d+(b&&b.complexity?b.complexity():0)},0)},toGrayscale:function(){for(var d=this.paths.length;d--;)this.paths[d].toGrayscale();return this},getObjects:function(){return this.paths}});e.PathGroup.fromObject=function(d,b){typeof d.paths==="string"?e.loadSVGFromURL(d.paths,function(g){var h=d.paths;delete d.paths;
g=e.util.groupSVGElements(g,d,h);b(g)}):e.util.enlivenObjects(d.paths,function(g){delete d.paths;b(new e.PathGroup(g,d))})};e.PathGroup.async=true}})(typeof exports!=="undefined"?exports:this);
(function(l){var e=l.fabric||(l.fabric={}),a=e.util.object.extend,f=e.util.array.min,c=e.util.array.max,d=e.util.array.invoke;if(!e.Group){var b={lockMovementX:true,lockMovementY:true,lockRotation:true,lockScalingX:true,lockScalingY:true,lockUniScaling:true};e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",initialize:function(g,h){h=h||{};this._objects=g||[];for(var j=this._objects.length;j--;)this._objects[j].group=this;this.originalState={};this.callSuper("initialize");this._calcBounds();
this._updateObjectsCoords();h&&a(this,h);this._setOpacityIfSame();this.setCoords(true);this.saveCoords()},_updateObjectsCoords:function(){var g=this.left,h=this.top;this.forEachObject(function(j){var i=j.get("left"),k=j.get("top");j.set("originalLeft",i);j.set("originalTop",k);j.set("left",i-g);j.set("top",k-h);j.setCoords();j.__origHasControls=j.hasControls;j.hasControls=false},this)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},getObjects:function(){return this._objects},
addWithUpdate:function(g){this._restoreObjectsState();this._objects.push(g);g.group=this;this.forEachObject(function(h){h.set("active",true);h.group=this},this);this._calcBounds();this._updateObjectsCoords();return this},removeWithUpdate:function(g){this._restoreObjectsState();this.forEachObject(function(h){h.set("active",true);h.group=this},this);this.remove(g);this._calcBounds();this._updateObjectsCoords();return this},_onObjectAdded:function(g){g.group=this},_onObjectRemoved:function(g){delete g.group;
g.set("active",false)},delegatedProperties:{fill:true,opacity:true,fontFamily:true,fontWeight:true,fontSize:true,fontStyle:true,lineHeight:true,textDecoration:true,textAlign:true,backgroundColor:true},_set:function(g,h){if(g in this.delegatedProperties){var j=this._objects.length;for(this[g]=h;j--;)this._objects[j].set(g,h)}else this[g]=h},toObject:function(g){return a(this.callSuper("toObject",g),{objects:d(this._objects,"toObject",g)})},render:function(g,h){if(this.visible){g.save();this.transform(g);
var j=Math.max(this.scaleX,this.scaleY);this.clipTo&&e.util.clipContext(this,g);for(var i=0,k=this._objects.length;i<k;i++){var m=this._objects[i],n=m.borderScaleFactor,q=m.hasRotatingPoint;if(m.visible){m.borderScaleFactor=j;m.hasRotatingPoint=false;m.render(g);m.borderScaleFactor=n;m.hasRotatingPoint=q}}this.clipTo&&g.restore();if(!h&&this.active){this.drawBorders(g);this.drawControls(g)}g.restore();this.setCoords()}},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,
this);return this},_restoreObjectState:function(g){var h=this.get("left"),j=this.get("top"),i=this.getAngle()*(Math.PI/180),k=Math.cos(i)*g.get("top")*this.get("scaleY")+Math.sin(i)*g.get("left")*this.get("scaleX");i=-Math.sin(i)*g.get("top")*this.get("scaleY")+Math.cos(i)*g.get("left")*this.get("scaleX");g.setAngle(g.getAngle()+this.getAngle());g.set("left",h+i);g.set("top",j+k);g.set("scaleX",g.get("scaleX")*this.get("scaleX"));g.set("scaleY",g.get("scaleY")*this.get("scaleY"));g.setCoords();g.hasControls=
g.__origHasControls;delete g.__origHasControls;g.set("active",false);g.setCoords();delete g.group;return this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(g){g.setCoords()});return this},_setOpacityIfSame:function(){var g=this.getObjects(),
h=g[0]?g[0].get("opacity"):1;if(g.every(function(j){return j.get("opacity")===h}))this.opacity=h},_calcBounds:function(){var g=[],h=[],j,i;i=0;for(var k=this._objects.length;i<k;++i){j=this._objects[i];j.setCoords();for(var m in j.oCoords){g.push(j.oCoords[m].x);h.push(j.oCoords[m].y)}}j=f(g);i=c(g);g=f(h);h=c(h);i=i-j||0;h=h-g||0;this.width=i;this.height=h;this.left=j+i/2||0;this.top=g+h/2||0},toSVG:function(){for(var g=[],h=0,j=this._objects.length;h<j;h++)g.push(this._objects[h].toSVG());return'<g transform="'+
this.getSvgTransform()+'">'+g.join("")+"</g>"},get:function(g){if(g in b)if(this[g])return this[g];else{for(var h=0,j=this._objects.length;h<j;h++)if(this._objects[h][g])return true;return false}else{if(g in this.delegatedProperties)return this._objects[0]&&this._objects[0].get(g);return this[g]}}});e.Group.fromObject=function(g,h){e.util.enlivenObjects(g.objects,function(j){delete g.objects;h&&h(new e.Group(j,g))})};e.Group.async=true}})(typeof exports!=="undefined"?exports:this);
(function(l){var e=fabric.util.object.extend;if(!l.fabric)l.fabric={};if(l.fabric.Image)fabric.warn("fabric.Image is already defined.");else{fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",initialize:function(a,f){f||(f={});this.filters=[];this.callSuper("initialize",f);this._initElement(a);this._initConfig(f);if(f.filters){this.filters=f.filters;this.applyFilters()}},getElement:function(){return this._element},setElement:function(a,f){this._originalElement=this._element=a;this._initConfig();
this.filters.length!==0&&this.applyFilters(f);return this},getOriginalSize:function(){var a=this.getElement();return{width:a.width,height:a.height}},render:function(a,f){if(this.visible){a.save();var c=this.transformMatrix;this.group&&this.group.type!=="group"&&a.translate(-this.group.width/2+this.width/2,-this.group.height/2+this.height/2);c&&a.transform(c[0],c[1],c[2],c[3],c[4],c[5]);f||this.transform(a);a.save();this._setShadow(a);this.clipTo&&fabric.util.clipContext(this,a);this._render(a);this.shadow&&
!this.shadow.affectStroke&&this._removeShadow(a);this._renderStroke(a);this.clipTo&&a.restore();a.restore();if(this.active&&!f){this.drawBorders(a);this.drawControls(a)}a.restore()}},_stroke:function(a){a.save();a.lineWidth=this.strokeWidth;a.lineCap=this.strokeLineCap;a.lineJoin=this.strokeLineJoin;a.miterLimit=this.strokeMiterLimit;a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a):this.stroke;a.beginPath();a.strokeRect(-this.width/2,-this.height/2,this.width,this.height);a.closePath();a.restore()},
_renderDashedStroke:function(a){var f=-this.width/2,c=-this.height/2,d=this.width,b=this.height;a.save();a.lineWidth=this.strokeWidth;a.lineCap=this.strokeLineCap;a.lineJoin=this.strokeLineJoin;a.miterLimit=this.strokeMiterLimit;a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a):this.stroke;a.beginPath();fabric.util.drawDashedLine(a,f,c,f+d,c,this.strokeDashArray);fabric.util.drawDashedLine(a,f+d,c,f+d,c+b,this.strokeDashArray);fabric.util.drawDashedLine(a,f+d,c+b,f,c+b,this.strokeDashArray);
fabric.util.drawDashedLine(a,f,c+b,f,c,this.strokeDashArray);a.closePath();a.restore()},toObject:function(a){return e(this.callSuper("toObject",a),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(f){return f&&f.toObject()})})},toSVG:function(){var a=[];a.push('<g transform="',this.getSvgTransform(),'">','<image xlink:href="',this.getSvgSrc(),'" style="',this.getSvgStyles(),'" transform="translate('+-this.width/2+" "+-this.height/2+")",'" width="',this.width,
'" height="',this.height,'"></image>');if(this.stroke||this.strokeDashArray){var f=this.fill;this.fill=null;a.push("<rect ",'x="',-1*this.width/2,'" y="',-1*this.height/2,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>');this.fill=f}a.push("</g>");return a.join("")},getSrc:function(){return this.getElement().src||this.getElement()._src},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(a,f){this.constructor.fromObject(this.toObject(f),
a)},applyFilters:function(a){if(this.filters.length===0){this._element=this._originalElement;a&&a()}else{var f=this._originalElement,c=fabric.util.createCanvasElement(),d=fabric.util.createImage(),b=this;c.width=f.width;c.height=f.height;c.getContext("2d").drawImage(f,0,0,f.width,f.height);this.filters.forEach(function(g){g&&g.applyTo(c)});d.width=f.width;d.height=f.height;if(fabric.isLikelyNode){d.src=c.toBuffer(undefined,fabric.Image.pngCompression);b._element=d;a&&a()}else{d.onload=function(){b._element=
d;a&&a();d.onload=c=f=null};d.src=c.toDataURL("image/png")}return this}},_render:function(a){a.drawImage(this._element,-this.width/2,-this.height/2,this.width,this.height)},_resetWidthHeight:function(){var a=this.getElement();this.set("width",a.width);this.set("height",a.height)},_initElement:function(a){this.setElement(fabric.util.getById(a));fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={});this.setOptions(a);this._setWidthHeight(a)},_initFilters:function(a,
f){if(a.filters&&a.filters.length)fabric.util.enlivenObjects(a.filters,function(c){f&&f(c)},"fabric.Image.filters");else f&&f()},_setWidthHeight:function(a){this.width="width"in a?a.width:this.getElement().width||0;this.height="height"in a?a.height:this.getElement().height||0},complexity:function(){return 1}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc;fabric.Image.fromObject=function(a,f){var c=fabric.document.createElement("img"),d=a.src;
c.onload=function(){fabric.Image.prototype._initFilters.call(a,a,function(b){a.filters=b||[];b=new fabric.Image(c,a);f&&f(b);c=c.onload=c.onerror=null})};c.onerror=function(){fabric.log("Error loading "+c.src);f&&f(null,true);c=c.onload=c.onerror=null};c.src=d};fabric.Image.fromURL=function(a,f,c){fabric.util.loadImage(a,function(d){f(new fabric.Image(d,c))})};fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height xlink:href".split(" "));fabric.Image.fromElement=function(a,
f,c){a=fabric.parseAttributes(a,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(a["xlink:href"],f,e(c?fabric.util.object.clone(c):{},a))};fabric.Image.async=true;fabric.Image.pngCompression=1}})(typeof exports!=="undefined"?exports:this);
fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var l=this.getAngle()%360;if(l>0)return Math.round((l-1)/90)*90;return Math.round(l/90)*90},straighten:function(){this.setAngle(this._getAngleValueForStraighten());return this},fxStraighten:function(l){l=l||{};var e=function(){},a=l.onComplete||e,f=l.onChange||e,c=this;fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(d){c.setAngle(d);
f()},onComplete:function(){c.setCoords();a()},onStart:function(){c.set("active",false)}});return this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(l){l.straighten();this.renderAll();return this},fxStraightenObject:function(l){l.fxStraighten({onChange:this.renderAll.bind(this)});return this}});fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}});
(function(l){var e=l.fabric||(l.fabric={}),a=e.util.object.extend;e.Image.filters.Brightness=e.util.createClass(e.Image.filters.BaseFilter,{type:"Brightness",initialize:function(f){f=f||{};this.brightness=f.brightness||100},applyTo:function(f){var c=f.getContext("2d");f=c.getImageData(0,0,f.width,f.height);for(var d=f.data,b=this.brightness,g=0,h=d.length;g<h;g+=4){d[g]+=b;d[g+1]+=b;d[g+2]+=b}c.putImageData(f,0,0)},toObject:function(){return a(this.callSuper("toObject"),{brightness:this.brightness})}});
e.Image.filters.Brightness.fromObject=function(f){return new e.Image.filters.Brightness(f)}})(typeof exports!=="undefined"?exports:this);
(function(l){var e=l.fabric||(l.fabric={}),a=e.util.object.extend;e.Image.filters.Convolute=e.util.createClass(e.Image.filters.BaseFilter,{type:"Convolute",initialize:function(f){f=f||{};this.opaque=f.opaque;this.matrix=f.matrix||[0,0,0,0,1,0,0,0,0];this.tmpCtx=e.util.createCanvasElement().getContext("2d")},_createImageData:function(f,c){return this.tmpCtx.createImageData(f,c)},applyTo:function(f){var c=this.matrix,d=f.getContext("2d"),b=d.getImageData(0,0,f.width,f.height);f=Math.round(Math.sqrt(c.length));
var g=Math.floor(f/2),h=b.data,j=b.width;b=b.height;for(var i=this._createImageData(j,b),k=i.data,m=this.opaque?1:0,n=0;n<b;n++)for(var q=0;q<j;q++){for(var t=n,w=q,y=(n*j+q)*4,s=0,v=0,p=0,o=0,r=0;r<f;r++)for(var u=0;u<f;u++){var x=t+r-g,z=w+u-g;if(x>=0&&x<b&&z>=0&&z<j){x=(x*j+z)*4;z=c[r*f+u];s+=h[x]*z;v+=h[x+1]*z;p+=h[x+2]*z;o+=h[x+3]*z}}k[y]=s;k[y+1]=v;k[y+2]=p;k[y+3]=o+m*(255-o)}d.putImageData(i,0,0)},toObject:function(){return a(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});
e.Image.filters.Convolute.fromObject=function(f){return new e.Image.filters.Convolute(f)}})(typeof exports!=="undefined"?exports:this);
(function(l){var e=l.fabric||(l.fabric={}),a=e.util.object.extend;e.Image.filters.GradientTransparency=e.util.createClass(e.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(f){f=f||{};this.threshold=f.threshold||100},applyTo:function(f){var c=f.getContext("2d");f=c.getImageData(0,0,f.width,f.height);for(var d=f.data,b=this.threshold,g=d.length,h=0,j=d.length;h<j;h+=4)d[h+3]=b+255*(g-h)/g;c.putImageData(f,0,0)},toObject:function(){return a(this.callSuper("toObject"),{threshold:this.threshold})}});
e.Image.filters.GradientTransparency.fromObject=function(f){return new e.Image.filters.GradientTransparency(f)}})(typeof exports!=="undefined"?exports:this);
(function(l){var e=l.fabric||(l.fabric={});e.Image.filters.Grayscale=e.util.createClass(e.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(a){var f=a.getContext("2d");a=f.getImageData(0,0,a.width,a.height);for(var c=a.data,d=a.width*a.height*4,b=0,g;b<d;){g=(c[b]+c[b+1]+c[b+2])/3;c[b]=g;c[b+1]=g;c[b+2]=g;b+=4}f.putImageData(a,0,0)}});e.Image.filters.Grayscale.fromObject=function(){return new e.Image.filters.Grayscale}})(typeof exports!=="undefined"?exports:this);
(function(l){var e=l.fabric||(l.fabric={});e.Image.filters.Invert=e.util.createClass(e.Image.filters.BaseFilter,{type:"Invert",applyTo:function(a){var f=a.getContext("2d");a=f.getImageData(0,0,a.width,a.height);var c=a.data,d=c.length,b;for(b=0;b<d;b+=4){c[b]=255-c[b];c[b+1]=255-c[b+1];c[b+2]=255-c[b+2]}f.putImageData(a,0,0)}});e.Image.filters.Invert.fromObject=function(){return new e.Image.filters.Invert}})(typeof exports!=="undefined"?exports:this);
(function(l){var e=l.fabric||(l.fabric={}),a=e.util.object.extend;e.Image.filters.Mask=e.util.createClass(e.Image.filters.BaseFilter,{type:"Mask",initialize:function(f){f=f||{};this.mask=f.mask;this.channel=[0,1,2,3].indexOf(f.channel)>-1?f.channel:0},applyTo:function(f){if(this.mask){var c=f.getContext("2d");f=c.getImageData(0,0,f.width,f.height);var d=f.data,b=this.mask.getElement(),g=e.util.createCanvasElement(),h=this.channel,j=f.width*f.height*4;g.width=b.width;g.height=b.height;g.getContext("2d").drawImage(b,
0,0,b.width,b.height);g=g.getContext("2d").getImageData(0,0,b.width,b.height).data;for(b=0;b<j;b+=4)d[b+3]=g[b+h];c.putImageData(f,0,0)}},toObject:function(){return a(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}});e.Image.filters.Mask.fromObject=function(f,c){var d=e.document.createElement("img"),b=f.mask.src;d.onload=function(){f.mask=new e.Image(d,f.mask);c&&c(new e.Image.filters.Mask(f));d=d.onload=d.onerror=null};d.onerror=function(){e.log("Error loading "+d.src);
c&&c(null,true);d=d.onload=d.onerror=null};d.src=b};e.Image.filters.Mask.async=true})(typeof exports!=="undefined"?exports:this);
(function(l){var e=l.fabric||(l.fabric={}),a=e.util.object.extend;e.Image.filters.Noise=e.util.createClass(e.Image.filters.BaseFilter,{type:"Noise",initialize:function(f){f=f||{};this.noise=f.noise||100},applyTo:function(f){var c=f.getContext("2d");f=c.getImageData(0,0,f.width,f.height);for(var d=f.data,b=this.noise,g,h=0,j=d.length;h<j;h+=4){g=(0.5-Math.random())*b;d[h]+=g;d[h+1]+=g;d[h+2]+=g}c.putImageData(f,0,0)},toObject:function(){return a(this.callSuper("toObject"),{noise:this.noise})}});e.Image.filters.Noise.fromObject=
function(f){return new e.Image.filters.Noise(f)}})(typeof exports!=="undefined"?exports:this);
(function(l){var e=l.fabric||(l.fabric={}),a=e.util.object.extend;e.Image.filters.Pixelate=e.util.createClass(e.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(f){f=f||{};this.blocksize=f.blocksize||4},applyTo:function(f){var c=f.getContext("2d");f=c.getImageData(0,0,f.width,f.height);var d=f.data,b=f.height,g=f.width,h,j,i,k,m,n,q;for(j=0;j<b;j+=this.blocksize)for(i=0;i<g;i+=this.blocksize){h=j*4*g+i*4;k=d[h];m=d[h+1];n=d[h+2];q=d[h+3];for(var t=j,w=j+this.blocksize;t<w;t++)for(var y=
i,s=i+this.blocksize;y<s;y++){h=t*4*g+y*4;d[h]=k;d[h+1]=m;d[h+2]=n;d[h+3]=q}}c.putImageData(f,0,0)},toObject:function(){return a(this.callSuper("toObject"),{blocksize:this.blocksize})}});e.Image.filters.Pixelate.fromObject=function(f){return new e.Image.filters.Pixelate(f)}})(typeof exports!=="undefined"?exports:this);
(function(l){var e=l.fabric||(l.fabric={}),a=e.util.object.extend;e.Image.filters.RemoveWhite=e.util.createClass(e.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(f){f=f||{};this.threshold=f.threshold||30;this.distance=f.distance||20},applyTo:function(f){var c=f.getContext("2d");f=c.getImageData(0,0,f.width,f.height);for(var d=f.data,b=this.distance,g=255-this.threshold,h=Math.abs,j,i,k,m=0,n=d.length;m<n;m+=4){j=d[m];i=d[m+1];k=d[m+2];if(j>g&&i>g&&k>g&&h(j-i)<b&&h(j-k)<b&&h(i-k)<
b)d[m+3]=1}c.putImageData(f,0,0)},toObject:function(){return a(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}});e.Image.filters.RemoveWhite.fromObject=function(f){return new e.Image.filters.RemoveWhite(f)}})(typeof exports!=="undefined"?exports:this);
(function(l){var e=l.fabric||(l.fabric={});e.Image.filters.Sepia=e.util.createClass(e.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(a){var f=a.getContext("2d");a=f.getImageData(0,0,a.width,a.height);var c=a.data,d=c.length,b,g;for(b=0;b<d;b+=4){g=0.3*c[b]+0.59*c[b+1]+0.11*c[b+2];c[b]=g+100;c[b+1]=g+50;c[b+2]=g+255}f.putImageData(a,0,0)}});e.Image.filters.Sepia.fromObject=function(){return new e.Image.filters.Sepia}})(typeof exports!=="undefined"?exports:this);
(function(l){var e=l.fabric||(l.fabric={});e.Image.filters.Sepia2=e.util.createClass(e.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(a){var f=a.getContext("2d");a=f.getImageData(0,0,a.width,a.height);var c=a.data,d=c.length,b,g,h,j;for(b=0;b<d;b+=4){g=c[b];h=c[b+1];j=c[b+2];c[b]=(g*0.393+h*0.769+j*0.189)/1.351;c[b+1]=(g*0.349+h*0.686+j*0.168)/1.203;c[b+2]=(g*0.272+h*0.534+j*0.131)/2.14}f.putImageData(a,0,0)}});e.Image.filters.Sepia2.fromObject=function(){return new e.Image.filters.Sepia2}})(typeof exports!==
"undefined"?exports:this);
(function(l){var e=l.fabric||(l.fabric={}),a=e.util.object.extend;e.Image.filters.Tint=e.util.createClass(e.Image.filters.BaseFilter,{type:"Tint",initialize:function(f){f=f||{};this.color=f.color||0},applyTo:function(f){var c=f.getContext("2d");f=c.getImageData(0,0,f.width,f.height);var d=f.data,b=d.length,g,h;for(g=parseInt(this.color,10).toString(16);g.length<6;)g="0"+g;var j=parseInt("0x"+g.substr(0,2),16),i=parseInt("0x"+g.substr(2,2),16),k=parseInt("0x"+g.substr(4,2),16);for(g=0;g<b;g+=4){h=
d[g+3];if(h>0){d[g]=j;d[g+1]=i;d[g+2]=k}}c.putImageData(f,0,0)},toObject:function(){return a(this.callSuper("toObject"),{color:this.color})}});e.Image.filters.Tint.fromObject=function(f){return new e.Image.filters.Tint(f)}})(typeof exports!=="undefined"?exports:this);
(function(l){var e=l.fabric||(l.fabric={}),a=e.util.object.extend,f=e.util.object.clone,c=e.util.toFixed,d=e.StaticCanvas.supports("setLineDash");if(e.Text)e.warn("fabric.Text is already defined");else{l=e.Object.prototype.stateProperties.concat();l.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","backgroundColor","textBackgroundColor","useNative","path");e.Text=e.util.createClass(e.Object,{_dimensionAffectingProps:{fontSize:true,fontWeight:true,
fontFamily:true,textDecoration:true,fontStyle:true,lineHeight:true,stroke:true,strokeWidth:true,text:true},type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.3,backgroundColor:"",textBackgroundColor:"",path:null,useNative:true,stateProperties:l,stroke:null,shadow:null,initialize:function(b,g){g=g||{};this.text=b;this.__skipDimension=true;this.setOptions(g);this.__skipDimension=false;this._initDimensions();this.setCoords()},
_initDimensions:function(){this.__skipDimension||this._render(e.util.createCanvasElement().getContext("2d"))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(b){var g=this.group&&this.group.type!=="group";if(g&&!this.transformMatrix)b.translate(-this.group.width/2+this.left,-this.group.height/2+this.top);else g&&this.transformMatrix&&b.translate(-this.group.width/2,-this.group.height/2);typeof Cufon===
"undefined"||this.useNative===true?this._renderViaNative(b):this._renderViaCufon(b)},_renderViaNative:function(b){this.transform(b,e.isLikelyNode);this._setTextStyles(b);var g=this.text.split(/\r?\n/);this.width=this._getTextWidth(b,g);this.height=this._getTextHeight(b,g);this.clipTo&&e.util.clipContext(this,b);this._renderTextBackground(b,g);if(this.textAlign!=="left"&&this.textAlign!=="justify"){b.save();b.translate(this.textAlign==="center"?this.width/2:this.width,0)}b.save();this._setShadow(b);
this._renderTextFill(b,g);this._renderTextStroke(b,g);this._removeShadow(b);b.restore();this.textAlign!=="left"&&this.textAlign!=="justify"&&b.restore();this._renderTextDecoration(b,g);this.clipTo&&b.restore();this._setBoundaries(b,g);this._totalLineHeight=0},_setBoundaries:function(b,g){this._boundaries=[];for(var h=0,j=g.length;h<j;h++){var i=this._getLineWidth(b,g[h]),k=this._getLineLeftOffset(i);this._boundaries.push({height:this.fontSize*this.lineHeight,width:i,left:k})}},_setTextStyles:function(b){if(this.fill)b.fillStyle=
this.fill.toLive?this.fill.toLive(b):this.fill;if(this.stroke){b.lineWidth=this.strokeWidth;b.lineCap=this.strokeLineCap;b.lineJoin=this.strokeLineJoin;b.miterLimit=this.strokeMiterLimit;b.strokeStyle=this.stroke.toLive?this.stroke.toLive(b):this.stroke}b.textBaseline="alphabetic";b.textAlign=this.textAlign;b.font=this._getFontDeclaration()},_getTextHeight:function(b,g){return this.fontSize*g.length*this.lineHeight},_getTextWidth:function(b,g){for(var h=b.measureText(g[0]).width,j=1,i=g.length;j<
i;j++){var k=b.measureText(g[j]).width;if(k>h)h=k}return h},_drawChars:function(b,g,h,j,i){g[b](h,j,i)},_drawTextLine:function(b,g,h,j,i,k){i-=this.fontSize/4;if(this.textAlign!=="justify")this._drawChars(b,g,h,j,i,k);else{var m=g.measureText(h).width,n=this.width;if(n>m){m=h.split(/\s+/);h=g.measureText(h.replace(/\s+/g,"")).width;n=(n-h)/(m.length-1);for(var q=h=0,t=m.length;q<t;q++){this._drawChars(b,g,m[q],j+h,i,k);h+=g.measureText(m[q]).width+n}}else this._drawChars(b,g,h,j,i,k)}},_getLeftOffset:function(){if(e.isLikelyNode&&
(this.originX==="left"||this.originX==="center"))return 0;return-this.width/2},_getTopOffset:function(){if(e.isLikelyNode){if(this.originY==="center")return-this.height/2;else if(this.originY==="bottom")return-this.height;return 0}return-this.height/2},_renderTextFill:function(b,g){if(this.fill||this.skipFillStrokeCheck){this._boundaries=[];for(var h=0,j=0,i=g.length;j<i;j++){var k=this._getHeightOfLine(b,j,g);h+=k;this._drawTextLine("fillText",b,g[j],this._getLeftOffset(),this._getTopOffset()+h,
j)}}},_renderTextStroke:function(b,g){if(this.stroke||this.skipFillStrokeCheck){var h=0;b.save();if(this.strokeDashArray){1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray);d&&b.setLineDash(this.strokeDashArray)}b.beginPath();for(var j=0,i=g.length;j<i;j++){var k=this._getHeightOfLine(b,j,g);h+=k;this._drawTextLine("strokeText",b,g[j],this._getLeftOffset(),this._getTopOffset()+h,j)}b.closePath();b.restore()}},_getHeightOfLine:function(){return this.fontSize*
this.lineHeight},_renderTextBackground:function(b,g){this._renderTextBoxBackground(b);this._renderTextLinesBackground(b,g)},_renderTextBoxBackground:function(b){if(this.backgroundColor){b.save();b.fillStyle=this.backgroundColor;b.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height);b.restore()}},_renderTextLinesBackground:function(b,g){if(this.textBackgroundColor){b.save();b.fillStyle=this.textBackgroundColor;for(var h=0,j=g.length;h<j;h++)if(g[h]!==""){var i=this._getLineWidth(b,
g[h]),k=this._getLineLeftOffset(i);b.fillRect(this._getLeftOffset()+k,this._getTopOffset()+h*this.fontSize*this.lineHeight,i,this.fontSize*this.lineHeight)}b.restore()}},_getLineLeftOffset:function(b){if(this.textAlign==="center")return(this.width-b)/2;if(this.textAlign==="right")return this.width-b;return 0},_getLineWidth:function(b,g){return this.textAlign==="justify"?this.width:b.measureText(g).width},_renderTextDecoration:function(b,g){function h(m){for(var n=0,q=g.length;n<q;n++){var t=i._getLineWidth(b,
g[n]),w=i._getLineLeftOffset(t);b.fillRect(i._getLeftOffset()+w,m+n*i._getHeightOfLine(b,n,g)-j,t,1)}}if(this.textDecoration){var j=this._getTextHeight(b,g)/2,i=this,k=this.fontSize/4;this.textDecoration.indexOf("underline")>-1&&h(this.fontSize*this.lineHeight);this.textDecoration.indexOf("line-through")>-1&&h(this.fontSize*this.lineHeight-k);this.textDecoration.indexOf("overline")>-1&&h(k)}},_getFontDeclaration:function(){return[e.isLikelyNode?this.fontWeight:this.fontStyle,e.isLikelyNode?this.fontStyle:
this.fontWeight,this.fontSize+"px",e.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(b,g){if(this.visible){b.save();this._render(b);if(!g&&this.active){this.drawBorders(b);this.drawControls(b)}b.restore()}},toObject:function(b){return a(this.callSuper("toObject",b),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,
path:this.path,backgroundColor:this.backgroundColor,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative})},toSVG:function(){var b=this.text.split(/\r?\n/),g=this.useNative?this.fontSize*this.lineHeight:-this._fontAscent-this._fontAscent/5*this.lineHeight,h=-(this.width/2),j=this.useNative?this.fontSize-1:this.height/2-b.length*this.fontSize-this._totalLineHeight,i=this._getSVGTextAndBg(g,h,b);b=this._getSVGShadows(g,b);j+=this._fontAscent?this._fontAscent/5*this.lineHeight:0;return['<g transform="',
this.getSvgTransform(),'">',i.textBgRects.join(""),"<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" transform="translate(',c(h,2)," ",c(j,2),')">',b.join(""),i.textSpans.join(""),"</text></g>"].join("")},_getSVGShadows:function(b,
g){var h=[],j,i,k=1;if(!this.shadow||!this._boundaries)return h;j=0;for(i=g.length;j<i;j++)if(g[j]!==""){h.push('<tspan x="',c((this._boundaries&&this._boundaries[j]?this._boundaries[j].left:0)+k+this.shadow.offsetX,2),j===0||this.useNative?'" y':'" dy','="',c(this.useNative?b*j-this.height/2+this.shadow.offsetY:b+(j===0?this.shadow.offsetY:0),2),'" ',this._getFillAttributes(this.shadow.color),">",e.util.string.escapeXml(g[j]),"</tspan>");k=1}else k++;return h},_getSVGTextAndBg:function(b,g,h){var j=
[],i=[],k,m,n,q=1;this.backgroundColor&&this._boundaries&&i.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',c(-this.width/2,2),'" y="',c(-this.height/2,2),'" width="',c(this.width,2),'" height="',c(this.height,2),'"></rect>');k=0;for(n=h.length;k<n;k++){if(h[k]!==""){m=this._boundaries&&this._boundaries[k]?c(this._boundaries[k].left,2):0;j.push('<tspan x="',m,'" ',k===0||this.useNative?"y":"dy",'="',c(this.useNative?b*k-this.height/2:b*q,2),'" ',this._getFillAttributes(this.fill),
">",e.util.string.escapeXml(h[k]),"</tspan>");q=1}else q++;this.textBackgroundColor&&this._boundaries&&i.push("<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',c(g+this._boundaries[k].left,2),'" y="',c(b*k-this.height/2,2),'" width="',c(this._boundaries[k].width,2),'" height="',c(this._boundaries[k].height,2),'"></rect>')}return{textSpans:j,textBgRects:i}},_getFillAttributes:function(b){var g=b&&typeof b==="string"?new e.Color(b):"";if(!g||!g.getSource()||g.getAlpha()===1)return'fill="'+
b+'"';return'opacity="'+g.getAlpha()+'" fill="'+g.setAlpha(1).toRgb()+'"'},_set:function(b,g){if(b==="fontFamily"&&this.path)this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+g+"$3");this.callSuper("_set",b,g);if(b in this._dimensionAffectingProps){this._initDimensions();this.setCoords()}},complexity:function(){return 1}});e.Text.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y font-family font-style font-weight font-size text-decoration".split(" "));e.Text.fromElement=function(b,g){if(!b)return null;
var h=e.parseAttributes(b,e.Text.ATTRIBUTE_NAMES);g=e.util.object.extend(g?e.util.object.clone(g):{},h);h=new e.Text(b.textContent,g);h.set({left:h.getLeft()+h.getWidth()/2,top:h.getTop()-h.getHeight()/2});return h};e.Text.fromObject=function(b){return new e.Text(b.text,f(b))};e.util.createAccessors(e.Text)}})(typeof exports!=="undefined"?exports:this);
fabric.util.object.extend(fabric.Text.prototype,{_renderViaCufon:function(l){var e=Cufon.textOptions||(Cufon.textOptions={});e.left=this.left;e.top=this.top;e.context=l;e.color=this.fill;var a=this._initDummyElementForCufon();this.transform(l);Cufon.replaceElement(a,{engine:"canvas",separate:"none",fontFamily:this.fontFamily,fontWeight:this.fontWeight,textDecoration:this.textDecoration,textShadow:this.shadow&&this.shadow.toString(),textAlign:this.textAlign,fontStyle:this.fontStyle,lineHeight:this.lineHeight,
stroke:this.stroke,strokeWidth:this.strokeWidth,backgroundColor:this.backgroundColor,textBackgroundColor:this.textBackgroundColor});this.width=e.width;this.height=e.height;this._totalLineHeight=e.totalLineHeight;this._fontAscent=e.fontAscent;this._boundaries=e.boundaries;this.setCoords()},_initDummyElementForCufon:function(){var l=fabric.document.createElement("pre");fabric.document.createElement("div").appendChild(l);if(typeof G_vmlCanvasManager==="undefined")l.innerHTML=this.text;else l.innerText=
this.text.replace(/\r?\n/gi,"\r");l.style.fontSize=this.fontSize+"px";l.style.letterSpacing="normal";return l}});
(function(){function l(i,k,m){var n=f.parse(i);if(!n.port)n.port=n.protocol.indexOf("https:")===0?443:80;i=(n.port===443?d:c).request({hostname:n.hostname,port:n.port,path:n.path,method:"GET"},function(q){var t="";k&&q.setEncoding(k);q.on("end",function(){m(t)});q.on("data",function(w){if(q.statusCode===200)t+=w})});i.on("error",function(q){q.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+n.hostname+":"+n.port):fabric.log(q.message)});i.end()}function e(i,k){require("fs").readFile(i,
function(m,n){if(m){fabric.log(m);throw m;}else k(n)})}if(!(typeof document!=="undefined"&&typeof window!=="undefined")){var a=(new require("xmldom")).DOMParser,f=require("url"),c=require("http"),d=require("https"),b=require("canvas"),g=require("canvas").Image;fabric.util.loadImage=function(i,k,m){var n=function(t){q.src=new Buffer(t,"binary");q._src=i;k&&k.call(m,q)},q=new g;if(i&&(i instanceof Buffer||i.indexOf("data")===0)){q.src=q._src=i;k&&k.call(m,q)}else if(i&&i.indexOf("http")!==0)e(i,n);
else i&&l(i,"binary",n)};fabric.loadSVGFromURL=function(i,k,m){i=i.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();i.indexOf("http")!==0?e(i,function(n){fabric.loadSVGFromString(n,k,m)}):l(i,"",function(n){fabric.loadSVGFromString(n,k,m)})};fabric.loadSVGFromString=function(i,k,m){i=(new a).parseFromString(i);fabric.parseSVGDocument(i.documentElement,function(n,q){k&&k(n,q)},m)};fabric.util.getScript=function(i,k){l(i,"",function(m){eval(m);k&&k()})};fabric.Image.fromObject=function(i,k){fabric.util.loadImage(i.src,
function(m){var n=new fabric.Image(m);n._initConfig(i);n._initFilters(i,function(q){n.filters=q||[];k&&k(n)})})};fabric.createCanvasForNode=function(i,k){var m=fabric.document.createElement("canvas"),n=new b(i||600,k||600);m.style={};m.width=n.width;m.height=n.height;m=new (fabric.Canvas||fabric.StaticCanvas)(m);m.contextContainer=n.getContext("2d");m.nodeCanvas=n;m.Font=b.Font;return m};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};fabric.StaticCanvas.prototype.createJPEGStream=
function(i){return this.nodeCanvas.createJPEGStream(i)};var h=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(i){h.call(this,i);this.nodeCanvas.width=i;return this};if(fabric.Canvas)fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth;var j=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(i){j.call(this,i);this.nodeCanvas.height=i;return this};if(fabric.Canvas)fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight}})();
