var fabric=fabric||{version:"1.4.1"};"undefined"!==typeof exports&&(exports.fabric=fabric);"undefined"!==typeof document&&"undefined"!==typeof window?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.window=fabric.document.createWindow());fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement;fabric.isLikelyNode="undefined"!==typeof Buffer&&"undefined"===typeof window;
fabric.SHARED_ATTRIBUTES="transform fill fill-opacity fill-rule opacity stroke stroke-dasharray stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width".split(" ");
var Cufon=function(){function g(d){var a=this.face=d.face;this.glyphs=d.glyphs;this.w=d.w;this.baseSize=parseInt(a["units-per-em"],10);this.family=a["font-family"].toLowerCase();this.weight=a["font-weight"];this.style=a["font-style"]||"normal";this.viewBox=function(){var d=a.bbox.split(/\s+/),d={minX:parseInt(d[0],10),minY:parseInt(d[1],10),maxX:parseInt(d[2],10),maxY:parseInt(d[3],10)};d.width=d.maxX-d.minX;d.height=d.maxY-d.minY;d.toString=function(){return[this.minX,this.minY,this.width,this.height].join(" ")};
return d}();this.ascent=-parseInt(a.ascent,10);this.descent=-parseInt(a.descent,10);this.height=-this.ascent+this.descent}function e(){var d={},a={oblique:"italic",italic:"oblique"};this.add=function(a){(d[a.style]||(d[a.style]={}))[a.weight]=a};this.get=function(c,b){var f=d[c]||d[a[c]]||d.normal||d.italic||d.oblique;if(!f)return null;b={normal:400,bold:700}[b]||parseInt(b,10);if(f[b])return f[b];var e={1:1,99:0}[b%100],l=[],k,g;void 0===e&&(e=400<b);500==b&&(b=400);for(var h in f){h=parseInt(h,
10);if(!k||h<k)k=h;if(!g||h>g)g=h;l.push(h)}b<k&&(b=k);b>g&&(b=g);l.sort(function(d,a){return(e?d>b&&a>b?d<a:d>a:d<b&&a<b?d>a:d<a)?-1:1});return f[l[0]]}}function b(d){var a={},c={};this.get=function(c){return void 0!=a[c]?a[c]:d[c]};this.getSize=function(d,a){return c[d]||(c[d]=new n.Size(this.get(d),a))};this.extend=function(d){for(var c in d)a[c]=d[c];return this}}function f(d,a,c){d.addEventListener?d.addEventListener(a,c,!1):d.attachEvent&&d.attachEvent("on"+a,function(){return c.call(d,fabric.window.event)})}
function a(d){var a={};return function(c){a.hasOwnProperty(c)||(a[c]=d.apply(null,arguments));return a[c]}}function c(d){return fabric.document.getElementsByTagName(d)}function d(){for(var d={},a,c=0,b=arguments.length;c<b;++c)for(a in arguments[c])d[a]=arguments[c][a];return d}function l(d,a,c,b,f,e){var l=b.separate;if("none"==l)return t[b.engine].apply(null,arguments);var k=fabric.document.createDocumentFragment(),g=a.split(v[l]),h="words"==l;h&&p&&(/^\s/.test(a)&&g.unshift(""),/\s$/.test(a)&&
g.push(""));for(var m=0,q=g.length;m<q;++m)(l=t[b.engine](d,h?n.textAlign(g[m],c,m,q):g[m],c,b,f,e,m<q-1))&&k.appendChild(l);return k}function k(d,a){var c,b,f,e;f=q.get(d);f.options||(a.hover&&a.hoverables[d.nodeName.toLowerCase()]&&w.attach(d),f.options=a);for(var g=d.firstChild;g;g=f){f=g.nextSibling;e=!1;if(1==g.nodeType){if(!g.firstChild)continue;if(/cufon/.test(g.className))e=!0;else{arguments.callee(g,a);continue}}b||(b=n.getStyle(d).extend(a));if(!c)a:{(c=b)||(c=n.getStyle(d));for(var k=n.quotedList(c.get("fontFamily").toLowerCase()),
h=void 0,m=0,p=k.length;m<p;++m)if(h=k[m],x[h]){c=x[h].get(c.get("fontStyle"),c.get("fontWeight"));break a}c=null}if(c)if(e)t[a.engine](c,null,b,a,g,d);else e=g.data,"undefined"!=typeof G_vmlCanvasManager&&(e=e.replace(/\r/g,"\n")),""!==e&&((e=l(c,e,b,a,g,d))?g.parentNode.replaceChild(e,g):g.parentNode.removeChild(g))}}var h=function(){return h.replace.apply(null,arguments)},m=h.DOM={ready:function(){var d=!1,a={loaded:1,complete:1},c=[],b=function(){if(!d){d=!0;for(var a;a=c.shift();a());}};fabric.document.addEventListener&&
(fabric.document.addEventListener("DOMContentLoaded",b,!1),fabric.window.addEventListener("pageshow",b,!1));!fabric.window.opera&&fabric.document.readyState&&function(){a[fabric.document.readyState]?b():setTimeout(arguments.callee,10)}();fabric.document.readyState&&fabric.document.createStyleSheet&&function(){try{fabric.document.body.doScroll("left"),b()}catch(d){setTimeout(arguments.callee,1)}}();f(fabric.window,"load",b);return function(a){arguments.length?d?a():c.push(a):b()}}()},n=h.CSS={Size:function(d,
a){this.value=parseFloat(d);this.unit=String(d).match(/[a-z%]*$/)[0]||"px";this.convert=function(d){return d/a*this.value};this.convertFrom=function(d){return d/this.value*a};this.toString=function(){return this.value+this.unit}},getStyle:function(d){return new b(d.style)},quotedList:a(function(d){for(var a=[],c=/\s*((["'])([\s\S]*?[^\\])\2|[^,]+)\s*/g,b;b=c.exec(d);)a.push(b[3]||b[1]);return a}),ready:function(){var d=!1,a=[],b=Object.prototype.propertyIsEnumerable?c("style"):{length:0},f=c("link");
m.ready(function(){for(var c=0,e,l=0,g=f.length;e=f[l],l<g;++l)e.disabled||"stylesheet"!=e.rel.toLowerCase()||++c;if(fabric.document.styleSheets.length>=b.length+c)for(d=!0;c=a.shift();c());else setTimeout(arguments.callee,10)});return function(c){d?c():a.push(c)}}(),supports:function(d,a){var c=fabric.document.createElement("span").style;if(void 0===c[d])return!1;c[d]=a;return c[d]===a},textAlign:function(d,a,c,b){"right"==a.get("textAlign")?0<c&&(d=" "+d):c<b-1&&(d+=" ");return d},textDecoration:function(d,
a){a||(a=this.getStyle(d));for(var c={underline:null,overline:null,"line-through":null},b=d;b.parentNode&&1==b.parentNode.nodeType;){var f=!0,e;for(e in c)c[e]||(-1!=a.get("textDecoration").indexOf(e)&&(c[e]=a.get("color")),f=!1);if(f)break;a=this.getStyle(b=b.parentNode)}return c},textShadow:a(function(d){if("none"==d)return null;for(var a=[],c={},b,f=0,e=/(#[a-f0-9]+|[a-z]+\(.*?\)|[a-z]+)|(-?[\d.]+[a-z%]*)|,/ig;b=e.exec(d);)","==b[0]?(a.push(c),c={},f=0):b[1]?c.color=b[1]:c[["offX","offY","blur"][f++]]=
b[2];a.push(c);return a}),color:a(function(d){var a={};a.color=d.replace(/^rgba\((.*?),\s*([\d.]+)\)/,function(d,c,b){a.opacity=parseFloat(b);return"rgb("+c+")"});return a}),textTransform:function(d,a){return d[{uppercase:"toUpperCase",lowercase:"toLowerCase"}[a.get("textTransform")]||"toString"]()}},p=0==" ".split(/\s+/).length,q=new function(){var d={},a=0;this.get=function(c){c=c.cufid||(c.cufid=++a);return d[c]||(d[c]={})}},w=new function(){function d(a){a=a.relatedTarget;var b;(b=!a)||(b=this.contains?
this.contains(a):this.compareDocumentPosition(a)&16);b||c(this)}function a(d){c(this)}function c(d){setTimeout(function(){h.replace(d,q.get(d).options,!0)},10)}this.attach=function(c){void 0===c.onmouseenter?(f(c,"mouseover",d),f(c,"mouseout",d)):(f(c,"mouseenter",a),f(c,"mouseleave",a))}},s=[],t={},x={},A={engine:null,hover:!1,hoverables:{a:!0},printable:!0,selector:fabric.window.Sizzle||fabric.window.jQuery&&function(d){return jQuery(d)}||fabric.window.dojo&&dojo.query||fabric.window.$$&&function(d){return $$(d)}||
fabric.window.$&&function(d){return $(d)}||fabric.document.querySelectorAll&&function(d){return fabric.document.querySelectorAll(d)}||c,separate:"words",textShadow:"none"},v={words:/\s+/,characters:""};h.now=function(){m.ready();return h};h.refresh=function(){for(var d=s.splice(0,s.length),a=0,c=d.length;a<c;++a)h.replace.apply(null,d[a]);return h};h.registerEngine=function(d,a){if(!a)return h;t[d]=a;return h.set("engine",d)};h.registerFont=function(d){d=new g(d);var a=d.family;x[a]||(x[a]=new e);
x[a].add(d);return h.set("fontFamily",'"'+a+'"')};h.replace=function(a,c,b){c=d(A,c);if(!c.engine)return h;"string"==typeof c.textShadow&&c.textShadow&&(c.textShadow=n.textShadow(c.textShadow));b||s.push(arguments);if(a.nodeType||"string"==typeof a)a=[a];n.ready(function(){for(var d=0,b=a.length;d<b;++d){var f=a[d];"string"==typeof f?h.replace(c.selector(f),c,!0):k(f,c)}});return h};h.replaceElement=function(a,c){c=d(A,c);"string"==typeof c.textShadow&&c.textShadow&&(c.textShadow=n.textShadow(c.textShadow));
return k(a,c)};h.engines=t;h.fonts=x;h.getOptions=function(){return d(A)};h.set=function(d,a){A[d]=a;return h};return h}();
Cufon.registerEngine("canvas",function(){var g=Cufon.CSS.supports("display","inline-block"),e=!g&&("BackCompat"==fabric.document.compatMode||/frameset|transitional/i.test(fabric.document.doctype.publicId)),b=fabric.document.createElement("style");b.type="text/css";e=fabric.document.createTextNode(".cufon-canvas{text-indent:0}@media screen,projection{.cufon-canvas{display:inline;display:inline-block;position:relative;vertical-align:middle"+(e?"":";font-size:1px;line-height:1px")+"}.cufon-canvas .cufon-alt{display:-moz-inline-box;display:inline-block;width:0;height:0;overflow:hidden}"+
(g?".cufon-canvas canvas{position:relative}":".cufon-canvas canvas{position:absolute}")+"}@media print{.cufon-canvas{padding:0 !important}.cufon-canvas canvas{display:none}.cufon-canvas .cufon-alt{display:inline}}");try{b.appendChild(e)}catch(f){b.setAttribute("type","text/css"),b.styleSheet.cssText=e.data}fabric.document.getElementsByTagName("head")[0].appendChild(b);return function(a,c,d,b,f,e){function m(c){y.fillStyle=c||Cufon.textOptions.color||d.get("color");var f=c=0;"right"===b.textAlign?
y.translate(F[f],0):"center"===b.textAlign&&y.translate(F[f]/2,0);for(var e=0,g=C.length;e<g;++e)if("\n"===C[e]){f++;var k=-a.ascent-a.ascent/5*b.lineHeight;"right"===b.textAlign?(y.translate(-B,k),y.translate(F[f],0)):"center"===b.textAlign?(y.translate(-c-F[f-1]/2,k),y.translate(F[f]/2,0)):y.translate(-c,k);c=0}else{var h=a.glyphs[C[e]]||a.missingGlyph;if(h){k=Number(h.w||a.w)+w;I&&(y.save(),y.strokeStyle=y.fillStyle,y.lineWidth+=y.lineWidth,y.beginPath(),I.underline&&(y.moveTo(0,-a.face["underline-position"]+
0.5),y.lineTo(k,-a.face["underline-position"]+0.5)),I.overline&&(y.moveTo(0,a.ascent+0.5),y.lineTo(k,a.ascent+0.5)),I["line-through"]&&(y.moveTo(0,-a.descent+0.5),y.lineTo(k,-a.descent+0.5)),y.stroke(),y.restore());J&&(y.save(),y.transform(1,0,-0.25,1,0,0));y.beginPath();if(h.d)if(h.code)for(var m=h.code,h=y,n=0,q=m.length;n<q;++n){var p=m[n];h[p.m].apply(h,p.a)}else{var m=h,h="m"+h.d,n=y,p=q=0,s=[],A=/([mrvxe])([^a-z]*)/g,v=void 0,t=0;a:for(;v=A.exec(h);++t){var u=v[2].split(",");switch(v[1]){case "v":s[t]=
{m:"bezierCurveTo",a:[q+~~u[0],p+~~u[1],q+~~u[2],p+~~u[3],q+=~~u[4],p+=~~u[5]]};break;case "r":s[t]={m:"lineTo",a:[q+=~~u[0],p+=~~u[1]]};break;case "m":s[t]={m:"moveTo",a:[q=~~u[0],p=~~u[1]]};break;case "x":s[t]={m:"closePath",a:[]};break;case "e":break a}n[s[t].m].apply(n,s[t].a)}m.code=s}y.fill();b.strokeStyle&&(y.closePath(),y.save(),y.lineWidth=b.strokeWidth,y.strokeStyle=b.strokeStyle,y.stroke(),y.restore());J&&y.restore();y.translate(k,0);c+=k}}}var n=null===c,p=a.viewBox,q=d.getSize("fontSize",
a.baseSize),w=d.get("letterSpacing"),w="normal"==w?0:q.convertFrom(parseInt(w,10)),s=e=0,t=0,x=b.textShadow,A=[];Cufon.textOptions.shadowOffsets=[];Cufon.textOptions.shadows=null;if(x){Cufon.textOptions.shadows=x;for(var v=0,u=x.length;v<u;++v){var r=x[v],z=q.convertFrom(parseFloat(r.offX)),r=q.convertFrom(parseFloat(r.offY));A[v]=[z,r]}}for(var C=Cufon.CSS.textTransform(n?f.alt:c,d).split(""),B=0,r=null,z=0,D=1,H=[],v=0,u=C.length;v<u;++v)if("\n"===C[v])D++,B>z&&(z=B),H.push(B),B=0;else{var G=a.glyphs[C[v]]||
a.missingGlyph;G&&(B+=r=Number(G.w||a.w)+w)}H.push(B);for(var B=Math.max(z,B),F=[],v=H.length;v--;)F[v]=B-H[v];if(null===r)return null;s+=p.width-r;t+=p.minX;n?(n=f,f=f.firstChild):(n=fabric.document.createElement("span"),n.className="cufon cufon-canvas",n.alt=c,f=fabric.document.createElement("canvas"),n.appendChild(f),b.printable&&(v=fabric.document.createElement("span"),v.className="cufon-alt",v.appendChild(fabric.document.createTextNode(c)),n.appendChild(v)));c=n.style;u=f.style||{};r=q.convert(p.height-
e+0);v=Math.ceil(r);r=v/r;f.width=Math.ceil(q.convert(B+s-t)*r);f.height=v;e+=p.minY;u.top=Math.round(q.convert(e-a.ascent))+"px";u.left=Math.round(q.convert(t))+"px";s=Math.ceil(q.convert(B*r));u=s+"px";r=q.convert(a.height);q=(b.lineHeight-1)*q.convert(-a.ascent/5)*(D-1);Cufon.textOptions.width=s;Cufon.textOptions.height=r*D+q;Cufon.textOptions.lines=D;Cufon.textOptions.totalLineHeight=q;g?(c.width=u,c.height=r+"px"):(c.paddingLeft=u,c.paddingBottom=r-1+"px");var y=Cufon.textOptions.context||f.getContext("2d"),
E=v/p.height;Cufon.textOptions.fontAscent=a.ascent*E;Cufon.textOptions.boundaries=null;p=Cufon.textOptions.shadowOffsets;for(v=A.length;v--;)p[v]=[A[v][0]*E,A[v][1]*E];y.save();y.scale(E,E);y.translate(-t-1/E*f.width/2+(Cufon.fonts[a.family].offsetLeft||0),-e-Cufon.textOptions.height/E/2+(Cufon.fonts[a.family].offsetTop||0));y.lineWidth=a.face["underline-thickness"];y.save();var I=Cufon.getTextDecoration(b),J="italic"===b.fontStyle;y.save();(function(){y.save();var d=0,c=0,f=[{left:0}];b.backgroundColor&&
(y.save(),y.fillStyle=b.backgroundColor,y.translate(0,a.ascent),y.fillRect(0,0,B+10,(-a.ascent+a.descent)*D),y.restore());"right"===b.textAlign?(y.translate(F[c],0),f[0].left=F[c]*E):"center"===b.textAlign&&(y.translate(F[c]/2,0),f[0].left=F[c]/2*E);for(var e=0,g=C.length;e<g;++e)if("\n"===C[e]){c++;var k=-a.ascent-a.ascent/5*b.lineHeight,h=f[f.length-1],m={left:0};h.width=d*E;h.height=(-a.ascent+a.descent)*E;"right"===b.textAlign?(y.translate(-B,k),y.translate(F[c],0),m.left=F[c]*E):"center"===b.textAlign?
(y.translate(-d-F[c-1]/2,k),y.translate(F[c]/2,0),m.left=F[c]/2*E):y.translate(-d,k);f.push(m);d=0}else if(k=a.glyphs[C[e]]||a.missingGlyph)k=Number(k.w||a.w)+w,b.textBackgroundColor&&(y.save(),y.fillStyle=b.textBackgroundColor,y.translate(0,a.ascent),y.fillRect(0,0,k+10,-a.ascent+a.descent),y.restore()),y.translate(k,0),d+=k,e==g-1&&(f[f.length-1].width=d*E,f[f.length-1].height=(-a.ascent+a.descent)*E);y.restore();Cufon.textOptions.boundaries=f})();if(x)for(v=0,u=x.length;v<u;++v)r=x[v],y.save(),
y.translate.apply(y,A[v]),m(r.color),y.restore();m();y.restore();y.restore();y.restore();return n}}());
Cufon.registerEngine("vml",function(){function g(b,f){if(/px$/i.test(f))return parseFloat(f);var a=b.style.left,c=b.runtimeStyle.left;b.runtimeStyle.left=b.currentStyle.left;b.style.left=f;var d=b.style.pixelLeft;b.style.left=a;b.runtimeStyle.left=c;return d}if(fabric.document.namespaces){var e=fabric.document.createElement("canvas");if(!(e&&e.getContext&&e.getContext.apply)&&(null==fabric.document.namespaces.cvml&&fabric.document.namespaces.add("cvml","urn:schemas-microsoft-com:vml"),e=fabric.document.createElement("cvml:shape"),
e.style.behavior="url(#default#VML)",e.coordsize))return e=null,fabric.document.write('<style type="text/css">.cufon-vml-canvas{text-indent:0}@media screen{cvml\\:shape,cvml\\:shadow{behavior:url(#default#VML);display:block;antialias:true;position:absolute}.cufon-vml-canvas{position:absolute;text-align:left}.cufon-vml{display:inline-block;position:relative;vertical-align:middle}.cufon-vml .cufon-alt{position:absolute;left:-10000in;font-size:1px}a .cufon-vml{cursor:pointer}}@media print{.cufon-vml *{display:none}.cufon-vml .cufon-alt{display:inline}}</style>'),
function(b,f,a,c,d,e,k){var h=null===f;h&&(f=d.alt);var m=b.viewBox,n;if(!(n=a.computedFontSize)){n=Cufon.CSS.Size;var p;p=a.get("fontSize");p=g(e,/(?:em|ex|%)$/i.test(p)?"1em":p);n=a.computedFontSize=new n(p+"px",b.baseSize)}p=a.computedLSpacing;void 0==p&&(p=a.get("letterSpacing"),a.computedLSpacing=p="normal"==p?0:~~n.convertFrom(g(e,p)));if(h)e=d,d=d.firstChild;else{e=fabric.document.createElement("span");e.className="cufon cufon-vml";e.alt=f;d=fabric.document.createElement("span");d.className=
"cufon-vml-canvas";e.appendChild(d);if(c.printable){var q=fabric.document.createElement("span");q.className="cufon-alt";q.appendChild(fabric.document.createTextNode(f));e.appendChild(q)}k||e.appendChild(fabric.document.createElement("cvml:shape"))}k=e.style;var w=d.style,s=n.convert(m.height),q=Math.ceil(s),s=q/s,t=m.minX,x=m.minY;w.height=q;w.top=Math.round(n.convert(x-b.ascent));w.left=Math.round(n.convert(t));k.height=n.convert(b.height)+"px";Cufon.getTextDecoration(c);w=a.get("color");f=Cufon.CSS.textTransform(f,
a).split("");var A=a=0,v=null,u;c=c.textShadow;for(var r=0,z=0,C=f.length;r<C;++r)(u=b.glyphs[f[r]]||b.missingGlyph)&&(a+=v=~~(u.w||b.w)+p);if(null===v)return null;u=-t+a+(m.width-v);for(var r=n.convert(u*s),v=Math.round(r),B=u+","+m.height,D,H="r"+B+"nsnf",r=0;r<C;++r)if(u=b.glyphs[f[r]]||b.missingGlyph){h?(m=d.childNodes[z],m.firstChild&&m.removeChild(m.firstChild)):(m=fabric.document.createElement("cvml:shape"),d.appendChild(m));m.stroked="f";m.coordsize=B;m.coordorigin=D=t-A+","+x;m.path=(u.d?
"m"+u.d+"xe":"")+"m"+D+H;m.fillcolor=w;D=m.style;D.width=v;D.height=q;if(c){D=c[0];var G=c[1],F=Cufon.CSS.color(D.color),y,E=fabric.document.createElement("cvml:shadow");E.on="t";E.color=F.color;E.offset=D.offX+","+D.offY;G&&(y=Cufon.CSS.color(G.color),E.type="double",E.color2=y.color,E.offset2=G.offX+","+G.offY);E.opacity=F.opacity||y&&y.opacity||1;m.appendChild(E)}A+=~~(u.w||b.w)+p;++z}k.width=Math.max(Math.ceil(n.convert(a*s)),0);return e}}}());
Cufon.getTextDecoration=function(g){return{underline:"underline"===g.textDecoration,overline:"overline"===g.textDecoration,"line-through":"line-through"===g.textDecoration}};"undefined"!=typeof exports&&(exports.Cufon=Cufon);var JSON;JSON||(JSON={});
(function(){function g(d){return 10>d?"0"+d:d}function e(d){a.lastIndex=0;return a.test(d)?'"'+d.replace(a,function(d){var a=l[d];return"string"===typeof a?a:"\\u"+("0000"+d.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+d+'"'}function b(a,f){var l,g,q,w,s=c,t,x=f[a];x&&"object"===typeof x&&"function"===typeof x.toJSON&&(x=x.toJSON(a));"function"===typeof k&&(x=k.call(f,a,x));switch(typeof x){case "string":return e(x);case "number":return isFinite(x)?String(x):"null";case "boolean":case "null":return String(x);
case "object":if(!x)return"null";c+=d;t=[];if("[object Array]"===Object.prototype.toString.apply(x)){w=x.length;for(l=0;l<w;l+=1)t[l]=b(l,x)||"null";q=0===t.length?"[]":c?"[\n"+c+t.join(",\n"+c)+"\n"+s+"]":"["+t.join(",")+"]";c=s;return q}if(k&&"object"===typeof k)for(w=k.length,l=0;l<w;l+=1)"string"===typeof k[l]&&(g=k[l],(q=b(g,x))&&t.push(e(g)+(c?": ":":")+q));else for(g in x)Object.prototype.hasOwnProperty.call(x,g)&&(q=b(g,x))&&t.push(e(g)+(c?": ":":")+q);q=0===t.length?"{}":c?"{\n"+c+t.join(",\n"+
c)+"\n"+s+"}":"{"+t.join(",")+"}";c=s;return q}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(d){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+g(this.getUTCMonth()+1)+"-"+g(this.getUTCDate())+"T"+g(this.getUTCHours())+":"+g(this.getUTCMinutes())+":"+g(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(d){return this.valueOf()});var f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c,d,l={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},k;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,f,e){var l;d=c="";if("number"===typeof e)for(l=0;l<e;l+=1)d+=" ";else"string"===typeof e&&(d=e);if((k=f)&&"function"!==typeof f&&("object"!==typeof f||"number"!==typeof f.length))throw Error("JSON.stringify");return b("",{"":a})});
"function"!==typeof JSON.parse&&(JSON.parse=function(d,a){function c(d,b){var f,e,l=d[b];if(l&&"object"===typeof l)for(f in l)Object.prototype.hasOwnProperty.call(l,f)&&(e=c(l,f),void 0!==e?l[f]=e:delete l[f]);return a.call(d,b,l)}var b;d=String(d);f.lastIndex=0;f.test(d)&&(d=d.replace(f,function(d){return"\\u"+("0000"+d.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(d.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return b=eval("("+d+")"),"function"===typeof a?c({"":b},""):b;throw new SyntaxError("JSON.parse");})})();if("undefined"===typeof Event)var Event={};if("undefined"===typeof eventjs)var eventjs=Event;
(function(g){g.modifyEventListener=!0;g.modifySelectors=!0;g.add=function(d,a,c,f){return b(d,a,c,f,"add")};g.remove=function(d,a,c,f){return b(d,a,c,f,"remove")};g.stop=function(d){d&&(d.stopPropagation&&d.stopPropagation(),d.cancelBubble=!0,d.bubble=0)};g.prevent=function(d){d&&(d.preventDefault&&d.preventDefault(),d.preventManipulation&&d.preventManipulation(),d.returnValue=!1)};g.cancel=function(d){g.stop(d);g.prevent(d)};g.getEventSupport=function(d,a){"string"===typeof d&&(a=d,d=window);a="on"+
a;if(a in d)return!0;d.setAttribute||(d=document.createElement("div"));if(d.setAttribute&&d.removeAttribute){d.setAttribute(a,"");var c="function"===typeof d[a];"undefined"!==typeof d[a]&&(d[a]=null);d.removeAttribute(a);return c}};var e=function(d){if(!d||"object"!==typeof d)return d;var a=new d.constructor,c;for(c in d)a[c]=d[c]&&"object"===typeof d[c]?e(d[c]):d[c];return a},b=function(d,c,h,t,x,A){t=t||{};if("[object Object]"===String(d)){var v=d;d=v.target;c=v.type;h=v.listener;delete v.target;
delete v.type;delete v.listener;for(var u in v)t[u]=v[u]}if(d&&c&&h)if("string"===typeof d&&"ready"===c)var r=(new Date).getTime(),z=t.timeout,C=window.setInterval(function(){(new Date).getTime()-r>z&&window.clearInterval(C);document.querySelector(d)&&(window.clearInterval(C),setTimeout(h,1))},t.interval||1E3/60);else{if("string"===typeof d){d=document.querySelectorAll(d);if(0===d.length)return a("Missing target on listener!",arguments);1===d.length&&(d=d[0])}var B,v={};if(0<d.length&&d!==window){u=
0;for(var D=d.length;u<D;u++)(B=b(d[u],c,h,e(t),x))&&(v[u]=B);return f(v)}c.indexOf&&-1!==c.indexOf(" ")&&(c=c.split(" "));c.indexOf&&-1!==c.indexOf(",")&&(c=c.split(","));if("string"!==typeof c){if("number"===typeof c.length)for(u=0,D=c.length;u<D;u++)(B=b(d,c[u],h,e(t),x))&&(v[c[u]]=B);else for(u in c)(B="function"===typeof c[u]?b(d,u,c[u],e(t),x):b(d,u,c[u].listener,e(c[u]),x))&&(v[u]=B);return f(v)}if("object"!==typeof d)return a("Target is not defined!",arguments);if("function"!==typeof h)return a("Listener is not a function!",
arguments);v=t.useCapture||!1;u=m(d)+"."+m(h)+"."+(v?1:0);if(g.Gesture&&g.Gesture._gestureHandlers[c]){u=c+u;if("remove"===x){if(!k[u])return;k[u].remove();delete k[u]}else if("add"===x){if(k[u])return k[u].add(),k[u];if(t.useCall&&!g.modifyEventListener){var H=h;h=function(a,c){for(var b in c)a[b]=c[b];return H.call(d,a)}}t.gesture=c;t.target=d;t.listener=h;t.fromOverwrite=A;k[u]=g.proxy[c](t)}return k[u]}for(var G=l(c),D=0;D<G.length;D++)if(c=G[D],B=c+"."+u,"remove"===x)k[B]&&(d[p](c,h,v),delete k[B]);
else if("add"===x){if(k[B])break;d[n](c,h,v);k[B]={id:B,type:c,target:d,listener:h,remove:function(){for(var a=0;a<G.length;a++)g.remove(d,G[a],h,t)}}}return k[B]}},f=function(d){return{remove:function(){for(var a in d)d[a].remove()},add:function(){for(var a in d)d[a].add()}}},a=function(d,a){"undefined"!==typeof console&&"undefined"!==typeof console.error&&console.error(d,a)},c={msPointer:["MSPointerDown","MSPointerMove","MSPointerUp"],touch:["touchstart","touchmove","touchend"],mouse:["mousedown",
"mousemove","mouseup"]},d={MSPointerDown:0,MSPointerMove:1,MSPointerUp:2,touchstart:0,touchmove:1,touchend:2,mousedown:0,mousemove:1,mouseup:2};g.supports={};window.navigator.msPointerEnabled&&(g.supports.msPointer=!0);g.getEventSupport("touchstart")&&(g.supports.touch=!0);g.getEventSupport("mousedown")&&(g.supports.mouse=!0);var l=function(){return function(a){var b=document.addEventListener?"":"on",f=d[a];if(isFinite(f)){a=[];for(var e in g.supports)a.push(b+c[e][f]);return a}return[b+a]}}(),k=
{},h=0,m=function(d){if(d===window)return"#window";if(d===document)return"#document";d.uniqueID||(d.uniqueID="e"+h++);return d.uniqueID},n=document.addEventListener?"addEventListener":"attachEvent",p=document.removeEventListener?"removeEventListener":"detachEvent";g.createPointerEvent=function(d,a,c){var b=a.gesture,f=a.target,e=d.changedTouches||g.proxy.getCoords(d);if(e.length){var l=e[0];a.pointers=c?[]:e;a.pageX=l.pageX;a.pageY=l.pageY;a.x=a.pageX;a.y=a.pageY}c=document.createEvent("Event");c.initEvent(b,
!0,!0);c.originalEvent=d;for(var k in a)"target"!==k&&(c[k]=a[k]);d=c.type;g.Gesture&&g.Gesture._gestureHandlers[d]&&a.oldListener.call(f,c,a,!1)};g.modifyEventListener&&window.HTMLElement&&function(){var d=function(d){var a=function(a){var c=a+"EventListener",f=d[c];d[c]=function(d,c,e){if(g.Gesture&&g.Gesture._gestureHandlers[d]){var k=e;"object"===typeof e?k.useCall=!0:k={useCall:!0,useCapture:e};b(this,d,c,k,a,!0)}else for(d=l(d),k=0;k<d.length;k++)f.call(this,d[k],c,e)}};a("add");a("remove")};
navigator.userAgent.match(/Firefox/)?(d(HTMLDivElement.prototype),d(HTMLCanvasElement.prototype)):d(HTMLElement.prototype);d(document);d(window)}();g.modifySelectors&&function(){var d=NodeList.prototype;d.removeEventListener=function(d,a,c){for(var b=0,f=this.length;b<f;b++)this[b].removeEventListener(d,a,c)};d.addEventListener=function(d,a,c){for(var b=0,f=this.length;b<f;b++)this[b].addEventListener(d,a,c)}}();return g})(Event);"undefined"===typeof Event&&(Event={});
"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(g){g.pointerSetup=function(b,f){b.doc=b.target.ownerDocument||b.target;b.minFingers=b.minFingers||b.fingers||1;b.maxFingers=b.maxFingers||b.fingers||Infinity;b.position=b.position||"relative";delete b.fingers;f=f||{};f.enabled=!0;f.gesture=b.gesture;f.target=b.target;f.env=b.env;Event.modifyEventListener&&b.fromOverwrite&&(b.oldListener=b.listener,b.listener=Event.createPointerEvent);var a=0,c=0===f.gesture.indexOf("pointer")&&Event.modifyEventListener?"pointer":"mouse";b.oldListener&&
(f.oldListener=b.oldListener);f.listener=b.listener;f.proxy=function(d){f.defaultListener=b.listener;b.listener=d;d(b.event,f)};f.add=function(){!0!==f.enabled&&(b.onPointerDown&&Event.add(b.target,c+"down",b.onPointerDown),b.onPointerMove&&Event.add(b.doc,c+"move",b.onPointerMove),b.onPointerUp&&Event.add(b.doc,c+"up",b.onPointerUp),f.enabled=!0)};f.remove=function(){!1!==f.enabled&&(b.onPointerDown&&Event.remove(b.target,c+"down",b.onPointerDown),b.onPointerMove&&Event.remove(b.doc,c+"move",b.onPointerMove),
b.onPointerUp&&Event.remove(b.doc,c+"up",b.onPointerUp),f.reset(),f.enabled=!1)};f.pause=function(d){!b.onPointerMove||d&&!d.move||Event.remove(b.doc,c+"move",b.onPointerMove);!b.onPointerUp||d&&!d.up||Event.remove(b.doc,c+"up",b.onPointerUp);a=b.fingers;b.fingers=0};f.resume=function(d){!b.onPointerMove||d&&!d.move||Event.add(b.doc,c+"move",b.onPointerMove);!b.onPointerUp||d&&!d.up||Event.add(b.doc,c+"up",b.onPointerUp);b.fingers=a};f.reset=function(){b.tracker={};b.fingers=0};return f};var e=Event.supports;
Event.pointerType=e.mouse?"mouse":e.touch?"touch":"mspointer";g.pointerStart=function(b,f,a){var c=(b.type||"mousedown").toUpperCase();0===c.indexOf("MOUSE")?Event.pointerType="mouse":0===c.indexOf("TOUCH")?Event.pointerType="touch":0===c.indexOf("MSPOINTER")&&(Event.pointerType="mspointer");var d=function(d,c){var b=a.bbox,f=e[c]={};switch(a.position){case "absolute":f.offsetX=0;f.offsetY=0;break;case "differenceFromLast":f.offsetX=d.pageX;f.offsetY=d.pageY;break;case "difference":f.offsetX=d.pageX;
f.offsetY=d.pageY;break;case "move":f.offsetX=d.pageX-b.x1;f.offsetY=d.pageY-b.y1;break;default:f.offsetX=b.x1,f.offsetY=b.y1}if("relative"===a.position)var g=d.pageX+b.scrollLeft-f.offsetX,b=d.pageY+b.scrollTop-f.offsetY;else g=d.pageX-f.offsetX,b=d.pageY-f.offsetY;f.rotation=0;f.scale=1;f.startTime=f.moveTime=(new Date).getTime();f.move={x:g,y:b};f.start={x:g,y:b};a.fingers++};a.event=b;f.defaultListener&&(a.listener=f.defaultListener,delete f.defaultListener);var c=!a.fingers,e=a.tracker;b=b.changedTouches||
g.getCoords(b);for(var k=b.length,h=0;h<k;h++){var m=b[h],n=m.identifier||Infinity;if(a.fingers){if(a.fingers>=a.maxFingers){var p=[];for(n in a.tracker)p.push(n);f.identifier=p.join(",");return c}var q=0;for(p in e){if(e[p].up){delete e[p];d(m,n);a.cancel=!0;break}q++}e[n]||d(m,n)}else e=a.tracker={},f.bbox=a.bbox=g.getBoundingBox(a.target),a.fingers=0,a.cancel=!1,d(m,n)}p=[];for(n in a.tracker)p.push(n);f.identifier=p.join(",");return c};g.pointerEnd=function(b,f,a,c){var d=b.touches||[],e=d.length;
b={};for(var g=0;g<e;g++){var h=d[g].identifier;b[h||Infinity]=!0}for(h in a.tracker)d=a.tracker[h],b[h]||d.up||(c&&c({pageX:d.pageX,pageY:d.pageY,changedTouches:[{pageX:d.pageX,pageY:d.pageY,identifier:"Infinity"===h?Infinity:h}]},"up"),d.up=!0,a.fingers--);if(0!==a.fingers)return!1;c=[];a.gestureFingers=0;for(h in a.tracker)a.gestureFingers++,c.push(h);f.identifier=c.join(",");return!0};g.getCoords=function(b){g.getCoords="undefined"!==typeof b.pageX?function(b){return Array({type:"mouse",x:b.pageX,
y:b.pageY,pageX:b.pageX,pageY:b.pageY,identifier:b.pointerId||Infinity})}:function(b){b=b||window.event;return Array({type:"mouse",x:b.clientX+document.documentElement.scrollLeft,y:b.clientY+document.documentElement.scrollTop,pageX:b.clientX+document.documentElement.scrollLeft,pageY:b.clientY+document.documentElement.scrollTop,identifier:Infinity})};return g.getCoords(b)};g.getCoord=function(b){if("ontouchstart"in window){var f=0,a=0;g.getCoord=function(c){return(c=c.changedTouches)&&c.length?{x:f=
c[0].pageX,y:a=c[0].pageY}:{x:f,y:a}}}else g.getCoord="undefined"!==typeof b.pageX&&"undefined"!==typeof b.pageY?function(a){return{x:a.pageX,y:a.pageY}}:function(a){a=a||window.event;return{x:a.clientX+document.documentElement.scrollLeft,y:a.clientY+document.documentElement.scrollTop}};return g.getCoord(b)};g.getBoundingBox=function(b){if(b===window||b===document)b=document.body;var f={},a=b.getBoundingClientRect();f.width=a.width;f.height=a.height;f.x1=a.left;f.y1=a.top;f.x2=f.x1+f.width;f.y2=f.y1+
f.height;f.scaleX=a.width/b.offsetWidth||1;f.scaleY=a.height/b.offsetHeight||1;f.scrollLeft=0;f.scrollTop=0;for(b=b.parentNode;null!==b&&b!==document.body&&void 0!==b.scrollTop;){a=window.getComputedStyle(b).getPropertyValue("position");if("absolute"===a)break;else if("fixed"===a){f.scrollTop-=b.parentNode.scrollTop;break}else f.scrollLeft+=b.scrollLeft,f.scrollTop+=b.scrollTop;b=b.parentNode}return f};(function(){var b=navigator.userAgent.toLowerCase(),f=-1!==b.indexOf("macintosh"),a=f&&-1!==b.indexOf("khtml")?
{91:!0,93:!0}:f&&-1!==b.indexOf("firefox")?{224:!0}:{17:!0};g.metaTrackerReset=function(){g.metaKey=!1;g.ctrlKey=!1;g.shiftKey=!1;g.altKey=!1};g.metaTracker=function(c){var d=!!a[c.keyCode];d&&(g.metaKey="keydown"===c.type);g.ctrlKey=c.ctrlKey;g.shiftKey=c.shiftKey;g.altKey=c.altKey;return d}})();return g}(Event.proxy);"undefined"===typeof Event&&(Event={});
Event.MutationObserver=function(){var g=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,e=function(){var b=document.createElement("p"),f=!1,a=function(){f=!0};if(b.addEventListener)b.addEventListener("DOMAttrModified",a,!1);else if(b.attachEvent)b.attachEvent("onDOMAttrModified",a);else return!1;b.setAttribute("id","target");return f}();return function(b,f){g?(new g(function(a){a.forEach(function(a){f.call(a.target,a.attributeName)})})).observe(b,{subtree:!1,attributes:!0}):
e?Event.add(b,"DOMAttrModified",function(a){f.call(b,a.attrName)}):"onpropertychange"in document.body&&Event.add(b,"propertychange",function(a){f.call(b,window.event.propertyName)})}}();"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(g){g.click=function(e){e.gesture=e.gesture||"click";e.maxFingers=e.maxFingers||e.fingers||1;var b;e.onPointerDown=function(a){g.pointerStart(a,f,e)&&(Event.add(e.doc,"mousemove",e.onPointerMove).listener(a),Event.add(e.doc,"mouseup",e.onPointerUp))};e.onPointerMove=function(a){b=a};e.onPointerUp=function(a){if(g.pointerEnd(a,f,e)&&(Event.remove(e.doc,"mousemove",e.onPointerMove),Event.remove(e.doc,"mouseup",e.onPointerUp),!(b.cancelBubble&&1<++b.bubble))){var c=(b.changedTouches||
g.getCoords(b))[0];a=e.bbox;var d=g.getBoundingBox(e.target);if("relative"===e.position)var l=c.pageX+a.scrollLeft-a.x1,c=c.pageY+a.scrollTop-a.y1;else l=c.pageX-a.x1,c=c.pageY-a.y1;if(0<l&&l<a.width&&0<c&&c<a.height&&a.scrollTop===d.scrollTop){for(var k in e.tracker)break;k=e.tracker[k];f.x=k.start.x;f.y=k.start.y;e.listener(b,f)}}};var f=g.pointerSetup(e);f.state="click";Event.add(e.target,"mousedown",e.onPointerDown);return f};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||
{};Event.Gesture._gestureHandlers.click=g.click;return g}(Event.proxy);"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(g){g.dbltap=g.dblclick=function(e){e.gesture=e.gesture||"dbltap";e.maxFingers=e.maxFingers||e.fingers||1;var b,f,a,c,d;e.onPointerDown=function(k){var h=k.changedTouches||g.getCoords(k);b&&!f?(d=h[0],f=(new Date).getTime()-b):(c=h[0],b=(new Date).getTime(),f=0,clearTimeout(a),a=setTimeout(function(){b=0},700));g.pointerStart(k,l,e)&&(Event.add(e.doc,"mousemove",e.onPointerMove).listener(k),Event.add(e.doc,"mouseup",e.onPointerUp))};e.onPointerMove=function(l){b&&!f&&(d=(l.changedTouches||
g.getCoords(l))[0]);l=e.bbox;if("relative"===e.position)var h=d.pageX+l.scrollLeft-l.x1,m=d.pageY+l.scrollTop-l.y1;else h=d.pageX-l.x1,m=d.pageY-l.y1;0<h&&h<l.width&&0<m&&m<l.height&&25>=Math.abs(d.pageX-c.pageX)&&25>=Math.abs(d.pageY-c.pageY)||(Event.remove(e.doc,"mousemove",e.onPointerMove),clearTimeout(a),b=f=0)};e.onPointerUp=function(d){g.pointerEnd(d,l,e)&&(Event.remove(e.doc,"mousemove",e.onPointerMove),Event.remove(e.doc,"mouseup",e.onPointerUp));if(b&&f){if(700>=f&&!(d.cancelBubble&&1<++d.bubble)){l.state=
e.gesture;for(var c in e.tracker)break;c=e.tracker[c];l.x=c.start.x;l.y=c.start.y;e.listener(d,l)}clearTimeout(a);b=f=0}};var l=g.pointerSetup(e);l.state="dblclick";Event.add(e.target,"mousedown",e.onPointerDown);return l};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.dbltap=g.dbltap;Event.Gesture._gestureHandlers.dblclick=g.dblclick;return g}(Event.proxy);"undefined"===typeof Event&&(Event={});
"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(g){g.dragElement=function(e,b){g.drag({event:b,target:e,position:"move",listener:function(b,a){e.style.left=a.x+"px";e.style.top=a.y+"px";Event.prevent(b)}})};g.drag=function(e){e.gesture="drag";e.onPointerDown=function(f){g.pointerStart(f,b,e)&&!e.monitor&&(Event.add(e.doc,"mousemove",e.onPointerMove),Event.add(e.doc,"mouseup",e.onPointerUp));e.onPointerMove(f,"down")};e.onPointerMove=function(f,a){if(!e.tracker)return e.onPointerDown(f);for(var c=e.bbox,d=f.changedTouches||
g.getCoords(f),l=d.length,k=0;k<l;k++){var h=d[k],m=h.identifier||Infinity,n=e.tracker[m];n&&(n.pageX=h.pageX,n.pageY=h.pageY,b.state=a||"move",b.identifier=m,b.start=n.start,b.fingers=e.fingers,"differenceFromLast"===e.position?(b.x=n.pageX-n.offsetX,b.y=n.pageY-n.offsetY,n.offsetX=n.pageX,n.offsetY=n.pageY):"relative"===e.position?(b.x=n.pageX+c.scrollLeft-n.offsetX,b.y=n.pageY+c.scrollTop-n.offsetY):(b.x=n.pageX-n.offsetX,b.y=n.pageY-n.offsetY),e.listener(f,b))}};e.onPointerUp=function(f){g.pointerEnd(f,
b,e,e.onPointerMove)&&!e.monitor&&(Event.remove(e.doc,"mousemove",e.onPointerMove),Event.remove(e.doc,"mouseup",e.onPointerUp))};var b=g.pointerSetup(e);if(e.event)e.onPointerDown(e.event);else Event.add(e.target,"mousedown",e.onPointerDown),e.monitor&&(Event.add(e.doc,"mousemove",e.onPointerMove),Event.add(e.doc,"mouseup",e.onPointerUp));return b};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.drag=g.drag;return g}(Event.proxy);
"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(g){var e=Math.PI/180;g.gesture=function(b){b.gesture=b.gesture||"gesture";b.minFingers=b.minFingers||b.fingers||2;b.onPointerDown=function(a){var c=b.fingers;g.pointerStart(a,f,b)&&(Event.add(b.doc,"mousemove",b.onPointerMove),Event.add(b.doc,"mouseup",b.onPointerUp));if(b.fingers===b.minFingers&&c!==b.fingers){f.fingers=b.minFingers;f.scale=1;f.rotation=0;f.state="start";var c="",d;for(d in b.tracker)c+=d;f.identifier=parseInt(c);b.listener(a,f)}};b.onPointerMove=function(a,
c){for(var d=b.bbox,l=b.tracker,k=a.changedTouches||g.getCoords(a),h=k.length,m=0;m<h;m++){var n=k[m],p=n.identifier||Infinity,q=l[p];q&&("relative"===b.position?(q.move.x=n.pageX+d.scrollLeft-d.x1,q.move.y=n.pageY+d.scrollTop-d.y1):(q.move.x=n.pageX-d.x1,q.move.y=n.pageY-d.y1))}if(!(b.fingers<b.minFingers)){var k=[],w=q=m=d=0,h=0;for(p in l)n=l[p],n.up||(q+=n.move.x,w+=n.move.y,h++);q/=h;w/=h;for(p in l)if(n=l[p],!n.up){h=n.start;if(!h.distance){var s=h.x-q,t=h.y-w;h.distance=Math.sqrt(s*s+t*t);
h.angle=Math.atan2(s,t)/e}var s=n.move.x-q,t=n.move.y-w,x=Math.sqrt(s*s+t*t),d=d+x/h.distance,s=Math.atan2(s,t)/e,h=(h.angle-s+360)%360-180;n.DEG2=n.DEG1;n.DEG1=0<h?h:-h;"undefined"!==typeof n.DEG2&&(n.rotation=0<h?n.rotation+(n.DEG1-n.DEG2):n.rotation-(n.DEG1-n.DEG2),m+=n.rotation);k.push(n.move)}f.touches=k;f.fingers=b.fingers;f.scale=d/b.fingers;f.rotation=m/b.fingers;f.state="change";b.listener(a,f)}};b.onPointerUp=function(a){var c=b.fingers;g.pointerEnd(a,f,b)&&(Event.remove(b.doc,"mousemove",
b.onPointerMove),Event.remove(b.doc,"mouseup",b.onPointerUp));c===b.minFingers&&b.fingers<b.minFingers&&(f.fingers=b.fingers,f.state="end",b.listener(a,f))};var f=g.pointerSetup(b);Event.add(b.target,"mousedown",b.onPointerDown);return f};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.gesture=g.gesture;return g}(Event.proxy);"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(g){g.pointerdown=g.pointermove=g.pointerup=function(e){e.gesture=e.gesture||"pointer";if(!e.target.isPointerEmitter){var b=!0;e.onPointerDown=function(a){b=!1;f.gesture="pointerdown";e.listener(a,f)};e.onPointerMove=function(a){f.gesture="pointermove";e.listener(a,f,b)};e.onPointerUp=function(a){b=!0;f.gesture="pointerup";e.listener(a,f,!0)};var f=g.pointerSetup(e);Event.add(e.target,"mousedown",e.onPointerDown);Event.add(e.target,"mousemove",e.onPointerMove);Event.add(e.doc,
"mouseup",e.onPointerUp);e.target.isPointerEmitter=!0;return f}};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.pointerdown=g.pointerdown;Event.Gesture._gestureHandlers.pointermove=g.pointermove;Event.Gesture._gestureHandlers.pointerup=g.pointerup;return g}(Event.proxy);"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(g){g.shake=function(e){var b={gesture:"devicemotion",acceleration:{},accelerationIncludingGravity:{},target:e.target,listener:e.listener,remove:function(){window.removeEventListener("devicemotion",d,!1)}},f=(new Date).getTime(),a={x:0,y:0,z:0},c={x:{count:0,value:0},y:{count:0,value:0},z:{count:0,value:0}},d=function(d){var g=d.accelerationIncludingGravity;a.x=0.8*a.x+(1-0.8)*g.x;a.y=0.8*a.y+(1-0.8)*g.y;a.z=0.8*a.z+(1-0.8)*g.z;b.accelerationIncludingGravity=a;b.acceleration.x=
g.x-a.x;b.acceleration.y=g.y-a.y;b.acceleration.z=g.z-a.z;if("devicemotion"===e.gesture)e.listener(d,b);else for(var g=(new Date).getTime(),h=0;3>h;h++){var m="xyz"[h],n=b.acceleration[m],m=c[m],p=Math.abs(n);!(1E3>g-f)&&4<p&&(n=g*n/p,p=Math.abs(n+m.value),m.value&&200>p?(m.value=n,m.count++,3===m.count&&(e.listener(d,b),f=g,m.value=0,m.count=0)):(m.value=n,m.count=1))}};if(window.addEventListener)return window.addEventListener("devicemotion",d,!1),b};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=
Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.shake=g.shake;return g}(Event.proxy);"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(g){var e=Math.PI/180;g.swipe=function(b){b.snap=b.snap||90;b.threshold=b.threshold||1;b.gesture=b.gesture||"swipe";b.onPointerDown=function(a){g.pointerStart(a,f,b)&&(Event.add(b.doc,"mousemove",b.onPointerMove).listener(a),Event.add(b.doc,"mouseup",b.onPointerUp))};b.onPointerMove=function(a){a=a.changedTouches||g.getCoords(a);for(var c=a.length,d=0;d<c;d++){var f=a[d],e=b.tracker[f.identifier||Infinity];e&&(e.move.x=f.pageX,e.move.y=f.pageY,e.moveTime=(new Date).getTime())}};
b.onPointerUp=function(a){if(g.pointerEnd(a,f,b)){Event.remove(b.doc,"mousemove",b.onPointerMove);Event.remove(b.doc,"mouseup",b.onPointerUp);var c,d,l,k,h={x:0,y:0},m=0,n=0,p=0,q;for(q in b.tracker){var w=b.tracker[q];k=w.move.x-w.start.x;var s=w.move.y-w.start.y,m=m+w.move.x,n=n+w.move.y;h.x+=w.start.x;h.y+=w.start.y;p++;d=Math.sqrt(k*k+s*s);w=w.moveTime-w.startTime;k=Math.atan2(k,s)/e+180;d=w?d/w:0;if("undefined"===typeof l)l=k,c=d;else if(20>=Math.abs(k-l))l=(l+k)/2,c=(c+d)/2;else return}q=b.gestureFingers;
b.minFingers<=q&&b.maxFingers>=q&&c>b.threshold&&(h.x/=p,h.y/=p,f.start=h,f.x=m/p,f.y=n/p,f.angle=-(((l/b.snap+0.5>>0)*b.snap||360)-360),f.velocity=c,f.fingers=q,f.state="swipe",b.listener(a,f))}};var f=g.pointerSetup(b);Event.add(b.target,"mousedown",b.onPointerDown);return f};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.swipe=g.swipe;return g}(Event.proxy);"undefined"===typeof Event&&(Event={});
"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(g){g.longpress=function(e){e.gesture="longpress";return g.tap(e)};g.tap=function(e){e.delay=e.delay||500;e.timeout=e.timeout||250;e.driftDeviance=e.driftDeviance||10;e.gesture=e.gesture||"tap";var b,f;e.onPointerDown=function(c){g.pointerStart(c,a,e)&&(b=(new Date).getTime(),Event.add(e.doc,"mousemove",e.onPointerMove).listener(c),Event.add(e.doc,"mouseup",e.onPointerUp),"longpress"===e.gesture&&(f=setTimeout(function(){if(!(c.cancelBubble&&1<++c.bubble)){var d=0,b;for(b in e.tracker){var f=
e.tracker[b];if(!0===f.end||e.cancel)return;d++}e.minFingers<=d&&e.maxFingers>=d&&(a.state="start",a.fingers=d,a.x=f.start.x,a.y=f.start.y,e.listener(c,a))}},e.delay)))};e.onPointerMove=function(a){var d=e.bbox;a=a.changedTouches||g.getCoords(a);for(var b=a.length,f=0;f<b;f++){var h=a[f],m=e.tracker[h.identifier||Infinity];if(m){if("relative"===e.position)var n=h.pageX+d.scrollLeft-d.x1,h=h.pageY+d.scrollTop-d.y1;else n=h.pageX-d.x1,h=h.pageY-d.y1;var p=n-m.start.x,m=h-m.start.y,m=Math.sqrt(p*p+m*
m);if(!(0<n&&n<d.width&&0<h&&h<d.height&&m<=e.driftDeviance)){Event.remove(e.doc,"mousemove",e.onPointerMove);e.cancel=!0;break}}}};e.onPointerUp=function(c){if(g.pointerEnd(c,a,e)&&(clearTimeout(f),Event.remove(e.doc,"mousemove",e.onPointerMove),Event.remove(e.doc,"mouseup",e.onPointerUp),!(c.cancelBubble&&1<++c.bubble)))if("longpress"===e.gesture)"start"===a.state&&(a.state="end",e.listener(c,a));else if(!(e.cancel||(new Date).getTime()-b>e.timeout)){var d=e.gestureFingers;e.minFingers<=d&&e.maxFingers>=
d&&(a.state="tap",a.fingers=e.gestureFingers,e.listener(c,a))}};var a=g.pointerSetup(e);Event.add(e.target,"mousedown",e.onPointerDown);return a};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.tap=g.tap;Event.Gesture._gestureHandlers.longpress=g.longpress;return g}(Event.proxy);"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(g){g.wheel=function(e){var b,f=e.timeout||150,a=0,c={gesture:"wheel",state:"start",wheelDelta:0,target:e.target,listener:e.listener,preventElasticBounce:function(){var d=this.target,a=d.scrollTop;a+d.offsetHeight===d.scrollHeight&&0>=this.wheelDelta?Event.cancel(event):0===a&&0<=this.wheelDelta&&Event.cancel(event);Event.stop(event)},add:function(){e.target[l](h,d,!1)},remove:function(){e.target[g](h,d,!1)}},d=function(d){d=d||window.event;c.state=a++?"change":"start";c.wheelDelta=
d.detail?-20*d.detail:d.wheelDelta;e.listener(d,c);clearTimeout(b);b=setTimeout(function(){a=0;c.state="end";c.wheelDelta=0;e.listener(d,c)},f)},l=document.addEventListener?"addEventListener":"attachEvent",g=document.removeEventListener?"removeEventListener":"detachEvent",h=Event.getEventSupport("mousewheel")?"mousewheel":"DOMMouseScroll";e.target[l](h,d,!1);return c};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.wheel=
g.wheel;return g}(Event.proxy);"undefined"===typeof Event&&(Event={});"undefined"===typeof Event.proxy&&(Event.proxy={});
Event.proxy=function(g){g.orientation=function(e){var b={gesture:"orientationchange",previous:null,current:window.orientation,target:e.target,listener:e.listener,remove:function(){window.removeEventListener("orientationchange",f,!1)}},f=function(a){b.previous=b.current;b.current=window.orientation;null!==b.previous&&b.previous!=b.current&&e.listener(a,b)};window.DeviceOrientationEvent&&window.addEventListener("orientationchange",f,!1);return b};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=
Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.orientation=g.orientation;return g}(Event.proxy);
(function(){function g(a,c){this.__eventListeners[a]&&(c?fabric.util.removeFromArray(this.__eventListeners[a],c):this.__eventListeners[a].length=0)}function e(a,c){this.__eventListeners||(this.__eventListeners={});if(1===arguments.length)for(var d in a)this.on(d,a[d]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(c);return this}function b(a,c){if(this.__eventListeners){if(0===arguments.length)this.__eventListeners={};else if(1===arguments.length&&"object"===
typeof arguments[0])for(var d in a)g.call(this,d,a[d]);else g.call(this,a,c);return this}}function f(a,c){if(this.__eventListeners){var d=this.__eventListeners[a];if(d){for(var b=0,f=d.length;b<f;b++)d[b].call(this,c||{});return this}}}fabric.Observable={observe:e,stopObserving:b,fire:f,on:e,off:b,trigger:f}})();
fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var g=0,e=arguments.length;g<e;g++)this._onObjectAdded(arguments[g]);this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(g,e,b){var f=this.getObjects();b?f[e]=g:f.splice(e,0,g);this._onObjectAdded(g);this.renderOnAddRemove&&this.renderAll();return this},remove:function(){for(var g=this.getObjects(),e,b=0,f=arguments.length;b<f;b++)e=g.indexOf(arguments[b]),-1!==e&&(g.splice(e,1),this._onObjectRemoved(arguments[b]));
this.renderOnAddRemove&&this.renderAll();return this},forEachObject:function(g,e){for(var b=this.getObjects(),f=b.length;f--;)g.call(e,b[f],f,b);return this},getObjects:function(g){return"undefined"===typeof g?this._objects:this._objects.filter(function(e){return e.type===g})},item:function(g){return this.getObjects()[g]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(g){return-1<this.getObjects().indexOf(g)},complexity:function(){return this.getObjects().reduce(function(g,
e){return g+=e.complexity?e.complexity():0},0)}};
(function(g){var e=Math.sqrt,b=Math.atan2,f=Math.PI/180;fabric.util={removeFromArray:function(a,c){var d=a.indexOf(c);-1!==d&&a.splice(d,1);return a},getRandomInt:function(a,c){return Math.floor(Math.random()*(c-a+1))+a},degreesToRadians:function(a){return a*f},radiansToDegrees:function(a){return a/f},rotatePoint:function(a,c,d){var b=Math.sin(d);d=Math.cos(d);a.subtractEquals(c);return(new fabric.Point(a.x*d-a.y*b,a.x*b+a.y*d)).addEquals(c)},toFixed:function(a,c){return parseFloat(Number(a).toFixed(c))},
falseFunction:function(){return!1},getKlass:function(a,c){a=fabric.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1));return fabric.util.resolveNamespace(c)[a]},resolveNamespace:function(a){if(!a)return fabric;a=a.split(".");for(var c=a.length,d=g||fabric.window,b=0;b<c;++b)d=d[a[b]];return d},loadImage:function(a,c,d,b){if(a){var f=fabric.util.createImage();f.onload=function(){c&&c.call(d,f);f=f.onload=f.onerror=null};f.onerror=function(){fabric.log("Error loading "+f.src);c&&c.call(d,null,
!0);f=f.onload=f.onerror=null};0!==a.indexOf("data")&&"undefined"!==typeof b&&(f.crossOrigin=b);f.src=a}else c&&c.call(d,a)},enlivenObjects:function(a,c,d,b){function f(){++g===n&&c&&c(e)}a=a||[];var e=[],g=0,n=a.length;n?a.forEach(function(a,c){if(a&&a.type){var g=fabric.util.getKlass(a.type,d);g.async?g.fromObject(a,function(d,g){g||(e[c]=d,b&&b(a,e[c]));f()}):(e[c]=g.fromObject(a),b&&b(a,e[c]),f())}else f()}):c&&c(e)},groupSVGElements:function(a,c,d){a=1<a.length?new fabric.PathGroup(a,c):a[0];
"undefined"!==typeof d&&a.setSourcePath(d);return a},populateWithProperties:function(a,c,d){if(d&&"[object Array]"===Object.prototype.toString.call(d))for(var b=0,f=d.length;b<f;b++)d[b]in a&&(c[d[b]]=a[d[b]])},drawDashedLine:function(a,c,d,f,g,h){f-=c;var m=g-d;g=e(f*f+m*m);f=b(m,f);var m=h.length,n=0,p=!0;a.save();a.translate(c,d);a.moveTo(0,0);a.rotate(f);for(c=0;g>c;)c+=h[n++%m],c>g&&(c=g),a[p?"lineTo":"moveTo"](c,0),p=!p;a.restore()},createCanvasElement:function(a){a||(a=fabric.document.createElement("canvas"));
a.getContext||"undefined"===typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(a);return a},createImage:function(){return fabric.isLikelyNode?new (require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(a){a=a.prototype;for(var c=a.stateProperties.length;c--;){var d=a.stateProperties[c],b=d.charAt(0).toUpperCase()+d.slice(1),f="set"+b,b="get"+b;a[b]||(a[b]=new Function('return this.get("'+d+'")'));a[f]||(a[f]=new Function("value",'return this.set("'+d+'", value)'))}},
clipContext:function(a,c){c.save();c.beginPath();a.clipTo(c);c.clip()},multiplyTransformMatrices:function(a,c){for(var d=[[a[0],a[2],a[4]],[a[1],a[3],a[5]],[0,0,1]],b=[[c[0],c[2],c[4]],[c[1],c[3],c[5]],[0,0,1]],f=[],e=0;3>e;e++){f[e]=[];for(var g=0;3>g;g++){for(var n=0,p=0;3>p;p++)n+=d[e][p]*b[p][g];f[e][g]=n}}return[f[0][0],f[1][0],f[0][1],f[1][1],f[0][2],f[1][2]]},getFunctionBody:function(a){return(String(a).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},normalizePoints:function(a,c){for(var d=fabric.util.array.min(a,
"x"),b=fabric.util.array.min(a,"y"),d=0>d?d:0,b=0>d?b:0,f=0,e=a.length;f<e;f++)a[f].x-=c.width/2+d||0,a[f].y-=c.height/2+b||0},isTransparent:function(a,c,d,b){0<b&&(c=c>b?c-b:0,d=d>b?d-b:0);var f=!0;a=a.getImageData(c,d,2*b||1,2*b||1);c=3;for(d=a.data.length;c<d&&(f=0>=a.data[c],!1!==f);c+=4);return f}}})("undefined"!==typeof exports?exports:this);
(function(){function g(d,f,e,g,m,n,p,q,w){var s,t,x,A,v,u;c=a.call(arguments);if(b[c])return b[c];var r=e;s=g;t=q;x=w;var z=d;A=f;u=p*(Math.PI/180);v=Math.sin(u);u=Math.cos(u);r=Math.abs(r);s=Math.abs(s);var C=0.5*u*(t-z)+0.5*v*(x-A),B=0.5*u*(x-A)-0.5*v*(t-z),C=C*C/(r*r)+B*B/(s*s);1<C&&(C=Math.sqrt(C),r*=C,s*=C);var C=u/r,B=v/r,r=-v/s,D=u/s;s=C*t+B*x;t=r*t+D*x;x=C*z+B*A;A=r*z+D*A;z=1/((x-s)*(x-s)+(A-t)*(A-t))-0.25;0>z&&(z=0);C=Math.sqrt(z);n===m&&(C=-C);z=0.5*(s+x)-C*(A-t);C=0.5*(t+A)+C*(x-s);s=Math.atan2(t-
C,s-z);A=Math.atan2(A-C,x-z)-s;0>A&&1===n?A+=2*Math.PI:0<A&&0===n&&(A-=2*Math.PI);t=Math.ceil(Math.abs(A/(0.5*Math.PI+0.0010)));x=[];for(r=0;r<t;r++)x[r]=[z,C,s+r*A/t,s+(r+1)*A/t,e,g,v,u];return b[c]=x}function e(d,b,e,g,m,n,p,q){c=a.call(arguments);if(f[c])return f[c];var w=q*m,s=-p*n,t=p*m,x=q*n,A=0.5*(g-e),v=8/3*Math.sin(0.5*A)*Math.sin(0.5*A)/Math.sin(A),A=d+Math.cos(e)-v*Math.sin(e),u=b+Math.sin(e)+v*Math.cos(e),r=d+Math.cos(g),z=b+Math.sin(g),C=r+v*Math.sin(g),v=z-v*Math.cos(g);f[c]=[w*A+s*
u,t*A+x*u,w*C+s*v,t*C+x*v,w*r+s*z,t*r+x*z];return f[c]}var b={},f={},a=Array.prototype.join,c;fabric.util.drawArc=function(d,a,c,b){a=g(b[5],b[6],b[0],b[1],b[3],b[4],b[2],a,c);for(c=0;c<a.length;c++)b=e.apply(this,a[c]),d.bezierCurveTo.apply(d,b)}})();
(function(){function g(b,f,a){if(b&&0!==b.length){var c=b.length-1,d=f?b[c][f]:b[c];if(f)for(;c--;)a(b[c][f],d)&&(d=b[c][f]);else for(;c--;)a(b[c],d)&&(d=b[c]);return d}}var e=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(b){if(void 0===this||null===this)throw new TypeError;var f=Object(this),a=f.length>>>0;if(0===a)return-1;var c=0;0<arguments.length&&(c=Number(arguments[1]),c!==c?c=0:0!==c&&c!==Number.POSITIVE_INFINITY&&c!==Number.NEGATIVE_INFINITY&&(c=(0<c||-1)*
Math.floor(Math.abs(c))));if(c>=a)return-1;for(c=0<=c?c:Math.max(a-Math.abs(c),0);c<a;c++)if(c in f&&f[c]===b)return c;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(b,f){for(var a=0,c=this.length>>>0;a<c;a++)a in this&&b.call(f,this[a],a,this)});Array.prototype.map||(Array.prototype.map=function(b,f){for(var a=[],c=0,d=this.length>>>0;c<d;c++)c in this&&(a[c]=b.call(f,this[c],c,this));return a});Array.prototype.every||(Array.prototype.every=function(b,f){for(var a=0,c=this.length>>>
0;a<c;a++)if(a in this&&!b.call(f,this[a],a,this))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(b,f){for(var a=0,c=this.length>>>0;a<c;a++)if(a in this&&b.call(f,this[a],a,this))return!0;return!1});Array.prototype.filter||(Array.prototype.filter=function(b,f){for(var a=[],c,d=0,e=this.length>>>0;d<e;d++)d in this&&(c=this[d],b.call(f,c,d,this)&&a.push(c));return a});Array.prototype.reduce||(Array.prototype.reduce=function(b){var f=this.length>>>0,a=0,c;if(1<arguments.length)c=
arguments[1];else{do{if(a in this){c=this[a++];break}if(++a>=f)throw new TypeError;}while(1)}for(;a<f;a++)a in this&&(c=b.call(null,c,this[a],a,this));return c});fabric.util.array={invoke:function(b,f){for(var a=e.call(arguments,2),c=[],d=0,l=b.length;d<l;d++)c[d]=a.length?b[d][f].apply(b[d],a):b[d][f].call(b[d]);return c},min:function(b,f){return g(b,f,function(a,c){return a<c})},max:function(b,f){return g(b,f,function(a,c){return a>=c})}}})();
(function(){function g(e,b){for(var f in b)e[f]=b[f];return e}fabric.util.object={extend:g,clone:function(e){return g({},e)}}})();
(function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});fabric.util.string={camelize:function(g){return g.replace(/-+(.)?/g,function(e,b){return b?b.toUpperCase():""})},capitalize:function(g,e){return g.charAt(0).toUpperCase()+(e?g.slice(1):g.slice(1).toLowerCase())},escapeXml:function(g){return g.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();
(function(){var g=Array.prototype.slice,e=Function.prototype.apply,b=function(){};Function.prototype.bind||(Function.prototype.bind=function(f){var a=this,c=g.call(arguments,1),d;d=c.length?function(){return e.call(a,this instanceof b?this:f,c.concat(g.call(arguments)))}:function(){return e.call(a,this instanceof b?this:f,arguments)};b.prototype=this.prototype;d.prototype=new b;return d})})();
(function(){function g(){}function e(d){var a=this.constructor.superclass.prototype[d];return 1<arguments.length?a.apply(this,b.call(arguments,1)):a.call(this)}var b=Array.prototype.slice,f=function(){},a=function(){for(var d in{toString:1})if("toString"===d)return!1;return!0}(),c=function(d,c,b){for(var f in c)f in d.prototype&&"function"===typeof d.prototype[f]&&-1<(c[f]+"").indexOf("callSuper")?d.prototype[f]=function(d){return function(){var a=this.constructor.superclass;this.constructor.superclass=
b;var f=c[d].apply(this,arguments);this.constructor.superclass=a;if("initialize"!==d)return f}}(f):d.prototype[f]=c[f],a&&(c.toString!==Object.prototype.toString&&(d.prototype.toString=c.toString),c.valueOf!==Object.prototype.valueOf&&(d.prototype.valueOf=c.valueOf))};fabric.util.createClass=function(){function d(){this.initialize.apply(this,arguments)}var a=null,k=b.call(arguments,0);"function"===typeof k[0]&&(a=k.shift());d.superclass=a;d.subclasses=[];a&&(g.prototype=a.prototype,d.prototype=new g,
a.subclasses.push(d));for(var h=0,m=k.length;h<m;h++)c(d,k[h],a);d.prototype.initialize||(d.prototype.initialize=f);d.prototype.constructor=d;d.prototype.callSuper=e;return d}})();
(function(){function g(d){var a=Array.prototype.slice.call(arguments,1),c,b,f=a.length;for(b=0;b<f;b++)if(c=typeof d[a[b]],!/^(?:function|object|unknown)$/.test(c))return!1;return!0}function e(d,a){return function(b){a.call(c(d),b||fabric.window.event)}}function b(d,a){return function(c){if(m[d]&&m[d][a])for(var b=m[d][a],f=0,e=b.length;f<e;f++)b[f].call(this,c||fabric.window.event)}}function f(d,a,c){var b="touchend"===d.type?"changedTouches":"touches";return d[b]&&d[b][0]?d[b][0][a]-(d[b][0][a]-
d[b][0][c])||d[c]:d[c]}var a=function(){var d=0;return function(a){return a.__uniqueID||(a.__uniqueID="uniqueID__"+d++)}}(),c,d;(function(){var a={};c=function(d){return a[d]};d=function(d,c){a[d]=c}})();var l=g(fabric.document.documentElement,"addEventListener","removeEventListener")&&g(fabric.window,"addEventListener","removeEventListener"),k=g(fabric.document.documentElement,"attachEvent","detachEvent")&&g(fabric.window,"attachEvent","detachEvent"),h={},m={};l?(l=function(d,a,c){d.addEventListener(a,
c,!1)},k=function(d,a,c){d.removeEventListener(a,c,!1)}):k?(l=function(c,b,f){var l=a(c);d(l,c);h[l]||(h[l]={});h[l][b]||(h[l][b]=[]);f={handler:f,wrappedHandler:e(l,f)};h[l][b].push(f);c.attachEvent("on"+b,f.wrappedHandler)},k=function(d,c,b){var f=a(d),e;if(h[f]&&h[f][c])for(var l=0,g=h[f][c].length;l<g;l++)(e=h[f][c][l])&&e.handler===b&&(d.detachEvent("on"+c,e.wrappedHandler),h[f][c][l]=null)}):(l=function(d,c,f){var e=a(d);m[e]||(m[e]={});if(!m[e][c]){m[e][c]=[];var l=d["on"+c];l&&m[e][c].push(l);
d["on"+c]=b(e,c)}m[e][c].push(f)},k=function(d,c,b){d=a(d);if(m[d]&&m[d][c]){c=m[d][c];d=0;for(var f=c.length;d<f;d++)c[d]===b&&c.splice(d,1)}});fabric.util.addListener=l;fabric.util.removeListener=k;var n=function(d){return"unknown"!==typeof d.clientX?d.clientX:0},p=function(d){return"unknown"!==typeof d.clientY?d.clientY:0};fabric.isTouchSupported&&(n=function(d){return f(d,"pageX","clientX")},p=function(d){return f(d,"pageY","clientY")});fabric.util.getPointer=function(d,a){d||(d=fabric.window.event);
var c=fabric.util.getScrollLeftTop(d.target||("unknown"!==typeof d.srcElement?d.srcElement:null),a);return{x:n(d)+c.left,y:p(d)+c.top}};fabric.util.object.extend(fabric.util,fabric.Observable)})();
(function(){var g=fabric.document.createElement("div"),e="string"===typeof g.style.filter,b=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,f=function(a){return a};"string"===typeof g.style.opacity?f=function(a,c){a.style.opacity=c;return a}:e&&(f=function(a,c){var d=a.style;a.currentStyle&&!a.currentStyle.hasLayout&&(d.zoom=1);b.test(d.filter)?d.filter=d.filter.replace(b,0.9999<=c?"":"alpha(opacity="+100*c+")"):d.filter+=" alpha(opacity="+100*c+")";return a});fabric.util.setStyle=function(a,c){var d=a.style;
if(!d)return a;if("string"===typeof c)return a.style.cssText+=";"+c,-1<c.indexOf("opacity")?f(a,c.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var b in c)"opacity"===b?f(a,c[b]):d["float"===b||"cssFloat"===b?"undefined"===typeof d.styleFloat?"cssFloat":"styleFloat":b]=c[b];return a}})();
(function(){function g(d,a){var c=fabric.document.createElement(d),b;for(b in a)"class"===b?c.className=a[b]:"for"===b?c.htmlFor=a[b]:c.setAttribute(b,a[b]);return c}function e(d,a){d.style||(d.style={});if(fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle)return fabric.document.defaultView.getComputedStyle(d,null)[a];var c=d.style[a];!c&&d.currentStyle&&(c=d.currentStyle[a]);return c}var b=Array.prototype.slice,f=function(d){return b.call(d,0)},a;try{a=f(fabric.document.childNodes)instanceof
Array}catch(c){}a||(f=function(d){for(var a=Array(d.length),c=d.length;c--;)a[c]=d[c];return a});(function(){var d=fabric.document.documentElement.style,a="userSelect"in d?"userSelect":"MozUserSelect"in d?"MozUserSelect":"WebkitUserSelect"in d?"WebkitUserSelect":"KhtmlUserSelect"in d?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=function(d){"undefined"!==typeof d.onselectstart&&(d.onselectstart=fabric.util.falseFunction);a?d.style[a]="none":"string"===typeof d.unselectable&&(d.unselectable=
"on");return d};fabric.util.makeElementSelectable=function(d){"undefined"!==typeof d.onselectstart&&(d.onselectstart=null);a?d.style[a]="":"string"===typeof d.unselectable&&(d.unselectable="");return d}})();(function(){fabric.util.getScript=function(d,a){var c=fabric.document.getElementsByTagName("head")[0],b=fabric.document.createElement("script"),f=!0;b.onload=b.onreadystatechange=function(d){!f||"string"===typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(f=!1,
a(d||fabric.window.event),b=b.onload=b.onreadystatechange=null)};b.src=d;c.appendChild(b)}})();fabric.util.getById=function(d){return"string"===typeof d?fabric.document.getElementById(d):d};fabric.util.toArray=f;fabric.util.makeElement=g;fabric.util.addClass=function(d,a){-1===(" "+d.className+" ").indexOf(" "+a+" ")&&(d.className+=(d.className?" ":"")+a)};fabric.util.wrapElement=function(d,a,c){"string"===typeof a&&(a=g(a,c));d.parentNode&&d.parentNode.replaceChild(a,d);a.appendChild(d);return a};
fabric.util.getScrollLeftTop=function(d,a){var c,b,f=0,e=0,g=fabric.document.documentElement,q=fabric.document.body||{scrollLeft:0,scrollTop:0};for(b=d;d&&d.parentNode&&!c;)d=d.parentNode,d!==fabric.document&&"fixed"===fabric.util.getElementStyle(d,"position")&&(c=d),d!==fabric.document&&b!==a&&"absolute"===fabric.util.getElementStyle(d,"position")?e=f=0:d===fabric.document?(f=q.scrollLeft||g.scrollLeft||0,e=q.scrollTop||g.scrollTop||0):(f+=d.scrollLeft||0,e+=d.scrollTop||0);return{left:f,top:e}};
fabric.util.getElementOffset=function(d){var a,c={left:0,top:0};a=d&&d.ownerDocument;var b={left:0,top:0},f={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!a)return{left:0,top:0};for(var g in f)b[f[g]]+=parseInt(e(d,g),10)||0;a=a.documentElement;"undefined"!==typeof d.getBoundingClientRect&&(c=d.getBoundingClientRect());d=fabric.util.getScrollLeftTop(d,null);return{left:c.left+d.left-(a.clientLeft||0)+b.left,top:c.top+d.top-(a.clientTop||0)+b.top}};fabric.util.getElementStyle=
e})();
(function(){function g(){}var e=function(){for(var b=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],f=b.length;f--;)try{if(b[f]())return b[f]}catch(a){}}();fabric.util.request=function(b,f){f||(f={});var a=f.method?f.method.toUpperCase():"GET",c=f.onComplete||function(){},d=e(),l;d.onreadystatechange=function(){4===d.readyState&&(c(d),
d.onreadystatechange=g)};"GET"===a&&(l=null,"string"===typeof f.parameters&&(b=b+(/\?/.test(b)?"&":"?")+f.parameters));d.open(a,b,!0);"POST"!==a&&"PUT"!==a||d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");d.send(l);return d}})();fabric.log=function(){};fabric.warn=function(){};"undefined"!==typeof console&&["log","warn"].forEach(function(g){"undefined"!==typeof console[g]&&console[g].apply&&(fabric[g]=function(){return console[g].apply(console,arguments)})});
(function(){var g=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(b){fabric.window.setTimeout(b,1E3/60)},e=function(){return g.apply(fabric.window,arguments)};fabric.util.animate=function(b){e(function(f){b||(b={});var a=f||+new Date,c=b.duration||500,d=a+c,l,g=b.onChange||function(){},h=b.abort||function(){return!1},m=b.easing||function(d,a,
c,b){return-c*Math.cos(d/b*(Math.PI/2))+c+a},n="startValue"in b?b.startValue:0;f="endValue"in b?b.endValue:100;var p=b.byValue||f-n;b.onStart&&b.onStart();(function w(f){l=f||+new Date;f=l>d?c:l-a;h()?b.onComplete&&b.onComplete():(g(m(f,n,p,c)),l>d?b.onComplete&&b.onComplete():e(w))})(a)})};fabric.util.requestAnimFrame=e})();
(function(){function g(a,c,d,b){a<Math.abs(c)?(a=c,b=d/4):b=d/(2*Math.PI)*Math.asin(c/a);return{a:a,c:c,p:d,s:b}}function e(a,c,d){return a.a*Math.pow(2,10*(c-=1))*Math.sin(2*(c*d-a.s)*Math.PI/a.p)}function b(a,c,d,b){return d-f(b-a,0,d,b)+c}function f(a,c,d,b){return(a/=b)<1/2.75?7.5625*d*a*a+c:a<2/2.75?d*(7.5625*(a-=1.5/2.75)*a+0.75)+c:a<2.5/2.75?d*(7.5625*(a-=2.25/2.75)*a+0.9375)+c:d*(7.5625*(a-=2.625/2.75)*a+0.984375)+c}fabric.util.ease={easeInQuad:function(a,c,d,b){return d*(a/=b)*a+c},easeOutQuad:function(a,
c,d,b){return-d*(a/=b)*(a-2)+c},easeInOutQuad:function(a,c,d,b){a/=b/2;return 1>a?d/2*a*a+c:-d/2*(--a*(a-2)-1)+c},easeInCubic:function(a,c,d,b){return d*(a/=b)*a*a+c},easeOutCubic:function(a,c,d,b){return d*((a=a/b-1)*a*a+1)+c},easeInOutCubic:function(a,c,d,b){a/=b/2;return 1>a?d/2*a*a*a+c:d/2*((a-=2)*a*a+2)+c},easeInQuart:function(a,c,d,b){return d*(a/=b)*a*a*a+c},easeOutQuart:function(a,c,d,b){return-d*((a=a/b-1)*a*a*a-1)+c},easeInOutQuart:function(a,c,d,b){a/=b/2;return 1>a?d/2*a*a*a*a+c:-d/2*
((a-=2)*a*a*a-2)+c},easeInQuint:function(a,c,d,b){return d*(a/=b)*a*a*a*a+c},easeOutQuint:function(a,c,d,b){return d*((a=a/b-1)*a*a*a*a+1)+c},easeInOutQuint:function(a,c,d,b){a/=b/2;return 1>a?d/2*a*a*a*a*a+c:d/2*((a-=2)*a*a*a*a+2)+c},easeInSine:function(a,c,d,b){return-d*Math.cos(a/b*(Math.PI/2))+d+c},easeOutSine:function(a,c,d,b){return d*Math.sin(a/b*(Math.PI/2))+c},easeInOutSine:function(a,c,d,b){return-d/2*(Math.cos(Math.PI*a/b)-1)+c},easeInExpo:function(a,c,d,b){return 0===a?c:d*Math.pow(2,
10*(a/b-1))+c},easeOutExpo:function(a,c,d,b){return a===b?c+d:d*(-Math.pow(2,-10*a/b)+1)+c},easeInOutExpo:function(a,c,d,b){if(0===a)return c;if(a===b)return c+d;a/=b/2;return 1>a?d/2*Math.pow(2,10*(a-1))+c:d/2*(-Math.pow(2,-10*--a)+2)+c},easeInCirc:function(a,c,d,b){return-d*(Math.sqrt(1-(a/=b)*a)-1)+c},easeOutCirc:function(a,c,d,b){return d*Math.sqrt(1-(a=a/b-1)*a)+c},easeInOutCirc:function(a,c,d,b){a/=b/2;return 1>a?-d/2*(Math.sqrt(1-a*a)-1)+c:d/2*(Math.sqrt(1-(a-=2)*a)+1)+c},easeInElastic:function(a,
c,d,b){var f=0;if(0===a)return c;a/=b;if(1===a)return c+d;f||(f=0.3*b);d=g(d,d,f,1.70158);return-e(d,a,b)+c},easeOutElastic:function(a,c,d,b){var f=0;if(0===a)return c;a/=b;if(1===a)return c+d;f||(f=0.3*b);d=g(d,d,f,1.70158);return d.a*Math.pow(2,-10*a)*Math.sin(2*(a*b-d.s)*Math.PI/d.p)+d.c+c},easeInOutElastic:function(a,c,d,b){var f=0;if(0===a)return c;a/=b/2;if(2===a)return c+d;f||(f=0.3*1.5*b);d=g(d,d,f,1.70158);return 1>a?-0.5*e(d,a,b)+c:0.5*d.a*Math.pow(2,-10*(a-=1))*Math.sin(2*(a*b-d.s)*Math.PI/
d.p)+d.c+c},easeInBack:function(a,c,d,b,f){void 0===f&&(f=1.70158);return d*(a/=b)*a*((f+1)*a-f)+c},easeOutBack:function(a,c,d,b,f){void 0===f&&(f=1.70158);return d*((a=a/b-1)*a*((f+1)*a+f)+1)+c},easeInOutBack:function(a,c,d,b,f){void 0===f&&(f=1.70158);a/=b/2;return 1>a?d/2*a*a*(((f*=1.525)+1)*a-f)+c:d/2*((a-=2)*a*(((f*=1.525)+1)*a+f)+2)+c},easeInBounce:b,easeOutBounce:f,easeInOutBounce:function(a,c,d,e){return a<e/2?0.5*b(2*a,0,d,e)+c:0.5*f(2*a-e,0,d,e)+0.5*d+c}}})();
(function(g){function e(d){return d in s?s[d]:d}function b(d,a,c){"fill"!==d&&"stroke"!==d||"none"!==a?"fillRule"===d?a="evenodd"===a?"destination-over":a:"strokeDashArray"===d?a=a.replace(/,/g," ").split(/\s+/):"transformMatrix"===d&&(a=c&&c.transformMatrix?w(c.transformMatrix,h.parseTransformAttribute(a)):h.parseTransformAttribute(a)):a="";c=(d="[object Array]"===Object.prototype.toString.call(a))?a.map(parseFloat):parseFloat(a);return!d&&isNaN(c)?a:c}function f(d){for(var a in t)if(d[a]&&"undefined"!==
typeof d[t[a]]&&0!==d[a].indexOf("url(")){var c=new h.Color(d[a]);d[a]=c.setAlpha(q(c.getAlpha()*d[t[a]],2)).toRgba();delete d[t[a]]}return d}function a(d,a){var c=d.match(/(normal|italic)?\s*(normal|small-caps)?\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\s*(\d+)px(?:\/(normal|[\d\.]+))?\s+(.*)/);if(c){var b=c[1],f=c[3],e=c[4],l=c[5],c=c[6];b&&(a.fontStyle=b);f&&(a.fontSize=isNaN(parseFloat(f))?f:parseFloat(f));e&&(a.fontSize=parseFloat(e));c&&(a.fontFamily=c);l&&(a.lineHeight=
"normal"===l?1:l)}}function c(d,c){var f,l;d.replace(/;$/,"").split(";").forEach(function(d){d=d.split(":");f=e(d[0].trim().toLowerCase());l=b(f,d[1].trim());"font"===f?a(l,c):c[f]=l})}function d(d){var a=d.nodeName,c=d.getAttribute("class");d=d.getAttribute("id");var b={},f;for(f in h.cssRules)if(c&&RegExp("^\\."+c).test(f)||d&&RegExp("^#"+d).test(f)||RegExp("^"+a).test(f))for(var e in h.cssRules[f])b[e]=h.cssRules[f][e];return b}function l(d){var a=d.objects;d=d.options;a=a.map(function(d){return h[n(d.type)].fromObject(d)});
return{objects:a,options:d}}function k(d,a,c){a[c]&&a[c].toSVG&&d.push('<pattern x="0" y="0" id="',c,'Pattern" ','width="',a[c].source.width,'" height="',a[c].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',a[c].source.width,'" height="',a[c].source.height,'" xlink:href="',a[c].source.src,'"></image></pattern>')}var h=g.fabric||(g.fabric={}),m=h.util.object.extend,n=h.util.string.capitalize,p=h.util.object.clone,q=h.util.toFixed,w=h.util.multiplyTransformMatrices,
s={"fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight",cx:"left",x:"left",r:"radius","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration",cy:"top",y:"top",transform:"transformMatrix"},t={stroke:"strokeOpacity",fill:"fillOpacity"};
h.parseTransformAttribute=function(){function d(a,c){var b=c[0];a[0]=Math.cos(b);a[1]=Math.sin(b);a[2]=-Math.sin(b);a[3]=Math.cos(b)}function a(d,c){var b=2===c.length?c[1]:c[0];d[0]=c[0];d[3]=b}function c(d,a){d[4]=a[0];2===a.length&&(d[5]=a[1])}var b=[1,0,0,1,0,0],f=RegExp("^\\s*(?:(?:(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))(?:(?:\\s+,?\\s*|,\\s*)(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))))*)?)\\s*$"),
e=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))",
"g");return function(l){var g=b.concat(),k=[];if(!l||l&&!f.test(l))return g;l.replace(e,function(f){var e=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))").exec(f).filter(function(d){return""!==
d&&null!=d});f=e[1];e=e.slice(2).map(parseFloat);switch(f){case "translate":c(g,e);break;case "rotate":d(g,e);break;case "scale":a(g,e);break;case "skewX":g[2]=e[0];break;case "skewY":g[1]=e[0];break;case "matrix":g=e}k.push(g.concat());g=b.concat()});for(l=k[0];1<k.length;)k.shift(),l=h.util.multiplyTransformMatrices(l,k[0]);return l}}();h.parseSVGDocument=function(){var d=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,a=RegExp("^\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*$");
return function(c,b,f){if(c){var e=new Date,l=h.util.toArray(c.getElementsByTagName("*"));if(0===l.length){for(var l=c.selectNodes("//*[name(.)!='svg']"),g=[],k=0,m=l.length;k<m;k++)g[k]=l[k];l=g}if((l=l.filter(function(a){var c;if(c=d.test(a.tagName)){a:{for(c=/^(?:pattern|defs)$/;a&&(a=a.parentNode);)if(c.test(a.nodeName)){a=!0;break a}a=!1}c=!a}return c}))&&(!l||l.length)){var g=c.getAttribute("viewBox"),k=c.getAttribute("width"),m=c.getAttribute("height"),n=null,q=null;g&&(g=g.match(a))&&(parseInt(g[1],
10),parseInt(g[2],10),n=parseInt(g[3],10),q=parseInt(g[4],10));var n=k?parseFloat(k):n,q=m?parseFloat(m):q,w={width:n,height:q};h.gradientDefs=h.getGradientDefs(c);h.cssRules=h.getCSSRules(c);h.parseElements(l,function(d){h.documentParsingTime=new Date-e;b&&b(d,w)},p(w),f)}}}}();var x={has:function(d,a){a(!1)},get:function(){},set:function(){}};m(h,{resolveGradients:function(d){for(var a=d.length;a--;){var c=d[a].get("fill");/^url\(/.test(c)&&(c=c.slice(5,c.length-1),h.gradientDefs[c]&&d[a].set("fill",
h.Gradient.fromElement(h.gradientDefs[c],d[a])))}},getGradientDefs:function(d){var a=d.getElementsByTagName("linearGradient");d=d.getElementsByTagName("radialGradient");var c,b,f={};for(b=a.length;b--;)c=a[b],f[c.getAttribute("id")]=c;for(b=d.length;b--;)c=d[b],f[c.getAttribute("id")]=c;return f},parseAttributes:function(a,c){if(a){var l,g={};a.parentNode&&/^g$/i.test(a.parentNode.nodeName)&&(g=h.parseAttributes(a.parentNode,c));var k=c.reduce(function(d,c){if(l=a.getAttribute(c))c=e(c),l=b(c,l,g),
d[c]=l;return d},{}),k=m(k,m(d(a),h.parseStyleAttribute(a)));return f(m(g,k))}},parseElements:function(d,a,c,b){h.ElementsParser.parse(d,a,c,b)},parseStyleAttribute:function(d){var f={};d=d.getAttribute("style");if(!d)return f;if("string"===typeof d)c(d,f);else{var l,g,k;for(k in d)"undefined"!==typeof d[k]&&(l=e(k.toLowerCase()),g=b(l,d[k]),"font"===l?a(g,f):f[l]=g)}return f},parsePointsAttribute:function(d){if(!d)return null;d=d.trim();var a=-1<d.indexOf(",");d=d.split(/\s+/);var c=[],b;if(a)for(a=
0,b=d.length;a<b;a++){var f=d[a].split(",");c.push({x:parseFloat(f[0]),y:parseFloat(f[1])})}else for(a=0,b=d.length;a<b;a+=2)c.push({x:parseFloat(d[a]),y:parseFloat(d[a+1])});return c},getCSSRules:function(d){d=d.getElementsByTagName("style");for(var a={},c,b=0,f=d.length;b<f;b++)c=d[0].textContent,c=c.replace(/\/\*[\s\S]*?\*\//g,""),c=c.match(/[^{]*\{[\s\S]*?\}/g),c=c.map(function(d){return d.trim()}),c.forEach(function(d){var c=d.match(/([\s\S]*?)\s*\{([^}]*)\}/);d=c[1];c=c[2].trim().replace(/;$/,
"").split(/\s*;\s*/);a[d]||(a[d]={});for(var b=0,f=c.length;b<f;b++){var e=c[b].split(/\s*:\s*/);a[d][e[0]]=e[1]}});return a},loadSVGFromURL:function(d,a,c){function b(f){var e=f.responseXML;e&&!e.documentElement&&h.window.ActiveXObject&&f.responseText&&(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(f.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));e&&e.documentElement&&h.parseSVGDocument(e.documentElement,function(c,b){x.set(d,{objects:h.util.array.invoke(c,"toObject"),
options:b});a(c,b)},c)}d=d.replace(/^\n\s*/,"").trim();x.has(d,function(c){c?x.get(d,function(d){d=l(d);a(d.objects,d.options)}):new h.util.request(d,{method:"get",onComplete:b})})},loadSVGFromString:function(d,a,c){d=d.trim();var b;if("undefined"!==typeof DOMParser){var f=new DOMParser;f&&f.parseFromString&&(b=f.parseFromString(d,"text/xml"))}else h.window.ActiveXObject&&(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(d.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));h.parseSVGDocument(b.documentElement,
function(d,c){a(d,c)},c)},createSVGFontFacesMarkup:function(d){for(var a="",c=0,b=d.length;c<b;c++)"text"===d[c].type&&d[c].path&&(a+=["@font-face {font-family: ",d[c].fontFamily,"; src: url('",d[c].path,"')}"].join(""));a&&(a=['<style type="text/css"><![CDATA[',a,"]]\x3e</style>"].join(""));return a},createSVGRefElementsMarkup:function(d){var a=[];k(a,d,"backgroundColor");k(a,d,"overlayColor");return a.join("")}})})("undefined"!==typeof exports?exports:this);
fabric.ElementsParser={parse:function(g,e,b,f){this.elements=g;this.callback=e;this.options=b;this.reviver=f;this.instances=Array(g.length);this.numElements=g.length;this.createObjects()},createObjects:function(){for(var g=0,e=this.elements.length;g<e;g++)(function(b,f){setTimeout(function(){b.createObject(b.elements[f],f)},0)})(this,g)},createObject:function(g,e){var b=fabric[fabric.util.string.capitalize(g.tagName)];if(b&&b.fromElement)try{this._createObject(b,g,e)}catch(f){fabric.log(f)}else this.checkIfDone()},
_createObject:function(g,e,b){g.async?g.fromElement(e,this.createCallback(b,e),this.options):(g=g.fromElement(e,this.options),this.reviver&&this.reviver(e,g),this.instances.splice(b,0,g),this.checkIfDone())},createCallback:function(g,e){var b=this;return function(f){b.reviver&&b.reviver(e,f);b.instances.splice(g,0,f);b.checkIfDone()}},checkIfDone:function(){0===--this.numElements&&(this.instances=this.instances.filter(function(g){return null!=g}),fabric.resolveGradients(this.instances),this.callback(this.instances))}};
(function(g){function e(b,f){this.x=b;this.y=f}g=g.fabric||(g.fabric={});g.Point?g.warn("fabric.Point is already defined"):(g.Point=e,e.prototype={constructor:e,add:function(b){return new e(this.x+b.x,this.y+b.y)},addEquals:function(b){this.x+=b.x;this.y+=b.y;return this},scalarAdd:function(b){return new e(this.x+b,this.y+b)},scalarAddEquals:function(b){this.x+=b;this.y+=b;return this},subtract:function(b){return new e(this.x-b.x,this.y-b.y)},subtractEquals:function(b){this.x-=b.x;this.y-=b.y;return this},
scalarSubtract:function(b){return new e(this.x-b,this.y-b)},scalarSubtractEquals:function(b){this.x-=b;this.y-=b;return this},multiply:function(b){return new e(this.x*b,this.y*b)},multiplyEquals:function(b){this.x*=b;this.y*=b;return this},divide:function(b){return new e(this.x/b,this.y/b)},divideEquals:function(b){this.x/=b;this.y/=b;return this},eq:function(b){return this.x===b.x&&this.y===b.y},lt:function(b){return this.x<b.x&&this.y<b.y},lte:function(b){return this.x<=b.x&&this.y<=b.y},gt:function(b){return this.x>
b.x&&this.y>b.y},gte:function(b){return this.x>=b.x&&this.y>=b.y},lerp:function(b,f){return new e(this.x+(b.x-this.x)*f,this.y+(b.y-this.y)*f)},distanceFrom:function(b){var f=this.x-b.x;b=this.y-b.y;return Math.sqrt(f*f+b*b)},midPointFrom:function(b){return new e(this.x+(b.x-this.x)/2,this.y+(b.y-this.y)/2)},min:function(b){return new e(Math.min(this.x,b.x),Math.min(this.y,b.y))},max:function(b){return new e(Math.max(this.x,b.x),Math.max(this.y,b.y))},toString:function(){return this.x+","+this.y},
setXY:function(b,f){this.x=b;this.y=f},setFromPoint:function(b){this.x=b.x;this.y=b.y},swap:function(b){var f=this.x,a=this.y;this.x=b.x;this.y=b.y;b.x=f;b.y=a}})})("undefined"!==typeof exports?exports:this);
(function(g){function e(b){this.status=b;this.points=[]}var b=g.fabric||(g.fabric={});b.Intersection?b.warn("fabric.Intersection is already defined"):(b.Intersection=e,b.Intersection.prototype={appendPoint:function(b){this.points.push(b)},appendPoints:function(b){this.points=this.points.concat(b)}},b.Intersection.intersectLineLine=function(f,a,c,d){var l,g=(d.x-c.x)*(f.y-c.y)-(d.y-c.y)*(f.x-c.x);l=(a.x-f.x)*(f.y-c.y)-(a.y-f.y)*(f.x-c.x);c=(d.y-c.y)*(a.x-f.x)-(d.x-c.x)*(a.y-f.y);0!==c?(g/=c,l/=c,0<=
g&&1>=g&&0<=l&&1>=l?(l=new e("Intersection"),l.points.push(new b.Point(f.x+g*(a.x-f.x),f.y+g*(a.y-f.y)))):l=new e):l=0===g||0===l?new e("Coincident"):new e("Parallel");return l},b.Intersection.intersectLinePolygon=function(b,a,c){for(var d=new e,l=c.length,g=0;g<l;g++){var h=e.intersectLineLine(b,a,c[g],c[(g+1)%l]);d.appendPoints(h.points)}0<d.points.length&&(d.status="Intersection");return d},b.Intersection.intersectPolygonPolygon=function(b,a){for(var c=new e,d=b.length,l=0;l<d;l++){var g=e.intersectLinePolygon(b[l],
b[(l+1)%d],a);c.appendPoints(g.points)}0<c.points.length&&(c.status="Intersection");return c},b.Intersection.intersectPolygonRectangle=function(f,a,c){var d=a.min(c),l=a.max(c);c=new b.Point(l.x,d.y);var g=new b.Point(d.x,l.y);a=e.intersectLinePolygon(d,c,f);c=e.intersectLinePolygon(c,l,f);l=e.intersectLinePolygon(l,g,f);f=e.intersectLinePolygon(g,d,f);d=new e;d.appendPoints(a.points);d.appendPoints(c.points);d.appendPoints(l.points);d.appendPoints(f.points);0<d.points.length&&(d.status="Intersection");
return d})})("undefined"!==typeof exports?exports:this);
(function(g){function e(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function b(a,c,d){0>d&&(d+=1);1<d&&(d-=1);return d<1/6?a+6*(c-a)*d:0.5>d?c:d<2/3?a+6*(c-a)*(2/3-d):a}var f=g.fabric||(g.fabric={});f.Color?f.warn("fabric.Color is already defined."):(f.Color=e,f.Color.prototype={_tryParsingColor:function(a){var c;a in e.colorNameMap&&(a=e.colorNameMap[a]);(c=e.sourceFromHex(a))||(c=e.sourceFromRgb(a));c||(c=e.sourceFromHsl(a));c&&this.setSource(c)},_rgbToHsl:function(a,c,d){a/=255;c/=
255;d/=255;var b,e,g,m=f.util.array.max([a,c,d]);e=f.util.array.min([a,c,d]);g=(m+e)/2;if(m===e)b=e=0;else{var n=m-e;e=0.5<g?n/(2-m-e):n/(m+e);switch(m){case a:b=(c-d)/n+(c<d?6:0);break;case c:b=(d-a)/n+2;break;case d:b=(a-c)/n+4}b/=6}return[Math.round(360*b),Math.round(100*e),Math.round(100*g)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+
a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),a=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var a=this.getSource(),c=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+c[0]+","+c[1]+"%,"+c[2]+"%,"+a[3]+")"},toHex:function(){var a=this.getSource(),c=a[0].toString(16),c=1===c.length?"0"+c:c,d=a[1].toString(16),d=1===d.length?"0"+d:d,a=a[2].toString(16),a=1===a.length?"0"+a:a;return c.toUpperCase()+d.toUpperCase()+a.toUpperCase()},
getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var c=this.getSource();c[3]=a;this.setSource(c);return this},toGrayscale:function(){var a=this.getSource(),c=parseInt((0.3*a[0]+0.59*a[1]+0.11*a[2]).toFixed(0),10);this.setSource([c,c,c,a[3]]);return this},toBlackWhite:function(a){var c=this.getSource(),d=(0.3*c[0]+0.59*c[1]+0.11*c[2]).toFixed(0),c=c[3],d=Number(d)<Number(a||127)?0:255;this.setSource([d,d,d,c]);return this},overlayWith:function(a){a instanceof e||(a=new e(a));var c=
[],d=this.getAlpha(),b=this.getSource();a=a.getSource();for(var f=0;3>f;f++)c.push(Math.round(0.5*b[f]+0.5*a[f]));c[3]=d;this.setSource(c);return this}},f.Color.reRGBa=/^rgba?\(\s*(\d{1,3}\%?)\s*,\s*(\d{1,3}\%?)\s*,\s*(\d{1,3}\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,f.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,f.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,f.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",
gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},f.Color.fromRgb=function(a){return e.fromSource(e.sourceFromRgb(a))},f.Color.sourceFromRgb=function(a){if(a=a.match(e.reRGBa)){var c=parseInt(a[1],10)/(/%$/.test(a[1])?100:1)*(/%$/.test(a[1])?255:1),d=parseInt(a[2],10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?255:1),b=parseInt(a[3],10)/(/%$/.test(a[3])?
100:1)*(/%$/.test(a[3])?255:1);return[parseInt(c,10),parseInt(d,10),parseInt(b,10),a[4]?parseFloat(a[4]):1]}},f.Color.fromRgba=e.fromRgb,f.Color.fromHsl=function(a){return e.fromSource(e.sourceFromHsl(a))},f.Color.sourceFromHsl=function(a){if(a=a.match(e.reHSLa)){var c=(parseFloat(a[1])%360+360)%360/360,d=parseFloat(a[2])/(/%$/.test(a[2])?100:1),f=parseFloat(a[3])/(/%$/.test(a[3])?100:1);if(0===d)f=d=c=f;else var g=0.5>=f?f*(d+1):f+d-f*d,h=2*f-g,f=b(h,g,c+1/3),d=b(h,g,c),c=b(h,g,c-1/3);return[Math.round(255*
f),Math.round(255*d),Math.round(255*c),a[4]?parseFloat(a[4]):1]}},f.Color.fromHsla=e.fromHsl,f.Color.fromHex=function(a){return e.fromSource(e.sourceFromHex(a))},f.Color.sourceFromHex=function(a){if(a.match(e.reHex)){var c=a.slice(a.indexOf("#")+1),d=3===c.length;a=d?c.charAt(0)+c.charAt(0):c.substring(0,2);var b=d?c.charAt(1)+c.charAt(1):c.substring(2,4),c=d?c.charAt(2)+c.charAt(2):c.substring(4,6);return[parseInt(a,16),parseInt(b,16),parseInt(c,16),1]}},f.Color.fromSource=function(a){var c=new e;
c.setSource(a);return c})})("undefined"!==typeof exports?exports:this);
(function(){function g(a){var c=a.getAttribute("style"),d=a.getAttribute("offset"),b,f,d=parseFloat(d)/(/%$/.test(d)?100:1);if(c){c=c.split(/\s*;\s*/);""===c[c.length-1]&&c.pop();for(var e=c.length;e--;){var g=c[e].split(/\s*:\s*/),n=g[0].trim(),g=g[1].trim();"stop-color"===n?b=g:"stop-opacity"===n&&(f=g)}}b||(b=a.getAttribute("stop-color")||"rgb(0,0,0)");f||(f=a.getAttribute("stop-opacity"));b=(new fabric.Color(b)).toRgb();return{offset:d,color:b,opacity:isNaN(parseFloat(f))?1:parseFloat(f)}}function e(a,
c){for(var d in c){if("string"===typeof c[d]&&/^\d+%$/.test(c[d])){var f=parseFloat(c[d],10);if("x1"===d||"x2"===d||"r2"===d)c[d]=fabric.util.toFixed(a.width*f/100,2);else if("y1"===d||"y2"===d)c[d]=fabric.util.toFixed(a.height*f/100,2)}b(c,d,a)}}function b(a,c,d){if("x1"===c||"x2"===c)a[c]-=fabric.util.toFixed(d.width/2,2);else if("y1"===c||"y2"===c)a[c]-=fabric.util.toFixed(d.height/2,2)}function f(a,c){for(var d in c)if(b(c,d,a),"x1"===d||"x2"===d||"r2"===d)c[d]=fabric.util.toFixed(100*(c[d]/a.width),
2)+"%";else if("y1"===d||"y2"===d)c[d]=fabric.util.toFixed(100*(c[d]/a.height),2)+"%"}fabric.Gradient=fabric.util.createClass({initialize:function(a){a||(a={});var c={};this.id=fabric.Object.__uid++;this.type=a.type||"linear";c={x1:a.coords.x1||0,y1:a.coords.y1||0,x2:a.coords.x2||0,y2:a.coords.y2||0};"radial"===this.type&&(c.r1=a.coords.r1||0,c.r2=a.coords.r2||0);this.coords=c;this.gradientUnits=a.gradientUnits||"objectBoundingBox";this.colorStops=a.colorStops.slice()},addColorStop:function(a){for(var c in a){var d=
new fabric.Color(a[c]);this.colorStops.push({offset:c,color:d.toRgb(),opacity:d.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,gradientUnits:this.gradientUnits,colorStops:this.colorStops}},toSVG:function(a,c){var d=fabric.util.object.clone(this.coords),b;this.colorStops.sort(function(d,a){return d.offset-a.offset});c&&"userSpaceOnUse"===this.gradientUnits?(d.x1+=a.width/2,d.y1+=a.height/2,d.x2+=a.width/2,d.y2+=a.height/2):"objectBoundingBox"===this.gradientUnits&&
f(a,d);"linear"===this.type?b=["<linearGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" x1="',d.x1,'" y1="',d.y1,'" x2="',d.x2,'" y2="',d.y2,'">']:"radial"===this.type&&(b=["<radialGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" cx="',d.x2,'" cy="',d.y2,'" r="',d.r2,'" fx="',d.x1,'" fy="',d.y1,'">']);for(d=0;d<this.colorStops.length;d++)b.push("<stop ",'offset="',100*this.colorStops[d].offset+"%",'" style="stop-color:',this.colorStops[d].color,this.colorStops[d].opacity?
";stop-opacity: "+this.colorStops[d].opacity:";",'"/>');b.push("linear"===this.type?"</linearGradient>":"</radialGradient>");return b.join("")},toLive:function(a){var c;if(this.type){"linear"===this.type?c=a.createLinearGradient(this.coords.x1,this.coords.y1,this.coords.x2,this.coords.y2):"radial"===this.type&&(c=a.createRadialGradient(this.coords.x1,this.coords.y1,this.coords.r1,this.coords.x2,this.coords.y2,this.coords.r2));a=0;for(var d=this.colorStops.length;a<d;a++){var b=this.colorStops[a].color,
f=this.colorStops[a].opacity,e=this.colorStops[a].offset;"undefined"!==typeof f&&(b=(new fabric.Color(b)).setAlpha(f).toRgba());c.addColorStop(parseFloat(e),b)}return c}}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(a,c){var d=a.getElementsByTagName("stop"),b="linearGradient"===a.nodeName?"linear":"radial",f=a.getAttribute("gradientUnits")||"objectBoundingBox",h=[],m={};"linear"===b?m={x1:a.getAttribute("x1")||0,y1:a.getAttribute("y1")||0,x2:a.getAttribute("x2")||"100%",y2:a.getAttribute("y2")||
0}:"radial"===b&&(m={x1:a.getAttribute("fx")||a.getAttribute("cx")||"50%",y1:a.getAttribute("fy")||a.getAttribute("cy")||"50%",r1:0,x2:a.getAttribute("cx")||"50%",y2:a.getAttribute("cy")||"50%",r2:a.getAttribute("r")||"50%"});for(var n=d.length;n--;)h.push(g(d[n]));e(c,m);return new fabric.Gradient({type:b,coords:m,gradientUnits:f,colorStops:h})},forObject:function(a,c){c||(c={});e(a,c);return new fabric.Gradient(c)}})})();
fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(g){g||(g={});this.id=fabric.Object.__uid++;if(g.source)if("string"===typeof g.source)if("undefined"!==typeof fabric.util.getFunctionBody(g.source))this.source=new Function(fabric.util.getFunctionBody(g.source));else{var e=this;this.source=fabric.util.createImage();fabric.util.loadImage(g.source,function(b){e.source=b})}else this.source=g.source;g.repeat&&(this.repeat=g.repeat);g.offsetX&&(this.offsetX=
g.offsetX);g.offsetY&&(this.offsetY=g.offsetY)},toObject:function(){var g;"function"===typeof this.source?g=String(this.source):"string"===typeof this.source.src&&(g=this.source.src);return{source:g,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(g){var e="function"===typeof this.source?this.source():this.source,b=e.width/g.getWidth();g=e.height/g.getHeight();var f="";e.src?f=e.src:e.toDataURL&&(f=e.toDataURL());return'<pattern id="SVGID_'+this.id+'" x="'+this.offsetX+
'" y="'+this.offsetY+'" width="'+b+'" height="'+g+'"><image x="0" y="0" width="'+e.width+'" height="'+e.height+'" xlink:href="'+f+'"></image></pattern>'},toLive:function(g){var e="function"===typeof this.source?this.source():this.source;return"undefined"===typeof e.src||e.complete&&0!==e.naturalWidth&&0!==e.naturalHeight?g.createPattern(e,this.repeat):""}});
(function(g){var e=g.fabric||(g.fabric={});e.Shadow?e.warn("fabric.Shadow is already defined."):(e.Shadow=e.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(b){"string"===typeof b&&(b=this._parseShadow(b));for(var f in b)this[f]=b[f];this.id=e.Object.__uid++},_parseShadow:function(b){b=b.trim();var f=e.Shadow.reOffsetsAndBlur.exec(b)||[];return{color:(b.replace(e.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseInt(f[1],
10)||0,offsetY:parseInt(f[2],10)||0,blur:parseInt(f[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(b){var f="SourceAlpha";!b||b.fill!==this.color&&b.stroke!==this.color||(f="SourceGraphic");return'<filter id="SVGID_'+this.id+'" y="-40%" height="180%"><feGaussianBlur in="'+f+'" stdDeviation="'+(this.blur?this.blur/3:0)+'"></feGaussianBlur><feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"></feOffset><feMerge><feMergeNode></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter>'},
toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};var b={},f=e.Shadow.prototype;this.color!==f.color&&(b.color=this.color);this.blur!==f.blur&&(b.blur=this.blur);this.offsetX!==f.offsetX&&(b.offsetX=this.offsetX);this.offsetY!==f.offsetY&&(b.offsetY=this.offsetY);return b}}),e.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)})("undefined"!==typeof exports?
exports:this);
(function(){if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var g=fabric.util.object.extend,e=fabric.util.getElementOffset,b=fabric.util.removeFromArray,f=Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(a,c){c||(c={});this._initStatic(a,c);fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,
clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,onBeforeScaleRotate:function(){},_initStatic:function(a,c){this._objects=[];this._createLowerCanvas(a);this._initOptions(c);c.overlayImage&&this.setOverlayImage(c.overlayImage,this.renderAll.bind(this));c.backgroundImage&&this.setBackgroundImage(c.backgroundImage,this.renderAll.bind(this));c.backgroundColor&&this.setBackgroundColor(c.backgroundColor,this.renderAll.bind(this));c.overlayColor&&this.setOverlayColor(c.overlayColor,this.renderAll.bind(this));
this.calcOffset()},calcOffset:function(){this._offset=e(this.lowerCanvasEl);return this},setOverlayImage:function(a,c,d){return this.__setBgOverlayImage("overlayImage",a,c,d)},setBackgroundImage:function(a,c,d){return this.__setBgOverlayImage("backgroundImage",a,c,d)},setOverlayColor:function(a,c){return this.__setBgOverlayColor("overlayColor",a,c)},setBackgroundColor:function(a,c){return this.__setBgOverlayColor("backgroundColor",a,c)},__setBgOverlayImage:function(a,c,d,b){"string"===typeof c?fabric.util.loadImage(c,
function(c){this[a]=new fabric.Image(c,b);d&&d()},this):(this[a]=c,d&&d());return this},__setBgOverlayColor:function(a,c,d){if(c.source){var b=this;fabric.util.loadImage(c.source,function(f){b[a]=new fabric.Pattern({source:f,repeat:c.repeat,offsetX:c.offsetX,offsetY:c.offsetY});d&&d()})}else this[a]=c,d&&d();return this},_createCanvasElement:function(){var a=fabric.document.createElement("canvas");a.style||(a.style={});if(!a)throw f;this._initCanvasElement(a);return a},_initCanvasElement:function(a){fabric.util.createCanvasElement(a);
if("undefined"===typeof a.getContext)throw f;},_initOptions:function(a){for(var c in a)this[c]=a[c];this.width=parseInt(this.lowerCanvasEl.width,10)||0;this.height=parseInt(this.lowerCanvasEl.height,10)||0;this.lowerCanvasEl.style&&(this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px")},_createLowerCanvas:function(a){this.lowerCanvasEl=fabric.util.getById(a)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);fabric.util.addClass(this.lowerCanvasEl,
"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a){return this._setDimension("width",a)},setHeight:function(a){return this._setDimension("height",a)},setDimensions:function(a){for(var c in a)this._setDimension(c,a[c]);return this},_setDimension:function(a,c){this.lowerCanvasEl[a]=c;this.lowerCanvasEl.style[a]=c+"px";
this.upperCanvasEl&&(this.upperCanvasEl[a]=c,this.upperCanvasEl.style[a]=c+"px");this.cacheCanvasEl&&(this.cacheCanvasEl[a]=c);this.wrapperEl&&(this.wrapperEl.style[a]=c+"px");this[a]=c;this.calcOffset();this.renderAll();return this},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(a,c){if(c)if(this.controlsAboveOverlay){var d=c.hasBorders,b=c.hasControls;c.hasBorders=c.hasControls=!1;c.render(a);c.hasBorders=
d;c.hasControls=b}else c.render(a)},_onObjectAdded:function(a){this.stateful&&a.setupState();a.setCoords();a.canvas=this;this.fire("object:added",{target:a});a.fire("added")},_onObjectRemoved:function(a){this.getActiveObject()===a&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared"));this.fire("object:removed",{target:a});a.fire("removed")},clearContext:function(a){a.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},
clear:function(){this._objects.length=0;this.discardActiveGroup&&this.discardActiveGroup();this.discardActiveObject&&this.discardActiveObject();this.clearContext(this.contextContainer);this.contextTop&&this.clearContext(this.contextTop);this.fire("canvas:cleared");this.renderAll();return this},renderAll:function(a){var c=this[!0===a&&this.interactive?"contextTop":"contextContainer"],d=this.getActiveGroup();this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop);a||
this.clearContext(c);this.fire("before:render");this.clipTo&&fabric.util.clipContext(this,c);this._renderBackground(c);this._renderObjects(c,d);this._renderActiveGroup(c,d);this.clipTo&&c.restore();this._renderOverlay(c);this.controlsAboveOverlay&&this.interactive&&this.drawControls(c);this.fire("after:render");return this},_renderObjects:function(a,c){for(var d=0,b=this._objects.length;d<b;++d)(!c||c&&this._objects[d]&&!c.contains(this._objects[d]))&&this._draw(a,this._objects[d])},_renderActiveGroup:function(a,
c){if(c){var d=[];this.forEachObject(function(a){c.contains(a)&&d.push(a)});c._set("objects",d);this._draw(a,c)}},_renderBackground:function(a){this.backgroundColor&&(a.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(a):this.backgroundColor,a.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height));this.backgroundImage&&this.backgroundImage.render(a)},_renderOverlay:function(a){this.overlayColor&&(a.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(a):
this.overlayColor,a.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height));this.overlayImage&&this.overlayImage.render(a)},renderTop:function(){var a=this.contextTop||this.contextContainer;this.clearContext(a);this.selection&&this._groupSelector&&this._drawSelection();var c=this.getActiveGroup();c&&c.render(a);this._renderOverlay(a);this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(a){this._centerObject(a,
new fabric.Point(this.getCenter().left,a.getCenterPoint().y));this.renderAll();return this},centerObjectV:function(a){this._centerObject(a,new fabric.Point(a.getCenterPoint().x,this.getCenter().top));this.renderAll();return this},centerObject:function(a){var c=this.getCenter();this._centerObject(a,new fabric.Point(c.left,c.top));this.renderAll();return this},_centerObject:function(a,c){a.setPositionByOrigin(c,"center","center");return this},toDatalessJSON:function(a){return this.toDatalessObject(a)},
toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(a,c){var d=this.getActiveGroup();d&&this.discardActiveGroup();var b={objects:this._toObjects(a,c)};g(b,this.__serializeBgOverlay());fabric.util.populateWithProperties(this,b,c);d&&(this.setActiveGroup(new fabric.Group(d.getObjects())),d.forEachObject(function(d){d.set("active",!0)}));return b},_toObjects:function(a,c){return this.getObjects().map(function(d){return this._toObject(d,
a,c)},this)},_toObject:function(a,c,d){var b;this.includeDefaultValues||(b=a.includeDefaultValues,a.includeDefaultValues=!1);c=a[c](d);this.includeDefaultValues||(a.includeDefaultValues=b);return c},__serializeBgOverlay:function(){var a={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};this.overlayColor&&(a.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor);this.backgroundImage&&(a.backgroundImage=
this.backgroundImage.toObject());this.overlayImage&&(a.overlayImage=this.overlayImage.toObject());return a},toSVG:function(a,c){a||(a={});var d=[];this._setSVGPreamble(d,a);this._setSVGHeader(d,a);this._setSVGBgOverlayColor(d,"backgroundColor");this._setSVGBgOverlayImage(d,"backgroundImage");this._setSVGObjects(d,c);this._setSVGBgOverlayColor(d,"overlayColor");this._setSVGBgOverlayImage(d,"overlayImage");d.push("</svg>");return d.join("")},_setSVGPreamble:function(a,c){c.suppressPreamble||a.push('<?xml version="1.0" encoding="',
c.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(a,c){a.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',c.viewBox?c.viewBox.width:this.width,'" ','height="',c.viewBox?c.viewBox.height:this.height,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+
'" ':null,c.viewBox?'viewBox="'+c.viewBox.x+" "+c.viewBox.y+" "+c.viewBox.width+" "+c.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(a,c){var d=this.getActiveGroup();d&&this.discardActiveGroup();for(var b=0,f=this.getObjects(),e=f.length;b<e;b++)a.push(f[b].toSVG(c));d&&(this.setActiveGroup(new fabric.Group(d.getObjects())),
d.forEachObject(function(d){d.set("active",!0)}))},_setSVGBgOverlayImage:function(a,c){this[c]&&this[c].toSVG&&a.push(this[c].toSVG())},_setSVGBgOverlayColor:function(a,c){this[c]&&this[c].source?a.push('<rect x="',this[c].offsetX,'" y="',this[c].offsetY,'" ','width="',"repeat-y"===this[c].repeat||"no-repeat"===this[c].repeat?this[c].source.width:this.width,'" height="',"repeat-x"===this[c].repeat||"no-repeat"===this[c].repeat?this[c].source.height:this.height,'" fill="url(#'+c+'Pattern)"',"></rect>"):
this[c]&&"overlayColor"===c&&a.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[c],'"',"></rect>")},sendToBack:function(a){b(this._objects,a);this._objects.unshift(a);return this.renderAll&&this.renderAll()},bringToFront:function(a){b(this._objects,a);this._objects.push(a);return this.renderAll&&this.renderAll()},sendBackwards:function(a,c){var d=this._objects.indexOf(a);0!==d&&(d=this._findNewLowerIndex(a,d,c),b(this._objects,a),this._objects.splice(d,0,a),
this.renderAll&&this.renderAll());return this},_findNewLowerIndex:function(a,c,d){if(d)for(d=c,c-=1;0<=c;--c){if(a.intersectsWithObject(this._objects[c])||a.isContainedWithinObject(this._objects[c])||this._objects[c].isContainedWithinObject(a)){d=c;break}}else d=c-1;return d},bringForward:function(a,c){var d=this._objects.indexOf(a);d!==this._objects.length-1&&(d=this._findNewUpperIndex(a,d,c),b(this._objects,a),this._objects.splice(d,0,a),this.renderAll&&this.renderAll());return this},_findNewUpperIndex:function(a,
c,d){if(d)for(d=c,c+=1;c<this._objects.length;++c){if(a.intersectsWithObject(this._objects[c])||a.isContainedWithinObject(this._objects[c])||this._objects[c].isContainedWithinObject(a)){d=c;break}}else d=c+1;return d},moveTo:function(a,c){b(this._objects,a);this._objects.splice(c,0,a);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();this.interactive&&this.removeListeners();return this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+
" }>"}});g(fabric.StaticCanvas.prototype,fabric.Observable);g(fabric.StaticCanvas.prototype,fabric.Collection);g(fabric.StaticCanvas.prototype,fabric.DataURLExporter);g(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var c=fabric.util.createCanvasElement();if(!c||!c.getContext)return null;var d=c.getContext("2d");if(!d)return null;switch(a){case "getImageData":return"undefined"!==typeof d.getImageData;case "setLineDash":return"undefined"!==typeof d.setLineDash;
case "toDataURL":return"undefined"!==typeof c.toDataURL;case "toDataURLWithQuality":try{return c.toDataURL("image/jpeg",0),!0}catch(b){}return!1;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}})();
fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",setShadow:function(g){this.shadow=new fabric.Shadow(g);return this},_setBrushStyles:function(){var g=this.canvas.contextTop;g.strokeStyle=this.color;g.lineWidth=this.width;g.lineCap=this.strokeLineCap;g.lineJoin=this.strokeLineJoin},_setShadow:function(){if(this.shadow){var g=this.canvas.contextTop;g.shadowColor=this.shadow.color;g.shadowBlur=this.shadow.blur;g.shadowOffsetX=
this.shadow.offsetX;g.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var g=this.canvas.contextTop;g.shadowColor="";g.shadowBlur=g.shadowOffsetX=g.shadowOffsetY=0}});
(function(){var g=fabric.util.array.min,e=fabric.util.array.max;fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(b){this.canvas=b;this._points=[]},onMouseDown:function(b){this._prepareForDrawing(b);this._captureDrawingPath(b);this._render()},onMouseMove:function(b){this._captureDrawingPath(b);this.canvas.clearContext(this.canvas.contextTop);this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(b){b=new fabric.Point(b.x,b.y);this._reset();
this._addPoint(b);this.canvas.contextTop.moveTo(b.x,b.y)},_addPoint:function(b){this._points.push(b)},_reset:function(){this._points.length=0;this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(b){b=new fabric.Point(b.x,b.y);this._addPoint(b)},_render:function(){var b=this.canvas.contextTop;b.beginPath();var f=this._points[0],a=this._points[1];2===this._points.length&&f.x===a.x&&f.y===a.y&&(f.x-=0.5,a.x+=0.5);b.moveTo(f.x,f.y);for(var c=1,d=this._points.length;c<d;c++)a=f.midPointFrom(a),
b.quadraticCurveTo(f.x,f.y,a.x,a.y),f=this._points[c],a=this._points[c+1];b.lineTo(f.x,f.y);b.stroke()},_getSVGPathData:function(){this.box=this.getPathBoundingBox(this._points);return this.convertPointsToSVGPath(this._points,this.box.minx,this.box.maxx,this.box.miny,this.box.maxy)},getPathBoundingBox:function(b){for(var f=[],a=[],c=b[0],d=b[1],l=c,k=1,h=b.length;k<h;k++){var m=c.midPointFrom(d);f.push(l.x);f.push(m.x);a.push(l.y);a.push(m.y);c=b[k];d=b[k+1];l=m}f.push(c.x);a.push(c.y);return{minx:g(f),
miny:g(a),maxx:e(f),maxy:e(a)}},convertPointsToSVGPath:function(b,f,a,c){a=[];var d=new fabric.Point(b[0].x-f,b[0].y-c),e=new fabric.Point(b[1].x-f,b[1].y-c);a.push("M ",b[0].x-f," ",b[0].y-c," ");for(var g=1,h=b.length;g<h;g++){var m=d.midPointFrom(e);a.push("Q ",d.x," ",d.y," ",m.x," ",m.y," ");d=new fabric.Point(b[g].x-f,b[g].y-c);g+1<b.length&&(e=new fabric.Point(b[g+1].x-f,b[g+1].y-c))}a.push("L ",d.x," ",d.y," ");return a},createPath:function(b){b=new fabric.Path(b);b.fill=null;b.stroke=this.color;
b.strokeWidth=this.width;b.strokeLineCap=this.strokeLineCap;b.strokeLineJoin=this.strokeLineJoin;this.shadow&&(this.shadow.affectStroke=!0,b.setShadow(this.shadow));return b},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var b=this._getSVGPathData().join("");if("M 0 0 Q 0 0 0 0 L 0 0"===b)this.canvas.renderAll();else{var f=this.box.minx+(this.box.maxx-this.box.minx)/2,a=this.box.miny+(this.box.maxy-this.box.miny)/2;this.canvas.contextTop.arc(f,a,3,0,2*Math.PI,!1);b=this.createPath(b);
b.set({left:f,top:a,originX:"center",originY:"center"});this.canvas.add(b);b.setCoords();this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderAll();this.canvas.fire("path:created",{path:b})}}})})();
fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(g){this.canvas=g;this.points=[]},drawDot:function(g){g=this.addPoint(g);var e=this.canvas.contextTop;e.fillStyle=g.fill;e.beginPath();e.arc(g.x,g.y,g.radius,0,2*Math.PI,!1);e.closePath();e.fill()},onMouseDown:function(g){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(g)},onMouseMove:function(g){this.drawDot(g)},onMouseUp:function(){var g=this.canvas.renderOnAddRemove;
this.canvas.renderOnAddRemove=!1;for(var e=[],b=0,f=this.points.length;b<f;b++){var a=this.points[b],a=new fabric.Circle({radius:a.radius,left:a.x,top:a.y,originX:"center",originY:"center",fill:a.fill});this.shadow&&a.setShadow(this.shadow);e.push(a)}e=new fabric.Group(e,{originX:"center",originY:"center"});this.canvas.add(e);this.canvas.fire("path:created",{path:e});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=g;this.canvas.renderAll()},addPoint:function(g){g=
new fabric.Point(g.x,g.y);var e=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,b=(new fabric.Color(this.color)).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();g.radius=e;g.fill=b;this.points.push(g);return g}});
fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(g){this.canvas=g;this.sprayChunks=[]},onMouseDown:function(g){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(g);this.render()},onMouseMove:function(g){this.addSprayChunk(g);this.render()},onMouseUp:function(){var g=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=
!1;for(var e=[],b=0,f=this.sprayChunks.length;b<f;b++)for(var a=this.sprayChunks[b],c=0,d=a.length;c<d;c++){var l=new fabric.Rect({width:a[c].width,height:a[c].width,left:a[c].x+1,top:a[c].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&l.setShadow(this.shadow);e.push(l)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));e=new fabric.Group(e,{originX:"center",originY:"center"});this.canvas.add(e);this.canvas.fire("path:created",{path:e});this.canvas.clearContext(this.canvas.contextTop);
this._resetShadow();this.canvas.renderOnAddRemove=g;this.canvas.renderAll()},_getOptimizedRects:function(g){for(var e={},b,f=0,a=g.length;f<a;f++)b=g[f].left+""+g[f].top,e[b]||(e[b]=g[f]);g=[];for(b in e)g.push(e[b]);return g},render:function(){var g=this.canvas.contextTop;g.fillStyle=this.color;g.save();for(var e=0,b=this.sprayChunkPoints.length;e<b;e++){var f=this.sprayChunkPoints[e];"undefined"!==typeof f.opacity&&(g.globalAlpha=f.opacity);g.fillRect(f.x,f.y,f.width,f.width)}g.restore()},addSprayChunk:function(g){this.sprayChunkPoints=
[];for(var e,b,f,a=this.width/2,c=0;c<this.density;c++)e=fabric.util.getRandomInt(g.x-a,g.x+a),b=fabric.util.getRandomInt(g.y-a,g.y+a),f=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth,e={x:e,y:b,width:f},this.randomOpacity&&(e.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(e);this.sprayChunks.push(this.sprayChunkPoints)}});
fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var g=fabric.document.createElement("canvas"),e=g.getContext("2d");g.width=g.height=25;e.fillStyle=this.color;e.beginPath();e.arc(10,10,10,0,2*Math.PI,!1);e.closePath();e.fill();return g},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");
this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(g){g=this.callSuper("createPath",g);g.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()});return g}});
(function(){var g=fabric.util.getPointer,e=fabric.util.degreesToRadians,b=fabric.util.radiansToDegrees,f=Math.atan2,a=Math.abs;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(d,a){a||(a={});this._initStatic(d,a);this._initInteractive();this._createCacheCanvas();fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",
selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._groupSelector=this._currentTransform=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(d){var a=
this._currentTransform;a.target.set({scaleX:a.original.scaleX,scaleY:a.original.scaleY,left:a.original.left,top:a.original.top});this._shouldCenterTransform(d,a.target)?"rotate"===a.action?this._setOriginToCenter(a.target):("center"!==a.originX&&(a.mouseXSign="right"===a.originX?-1:1),"center"!==a.originY&&(a.mouseYSign="bottom"===a.originY?-1:1),a.originX="center",a.originY="center"):(a.originX=a.original.originX,a.originY=a.original.originY)},containsPoint:function(d,a){var c=this.getPointer(d),
c=this._normalizePointer(a,c);return a.containsPoint(c)||a._findTargetCorner(d,this._offset)},_normalizePointer:function(d,a){var c=this.getActiveGroup(),b=a.x,f=a.y;c&&"group"!==d.type&&c.contains(d)&&(b-=c.left,f-=c.top);return{x:b,y:f}},isTargetTransparent:function(d,a,c){var b=d.hasBorders,f=d.transparentCorners;d.hasBorders=d.transparentCorners=!1;this._draw(this.contextCache,d);d.hasBorders=b;d.transparentCorners=f;d=fabric.util.isTransparent(this.contextCache,a,c,this.targetFindTolerance);
this.clearContext(this.contextCache);return d},_shouldClearSelection:function(d,a){var c=this.getActiveGroup(),b=this.getActiveObject();return!a||a&&c&&!c.contains(a)&&c!==a&&!d.shiftKey||a&&!a.evented||a&&!a.selectable&&b&&b!==a},_shouldCenterTransform:function(d,a){if(a){var c=this._currentTransform,b;"scale"===c.action||"scaleX"===c.action||"scaleY"===c.action?b=this.centeredScaling||a.centeredScaling:"rotate"===c.action&&(b=this.centeredRotation||a.centeredRotation);return b?!d.altKey:d.altKey}},
_getOriginFromCorner:function(d,a){var c={x:d.originX,y:d.originY};if("ml"===a||"tl"===a||"bl"===a)c.x="right";else if("mr"===a||"tr"===a||"br"===a)c.x="left";if("tl"===a||"mt"===a||"tr"===a)c.y="bottom";else if("bl"===a||"mb"===a||"br"===a)c.y="top";return c},_getActionFromCorner:function(d,a){var c="drag";a&&(c="ml"===a||"mr"===a?"scaleX":"mt"===a||"mb"===a?"scaleY":"mtr"===a?"rotate":"scale");return c},_setupCurrentTransform:function(d,a){if(a){var c=a._findTargetCorner(d,this._offset),b=g(d,a.canvas.upperCanvasEl),
f=this._getActionFromCorner(a,c),c=this._getOriginFromCorner(a,c);this._currentTransform={target:a,action:f,scaleX:a.scaleX,scaleY:a.scaleY,offsetX:b.x-a.left,offsetY:b.y-a.top,originX:c.x,originY:c.y,ex:b.x,ey:b.y,left:a.left,top:a.top,theta:e(a.angle),width:a.width*a.scaleX,mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:a.left,top:a.top,scaleX:a.scaleX,scaleY:a.scaleY,originX:c.x,originY:c.y};this._resetCurrentTransform(d)}},_translateObject:function(d,a){var c=this._currentTransform.target;
c.get("lockMovementX")||c.set("left",d-this._currentTransform.offsetX);c.get("lockMovementY")||c.set("top",a-this._currentTransform.offsetY)},_scaleObject:function(d,a,c){var b=this._currentTransform,f=this._offset,e=b.target,g=e.get("lockScalingX"),q=e.get("lockScalingY");if(!g||!q){var w=e.translateToOriginPoint(e.getCenterPoint(),b.originX,b.originY);d=e.toLocalPoint(new fabric.Point(d-f.left,a-f.top),b.originX,b.originY);this._setLocalMouse(d,b);this._setObjectScale(d,b,g,q,c);e.setPositionByOrigin(w,
b.originX,b.originY)}},_setObjectScale:function(d,a,c,b,f){var e=a.target;a.newScaleX=e.scaleX;a.newScaleY=e.scaleY;"equally"!==f||c||b?f?"x"!==f||e.get("lockUniScaling")?"y"!==f||e.get("lockUniScaling")||(a.newScaleY=d.y/(e.height+e.strokeWidth),b||e.set("scaleY",a.newScaleY)):(a.newScaleX=d.x/(e.width+e.strokeWidth),c||e.set("scaleX",a.newScaleX)):(a.newScaleX=d.x/(e.width+e.strokeWidth),a.newScaleY=d.y/(e.height+e.strokeWidth),c||e.set("scaleX",a.newScaleX),b||e.set("scaleY",a.newScaleY)):this._scaleObjectEqually(d,
e,a);this._flipObject(a)},_scaleObjectEqually:function(d,a,c){d=d.y+d.x;var b=(a.height+a.strokeWidth)*c.original.scaleY+(a.width+a.strokeWidth)*c.original.scaleX;c.newScaleX=c.original.scaleX*d/b;c.newScaleY=c.original.scaleY*d/b;a.set("scaleX",c.newScaleX);a.set("scaleY",c.newScaleY)},_flipObject:function(d){0>d.newScaleX&&("left"===d.originX?d.originX="right":"right"===d.originX&&(d.originX="left"));0>d.newScaleY&&("top"===d.originY?d.originY="bottom":"bottom"===d.originY&&(d.originY="top"))},
_setLocalMouse:function(d,c){var b=c.target;"right"===c.originX?d.x*=-1:"center"===c.originX&&(d.x=2*d.x*c.mouseXSign,0>d.x&&(c.mouseXSign=-c.mouseXSign));"bottom"===c.originY?d.y*=-1:"center"===c.originY&&(d.y=2*d.y*c.mouseYSign,0>d.y&&(c.mouseYSign=-c.mouseYSign));a(d.x)>b.padding?d.x=0>d.x?d.x+b.padding:d.x-b.padding:d.x=0;a(d.y)>b.padding?d.y=0>d.y?d.y+b.padding:d.y-b.padding:d.y=0},_rotateObject:function(d,a){var c=this._currentTransform,e=this._offset;if(!c.target.get("lockRotation")){var g=
f(c.ey-c.top-e.top,c.ex-c.left-e.left),e=f(a-c.top-e.top,d-c.left-e.left),g=b(e-g+c.theta);0>g&&(g=360+g);c.target.angle=g}},_setCursor:function(d){this.upperCanvasEl.style.cursor=d},_resetObjectTransform:function(d){d.scaleX=1;d.scaleY=1;d.setAngle(0)},_drawSelection:function(){var d=this.contextTop,c=this._groupSelector,b=c.left,f=c.top,e=a(b),g=a(f);d.fillStyle=this.selectionColor;d.fillRect(c.ex-(0<b?0:-b),c.ey-(0<f?0:-f),e,g);d.lineWidth=this.selectionLineWidth;d.strokeStyle=this.selectionBorderColor;
1<this.selectionDashArray.length?(b=c.ex+0.5-(0<b?0:e),c=c.ey+0.5-(0<f?0:g),d.beginPath(),fabric.util.drawDashedLine(d,b,c,b+e,c,this.selectionDashArray),fabric.util.drawDashedLine(d,b,c+g-1,b+e,c+g-1,this.selectionDashArray),fabric.util.drawDashedLine(d,b,c,b,c+g,this.selectionDashArray),fabric.util.drawDashedLine(d,b+e-1,c,b+e-1,c+g,this.selectionDashArray),d.closePath(),d.stroke()):d.strokeRect(c.ex+0.5-(0<b?0:e),c.ey+0.5-(0<f?0:g),e,g)},_isLastRenderedObject:function(d){return this.controlsAboveOverlay&&
this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(d,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(d,this._offset)},findTarget:function(d,a){if(!this.skipTargetFind){if(this._isLastRenderedObject(d))return this.lastRenderedObjectWithControlsAboveOverlay;var c=this.getActiveGroup();if(c&&!a&&this.containsPoint(d,c))return c;c=this._searchPossibleTargets(d);
this._fireOverOutEvents(c);return c}},_fireOverOutEvents:function(d){d?this._hoveredTarget!==d&&(this.fire("mouse:over",{target:d}),d.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),this._hoveredTarget=d):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_searchPossibleTargets:function(d){for(var a=[],c,b=this.getPointer(d),b=this._objects.length;b--;)if(this._objects[b]&&
this._objects[b].visible&&this._objects[b].evented&&this.containsPoint(d,this._objects[b]))if(this.perPixelTargetFind||this._objects[b].perPixelTargetFind)a[a.length]=this._objects[b];else{this.relatedTarget=c=this._objects[b];break}for(var f=0,e=a.length;f<e;f++)if(b=this.getPointer(d),!this.isTargetTransparent(a[f],b.x,b.y)){this.relatedTarget=c=a[f];break}return c},getPointer:function(d){d=g(d,this.upperCanvasEl);return{x:d.x-this._offset.left,y:d.y-this._offset.top}},_createUpperCanvas:function(){var d=
this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+d);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);
this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"absolute"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(d){var a=this.getWidth()||d.width,c=this.getHeight()||d.height;fabric.util.setStyle(d,
{position:"absolute",width:a+"px",height:c+"px",left:0,top:0});d.width=a;d.height=c;fabric.util.makeElementUnselectable(d)},_copyCanvasStyle:function(d,a){a.style.cssText=d.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(d){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=d;d.set("active",!0)},setActiveObject:function(d,a){this._setActiveObject(d);this.renderAll();this.fire("object:selected",
{target:d,e:a});d.fire("selected",{e:a});return this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(d){this._discardActiveObject();this.renderAll();this.fire("selection:cleared",{e:d});return this},_setActiveGroup:function(d){if(this._activeGroup=d)d.canvas=this,d.set("active",!0)},setActiveGroup:function(d,a){this._setActiveGroup(d);d&&(this.fire("object:selected",
{target:d,e:a}),d.fire("selected",{e:a}));return this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var d=this.getActiveGroup();d&&d.destroy();this.setActiveGroup(null)},discardActiveGroup:function(d){this._discardActiveGroup();this.fire("selection:cleared",{e:d});return this},deactivateAll:function(){for(var d=this.getObjects(),a=0,c=d.length;a<c;a++)d[a].set("active",!1);this._discardActiveGroup();this._discardActiveObject();return this},deactivateAllWithDispatch:function(d){var a=
this.getActiveGroup()||this.getActiveObject();a&&this.fire("before:selection:cleared",{target:a,e:d});this.deactivateAll();a&&this.fire("selection:cleared",{e:d});return this},drawControls:function(d){var a=this.getActiveGroup();a?this._drawGroupControls(d,a):this._drawObjectsControls(d)},_drawGroupControls:function(d,a){this._drawControls(d,a,"Group")},_drawObjectsControls:function(d){for(var a=0,c=this._objects.length;a<c;++a)this._objects[a]&&this._objects[a].active&&(this._drawControls(d,this._objects[a],
"Object"),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[a])},_drawControls:function(a,c,b){a.save();fabric[b].prototype.transform.call(c,a);c.drawBorders(a).drawControls(a);a.restore()}});for(var c in fabric.StaticCanvas)"prototype"!==c&&(fabric.Canvas[c]=fabric.StaticCanvas[c]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){});fabric.Element=fabric.Canvas})();
(function(){var g="n-resize ne-resize e-resize se-resize s-resize sw-resize w-resize nw-resize".split(" "),e={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},b=fabric.util.addListener,f=fabric.util.removeListener,a=fabric.util.getPointer;fabric.util.object.extend(fabric.Canvas.prototype,{_initEventListeners:function(){this._bindEvents();b(fabric.window,"resize",this._onResize);b(this.upperCanvasEl,"mousedown",this._onMouseDown);b(this.upperCanvasEl,"mousemove",this._onMouseMove);b(this.upperCanvasEl,"mousewheel",
this._onMouseWheel);b(this.upperCanvasEl,"touchstart",this._onMouseDown);b(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof Event&&"add"in Event&&(Event.add(this.upperCanvasEl,"gesture",this._onGesture),Event.add(this.upperCanvasEl,"drag",this._onDrag),Event.add(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.add(this.upperCanvasEl,"shake",this._onShake))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);
this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){f(fabric.window,"resize",this._onResize);f(this.upperCanvasEl,"mousedown",this._onMouseDown);f(this.upperCanvasEl,"mousemove",this._onMouseMove);f(this.upperCanvasEl,
"mousewheel",this._onMouseWheel);f(this.upperCanvasEl,"touchstart",this._onMouseDown);f(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof Event&&"remove"in Event&&(Event.remove(this.upperCanvasEl,"gesture",this._onGesture),Event.remove(this.upperCanvasEl,"drag",this._onDrag),Event.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.remove(this.upperCanvasEl,"shake",this._onShake))},_onGesture:function(a,d){this.__onTransformGesture&&this.__onTransformGesture(a,
d)},_onDrag:function(a,d){this.__onDrag&&this.__onDrag(a,d)},_onMouseWheel:function(a,d){this.__onMouseWheel&&this.__onMouseWheel(a,d)},_onOrientationChange:function(a,d){this.__onOrientationChange&&this.__onOrientationChange(a,d)},_onShake:function(a,d){this.__onShake&&this.__onShake(a,d)},_onMouseDown:function(a){this.__onMouseDown(a);b(fabric.document,"mouseup",this._onMouseUp);b(fabric.document,"touchend",this._onMouseUp);b(fabric.document,"mousemove",this._onMouseMove);b(fabric.document,"touchmove",
this._onMouseMove);f(this.upperCanvasEl,"mousemove",this._onMouseMove);f(this.upperCanvasEl,"touchmove",this._onMouseMove)},_onMouseUp:function(a){this.__onMouseUp(a);f(fabric.document,"mouseup",this._onMouseUp);f(fabric.document,"touchend",this._onMouseUp);f(fabric.document,"mousemove",this._onMouseMove);f(fabric.document,"touchmove",this._onMouseMove);b(this.upperCanvasEl,"mousemove",this._onMouseMove);b(this.upperCanvasEl,"touchmove",this._onMouseMove)},_onMouseMove:function(a){!this.allowTouchScrolling&&
a.preventDefault&&a.preventDefault();this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a,d){var b=this.getActiveGroup()||this.getActiveObject();return!!(a&&(a.isMoving||a!==b)||!a&&b||!a&&!b&&!this._groupSelector||d&&this._previousPointer&&this.selection&&(d.x!==this._previousPointer.x||d.y!==this._previousPointer.y))},__onMouseUp:function(a){var d;if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(a);else{this._currentTransform?(this._finalizeCurrentTransform(),
d=this._currentTransform.target):d=this.findTarget(a,!0);var b=this._shouldRender(d,this.getPointer(a));this._maybeGroupObjects(a);d&&(d.isMoving=!1);b&&this.renderAll();this._handleCursorAndEvent(a,d)}},_handleCursorAndEvent:function(a,d){this._setCursorFromEvent(a,d);var b=this;setTimeout(function(){b._setCursorFromEvent(a,d)},50);this.fire("mouse:up",{target:d,e:a});d&&d.fire("mouseup",{e:a})},_finalizeCurrentTransform:function(){var a=this._currentTransform.target;a._scaling&&(a._scaling=!1);
a.setCoords();this.stateful&&a.hasStateChanged()&&(this.fire("object:modified",{target:a}),a.fire("modified"));this._restoreOriginXY(a)},_restoreOriginXY:function(a){if(this._previousOriginX&&this._previousOriginY){var d=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=d.x;a.top=d.y;this._previousOriginY=this._previousOriginX=null}},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=
!0;this.discardActiveObject(a).renderAll();this.clipTo&&fabric.util.clipContext(this,this.contextTop);this.freeDrawingBrush.onMouseDown(this.getPointer(a));this.fire("mouse:down",{e:a})},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var d=this.getPointer(a);this.freeDrawingBrush.onMouseMove(d)}this.upperCanvasEl.style.cursor=this.freeDrawingCursor;this.fire("mouse:move",{e:a})},_onMouseUpInDrawingMode:function(a){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();
this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:a})},__onMouseDown:function(a){if(("which"in a?1===a.which:1===a.button)||fabric.isTouchSupported)if(this.isDrawingMode)this._onMouseDownInDrawingMode(a);else if(!this._currentTransform){var d=this.findTarget(a),b=this.getPointer(a);this._previousPointer=b;var f=this._shouldRender(d,b),e=this._shouldGroup(a,d);this._shouldClearSelection(a,d)?this._clearSelection(a,d,b):e&&(this._handleGrouping(a,d),d=this.getActiveGroup());d&&d.selectable&&
!e&&(this._beforeTransform(a,d),this._setupCurrentTransform(a,d));f&&this.renderAll();this.fire("mouse:down",{target:d,e:a});d&&d.fire("mousedown",{e:a})}},_beforeTransform:function(a,d){this.stateful&&d.saveState();if(d._findTargetCorner(a,this._offset))this.onBeforeScaleRotate(d);d!==this.getActiveGroup()&&d!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(d,a))},_clearSelection:function(a,d,b){this.deactivateAllWithDispatch(a);d&&d.selectable?this.setActiveObject(d,a):this.selection&&
(this._groupSelector={ex:b.x,ey:b.y,top:0,left:0})},_setOriginToCenter:function(a){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var d=a.getCenterPoint();a.originX="center";a.originY="center";a.left=d.x;a.top=d.y;this._currentTransform.left=a.left;this._currentTransform.top=a.top},_setCenterToOrigin:function(a){var d=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;
a.originY=this._previousOriginY;a.left=d.x;a.top=d.y;this._previousOriginY=this._previousOriginX=null},__onMouseMove:function(b){var d,f;if(this.isDrawingMode)this._onMouseMoveInDrawingMode(b);else{var e=this._groupSelector;e?(f=a(b,this.upperCanvasEl),e.left=f.x-this._offset.left-e.ex,e.top=f.y-this._offset.top-e.ey,this.renderTop()):this._currentTransform?this._transformObject(b):(d=this.findTarget(b),!d||d&&!d.selectable?this.upperCanvasEl.style.cursor=this.defaultCursor:this._setCursorFromEvent(b,
d));this.fire("mouse:move",{target:d,e:b});d&&d.fire("mousemove",{e:b})}},_transformObject:function(b){var d=a(b,this.upperCanvasEl),f=this._currentTransform;f.reset=!1;f.target.isMoving=!0;this._beforeScaleTransform(b,f);this._performTransformAction(b,f,d);this.renderAll()},_performTransformAction:function(a,d,b){var f=b.x;b=b.y;var e=d.target,g=d.action;"rotate"===g?(this._rotateObject(f,b),this._fire("rotating",e,a)):"scale"===g?(this._onScale(a,d,f,b),this._fire("scaling",e,a)):"scaleX"===g?(this._scaleObject(f,
b,"x"),this._fire("scaling",e,a)):"scaleY"===g?(this._scaleObject(f,b,"y"),this._fire("scaling",e,a)):(this._translateObject(f,b),this._fire("moving",e,a),this._setCursor(this.moveCursor))},_fire:function(a,d,b){this.fire("object:"+a,{target:d,e:b});d.fire(a,{e:b})},_beforeScaleTransform:function(a,d){if("scale"===d.action||"scaleX"===d.action||"scaleY"===d.action){var b=this._shouldCenterTransform(a,d.target);if(b&&("center"!==d.originX||"center"!==d.originY)||!b&&"center"===d.originX&&"center"===
d.originY)this._resetCurrentTransform(a),d.reset=!0}},_onScale:function(a,d,b,f){!a.shiftKey&&!this.uniScaleTransform||d.target.get("lockUniScaling")?(d.reset||"scale"!==d.currentAction||this._resetCurrentTransform(a,d.target),d.currentAction="scaleEqually",this._scaleObject(b,f,"equally")):(d.currentAction="scale",this._scaleObject(b,f))},_setCursorFromEvent:function(a,d){var b=this.upperCanvasEl.style;if(d&&d.selectable){var f=this.getActiveGroup();(f=d._findTargetCorner&&(!f||!f.contains(d))&&
d._findTargetCorner(a,this._offset))?this._setCornerCursor(f,d):b.cursor=d.hoverCursor||this.hoverCursor}else return b.cursor=this.defaultCursor,!1;return!0},_setCornerCursor:function(a,d){var b=this.upperCanvasEl.style;if(a in e)b.cursor=this._getRotatedCornerCursor(a,d);else if("mtr"===a&&d.hasRotatingPoint)b.cursor=this.rotationCursor;else return b.cursor=this.defaultCursor,!1},_getRotatedCornerCursor:function(a,d){var b=Math.round(d.getAngle()%360/45);0>b&&(b+=8);b+=e[a];return g[b%8]}})})();
(function(){var g=Math.min,e=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(b,f){var a=this.getActiveObject();return b.shiftKey&&(this.getActiveGroup()||a&&a!==f)&&this.selection},_handleGrouping:function(b,f){if(f===this.getActiveGroup()&&(f=this.findTarget(b,!0),!f||f.isType("group")))return;this.getActiveGroup()?this._updateActiveGroup(f,b):this._createActiveGroup(f,b);this._activeGroup&&this._activeGroup.saveCoords()},_updateActiveGroup:function(b,f){var a=this.getActiveGroup();
if(a.contains(b)){if(a.removeWithUpdate(b),this._resetObjectTransform(a),b.set("active",!1),1===a.size()){this.discardActiveGroup(f);this.setActiveObject(a.item(0));return}}else a.addWithUpdate(b),this._resetObjectTransform(a);this.fire("selection:created",{target:a,e:f});a.set("active",!0)},_createActiveGroup:function(b,f){if(this._activeObject&&b!==this._activeObject){var a=this._createGroup(b);this.setActiveGroup(a);this._activeObject=null;this.fire("selection:created",{target:a,e:f})}b.set("active",
!0)},_createGroup:function(b){var f=this.getObjects();b=f.indexOf(this._activeObject)<f.indexOf(b)?[this._activeObject,b]:[b,this._activeObject];return new fabric.Group(b,{originX:"center",originY:"center"})},_groupSelectedObjects:function(b){var f=this._collectObjects();1===f.length?this.setActiveObject(f[0],b):1<f.length&&(f=new fabric.Group(f.reverse(),{originX:"center",originY:"center"}),this.setActiveGroup(f,b),f.saveCoords(),this.fire("selection:created",{target:f}),this.renderAll())},_collectObjects:function(){var b=
[],f;f=this._groupSelector.ex;for(var a=this._groupSelector.ey,c=f+this._groupSelector.left,d=a+this._groupSelector.top,l=new fabric.Point(g(f,c),g(a,d)),k=new fabric.Point(e(f,c),e(a,d)),a=f===c&&a===d,c=this._objects.length;c--&&!((f=this._objects[c])&&f.selectable&&f.visible&&(f.intersectsWithRect(l,k)||f.isContainedWithinRect(l,k)||f.containsPoint(l)||f.containsPoint(k))&&(f.set("active",!0),b.push(f),a)););return b},_maybeGroupObjects:function(b){this.selection&&this._groupSelector&&this._groupSelectedObjects(b);
if(b=this.getActiveGroup())b.setObjectsCoords().setCoords(),b.isMoving=!1,this._setCursor(this.defaultCursor);this._currentTransform=this._groupSelector=null}})})();
fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(g){g||(g={});var e=g.format||"png",b=g.quality||1,f=g.multiplier||1;g={left:g.left,top:g.top,width:g.width,height:g.height};return 1!==f?this.__toDataURLWithMultiplier(e,b,g,f):this.__toDataURL(e,b,g)},__toDataURL:function(g,e,b){this.renderAll(!0);var f=this.upperCanvasEl||this.lowerCanvasEl;b=this.__getCroppedCanvas(f,b);"jpg"===g&&(g="jpeg");g=fabric.StaticCanvas.supports("toDataURLWithQuality")?(b||f).toDataURL("image/"+
g,e):(b||f).toDataURL("image/"+g);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return g},__getCroppedCanvas:function(g,e){var b,f;if("left"in e||"top"in e||"width"in e||"height"in e)b=fabric.util.createCanvasElement(),f=b.getContext("2d"),b.width=e.width||this.width,b.height=e.height||this.height,f.drawImage(g,-e.left||0,-e.top||0);return b},__toDataURLWithMultiplier:function(g,e,b,f){var a=this.getWidth(),c=this.getHeight(),d=a*f,l=c*f,k=this.getActiveObject(),h=this.getActiveGroup(),
m=this.contextTop||this.contextContainer;this.setWidth(d).setHeight(l);m.scale(f,f);b.left&&(b.left*=f);b.top&&(b.top*=f);b.width&&(b.width*=f);b.height&&(b.height*=f);h?this._tempRemoveBordersControlsFromGroup(h):k&&this.deactivateAll&&this.deactivateAll();this.renderAll(!0);g=this.__toDataURL(g,e,b);this.width=a;this.height=c;m.scale(1/f,1/f);this.setWidth(a).setHeight(c);h?this._restoreBordersControlsOnGroup(h):k&&this.setActiveObject&&this.setActiveObject(k);this.contextTop&&this.clearContext(this.contextTop);
this.renderAll();return g},toDataURLWithMultiplier:function(g,e,b){return this.toDataURL({format:g,multiplier:e,quality:b})},_tempRemoveBordersControlsFromGroup:function(g){g.origHasControls=g.hasControls;g.origBorderColor=g.borderColor;g.hasControls=!0;g.borderColor="rgba(0,0,0,0)";g.forEachObject(function(e){e.origBorderColor=e.borderColor;e.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(g){g.hideControls=g.origHideControls;g.borderColor=g.origBorderColor;g.forEachObject(function(e){e.borderColor=
e.origBorderColor;delete e.origBorderColor})}});
fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(g,e,b){return this.loadFromJSON(g,e,b)},loadFromJSON:function(g,e,b){if(g){var f="string"===typeof g?JSON.parse(g):g;this.clear();var a=this;this._enlivenObjects(f.objects,function(){a._setBgOverlay(f,e)},b);return this}},_setBgOverlay:function(g,e){var b=this,f={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(g.backgroundImage||g.overlayImage||g.background||g.overlay){var a=function(){f.backgroundImage&&
f.overlayImage&&f.backgroundColor&&f.overlayColor&&(b.renderAll(),e&&e())};this.__setBgOverlay("backgroundImage",g.backgroundImage,f,a);this.__setBgOverlay("overlayImage",g.overlayImage,f,a);this.__setBgOverlay("backgroundColor",g.background,f,a);this.__setBgOverlay("overlayColor",g.overlay,f,a);a()}else e&&e()},__setBgOverlay:function(g,e,b,f){var a=this;if(e)if("backgroundImage"===g||"overlayImage"===g)fabric.Image.fromObject(e,function(c){a[g]=c;b[g]=!0;f&&f()});else this["set"+fabric.util.string.capitalize(g,
!0)](e,function(){b[g]=!0;f&&f()});else b[g]=!0},_enlivenObjects:function(g,e,b){var f=this;if(0===g.length)e&&e();else{var a=this.renderOnAddRemove;this.renderOnAddRemove=!1;fabric.util.enlivenObjects(g,function(b){b.forEach(function(a,b){f.insertAt(a,b,!0)});f.renderOnAddRemove=a;e&&e()},null,b)}},_toDataURL:function(g,e){this.clone(function(b){e(b.toDataURL(g))})},_toDataURLWithMultiplier:function(g,e,b){this.clone(function(f){b(f.toDataURLWithMultiplier(g,e))})},clone:function(g,e){var b=JSON.stringify(this.toJSON(e));
this.cloneWithoutData(function(f){f.loadFromJSON(b,function(){g&&g(f)})})},cloneWithoutData:function(g){var e=fabric.document.createElement("canvas");e.width=this.getWidth();e.height=this.getHeight();var b=new fabric.Canvas(e);b.clipTo=this.clipTo;this.backgroundImage?(b.setBackgroundImage(this.backgroundImage.src,function(){b.renderAll();g&&g(b)}),b.backgroundImageOpacity=this.backgroundImageOpacity,b.backgroundImageStretch=this.backgroundImageStretch):g&&g(b)}});
(function(){var g=fabric.util.degreesToRadians,e=fabric.util.radiansToDegrees;fabric.util.object.extend(fabric.Canvas.prototype,{__onTransformGesture:function(b,f){if(!this.isDrawingMode&&2===b.touches.length&&"gesture"===f.gesture){var a=this.findTarget(b);"undefined"!==typeof a&&(this.onBeforeScaleRotate(a),this._rotateObjectByAngle(f.rotation),this._scaleObjectBy(f.scale));this.fire("touch:gesture",{target:a,e:b,self:f})}},__onDrag:function(b,f){this.fire("touch:drag",{e:b,self:f})},__onOrientationChange:function(b,
f){this.fire("touch:orientation",{e:b,self:f})},__onShake:function(b,f){this.fire("touch:shake",{e:b,self:f})},_scaleObjectBy:function(b,f){var a=this._currentTransform,c=a.target,d=c.get("lockScalingX"),e=c.get("lockScalingY");d&&e||(c._scaling=!0,f?"x"!==f||c.get("lockUniScaling")?"y"!==f||c.get("lockUniScaling")||e||c.set("scaleY",a.scaleY*b):d||c.set("scaleX",a.scaleX*b):(d||c.set("scaleX",a.scaleX*b),e||c.set("scaleY",a.scaleY*b)))},_rotateObjectByAngle:function(b){var f=this._currentTransform;
f.target.get("lockRotation")||(f.target.angle=e(g(b)+f.theta))}})})();
(function(g){var e=g.fabric||(g.fabric={});g=e.util.object.extend;var b=e.util.toFixed,f=e.util.string.capitalize,a=e.util.degreesToRadians,c=e.StaticCanvas.supports("setLineDash");e.Object||(e.Object=e.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,
centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,
lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule shadow clipTo visible backgroundColor".split(" "),initialize:function(a){a&&this.setOptions(a)},_initGradient:function(a){!a.fill||!a.fill.colorStops||a.fill instanceof e.Gradient||this.set("fill",new e.Gradient(a.fill))},_initPattern:function(a){!a.fill||
!a.fill.source||a.fill instanceof e.Pattern||this.set("fill",new e.Pattern(a.fill));!a.stroke||!a.stroke.source||a.stroke instanceof e.Pattern||this.set("stroke",new e.Pattern(a.stroke))},_initClipping:function(a){a.clipTo&&"string"===typeof a.clipTo&&(a=e.util.getFunctionBody(a.clipTo),"undefined"!==typeof a&&(this.clipTo=new Function("ctx",a)))},setOptions:function(a){for(var b in a)this.set(b,a[b]);this._initGradient(a);this._initPattern(a);this._initClipping(a)},transform:function(d,b){d.globalAlpha=
this.opacity;var c=b?this._getLeftTopCoords():this.getCenterPoint();d.translate(c.x,c.y);d.rotate(a(this.angle));d.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(a){var c=e.Object.NUM_FRACTION_DIGITS,c={type:this.type,originX:this.originX,originY:this.originY,left:b(this.left,c),top:b(this.top,c),width:b(this.width,c),height:b(this.height,c),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():
this.stroke,strokeWidth:b(this.strokeWidth,c),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:b(this.strokeMiterLimit,c),scaleX:b(this.scaleX,c),scaleY:b(this.scaleY,c),angle:b(this.getAngle(),c),flipX:this.flipX,flipY:this.flipY,opacity:b(this.opacity,c),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor};
this.includeDefaultValues||(c=this._removeDefaultValues(c));e.util.populateWithProperties(this,c,a);return c},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(a){var b=e.util.getKlass(a.type).prototype;b.stateProperties.forEach(function(c){a[c]===b[c]&&delete a[c]});return a},toString:function(){return"#<fabric."+f(this.type)+">"},get:function(a){return this[a]},set:function(a,b){if("object"===typeof a)for(var c in a)this._set(c,a[c]);else"function"===typeof b&&
"clipTo"!==a?this._set(a,b(this.get(a))):this._set(a,b);return this},_set:function(a,c){if("scaleX"===a||"scaleY"===a)c=this._constrainScale(c);"scaleX"===a&&0>c?(this.flipX=!this.flipX,c*=-1):"scaleY"===a&&0>c?(this.flipY=!this.flipY,c*=-1):"width"===a||"height"===a?this.minScaleLimit=b(Math.min(0.1,1/Math.max(this.width,this.height)),2):"shadow"!==a||!c||c instanceof e.Shadow||(c=new e.Shadow(c));this[a]=c;return this},toggle:function(a){var b=this.get(a);"boolean"===typeof b&&this.set(a,!b);return this},
setSourcePath:function(a){this.sourcePath=a;return this},render:function(a,b){if(0!==this.width&&0!==this.height&&this.visible){a.save();this._transform(a,b);this._setStrokeStyles(a);this._setFillStyles(a);var c=this.transformMatrix;c&&this.group&&(a.translate(-this.group.width/2,-this.group.height/2),a.transform(c[0],c[1],c[2],c[3],c[4],c[5]));this._setShadow(a);this.clipTo&&e.util.clipContext(this,a);this._render(a,b);this.clipTo&&a.restore();this._removeShadow(a);this.active&&!b&&(this.drawBorders(a),
this.drawControls(a));a.restore()}},_transform:function(a,b){var c=this.transformMatrix;c&&!this.group&&a.setTransform(c[0],c[1],c[2],c[3],c[4],c[5]);b||this.transform(a)},_setStrokeStyles:function(a){this.stroke&&(a.lineWidth=this.strokeWidth,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a):this.stroke)},_setFillStyles:function(a){this.fill&&(a.fillStyle=this.fill.toLive?this.fill.toLive(a):this.fill)},
_setShadow:function(a){this.shadow&&(a.shadowColor=this.shadow.color,a.shadowBlur=this.shadow.blur,a.shadowOffsetX=this.shadow.offsetX,a.shadowOffsetY=this.shadow.offsetY)},_removeShadow:function(a){a.shadowColor="";a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0},_renderFill:function(a){this.fill&&(this.fill.toLive&&(a.save(),a.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0)),a.fill(),this.fill.toLive&&a.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a))},
_renderStroke:function(a){this.stroke&&(a.save(),this.strokeDashArray?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),c?(a.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(a)):this._renderDashedStroke&&this._renderDashedStroke(a),a.stroke()):this._stroke?this._stroke(a):a.stroke(),this._removeShadow(a),a.restore())},clone:function(a,b){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(b),a):new e.Object(this.toObject(b))},
cloneAsImage:function(a){var b=this.toDataURL();e.util.loadImage(b,function(b){a&&a(new e.Image(b))});return this},toDataURL:function(a){a||(a={});var b=e.util.createCanvasElement(),c=this.getBoundingRect();b.width=c.width;b.height=c.height;e.util.wrapElement(b,"div");c=new e.Canvas(b);"jpg"===a.format&&(a.format="jpeg");"jpeg"===a.format&&(c.backgroundColor="#fff");var f={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1);this.setPositionByOrigin(new e.Point(b.width/
2,b.height/2),"center","center");b=this.canvas;c.add(this);a=c.toDataURL(a);this.set(f).setCoords();this.canvas=b;c.dispose();return a},isType:function(a){return this.type===a},complexity:function(){return 0},toJSON:function(a){return this.toObject(a)},setGradient:function(a,b){b||(b={});var c={colorStops:[]};c.type=b.type||(b.r1||b.r2?"radial":"linear");c.coords={x1:b.x1,y1:b.y1,x2:b.x2,y2:b.y2};if(b.r1||b.r2)c.coords.r1=b.r1,c.coords.r2=b.r2;for(var f in b.colorStops){var g=new e.Color(b.colorStops[f]);
c.colorStops.push({offset:f,color:g.toRgb(),opacity:g.getAlpha()})}return this.set(a,e.Gradient.forObject(this,c))},setPatternFill:function(a){return this.set("fill",new e.Pattern(a))},setShadow:function(a){return this.set("shadow",new e.Shadow(a))},setColor:function(a){this.set("fill",a);return this},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){this.canvas.centerObject(this);return this},remove:function(){this.canvas.remove(this);
return this},getLocalPointer:function(a,b){b=b||this.canvas.getPointer(a);var c=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:b.x-c.x,y:b.y-c.y}}}),e.util.createAccessors(e.Object),e.Object.prototype.rotate=e.Object.prototype.setAngle,g(e.Object.prototype,e.Observable),e.Object.NUM_FRACTION_DIGITS=2,e.Object.__uid=0)})("undefined"!==typeof exports?exports:this);
(function(){var g=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(e,b,f){var a=e.x,c=e.y,d=this.stroke?this.strokeWidth:0;"left"===b?a=e.x+(this.getWidth()+d*this.scaleX)/2:"right"===b&&(a=e.x-(this.getWidth()+d*this.scaleX)/2);"top"===f?c=e.y+(this.getHeight()+d*this.scaleY)/2:"bottom"===f&&(c=e.y-(this.getHeight()+d*this.scaleY)/2);return fabric.util.rotatePoint(new fabric.Point(a,c),e,g(this.angle))},translateToOriginPoint:function(e,
b,f){var a=e.x,c=e.y,d=this.stroke?this.strokeWidth:0;"left"===b?a=e.x-(this.getWidth()+d*this.scaleX)/2:"right"===b&&(a=e.x+(this.getWidth()+d*this.scaleX)/2);"top"===f?c=e.y-(this.getHeight()+d*this.scaleY)/2:"bottom"===f&&(c=e.y+(this.getHeight()+d*this.scaleY)/2);return fabric.util.rotatePoint(new fabric.Point(a,c),e,g(this.angle))},getCenterPoint:function(){var e=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(e,this.originX,this.originY)},getPointByOrigin:function(e,
b){var f=this.getCenterPoint();return this.translateToOriginPoint(f,e,b)},toLocalPoint:function(e,b,f){var a=this.getCenterPoint(),c=this.stroke?this.strokeWidth:0;b&&f?(b="left"===b?a.x-(this.getWidth()+c*this.scaleX)/2:"right"===b?a.x+(this.getWidth()+c*this.scaleX)/2:a.x,f="top"===f?a.y-(this.getHeight()+c*this.scaleY)/2:"bottom"===f?a.y+(this.getHeight()+c*this.scaleY)/2:a.y):(b=this.left,f=this.top);return fabric.util.rotatePoint(new fabric.Point(e.x,e.y),a,-g(this.angle)).subtractEquals(new fabric.Point(b,
f))},setPositionByOrigin:function(e,b,f){e=this.translateToCenterPoint(e,b,f);e=this.translateToOriginPoint(e,this.originX,this.originY);this.set("left",e.x);this.set("top",e.y)},adjustPosition:function(e){var b=g(this.angle),f=this.getWidth()/2,a=Math.cos(b)*f,f=Math.sin(b)*f,c=this.getWidth(),d=Math.cos(b)*c,b=Math.sin(b)*c;"center"===this.originX&&"left"===e||"right"===this.originX&&"center"===e?(this.left-=a,this.top-=f):"left"===this.originX&&"center"===e||"center"===this.originX&&"right"===
e?(this.left+=a,this.top+=f):"left"===this.originX&&"right"===e?(this.left+=d,this.top+=b):"right"===this.originX&&"left"===e&&(this.left-=d,this.top-=b);this.setCoords();this.originX=e},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})})();
(function(){var g=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(e,b){var f=this.oCoords,a=new fabric.Point(f.tl.x,f.tl.y),c=new fabric.Point(f.tr.x,f.tr.y),d=new fabric.Point(f.bl.x,f.bl.y),f=new fabric.Point(f.br.x,f.br.y);return"Intersection"===fabric.Intersection.intersectPolygonRectangle([a,c,f,d],e,b).status},intersectsWithObject:function(e){function b(a){return{tl:new fabric.Point(a.tl.x,a.tl.y),tr:new fabric.Point(a.tr.x,
a.tr.y),bl:new fabric.Point(a.bl.x,a.bl.y),br:new fabric.Point(a.br.x,a.br.y)}}var f=b(this.oCoords);e=b(e.oCoords);return"Intersection"===fabric.Intersection.intersectPolygonPolygon([f.tl,f.tr,f.br,f.bl],[e.tl,e.tr,e.br,e.bl]).status},isContainedWithinObject:function(e){var b=e.getBoundingRect();e=new fabric.Point(b.left,b.top);b=new fabric.Point(b.left+b.width,b.top+b.height);return this.isContainedWithinRect(e,b)},isContainedWithinRect:function(e,b){var f=this.getBoundingRect();return f.left>e.x&&
f.left+f.width<b.x&&f.top>e.y&&f.top+f.height<b.y},containsPoint:function(e){var b=this._getImageLines(this.oCoords);e=this._findCrossPoints(e,b);return 0!==e&&1===e%2},_getImageLines:function(e){return{topline:{o:e.tl,d:e.tr},rightline:{o:e.tr,d:e.br},bottomline:{o:e.br,d:e.bl},leftline:{o:e.bl,d:e.tl}}},_findCrossPoints:function(e,b){var f,a,c,d=0,g;for(g in b)if(c=b[g],!(c.o.y<e.y&&c.d.y<e.y||c.o.y>=e.y&&c.d.y>=e.y)&&(c.o.x===c.d.x&&c.o.x>=e.x?f=c.o.x:(f=(c.d.y-c.o.y)/(c.d.x-c.o.x),a=e.y-0*e.x,
c=c.o.y-f*c.o.x,f=-(a-c)/(0-f)),f>=e.x&&(d+=1),2===d))break;return d},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var e=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],b=fabric.util.array.min(e),e=fabric.util.array.max(e),e=Math.abs(b-e),f=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],a=fabric.util.array.min(f),
f=fabric.util.array.max(f),f=Math.abs(a-f);return{left:b,top:a,width:e,height:f}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(e){return Math.abs(e)<this.minScaleLimit?0>e?-this.minScaleLimit:this.minScaleLimit:e},scale:function(e){e=this._constrainScale(e);0>e&&(this.flipX=!this.flipX,this.flipY=!this.flipY,e*=-1);this.scaleY=this.scaleX=e;this.setCoords();return this},scaleToWidth:function(e){var b=this.getBoundingRectWidth()/
this.getWidth();return this.scale(e/this.width/b)},scaleToHeight:function(e){var b=this.getBoundingRectHeight()/this.getHeight();return this.scale(e/this.height/b)},setCoords:function(){var e=1<this.strokeWidth?this.strokeWidth:0,b=this.padding,f=g(this.angle);this.currentWidth=(this.width+e)*this.scaleX+2*b;this.currentHeight=(this.height+e)*this.scaleY+2*b;0>this.currentWidth&&(this.currentWidth=Math.abs(this.currentWidth));var e=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/
2,2)),a=Math.atan(isFinite(this.currentHeight/this.currentWidth)?this.currentHeight/this.currentWidth:0),b=Math.cos(a+f)*e,a=Math.sin(a+f)*e,e=Math.sin(f),f=Math.cos(f),c=this.getCenterPoint(),b={x:c.x-b,y:c.y-a},a={x:b.x+this.currentWidth*f,y:b.y+this.currentWidth*e},c={x:b.x-this.currentHeight*e,y:b.y+this.currentHeight*f},d={x:b.x+this.currentWidth/2*f,y:b.y+this.currentWidth/2*e};this.oCoords={tl:b,tr:a,br:{x:a.x-this.currentHeight*e,y:a.y+this.currentHeight*f},bl:c,ml:{x:b.x-this.currentHeight/
2*e,y:b.y+this.currentHeight/2*f},mt:d,mr:{x:a.x-this.currentHeight/2*e,y:a.y+this.currentHeight/2*f},mb:{x:c.x+this.currentWidth/2*f,y:c.y+this.currentWidth/2*e},mtr:{x:d.x,y:d.y}};this._setCornerCoords&&this._setCornerCoords();return this}})})();
fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this);return this},bringToFront:function(){this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this);return this},sendBackwards:function(g){this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,g):this.canvas.sendBackwards(this,g);return this},bringForward:function(g){this.group?
fabric.StaticCanvas.prototype.bringForward.call(this.group,this,g):this.canvas.bringForward(this,g);return this},moveTo:function(g){this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,g):this.canvas.moveTo(this,g);return this}});
fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var g=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",e=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",b=this.strokeWidth?this.strokeWidth:"0",f=this.strokeDashArray?this.strokeDashArray.join(" "):"";return["stroke: ",e,"; stroke-width: ",b,"; stroke-dasharray: ",f,"; stroke-linecap: ",this.strokeLineCap?this.strokeLineCap:"butt","; stroke-linejoin: ",this.strokeLineJoin?
this.strokeLineJoin:"miter","; stroke-miterlimit: ",this.strokeMiterLimit?this.strokeMiterLimit:"4","; fill: ",g,"; opacity: ","undefined"!==typeof this.opacity?this.opacity:"1",";",this.shadow&&"text"!==this.type?"filter: url(#SVGID_"+this.shadow.id+");":"",this.visible?"":" visibility: hidden;"].join("")},getSvgTransform:function(){var g=fabric.util.toFixed,e=this.getAngle(),b=this.getCenterPoint(),f=fabric.Object.NUM_FRACTION_DIGITS,b="translate("+g(b.x,f)+" "+g(b.y,f)+")",e=0!==e?" rotate("+g(e,
f)+")":"",g=1===this.scaleX&&1===this.scaleY?"":" scale("+g(this.scaleX,f)+" "+g(this.scaleY,f)+")";return[b,e,g,this.flipX?"matrix(-1 0 0 1 0 0) ":"",this.flipY?"matrix(1 0 0 -1 0 0)":""].join("")},_createBaseSVGMarkup:function(){var g=[];this.fill&&this.fill.toLive&&g.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&g.push(this.stroke.toSVG(this,!1));this.shadow&&g.push(this.shadow.toSVG(this));return g}});
fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(g){return this.get(g)!==this.originalState[g]},this)},saveState:function(g){this.stateProperties.forEach(function(e){this.originalState[e]=this.get(e)},this);g&&g.stateProperties&&g.stateProperties.forEach(function(e){this.originalState[e]=this.get(e)},this);return this},setupState:function(){this.originalState={};this.saveState();return this}});
(function(){var g=fabric.util.getPointer,e=fabric.util.degreesToRadians,b="undefined"!==typeof G_vmlCanvasManager;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(b,a){if(!this.hasControls||!this.active)return!1;var c=g(b,this.canvas.upperCanvasEl),d=c.x-a.left,c=c.y-a.top,e,k;for(k in this.oCoords)if(this.isControlVisible(k)&&("mtr"!==k||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==k&&"mr"!==k&&"mb"!==k&&"ml"!==k)&&(e=this._getImageLines(this.oCoords[k].corner),
e=this._findCrossPoints({x:d,y:c},e),0!==e&&1===e%2))return this.__corner=k;return!1},_setCornerCoords:function(){var b=this.oCoords,a=e(this.angle),c=e(45-this.angle),d=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,g=d*Math.cos(c),c=d*Math.sin(c),d=Math.sin(a),a=Math.cos(a);b.tl.corner={tl:{x:b.tl.x-c,y:b.tl.y-g},tr:{x:b.tl.x+g,y:b.tl.y-c},bl:{x:b.tl.x-g,y:b.tl.y+c},br:{x:b.tl.x+c,y:b.tl.y+g}};b.tr.corner={tl:{x:b.tr.x-c,y:b.tr.y-g},tr:{x:b.tr.x+g,y:b.tr.y-c},br:{x:b.tr.x+c,y:b.tr.y+g},bl:{x:b.tr.x-
g,y:b.tr.y+c}};b.bl.corner={tl:{x:b.bl.x-c,y:b.bl.y-g},bl:{x:b.bl.x-g,y:b.bl.y+c},br:{x:b.bl.x+c,y:b.bl.y+g},tr:{x:b.bl.x+g,y:b.bl.y-c}};b.br.corner={tr:{x:b.br.x+g,y:b.br.y-c},bl:{x:b.br.x-g,y:b.br.y+c},br:{x:b.br.x+c,y:b.br.y+g},tl:{x:b.br.x-c,y:b.br.y-g}};b.ml.corner={tl:{x:b.ml.x-c,y:b.ml.y-g},tr:{x:b.ml.x+g,y:b.ml.y-c},bl:{x:b.ml.x-g,y:b.ml.y+c},br:{x:b.ml.x+c,y:b.ml.y+g}};b.mt.corner={tl:{x:b.mt.x-c,y:b.mt.y-g},tr:{x:b.mt.x+g,y:b.mt.y-c},bl:{x:b.mt.x-g,y:b.mt.y+c},br:{x:b.mt.x+c,y:b.mt.y+g}};
b.mr.corner={tl:{x:b.mr.x-c,y:b.mr.y-g},tr:{x:b.mr.x+g,y:b.mr.y-c},bl:{x:b.mr.x-g,y:b.mr.y+c},br:{x:b.mr.x+c,y:b.mr.y+g}};b.mb.corner={tl:{x:b.mb.x-c,y:b.mb.y-g},tr:{x:b.mb.x+g,y:b.mb.y-c},bl:{x:b.mb.x-g,y:b.mb.y+c},br:{x:b.mb.x+c,y:b.mb.y+g}};b.mtr.corner={tl:{x:b.mtr.x-c+d*this.rotatingPointOffset,y:b.mtr.y-g-a*this.rotatingPointOffset},tr:{x:b.mtr.x+g+d*this.rotatingPointOffset,y:b.mtr.y-c-a*this.rotatingPointOffset},bl:{x:b.mtr.x-g+d*this.rotatingPointOffset,y:b.mtr.y+c-a*this.rotatingPointOffset},
br:{x:b.mtr.x+c+d*this.rotatingPointOffset,y:b.mtr.y+g-a*this.rotatingPointOffset}}},drawBorders:function(b){if(!this.hasBorders)return this;var a=this.padding,c=2*a,d=2*~~(this.strokeWidth/2);b.save();b.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;b.strokeStyle=this.borderColor;var e=1/this._constrainScale(this.scaleX),g=1/this._constrainScale(this.scaleY);b.lineWidth=1/this.borderScaleFactor;b.scale(e,g);e=this.getWidth();g=this.getHeight();b.strokeRect(~~(-(e/2)-a-d/2*this.scaleX)-
0.5,~~(-(g/2)-a-d/2*this.scaleY)-0.5,~~(e+c+d*this.scaleX)+1,~~(g+c+d*this.scaleY)+1);this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(a=(this.flipY?g+d*this.scaleY+2*a:-g-d*this.scaleY-2*a)/2,b.beginPath(),b.moveTo(0,a),b.lineTo(0,a+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset)),b.closePath(),b.stroke());b.restore();return this},drawControls:function(b){if(!this.hasControls)return this;var a=this.cornerSize,c=a/2,d=~~(this.strokeWidth/
2),e=-(this.width/2),g=-(this.height/2),h=this.padding/this.scaleX,m=this.padding/this.scaleY,n=c/this.scaleY,p=c/this.scaleX,q=(c-a)/this.scaleX,a=(c-a)/this.scaleY,c=this.height,w=this.width,s=this.transparentCorners?"strokeRect":"fillRect";b.save();b.lineWidth=1/Math.max(this.scaleX,this.scaleY);b.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;b.strokeStyle=b.fillStyle=this.cornerColor;this._drawControl("tl",b,s,e-p-d-h,g-n-d-m);this._drawControl("tr",b,s,e+w-p+d+h,g-n-d-m);this._drawControl("bl",
b,s,e-p-d-h,g+c+a+d+m);this._drawControl("br",b,s,e+w+q+d+h,g+c+a+d+m);this.get("lockUniScaling")||(this._drawControl("mt",b,s,e+w/2-p,g-n-d-m),this._drawControl("mb",b,s,e+w/2-p,g+c+a+d+m),this._drawControl("mb",b,s,e+w+q+d+h,g+c/2-n),this._drawControl("ml",b,s,e-p-d-h,g+c/2-n));this.hasRotatingPoint&&this._drawControl("mtr",b,s,e+w/2-p,this.flipY?g+c+this.rotatingPointOffset/this.scaleY-this.cornerSize/this.scaleX/2+d+m:g-this.rotatingPointOffset/this.scaleY-this.cornerSize/this.scaleY/2-d-m);b.restore();
return this},_drawControl:function(e,a,c,d,g){var k=this.cornerSize/this.scaleX,h=this.cornerSize/this.scaleY;this.isControlVisible(e)&&(b||this.transparentCorners||a.clearRect(d,g,k,h),a[c](d,g,k,h))},isControlVisible:function(b){return this._getControlsVisibility()[b]},setControlVisible:function(b,a){this._getControlsVisibility()[b]=a;return this},setControlsVisibility:function(b){b||(b={});for(var a in b)this.setControlVisible(a,b[a]);return this},_getControlsVisibility:function(){this._controlsVisibility||
(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0});return this._controlsVisibility}})})();
fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(g,e){e=e||{};var b=function(){},f=e.onComplete||b,a=e.onChange||b,c=this;fabric.util.animate({startValue:g.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(b){g.set("left",b);c.renderAll();a()},onComplete:function(){g.setCoords();f()}});return this},fxCenterObjectV:function(g,e){e=e||{};var b=function(){},f=e.onComplete||b,a=e.onChange||b,c=this;fabric.util.animate({startValue:g.get("top"),
endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(b){g.set("top",b);c.renderAll();a()},onComplete:function(){g.setCoords();f()}});return this},fxRemove:function(g,e){e=e||{};var b=function(){},f=e.onComplete||b,a=e.onChange||b,c=this;fabric.util.animate({startValue:g.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){g.set("active",!1)},onChange:function(b){g.set("opacity",b);c.renderAll();a()},onComplete:function(){c.remove(g);f()}});return this}});
fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"===typeof arguments[0]){var g=[],e,b;for(e in arguments[0])g.push(e);for(var f=0,a=g.length;f<a;f++)e=g[f],b=f!==a-1,this._animate(e,arguments[0][e],arguments[1],b)}else this._animate.apply(this,arguments);return this},_animate:function(g,e,b,f){var a=this,c;e=e.toString();b=b?fabric.util.object.clone(b):{};~g.indexOf(".")&&(c=g.split("."));var d=c?this.get(c[0])[c[1]]:this.get(g);"from"in b||(b.from=d);
e=~e.indexOf("=")?d+parseFloat(e.replace("=","")):parseFloat(e);fabric.util.animate({startValue:b.from,endValue:e,byValue:b.by,easing:b.easing,duration:b.duration,abort:b.abort&&function(){return b.abort.call(a)},onChange:function(d){c?a[c[0]][c[1]]=d:a.set(g,d);f||b.onChange&&b.onChange()},onComplete:function(){f||(a.setCoords(),b.onComplete&&b.onComplete())}})}});
(function(g){var e=g.fabric||(g.fabric={}),b=e.util.object.extend,f={x1:1,x2:1,y1:1,y2:1},a=e.StaticCanvas.supports("setLineDash");e.Line?e.warn("fabric.Line is already defined"):(e.Line=e.util.createClass(e.Object,{type:"line",initialize:function(a,b){b=b||{};a||(a=[0,0,0,0]);this.callSuper("initialize",b);this.set("x1",a[0]);this.set("y1",a[1]);this.set("x2",a[2]);this.set("y2",a[3]);this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={});this.set("width",Math.abs(this.x2-this.x1)||1);this.set("height",
Math.abs(this.y2-this.y1)||1);this.set("left","left"in a?a.left:Math.min(this.x1,this.x2)+this.width/2);this.set("top","top"in a?a.top:Math.min(this.y1,this.y2)+this.height/2)},_set:function(a,b){this[a]=b;a in f&&this._setWidthHeight();return this},_render:function(b){b.beginPath();this.group&&"path-group"===this.group.type&&!this.transformMatrix&&b.translate(-this.group.width/2+this.left,-this.group.height/2+this.top);if(!this.strokeDashArray||this.strokeDashArray&&a){var d=this.x1<=this.x2?-1:
1,e=this.y1<=this.y2?-1:1;b.moveTo(1===this.width?0:d*this.width/2,1===this.height?0:e*this.height/2);b.lineTo(1===this.width?0:-1*d*this.width/2,1===this.height?0:-1*e*this.height/2)}b.lineWidth=this.strokeWidth;d=b.strokeStyle;b.strokeStyle=this.stroke||b.fillStyle;this._renderStroke(b);b.strokeStyle=d},_renderDashedStroke:function(a){var b=this.x1<=this.x2?-1:1,f=this.y1<=this.y2?-1:1,b=1===this.width?0:b*this.width/2,f=1===this.height?0:f*this.height/2;a.beginPath();e.util.drawDashedLine(a,b,
f,-b,-f,this.strokeDashArray);a.closePath()},toObject:function(a){return b(this.callSuper("toObject",a),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},toSVG:function(a){var b=this._createBaseSVGMarkup();b.push("<line ",'x1="',this.get("x1"),'" y1="',this.get("y1"),'" x2="',this.get("x2"),'" y2="',this.get("y2"),'" style="',this.getSvgStyles(),'"/>');return a?a(b.join("")):b.join("")},complexity:function(){return 1}}),e.Line.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["x1",
"y1","x2","y2"]),e.Line.fromElement=function(a,d){var f=e.parseAttributes(a,e.Line.ATTRIBUTE_NAMES);return new e.Line([f.x1||0,f.y1||0,f.x2||0,f.y2||0],b(f,d))},e.Line.fromObject=function(a){return new e.Line([a.x1,a.y1,a.x2,a.y2],a)})})("undefined"!==typeof exports?exports:this);
(function(g){var e=g.fabric||(g.fabric={}),b=2*Math.PI,f=e.util.object.extend;e.Circle?e.warn("fabric.Circle is already defined."):(e.Circle=e.util.createClass(e.Object,{type:"circle",initialize:function(a){a=a||{};this.set("radius",a.radius||0);this.callSuper("initialize",a)},_set:function(a,b){this.callSuper("_set",a,b);"radius"===a&&this.setRadius(b);return this},toObject:function(a){return f(this.callSuper("toObject",a),{radius:this.get("radius")})},toSVG:function(a){var b=this._createBaseSVGMarkup();
b.push("<circle ",'cx="0" cy="0" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a?a(b.join("")):b.join("")},_render:function(a,c){a.beginPath();a.globalAlpha=this.group?a.globalAlpha*this.opacity:this.opacity;a.arc(c?this.left:0,c?this.top:0,this.radius,0,b,!1);a.closePath();this._renderFill(a);this._renderStroke(a)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},
setRadius:function(a){this.radius=a;this.set("width",2*a).set("height",2*a)},complexity:function(){return 1}}),e.Circle.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["cx","cy","r"]),e.Circle.fromElement=function(a,b){b||(b={});var d=e.parseAttributes(a,e.Circle.ATTRIBUTE_NAMES);if(!("radius"in d&&0<d.radius))throw Error("value of `r` attribute is required and can not be negative");"left"in d&&(d.left-=b.width/2||0);"top"in d&&(d.top-=b.height/2||0);d=new e.Circle(f(d,b));d.cx=parseFloat(a.getAttribute("cx"))||
0;d.cy=parseFloat(a.getAttribute("cy"))||0;return d},e.Circle.fromObject=function(a){return new e.Circle(a)})})("undefined"!==typeof exports?exports:this);
(function(g){var e=g.fabric||(g.fabric={});e.Triangle?e.warn("fabric.Triangle is already defined"):(e.Triangle=e.util.createClass(e.Object,{type:"triangle",initialize:function(b){b=b||{};this.callSuper("initialize",b);this.set("width",b.width||100).set("height",b.height||100)},_render:function(b){var e=this.width/2,a=this.height/2;b.beginPath();b.moveTo(-e,a);b.lineTo(0,-a);b.lineTo(e,a);b.closePath();this._renderFill(b);this._renderStroke(b)},_renderDashedStroke:function(b){var f=this.width/2,a=
this.height/2;b.beginPath();e.util.drawDashedLine(b,-f,a,0,-a,this.strokeDashArray);e.util.drawDashedLine(b,0,-a,f,a,this.strokeDashArray);e.util.drawDashedLine(b,f,a,-f,a,this.strokeDashArray);b.closePath()},toSVG:function(b){var e=this._createBaseSVGMarkup(),a=this.width/2,c=this.height/2,a=[-a+" "+c,"0 "+-c,a+" "+c].join();e.push("<polygon ",'points="',a,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return b?b(e.join("")):e.join("")},complexity:function(){return 1}}),
e.Triangle.fromObject=function(b){return new e.Triangle(b)})})("undefined"!==typeof exports?exports:this);
(function(g){var e=g.fabric||(g.fabric={}),b=2*Math.PI,f=e.util.object.extend;e.Ellipse?e.warn("fabric.Ellipse is already defined."):(e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("rx",a.rx||0);this.set("ry",a.ry||0);this.set("width",2*this.get("rx"));this.set("height",2*this.get("ry"))},toObject:function(a){return f(this.callSuper("toObject",a),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(a){var b=
this._createBaseSVGMarkup();b.push("<ellipse ",'rx="',this.get("rx"),'" ry="',this.get("ry"),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a?a(b.join("")):b.join("")},render:function(a,b){if(0!==this.rx&&0!==this.ry)return this.callSuper("render",a,b)},_render:function(a,c){a.beginPath();a.save();a.globalAlpha=this.group?a.globalAlpha*this.opacity:this.opacity;this.transformMatrix&&this.group&&a.translate(this.cx,this.cy);a.transform(1,0,0,this.ry/this.rx,0,
0);a.arc(c?this.left:0,c?this.top:0,this.rx,0,b,!1);this._renderFill(a);this._renderStroke(a);a.restore()},complexity:function(){return 1}}),e.Ellipse.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["cx","cy","rx","ry"]),e.Ellipse.fromElement=function(a,b){b||(b={});var d=e.parseAttributes(a,e.Ellipse.ATTRIBUTE_NAMES),g=d.left,k=d.top;"left"in d&&(d.left-=b.width/2||0);"top"in d&&(d.top-=b.height/2||0);d=new e.Ellipse(f(d,b));d.cx=g||0;d.cy=k||0;return d},e.Ellipse.fromObject=function(a){return new e.Ellipse(a)})})("undefined"!==
typeof exports?exports:this);
(function(g){var e=g.fabric||(g.fabric={}),b=e.util.object.extend;e.Rect?console.warn("fabric.Rect is already defined"):(g=e.Object.prototype.stateProperties.concat(),g.push("rx","ry","x","y"),e.Rect=e.util.createClass(e.Object,{stateProperties:g,type:"rect",rx:0,ry:0,x:0,y:0,strokeDashArray:null,initialize:function(b){b=b||{};this.callSuper("initialize",b);this._initRxRy();this.x=b.x||0;this.y=b.y||0},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(b){var a=
this.rx||0,c=this.ry||0,d=-this.width/2,e=-this.height/2,g=this.width,h=this.height,m=this.group&&"path-group"===this.group.type;b.beginPath();b.globalAlpha=m?b.globalAlpha*this.opacity:this.opacity;this.transformMatrix&&m&&b.translate(this.width/2+this.x,this.height/2+this.y);!this.transformMatrix&&m&&b.translate(-this.group.width/2+this.width/2+this.x,-this.group.height/2+this.height/2+this.y);m=0!==a||0!==c;b.moveTo(d+a,e);b.lineTo(d+g-a,e);m&&b.quadraticCurveTo(d+g,e,d+g,e+c,d+g,e+c);b.lineTo(d+
g,e+h-c);m&&b.quadraticCurveTo(d+g,e+h,d+g-a,e+h,d+g-a,e+h);b.lineTo(d+a,e+h);m&&b.quadraticCurveTo(d,e+h,d,e+h-c,d,e+h-c);b.lineTo(d,e+c);m&&b.quadraticCurveTo(d,e,d+a,e,d+a,e);b.closePath();this._renderFill(b);this._renderStroke(b)},_renderDashedStroke:function(b){var a=-this.width/2,c=-this.height/2,d=this.width,g=this.height;b.beginPath();e.util.drawDashedLine(b,a,c,a+d,c,this.strokeDashArray);e.util.drawDashedLine(b,a+d,c,a+d,c+g,this.strokeDashArray);e.util.drawDashedLine(b,a+d,c+g,a,c+g,this.strokeDashArray);
e.util.drawDashedLine(b,a,c+g,a,c,this.strokeDashArray);b.closePath()},_normalizeLeftTopProperties:function(b){"left"in b&&this.set("left",b.left+this.getWidth()/2);this.set("x",b.left||0);"top"in b&&this.set("top",b.top+this.getHeight()/2);this.set("y",b.top||0);return this},toObject:function(e){e=b(this.callSuper("toObject",e),{rx:this.get("rx")||0,ry:this.get("ry")||0,x:this.get("x"),y:this.get("y")});this.includeDefaultValues||this._removeDefaultValues(e);return e},toSVG:function(b){var a=this._createBaseSVGMarkup();
a.push("<rect ",'x="',-1*this.width/2,'" y="',-1*this.height/2,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return b?b(a.join("")):a.join("")},complexity:function(){return 1}}),e.Rect.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),e.Rect.fromElement=function(f,a){if(!f)return null;var c=e.parseAttributes(f,e.Rect.ATTRIBUTE_NAMES);c.left=
c.left||0;c.top=c.top||0;var d=new e.Rect(b(a?e.util.object.clone(a):{},c));d._normalizeLeftTopProperties(c);return d},e.Rect.fromObject=function(b){return new e.Rect(b)})})("undefined"!==typeof exports?exports:this);
(function(g){var e=g.fabric||(g.fabric={}),b=e.util.toFixed;e.Polyline?e.warn("fabric.Polyline is already defined"):(e.Polyline=e.util.createClass(e.Object,{type:"polyline",initialize:function(b,a,c){a=a||{};this.set("points",b);this.callSuper("initialize",a);this._calcDimensions(c)},_calcDimensions:function(b){return e.Polygon.prototype._calcDimensions.call(this,b)},toObject:function(b){return e.Polygon.prototype.toObject.call(this,b)},toSVG:function(e){for(var a=[],c=this._createBaseSVGMarkup(),
d=0,g=this.points.length;d<g;d++)a.push(b(this.points[d].x,2),",",b(this.points[d].y,2)," ");c.push("<polyline ",'points="',a.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return e?e(c.join("")):c.join("")},_render:function(b){var a;b.beginPath();b.moveTo(this.points[0].x,this.points[0].y);for(var c=0,d=this.points.length;c<d;c++)a=this.points[c],b.lineTo(a.x,a.y);this._renderFill(b);this._renderStroke(b)},_renderDashedStroke:function(b){var a,c;b.beginPath();
for(var d=0,g=this.points.length;d<g;d++)a=this.points[d],c=this.points[d+1]||a,e.util.drawDashedLine(b,a.x,a.y,c.x,c.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),e.Polyline.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polyline.fromElement=function(b,a){if(!b)return null;a||(a={});var c=e.parsePointsAttribute(b.getAttribute("points")),d=e.parseAttributes(b,e.Polyline.ATTRIBUTE_NAMES);e.util.normalizePoints(c,a);return new e.Polyline(c,e.util.object.extend(d,
a),!0)},e.Polyline.fromObject=function(b){return new e.Polyline(b.points,b,!0)})})("undefined"!==typeof exports?exports:this);
(function(g){var e=g.fabric||(g.fabric={}),b=e.util.object.extend,f=e.util.array.min,a=e.util.array.max,c=e.util.toFixed;e.Polygon?e.warn("fabric.Polygon is already defined"):(e.Polygon=e.util.createClass(e.Object,{type:"polygon",initialize:function(a,b,c){b=b||{};this.points=a;this.callSuper("initialize",b);this._calcDimensions(c)},_calcDimensions:function(b){var c=this.points,e=f(c,"x"),g=f(c,"y"),m=a(c,"x"),c=a(c,"y");this.width=m-e||1;this.height=c-g||1;this.minX=e;this.minY=g;if(!b){var n=this.width/
2+this.minX,p=this.height/2+this.minY;this.points.forEach(function(a){a.x-=n;a.y-=p},this)}},toObject:function(a){return b(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(a){for(var b=[],e=this._createBaseSVGMarkup(),f=0,g=this.points.length;f<g;f++)b.push(c(this.points[f].x,2),",",c(this.points[f].y,2)," ");e.push("<polygon ",'points="',b.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a?a(e.join("")):e.join("")},_render:function(a){var b;
a.beginPath();a.moveTo(this.points[0].x,this.points[0].y);for(var c=0,e=this.points.length;c<e;c++)b=this.points[c],a.lineTo(b.x,b.y);this._renderFill(a);if(this.stroke||this.strokeDashArray)a.closePath(),this._renderStroke(a)},_renderDashedStroke:function(a){var b,c;a.beginPath();for(var f=0,g=this.points.length;f<g;f++)b=this.points[f],c=this.points[f+1]||this.points[0],e.util.drawDashedLine(a,b.x,b.y,c.x,c.y,this.strokeDashArray);a.closePath()},complexity:function(){return this.points.length}}),
e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polygon.fromElement=function(a,c){if(!a)return null;c||(c={});var f=e.parsePointsAttribute(a.getAttribute("points")),g=e.parseAttributes(a,e.Polygon.ATTRIBUTE_NAMES);e.util.normalizePoints(f,c);return new e.Polygon(f,b(g,c),!0)},e.Polygon.fromObject=function(a){return new e.Polygon(a.points,a,!0)})})("undefined"!==typeof exports?exports:this);
(function(g){function e(a){return"H"===a[0]?a[1]:a[a.length-2]}function b(a){return"V"===a[0]?a[1]:a[a.length-1]}var f={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7};"use strict";var a=g.fabric||(g.fabric={}),c=a.util.array.min,d=a.util.array.max,l=a.util.object.extend,k=Object.prototype.toString,h=a.util.drawArc;a.Path?a.warn("fabric.Path is already defined"):(a.Path=a.util.createClass(a.Object,{type:"path",initialize:function(a,b){b=b||{};this.setOptions(b);if(!a)throw Error("`path` argument is required");
var d="[object Array]"===k.call(a);if(this.path=d?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi))d||(this.path=this._parsePath()),this._initializePath(b),b.sourcePath&&this.setSourcePath(b.sourcePath)},_initializePath:function(a){var b="width"in a&&null!=a.width,d="height"in a&&null!=a.width,c="left"in a,e="top"in a,f=c?this.left:0,g=e?this.top:0;b&&d?(e||(this.top=this.height/2),c||(this.left=this.width/2)):(l(this,this._parseDimensions()),b&&(this.width=a.width),d&&(this.height=a.height));this.pathOffset=
this.pathOffset||this._calculatePathOffset(f,g)},_calculatePathOffset:function(a,b){return{x:this.left-a-this.width/2,y:this.top-b-this.height/2}},_render:function(a){for(var b,d=null,c=0,e=0,f=0,g=0,l,k,v,u,r=-(this.width/2+this.pathOffset.x),z=-(this.height/2+this.pathOffset.y),C=0,B=this.path.length;C<B;++C){b=this.path[C];switch(b[0]){case "l":c+=b[1];e+=b[2];a.lineTo(c+r,e+z);break;case "L":c=b[1];e=b[2];a.lineTo(c+r,e+z);break;case "h":c+=b[1];a.lineTo(c+r,e+z);break;case "H":c=b[1];a.lineTo(c+
r,e+z);break;case "v":e+=b[1];a.lineTo(c+r,e+z);break;case "V":e=b[1];a.lineTo(c+r,e+z);break;case "m":c+=b[1];e+=b[2];d=!d||"m"!==d[0]&&"M"!==d[0]?"moveTo":"lineTo";a[d](c+r,e+z);break;case "M":c=b[1];e=b[2];d=!d||"m"!==d[0]&&"M"!==d[0]?"moveTo":"lineTo";a[d](c+r,e+z);break;case "c":l=c+b[5];k=e+b[6];f=c+b[3];g=e+b[4];a.bezierCurveTo(c+b[1]+r,e+b[2]+z,f+r,g+z,l+r,k+z);c=l;e=k;break;case "C":c=b[5];e=b[6];f=b[3];g=b[4];a.bezierCurveTo(b[1]+r,b[2]+z,f+r,g+z,c+r,e+z);break;case "s":l=c+b[3];k=e+b[4];
f=f?2*c-f:c;g=g?2*e-g:e;a.bezierCurveTo(f+r,g+z,c+b[1]+r,e+b[2]+z,l+r,k+z);f=c+b[1];g=e+b[2];c=l;e=k;break;case "S":l=b[3];k=b[4];f=2*c-f;g=2*e-g;a.bezierCurveTo(f+r,g+z,b[1]+r,b[2]+z,l+r,k+z);c=l;e=k;f=b[1];g=b[2];break;case "q":l=c+b[3];k=e+b[4];f=c+b[1];g=e+b[2];a.quadraticCurveTo(f+r,g+z,l+r,k+z);c=l;e=k;break;case "Q":l=b[3];k=b[4];a.quadraticCurveTo(b[1]+r,b[2]+z,l+r,k+z);c=l;e=k;f=b[1];g=b[2];break;case "t":l=c+b[1];k=e+b[2];null===d[0].match(/[QqTt]/)?(f=c,g=e):"t"===d[0]?(f=2*c-v,g=2*e-u):
"q"===d[0]&&(f=2*c-f,g=2*e-g);v=f;u=g;a.quadraticCurveTo(f+r,g+z,l+r,k+z);c=l;e=k;f=c+b[1];g=e+b[2];break;case "T":l=b[1];k=b[2];f=2*c-f;g=2*e-g;a.quadraticCurveTo(f+r,g+z,l+r,k+z);c=l;e=k;break;case "a":h(a,c+r,e+z,[b[1],b[2],b[3],b[4],b[5],b[6]+c+r,b[7]+e+z]);c+=b[6];e+=b[7];break;case "A":h(a,c+r,e+z,[b[1],b[2],b[3],b[4],b[5],b[6]+r,b[7]+z]);c=b[6];e=b[7];break;case "z":case "Z":a.closePath()}d=b}},render:function(b,d){if(this.visible){b.save();var c=this.transformMatrix;c&&b.transform(c[0],c[1],
c[2],c[3],c[4],c[5]);d||this.transform(b);this._setStrokeStyles(b);this._setFillStyles(b);this._setShadow(b);this.clipTo&&a.util.clipContext(this,b);b.beginPath();this._render(b);this._renderFill(b);this._renderStroke(b);this.clipTo&&b.restore();this._removeShadow(b);!d&&this.active&&(this.drawBorders(b),this.drawControls(b));b.restore()}},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){a=l(this.callSuper("toObject",
a),{path:this.path,pathOffset:this.pathOffset});this.sourcePath&&(a.sourcePath=this.sourcePath);this.transformMatrix&&(a.transformMatrix=this.transformMatrix);return a},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.path=this.sourcePath);delete a.sourcePath;return a},toSVG:function(a){for(var b=[],d=this._createBaseSVGMarkup(),c=0,e=this.path.length;c<e;c++)b.push(this.path[c].join(" "));b=b.join(" ");d.push('<g transform="',this.group?"":this.getSvgTransform(),'">',"<path ",
'd="',b,'" style="',this.getSvgStyles(),'" transform="translate(',-this.width/2," ",-this.height/2,")",'" stroke-linecap="round" ',"/>","</g>");return a?a(d.join("")):d.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a=[],b=[],d,c,e=/([-+]?\d+(?:\.\d+)?(?:e[-+]?\d+)?)/g,g,l=0,k=this.path.length;l<k;l++){d=this.path[l];g=d.slice(1).trim();for(b.length=0;c=e.exec(g);)b.push(c[0]);d=[d.charAt(0)];g=0;for(var h=b.length;g<h;g++)c=parseFloat(b[g]),isNaN(c)||d.push(c);
c=d[0].toLowerCase();c=f[c];if(d.length-1>c)for(g=1,h=d.length;g<h;g+=c)a.push([d[0]].concat(d.slice(g,g+c)));else a.push(d)}return a},_parseDimensions:function(){var a=[],b=[],e={};this.path.forEach(function(d,c){this._getCoordsFromCommand(d,c,a,b,e)},this);var f=c(a),g=c(b),l=d(a),k=d(b),l=l-f,k=k-g;return{left:this.left+(f+l/2),top:this.top+(g+k/2),width:l,height:k}},_getCoordsFromCommand:function(a,d,c,f,g){var l=!1;"H"!==a[0]&&(g.x=0===d?e(a):e(this.path[d-1]));"V"!==a[0]&&(g.y=0===d?b(a):b(this.path[d-
1]));a[0]===a[0].toLowerCase()&&(l=!0);a=this._getXY(a,l,g);d=parseInt(a.x,10);isNaN(d)||c.push(d);d=parseInt(a.y,10);isNaN(d)||f.push(d)},_getXY:function(a,d,c){var f=d?c.x+e(a):"V"===a[0]?c.x:e(a);a=d?c.y+b(a):"H"===a[0]?c.y:b(a);return{x:f,y:a}}}),a.Path.fromObject=function(b,d){"string"===typeof b.path?a.loadSVGFromURL(b.path,function(c){c=c[0];var e=b.path;delete b.path;a.util.object.extend(c,b);c.setSourcePath(e);d(c)}):d(new a.Path(b.path,b))},a.Path.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(["d"]),
a.Path.fromElement=function(b,d,c){b=a.parseAttributes(b,a.Path.ATTRIBUTE_NAMES);d&&d(new a.Path(b.d,l(b,c)))},a.Path.async=!0)})("undefined"!==typeof exports?exports:this);
(function(g){var e=g.fabric||(g.fabric={}),b=e.util.object.extend,f=e.util.array.invoke,a=e.Object.prototype.toObject;e.PathGroup?e.warn("fabric.PathGroup is already defined"):(e.PathGroup=e.util.createClass(e.Path,{type:"path-group",fill:"",initialize:function(a,b){b=b||{};this.paths=a||[];for(var e=this.paths.length;e--;)this.paths[e].group=this;this.setOptions(b);this.setCoords();b.sourcePath&&this.setSourcePath(b.sourcePath)},render:function(a){if(this.visible){a.save();var b=this.transformMatrix;
b&&a.transform(b[0],b[1],b[2],b[3],b[4],b[5]);this.transform(a);this._setShadow(a);this.clipTo&&e.util.clipContext(this,a);for(var b=0,f=this.paths.length;b<f;++b)this.paths[b].render(a,!0);this.clipTo&&a.restore();this._removeShadow(a);this.active&&(this.drawBorders(a),this.drawControls(a));a.restore()}},_set:function(a,b){if("fill"===a&&b&&this.isSameColor())for(var e=this.paths.length;e--;)this.paths[e]._set(a,b);return this.callSuper("_set",a,b)},toObject:function(c){c=b(a.call(this,c),{paths:f(this.getObjects(),
"toObject",c)});this.sourcePath&&(c.sourcePath=this.sourcePath);return c},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.paths=this.sourcePath);return a},toSVG:function(a){for(var b=this.getObjects(),e=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',">"],f=0,g=b.length;f<g;f++)e.push(b[f].toSVG(a));e.push("</g>");return a?a(e.join("")):e.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+
this.left+" }>"},isSameColor:function(){var a=this.getObjects()[0].get("fill");return this.getObjects().every(function(b){return b.get("fill")===a})},complexity:function(){return this.paths.reduce(function(a,b){return a+(b&&b.complexity?b.complexity():0)},0)},getObjects:function(){return this.paths}}),e.PathGroup.fromObject=function(a,b){"string"===typeof a.paths?e.loadSVGFromURL(a.paths,function(f){var g=a.paths;delete a.paths;f=e.util.groupSVGElements(f,a,g);b(f)}):e.util.enlivenObjects(a.paths,
function(f){delete a.paths;b(new e.PathGroup(f,a))})},e.PathGroup.async=!0)})("undefined"!==typeof exports?exports:this);
(function(g){var e=g.fabric||(g.fabric={}),b=e.util.object.extend,f=e.util.array.min,a=e.util.array.max,c=e.util.array.invoke;if(!e.Group){var d={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",initialize:function(a,d){d=d||{};this._objects=a||[];for(var c=this._objects.length;c--;)this._objects[c].group=this;this.originalState={};this.callSuper("initialize");this._calcBounds();this._updateObjectsCoords();
d&&b(this,d);this._setOpacityIfSame();this.setCoords(!0);this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(a){var b=a.getLeft(),d=a.getTop();a.set({originalLeft:b,originalTop:d,left:b-this.left,top:d-this.top});a.setCoords();a.__origHasControls=a.hasControls;a.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){this._restoreObjectsState();this._objects.push(a);
a.group=this;this.forEachObject(this._setObjectActive,this);this._calcBounds();this._updateObjectsCoords();return this},_setObjectActive:function(a){a.set("active",!0);a.group=this},removeWithUpdate:function(a){this._moveFlippedObject(a);this._restoreObjectsState();this.forEachObject(this._setObjectActive,this);this.remove(a);this._calcBounds();this._updateObjectsCoords();return this},_onObjectAdded:function(a){a.group=this},_onObjectRemoved:function(a){delete a.group;a.set("active",!1)},delegatedProperties:{fill:!0,
opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(a,b){if(a in this.delegatedProperties){var d=this._objects.length;for(this[a]=b;d--;)this._objects[d].set(a,b)}else this[a]=b},toObject:function(a){return b(this.callSuper("toObject",a),{objects:c(this._objects,"toObject",a)})},render:function(a,b){if(this.visible){a.save();this.transform(a);this.clipTo&&e.util.clipContext(this,a);for(var d=0,c=this._objects.length;d<
c;d++)this._renderObject(this._objects[d],a);this.clipTo&&a.restore();!b&&this.active&&(this.drawBorders(a),this.drawControls(a));a.restore()}},_renderObject:function(a,b){var d=a.borderScaleFactor,c=a.hasRotatingPoint,e=Math.max(this.scaleX,this.scaleY);a.visible&&(a.borderScaleFactor=e,a.hasRotatingPoint=!1,a.render(b),a.borderScaleFactor=d,a.hasRotatingPoint=c)},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},_moveFlippedObject:function(a){var b=
a.get("originX"),d=a.get("originY"),c=a.getCenterPoint();a.set({originX:"center",originY:"center",left:c.x,top:c.y});this._toggleFlipping(a);c=a.getPointByOrigin(b,d);a.set({originX:b,originY:d,left:c.x,top:c.y});return this},_toggleFlipping:function(a){this.flipX&&(a.toggle("flipX"),a.set("left",-a.get("left")),a.setAngle(-a.getAngle()));this.flipY&&(a.toggle("flipY"),a.set("top",-a.get("top")),a.setAngle(-a.getAngle()))},_restoreObjectState:function(a){this._setObjectPosition(a);a.setCoords();a.hasControls=
a.__origHasControls;delete a.__origHasControls;a.set("active",!1);a.setCoords();delete a.group;return this},_setObjectPosition:function(a){var b=this.getLeft(),d=this.getTop(),c=this._getRotatedLeftTop(a);a.set({angle:a.getAngle()+this.getAngle(),left:b+c.left,top:d+c.top,scaleX:a.get("scaleX")*this.get("scaleX"),scaleY:a.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(a){var b=this.getAngle()*(Math.PI/180);return{left:-Math.sin(b)*a.getTop()*this.get("scaleY")+Math.cos(b)*a.getLeft()*
this.get("scaleX"),top:Math.cos(b)*a.getTop()*this.get("scaleY")+Math.sin(b)*a.getLeft()*this.get("scaleX")}},destroy:function(){this._objects.forEach(this._moveFlippedObject,this);return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(a){a.setCoords()});return this},
_setOpacityIfSame:function(){var a=this.getObjects(),b=a[0]?a[0].get("opacity"):1;a.every(function(a){return a.get("opacity")===b})&&(this.opacity=b)},_calcBounds:function(){for(var a=[],b=[],d,c=0,e=this._objects.length;c<e;++c){d=this._objects[c];d.setCoords();for(var f in d.oCoords)a.push(d.oCoords[f].x),b.push(d.oCoords[f].y)}this.set(this._getBounds(a,b))},_getBounds:function(b,d){var c=f(b),e=a(b),g=f(d),p=a(d),e=e-c||0,p=p-g||0;return{width:e,height:p,left:c+e/2||0,top:g+p/2||0}},toSVG:function(a){for(var b=
["<g ",'transform="',this.getSvgTransform(),'">'],d=0,c=this._objects.length;d<c;d++)b.push(this._objects[d].toSVG(a));b.push("</g>");return a?a(b.join("")):b.join("")},get:function(a){if(a in d){if(this[a])return this[a];for(var b=0,c=this._objects.length;b<c;b++)if(this._objects[b][a])return!0;return!1}return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):this[a]}});e.Group.fromObject=function(a,b){e.util.enlivenObjects(a.objects,function(d){delete a.objects;b&&b(new e.Group(d,
a))})};e.Group.async=!0}})("undefined"!==typeof exports?exports:this);
(function(g){var e=fabric.util.object.extend;g.fabric||(g.fabric={});g.fabric.Image?fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",initialize:function(b,e){e||(e={});this.filters=[];this.callSuper("initialize",e);this._initElement(b,e);this._initConfig(e);e.filters&&(this.filters=e.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(b,e){this._originalElement=this._element=b;
this._initConfig();0!==this.filters.length&&this.applyFilters(e);return this},setCrossOrigin:function(b){this.crossOrigin=b;this._element.crossOrigin=b;return this},getOriginalSize:function(){var b=this.getElement();return{width:b.width,height:b.height}},render:function(b,e){if(this.visible){b.save();var a=this.transformMatrix;this.group&&"path-group"===this.group.type&&b.translate(-this.group.width/2+this.width/2,-this.group.height/2+this.height/2);a&&b.transform(a[0],a[1],a[2],a[3],a[4],a[5]);e||
this.transform(b);b.save();this._setShadow(b);this.clipTo&&fabric.util.clipContext(this,b);this._render(b);this.shadow&&!this.shadow.affectStroke&&this._removeShadow(b);this._renderStroke(b);this.clipTo&&b.restore();b.restore();this.active&&!e&&(this.drawBorders(b),this.drawControls(b));b.restore()}},_stroke:function(b){b.save();this._setStrokeStyles(b);b.beginPath();b.strokeRect(-this.width/2,-this.height/2,this.width,this.height);b.closePath();b.restore()},_renderDashedStroke:function(b){var e=
-this.width/2,a=-this.height/2,c=this.width,d=this.height;b.save();this._setStrokeStyles(b);b.beginPath();fabric.util.drawDashedLine(b,e,a,e+c,a,this.strokeDashArray);fabric.util.drawDashedLine(b,e+c,a,e+c,a+d,this.strokeDashArray);fabric.util.drawDashedLine(b,e+c,a+d,e,a+d,this.strokeDashArray);fabric.util.drawDashedLine(b,e,a+d,e,a,this.strokeDashArray);b.closePath();b.restore()},toObject:function(b){return e(this.callSuper("toObject",b),{src:this._originalElement.src||this._originalElement._src,
filters:this.filters.map(function(b){return b&&b.toObject()}),crossOrigin:this.crossOrigin})},toSVG:function(b){var e=[];e.push('<g transform="',this.getSvgTransform(),'">','<image xlink:href="',this.getSvgSrc(),'" style="',this.getSvgStyles(),'" transform="translate('+-this.width/2+" "+-this.height/2+")",'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="none"',"></image>");if(this.stroke||this.strokeDashArray){var a=this.fill;this.fill=null;e.push("<rect ",'x="',-1*this.width/
2,'" y="',-1*this.height/2,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>');this.fill=a}e.push("</g>");return b?b(e.join("")):e.join("")},getSrc:function(){return this.getElement().src||this.getElement()._src},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(b,e){this.constructor.fromObject(this.toObject(e),b)},applyFilters:function(b){if(0===this.filters.length)this._element=this._originalElement,b&&b();else{var e=this._originalElement,
a=fabric.util.createCanvasElement(),c=fabric.util.createImage(),d=this;a.width=e.width;a.height=e.height;a.getContext("2d").drawImage(e,0,0,e.width,e.height);this.filters.forEach(function(b){b&&b.applyTo(a)});c.width=e.width;c.height=e.height;fabric.isLikelyNode?(c.src=a.toBuffer(void 0,fabric.Image.pngCompression),d._element=c,b&&b()):(c.onload=function(){d._element=c;b&&b();c.onload=a=e=null},c.src=a.toDataURL("image/png"));return this}},_render:function(b){b.drawImage(this._element,-this.width/
2,-this.height/2,this.width,this.height)},_resetWidthHeight:function(){var b=this.getElement();this.set("width",b.width);this.set("height",b.height)},_initElement:function(b){this.setElement(fabric.util.getById(b));fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(b){b||(b={});this.setOptions(b);this._setWidthHeight(b);this._element.crossOrigin=this.crossOrigin},_initFilters:function(b,e){b.filters&&b.filters.length?fabric.util.enlivenObjects(b.filters,function(a){e&&
e(a)},"fabric.Image.filters"):e&&e()},_setWidthHeight:function(b){this.width="width"in b?b.width:this.getElement().width||0;this.height="height"in b?b.height:this.getElement().height||0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(b,e){fabric.util.loadImage(b.src,function(a){fabric.Image.prototype._initFilters.call(b,b,function(c){b.filters=c||[];c=new fabric.Image(a,b);e&&e(c)})},
null,b.crossOrigin)},fabric.Image.fromURL=function(b,e,a){fabric.util.loadImage(b,function(b){e(new fabric.Image(b,a))},null,a&&a.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(["x","y","width","height","xlink:href"]),fabric.Image.fromElement=function(b,f,a){b=fabric.parseAttributes(b,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(b["xlink:href"],f,e(a?fabric.util.object.clone(a):{},b))},fabric.Image.async=!0,fabric.Image.pngCompression=1)})("undefined"!==typeof exports?
exports:this);
fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var g=this.getAngle()%360;return 0<g?90*Math.round((g-1)/90):90*Math.round(g/90)},straighten:function(){this.setAngle(this._getAngleValueForStraighten());return this},fxStraighten:function(g){g=g||{};var e=function(){},b=g.onComplete||e,f=g.onChange||e,a=this;fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(b){a.setAngle(b);f()},
onComplete:function(){a.setCoords();b()},onStart:function(){a.set("active",!1)}});return this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(g){g.straighten();this.renderAll();return this},fxStraightenObject:function(g){g.fxStraighten({onChange:this.renderAll.bind(this)});return this}});fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}});
(function(g){var e=g.fabric||(g.fabric={}),b=e.util.object.extend;e.Image.filters.Brightness=e.util.createClass(e.Image.filters.BaseFilter,{type:"Brightness",initialize:function(b){b=b||{};this.brightness=b.brightness||100},applyTo:function(b){var a=b.getContext("2d");b=a.getImageData(0,0,b.width,b.height);for(var c=b.data,d=this.brightness,e=0,g=c.length;e<g;e+=4)c[e]+=d,c[e+1]+=d,c[e+2]+=d;a.putImageData(b,0,0)},toObject:function(){return b(this.callSuper("toObject"),{brightness:this.brightness})}});
e.Image.filters.Brightness.fromObject=function(b){return new e.Image.filters.Brightness(b)}})("undefined"!==typeof exports?exports:this);
(function(g){var e=g.fabric||(g.fabric={}),b=e.util.object.extend;e.Image.filters.Convolute=e.util.createClass(e.Image.filters.BaseFilter,{type:"Convolute",initialize:function(b){b=b||{};this.opaque=b.opaque;this.matrix=b.matrix||[0,0,0,0,1,0,0,0,0];this.tmpCtx=e.util.createCanvasElement().getContext("2d")},_createImageData:function(b,a){return this.tmpCtx.createImageData(b,a)},applyTo:function(b){var a=this.matrix,c=b.getContext("2d"),d=c.getImageData(0,0,b.width,b.height);b=Math.round(Math.sqrt(a.length));
for(var e=Math.floor(b/2),g=d.data,h=d.width,d=d.height,m=this._createImageData(h,d),n=m.data,p=this.opaque?1:0,q=0;q<d;q++)for(var w=0;w<h;w++){for(var s=q,t=w,x=4*(q*h+w),A=0,v=0,u=0,r=0,z=0;z<b;z++)for(var C=0;C<b;C++){var B=s+z-e,D=t+C-e;0>B||B>d||0>D||D>h||(B=4*(B*h+D),D=a[z*b+C],A+=g[B]*D,v+=g[B+1]*D,u+=g[B+2]*D,r+=g[B+3]*D)}n[x]=A;n[x+1]=v;n[x+2]=u;n[x+3]=r+p*(255-r)}c.putImageData(m,0,0)},toObject:function(){return b(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});e.Image.filters.Convolute.fromObject=
function(b){return new e.Image.filters.Convolute(b)}})("undefined"!==typeof exports?exports:this);
(function(g){var e=g.fabric||(g.fabric={}),b=e.util.object.extend;e.Image.filters.GradientTransparency=e.util.createClass(e.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(b){b=b||{};this.threshold=b.threshold||100},applyTo:function(b){var a=b.getContext("2d");b=a.getImageData(0,0,b.width,b.height);for(var c=b.data,d=this.threshold,e=c.length,g=0,h=c.length;g<h;g+=4)c[g+3]=d+255*(e-g)/e;a.putImageData(b,0,0)},toObject:function(){return b(this.callSuper("toObject"),{threshold:this.threshold})}});
e.Image.filters.GradientTransparency.fromObject=function(b){return new e.Image.filters.GradientTransparency(b)}})("undefined"!==typeof exports?exports:this);
(function(g){var e=g.fabric||(g.fabric={});e.Image.filters.Grayscale=e.util.createClass(e.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(b){var e=b.getContext("2d");b=e.getImageData(0,0,b.width,b.height);for(var a=b.data,c=4*b.width*b.height,d=0,g;d<c;)g=(a[d]+a[d+1]+a[d+2])/3,a[d]=g,a[d+1]=g,a[d+2]=g,d+=4;e.putImageData(b,0,0)}});e.Image.filters.Grayscale.fromObject=function(){return new e.Image.filters.Grayscale}})("undefined"!==typeof exports?exports:this);
(function(g){var e=g.fabric||(g.fabric={});e.Image.filters.Invert=e.util.createClass(e.Image.filters.BaseFilter,{type:"Invert",applyTo:function(b){var e=b.getContext("2d");b=e.getImageData(0,0,b.width,b.height);var a=b.data,c=a.length,d;for(d=0;d<c;d+=4)a[d]=255-a[d],a[d+1]=255-a[d+1],a[d+2]=255-a[d+2];e.putImageData(b,0,0)}});e.Image.filters.Invert.fromObject=function(){return new e.Image.filters.Invert}})("undefined"!==typeof exports?exports:this);
(function(g){var e=g.fabric||(g.fabric={}),b=e.util.object.extend;e.Image.filters.Mask=e.util.createClass(e.Image.filters.BaseFilter,{type:"Mask",initialize:function(b){b=b||{};this.mask=b.mask;this.channel=-1<[0,1,2,3].indexOf(b.channel)?b.channel:0},applyTo:function(b){if(this.mask){var a=b.getContext("2d");b=a.getImageData(0,0,b.width,b.height);var c=b.data,d=this.mask.getElement(),g=e.util.createCanvasElement(),k=this.channel,h=4*b.width*b.height;g.width=d.width;g.height=d.height;g.getContext("2d").drawImage(d,
0,0,d.width,d.height);g=g.getContext("2d").getImageData(0,0,d.width,d.height).data;for(d=0;d<h;d+=4)c[d+3]=g[d+k];a.putImageData(b,0,0)}},toObject:function(){return b(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}});e.Image.filters.Mask.fromObject=function(b,a){e.util.loadImage(b.mask.src,function(c){b.mask=new e.Image(c,b.mask);a&&a(new e.Image.filters.Mask(b))})};e.Image.filters.Mask.async=!0})("undefined"!==typeof exports?exports:this);
(function(g){var e=g.fabric||(g.fabric={}),b=e.util.object.extend;e.Image.filters.Noise=e.util.createClass(e.Image.filters.BaseFilter,{type:"Noise",initialize:function(b){b=b||{};this.noise=b.noise||100},applyTo:function(b){var a=b.getContext("2d");b=a.getImageData(0,0,b.width,b.height);for(var c=b.data,d=this.noise,e,g=0,h=c.length;g<h;g+=4)e=(0.5-Math.random())*d,c[g]+=e,c[g+1]+=e,c[g+2]+=e;a.putImageData(b,0,0)},toObject:function(){return b(this.callSuper("toObject"),{noise:this.noise})}});e.Image.filters.Noise.fromObject=
function(b){return new e.Image.filters.Noise(b)}})("undefined"!==typeof exports?exports:this);
(function(g){var e=g.fabric||(g.fabric={}),b=e.util.object.extend;e.Image.filters.Pixelate=e.util.createClass(e.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(b){b=b||{};this.blocksize=b.blocksize||4},applyTo:function(b){var a=b.getContext("2d");b=a.getImageData(0,0,b.width,b.height);var c=b.data,d=b.height,e=b.width,g,h,m,n,p,q,w;for(h=0;h<d;h+=this.blocksize)for(m=0;m<e;m+=this.blocksize){g=4*h*e+4*m;n=c[g];p=c[g+1];q=c[g+2];w=c[g+3];for(var s=h,t=h+this.blocksize;s<t;s++)for(var x=
m,A=m+this.blocksize;x<A;x++)g=4*s*e+4*x,c[g]=n,c[g+1]=p,c[g+2]=q,c[g+3]=w}a.putImageData(b,0,0)},toObject:function(){return b(this.callSuper("toObject"),{blocksize:this.blocksize})}});e.Image.filters.Pixelate.fromObject=function(b){return new e.Image.filters.Pixelate(b)}})("undefined"!==typeof exports?exports:this);
(function(g){var e=g.fabric||(g.fabric={}),b=e.util.object.extend;e.Image.filters.RemoveWhite=e.util.createClass(e.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(b){b=b||{};this.threshold=b.threshold||30;this.distance=b.distance||20},applyTo:function(b){var a=b.getContext("2d");b=a.getImageData(0,0,b.width,b.height);for(var c=b.data,d=this.distance,e=255-this.threshold,g=Math.abs,h,m,n,p=0,q=c.length;p<q;p+=4)h=c[p],m=c[p+1],n=c[p+2],h>e&&m>e&&n>e&&g(h-m)<d&&g(h-n)<d&&g(m-n)<d&&
(c[p+3]=1);a.putImageData(b,0,0)},toObject:function(){return b(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}});e.Image.filters.RemoveWhite.fromObject=function(b){return new e.Image.filters.RemoveWhite(b)}})("undefined"!==typeof exports?exports:this);
(function(g){var e=g.fabric||(g.fabric={});e.Image.filters.Sepia=e.util.createClass(e.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(b){var e=b.getContext("2d");b=e.getImageData(0,0,b.width,b.height);var a=b.data,c=a.length,d,g;for(d=0;d<c;d+=4)g=0.3*a[d]+0.59*a[d+1]+0.11*a[d+2],a[d]=g+100,a[d+1]=g+50,a[d+2]=g+255;e.putImageData(b,0,0)}});e.Image.filters.Sepia.fromObject=function(){return new e.Image.filters.Sepia}})("undefined"!==typeof exports?exports:this);
(function(g){var e=g.fabric||(g.fabric={});e.Image.filters.Sepia2=e.util.createClass(e.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(b){var e=b.getContext("2d");b=e.getImageData(0,0,b.width,b.height);var a=b.data,c=a.length,d,g,k,h;for(d=0;d<c;d+=4)g=a[d],k=a[d+1],h=a[d+2],a[d]=(0.393*g+0.769*k+0.189*h)/1.351,a[d+1]=(0.349*g+0.686*k+0.168*h)/1.203,a[d+2]=(0.272*g+0.534*k+0.131*h)/2.14;e.putImageData(b,0,0)}});e.Image.filters.Sepia2.fromObject=function(){return new e.Image.filters.Sepia2}})("undefined"!==
typeof exports?exports:this);
(function(g){var e=g.fabric||(g.fabric={}),b=e.util.object.extend;e.Image.filters.Tint=e.util.createClass(e.Image.filters.BaseFilter,{type:"Tint",initialize:function(b){b=b||{};this.color=b.color||"#000000";this.opacity="undefined"!==typeof b.opacity?b.opacity:(new e.Color(this.color)).getAlpha()},applyTo:function(b){var a=b.getContext("2d");b=a.getImageData(0,0,b.width,b.height);var c=b.data,d=c.length,g,k,h,m,n,p,q,w;g=(new e.Color(this.color)).getSource();k=g[0]*this.opacity;h=g[1]*this.opacity;
m=g[2]*this.opacity;w=1-this.opacity;for(g=0;g<d;g+=4)n=c[g],p=c[g+1],q=c[g+2],c[g]=k+n*w,c[g+1]=h+p*w,c[g+2]=m+q*w;a.putImageData(b,0,0)},toObject:function(){return b(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}});e.Image.filters.Tint.fromObject=function(b){return new e.Image.filters.Tint(b)}})("undefined"!==typeof exports?exports:this);
(function(g){var e=g.fabric||(g.fabric={}),b=e.util.object.extend,f=e.util.object.clone,a=e.util.toFixed,c=e.StaticCanvas.supports("setLineDash");e.Text?e.warn("fabric.Text is already defined"):(g=e.Object.prototype.stateProperties.concat(),g.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","useNative","path"),e.Text=e.util.createClass(e.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,textDecoration:!0,
fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.3,textBackgroundColor:"",path:null,useNative:!0,stateProperties:g,stroke:null,shadow:null,initialize:function(a,b){b=b||{};this.text=a;this.__skipDimension=!0;this.setOptions(b);this.__skipDimension=!1;this._initDimensions();this.setCoords()},_initDimensions:function(){if(!this.__skipDimension){var a=
e.util.createCanvasElement();this._render(a.getContext("2d"))}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){var b=this.group&&"path-group"===this.group.type;b&&!this.transformMatrix?a.translate(-this.group.width/2+this.left,-this.group.height/2+this.top):b&&this.transformMatrix&&a.translate(-this.group.width/2,-this.group.height/2);"undefined"===typeof Cufon||!0===this.useNative?this._renderViaNative(a):
this._renderViaCufon(a)},_renderViaNative:function(a){var b=this.text.split(this._reNewline);this.transform(a,e.isLikelyNode);this._setTextStyles(a);this.width=this._getTextWidth(a,b);this.height=this._getTextHeight(a,b);this.clipTo&&e.util.clipContext(this,a);this._renderTextBackground(a,b);this._translateForTextAlign(a);this._renderText(a,b);"left"!==this.textAlign&&"justify"!==this.textAlign&&a.restore();this._renderTextDecoration(a,b);this.clipTo&&a.restore();this._setBoundaries(a,b);this._totalLineHeight=
0},_renderText:function(a,b){a.save();this._setShadow(a);this._renderTextFill(a,b);this._renderTextStroke(a,b);this._removeShadow(a);a.restore()},_translateForTextAlign:function(a){"left"!==this.textAlign&&"justify"!==this.textAlign&&(a.save(),a.translate("center"===this.textAlign?this.width/2:this.width,0))},_setBoundaries:function(a,b){this._boundaries=[];for(var c=0,e=b.length;c<e;c++){var f=this._getLineWidth(a,b[c]),g=this._getLineLeftOffset(f);this._boundaries.push({height:this.fontSize*this.lineHeight,
width:f,left:g})}},_setTextStyles:function(a){this._setFillStyles(a);this._setStrokeStyles(a);a.textBaseline="alphabetic";this.skipTextAlign||(a.textAlign=this.textAlign);a.font=this._getFontDeclaration()},_getTextHeight:function(a,b){return this.fontSize*b.length*this.lineHeight},_getTextWidth:function(a,b){for(var c=a.measureText(b[0]||"|").width,e=1,f=b.length;e<f;e++){var g=a.measureText(b[e]).width;g>c&&(c=g)}return c},_renderChars:function(a,b,c,e,f){b[a](c,e,f)},_renderTextLine:function(a,
b,c,e,f,g){f-=this.fontSize/4;if("justify"!==this.textAlign)this._renderChars(a,b,c,e,f,g);else{var p=b.measureText(c).width,q=this.width;if(q>p){p=c.split(/\s+/);c=b.measureText(c.replace(/\s+/g,"")).width;for(var q=(q-c)/(p.length-1),w=c=0,s=p.length;w<s;w++)this._renderChars(a,b,p[w],e+c,f,g),c+=b.measureText(p[w]).width+q}else this._renderChars(a,b,c,e,f,g)}},_getLeftOffset:function(){return e.isLikelyNode?0:-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(a,
b){if(this.fill||this._skipFillStrokeCheck){this._boundaries=[];for(var c=0,e=0,f=b.length;e<f;e++){var g=this._getHeightOfLine(a,e,b),c=c+g;this._renderTextLine("fillText",a,b[e],this._getLeftOffset(),this._getTopOffset()+c,e)}}},_renderTextStroke:function(a,b){if(this.stroke||this._skipFillStrokeCheck){var e=0;a.save();this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),c&&a.setLineDash(this.strokeDashArray));a.beginPath();
for(var f=0,g=b.length;f<g;f++){var n=this._getHeightOfLine(a,f,b),e=e+n;this._renderTextLine("strokeText",a,b[f],this._getLeftOffset(),this._getTopOffset()+e,f)}a.closePath();a.restore()}},_getHeightOfLine:function(){return this.fontSize*this.lineHeight},_renderTextBackground:function(a,b){this._renderTextBoxBackground(a);this._renderTextLinesBackground(a,b)},_renderTextBoxBackground:function(a){this.backgroundColor&&(a.save(),a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset(),
this.width,this.height),a.restore())},_renderTextLinesBackground:function(a,b){if(this.textBackgroundColor){a.save();a.fillStyle=this.textBackgroundColor;for(var c=0,e=b.length;c<e;c++)if(""!==b[c]){var f=this._getLineWidth(a,b[c]),g=this._getLineLeftOffset(f);a.fillRect(this._getLeftOffset()+g,this._getTopOffset()+c*this.fontSize*this.lineHeight,f,this.fontSize*this.lineHeight)}a.restore()}},_getLineLeftOffset:function(a){return"center"===this.textAlign?(this.width-a)/2:"right"===this.textAlign?
this.width-a:0},_getLineWidth:function(a,b){return"justify"===this.textAlign?this.width:a.measureText(b).width},_renderTextDecoration:function(a,b){function c(g){for(var k=0,q=b.length;k<q;k++){var w=f._getLineWidth(a,b[k]),s=f._getLineLeftOffset(w);a.fillRect(f._getLeftOffset()+s,~~(g+k*f._getHeightOfLine(a,k,b)-e),w,1)}}if(this.textDecoration){var e=this._getTextHeight(a,b)/2,f=this;-1<this.textDecoration.indexOf("underline")&&c(this.fontSize*this.lineHeight);-1<this.textDecoration.indexOf("line-through")&&
c(this.fontSize*this.lineHeight-this.fontSize/2);-1<this.textDecoration.indexOf("overline")&&c(this.fontSize*this.lineHeight-this.fontSize)}},_getFontDeclaration:function(){return[e.isLikelyNode?this.fontWeight:this.fontStyle,e.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",e.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,b){if(this.visible){a.save();var c=this.transformMatrix;c&&!this.group&&a.setTransform(c[0],c[1],c[2],c[3],c[4],c[5]);this._render(a);
!b&&this.active&&(this.drawBorders(a),this.drawControls(a));a.restore()}},toObject:function(a){a=b(this.callSuper("toObject",a),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,path:this.path,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative});this.includeDefaultValues||this._removeDefaultValues(a);return a},toSVG:function(a){var b=
[],c=this.text.split(this._reNewline),e=this._getSVGLeftTopOffsets(c),f=this._getSVGTextAndBg(e.lineTop,e.textLeft,c),c=this._getSVGShadows(e.lineTop,c);e.textTop+=this._fontAscent?this._fontAscent/5*this.lineHeight:0;this._wrapSVGTextAndBg(b,f,c,e);return a?a(b.join("")):b.join("")},_getSVGLeftTopOffsets:function(a){return{textLeft:-(this.width/2),textTop:this.useNative?this.fontSize-1:this.height/2-a.length*this.fontSize-this._totalLineHeight,lineTop:this.useNative?this.fontSize*this.lineHeight:
-this._fontAscent-this._fontAscent/5*this.lineHeight}},_wrapSVGTextAndBg:function(b,c,e,f){b.push('<g transform="',this.getSvgTransform(),'">',c.textBgRects.join(""),"<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),
'" ','transform="translate(',a(f.textLeft,2)," ",a(f.textTop,2),')">',e.join(""),c.textSpans.join(""),"</text>","</g>")},_getSVGShadows:function(b,c){var f=[],g,m,n=1;if(!this.shadow||!this._boundaries)return f;g=0;for(m=c.length;g<m;g++)""!==c[g]?(f.push('<tspan x="',a((this._boundaries&&this._boundaries[g]?this._boundaries[g].left:0)+n+this.shadow.offsetX,2),0===g||this.useNative?'" y':'" dy','="',a(this.useNative?b*g-this.height/2+this.shadow.offsetY:b+(0===g?this.shadow.offsetY:0),2),'" ',this._getFillAttributes(this.shadow.color),
">",e.util.string.escapeXml(c[g]),"</tspan>"),n=1):n++;return f},_getSVGTextAndBg:function(a,b,c){var e=[],f=[],g=1;this._setSVGBg(f);for(var p=0,q=c.length;p<q;p++)""!==c[p]?(this._setSVGTextLineText(c[p],p,e,a,g,f),g=1):g++,this.textBackgroundColor&&this._boundaries&&this._setSVGTextLineBg(f,p,b,a);return{textSpans:e,textBgRects:f}},_setSVGTextLineText:function(b,c,f,g,m){var n=this._boundaries&&this._boundaries[c]?a(this._boundaries[c].left,2):0;f.push('<tspan x="',n,'" ',0===c||this.useNative?
"y":"dy",'="',a(this.useNative?g*c-this.height/2:g*m,2),'" ',this._getFillAttributes(this.fill),">",e.util.string.escapeXml(b),"</tspan>")},_setSVGTextLineBg:function(b,c,e,f){b.push("<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',a(e+this._boundaries[c].left,2),'" y="',a(f*c-this.height/2,2),'" width="',a(this._boundaries[c].width,2),'" height="',a(this._boundaries[c].height,2),'"></rect>')},_setSVGBg:function(b){this.backgroundColor&&this._boundaries&&b.push("<rect ",this._getFillAttributes(this.backgroundColor),
' x="',a(-this.width/2,2),'" y="',a(-this.height/2,2),'" width="',a(this.width,2),'" height="',a(this.height,2),'"></rect>')},_getFillAttributes:function(a){var b=a&&"string"===typeof a?new e.Color(a):"";return b&&b.getSource()&&1!==b.getAlpha()?'opacity="'+b.getAlpha()+'" fill="'+b.setAlpha(1).toRgb()+'"':'fill="'+a+'"'},_set:function(a,b){"fontFamily"===a&&this.path&&(this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+b+"$3"));this.callSuper("_set",a,b);a in this._dimensionAffectingProps&&
(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),e.Text.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y font-family font-style font-weight font-size text-decoration".split(" ")),e.Text.fromElement=function(a,b){if(!a)return null;var c=e.parseAttributes(a,e.Text.ATTRIBUTE_NAMES);b=e.util.object.extend(b?e.util.object.clone(b):{},c);c=new e.Text(a.textContent,b);c.set({left:c.getLeft()+c.getWidth()/2,top:c.getTop()-c.getHeight()/2});return c},e.Text.fromObject=function(a){return new e.Text(a.text,
f(a))},e.util.createAccessors(e.Text))})("undefined"!==typeof exports?exports:this);
fabric.util.object.extend(fabric.Text.prototype,{_renderViaCufon:function(g){var e=Cufon.textOptions||(Cufon.textOptions={});e.left=this.left;e.top=this.top;e.context=g;e.color=this.fill;var b=this._initDummyElementForCufon();this.transform(g);Cufon.replaceElement(b,{engine:"canvas",separate:"none",fontFamily:this.fontFamily,fontWeight:this.fontWeight,textDecoration:this.textDecoration,textShadow:this.shadow&&this.shadow.toString(),textAlign:this.textAlign,fontStyle:this.fontStyle,lineHeight:this.lineHeight,
stroke:this.stroke,strokeWidth:this.strokeWidth,backgroundColor:this.backgroundColor,textBackgroundColor:this.textBackgroundColor});this.width=e.width;this.height=e.height;this._totalLineHeight=e.totalLineHeight;this._fontAscent=e.fontAscent;this._boundaries=e.boundaries;this.setCoords()},_initDummyElementForCufon:function(){var g=fabric.document.createElement("pre");fabric.document.createElement("div").appendChild(g);"undefined"===typeof G_vmlCanvasManager?g.innerHTML=this.text:g.innerText=this.text.replace(/\r?\n/gi,
"\r");g.style.fontSize=this.fontSize+"px";g.style.letterSpacing="normal";return g}});
(function(){var g=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1E3,cursorDuration:600,styles:null,caching:!0,_skipFillStrokeCheck:!0,_reSpace:/\s|\n/,_fontSizeFraction:4,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},
initialize:function(e,b){this.styles=b?b.styles||{}:{};this.callSuper("initialize",e,b);this.initBehavior();fabric.IText.instances.push(this);this.__lineWidths={};this.__lineHeights={};this.__lineOffsets={}},isEmptyStyles:function(){if(!this.styles)return!0;var e=this.styles,b;for(b in e)for(var f in e[b])for(var a in e[b][f])return!1;return!0},setSelectionStart:function(e){this.selectionStart=e;this.hiddenTextarea&&(this.hiddenTextarea.selectionStart=e)},setSelectionEnd:function(e){this.selectionEnd=
e;this.hiddenTextarea&&(this.hiddenTextarea.selectionEnd=e)},getSelectionStyles:function(e,b){if(2===arguments.length){for(var f=[],a=e;a<b;a++)f.push(this.getSelectionStyles(a));return f}f=this.get2DCursorLocation(e);return this.styles[f.lineIndex]?this.styles[f.lineIndex][f.charIndex]||{}:{}},setSelectionStyles:function(e){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,e);else for(var b=this.selectionStart;b<this.selectionEnd;b++)this._extendStyles(b,e);return this},
_extendStyles:function(e,b){var f=this.get2DCursorLocation(e);this.styles[f.lineIndex]||(this.styles[f.lineIndex]={});this.styles[f.lineIndex][f.charIndex]||(this.styles[f.lineIndex][f.charIndex]={});fabric.util.object.extend(this.styles[f.lineIndex][f.charIndex],b)},_render:function(e){this.callSuper("_render",e);this.ctx=e;this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(this.active){var e=this.text.split(""),b;this.selectionStart===this.selectionEnd?(b=this._getCursorBoundaries(e,
"cursor"),this.renderCursor(b)):(b=this._getCursorBoundaries(e,"selection"),this.renderSelection(e,b))}},get2DCursorLocation:function(e){"undefined"===typeof e&&(e=this.selectionStart);e=this.text.slice(0,e).split(this._reNewline);return{lineIndex:e.length-1,charIndex:e[e.length-1].length}},getCurrentCharFontSize:function(e,b){return this.styles[e]&&this.styles[e][0===b?0:b-1]&&this.styles[e][0===b?0:b-1].fontSize||this.fontSize},getCurrentCharColor:function(e,b){return this.styles[e]&&this.styles[e][0===
b?0:b-1]&&this.styles[e][0===b?0:b-1].fill||this.cursorColor},_getCursorBoundaries:function(e,b){var f=this.get2DCursorLocation(),a=this.text.split(this._reNewline),c=Math.round(this._getLeftOffset()),d=-this.height/2,f=this._getCursorBoundariesOffsets(e,b,f,a);return{left:c,top:d,leftOffset:f.left+f.lineLeft,topOffset:f.top}},_getCursorBoundariesOffsets:function(e,b,f,a){var c=0,d=0,g=0,k=0;f="cursor"===b?this._getHeightOfLine(this.ctx,0)-this.getCurrentCharFontSize(f.lineIndex,f.charIndex):0;for(var h=
0;h<this.selectionStart;h++)"\n"===e[h]?(k=0,f+=this._getCachedLineHeight(d+("cursor"===b?1:0)),d++,g=0):(k+=this._getWidthOfChar(this.ctx,e[h],d,g),g++),c=this._getCachedLineOffset(d,a);this._clearCache();return{top:f,left:k,lineLeft:c}},_clearCache:function(){this.__lineWidths={};this.__lineHeights={};this.__lineOffsets={}},_getCachedLineHeight:function(e){return this.__lineHeights[e]||(this.__lineHeights[e]=this._getHeightOfLine(this.ctx,e))},_getCachedLineWidth:function(e,b){return this.__lineWidths[e]||
(this.__lineWidths[e]=this._getWidthOfLine(this.ctx,e,b))},_getCachedLineOffset:function(e,b){var f=this._getCachedLineWidth(e,b);return this.__lineOffsets[e]||(this.__lineOffsets[e]=this._getLineLeftOffset(f))},renderCursor:function(e){var b=this.ctx;b.save();var f=this.get2DCursorLocation(),a=f.lineIndex,f=f.charIndex,c=this.getCurrentCharFontSize(a,f);b.fillStyle=this.getCurrentCharColor(a,f);b.globalAlpha=this._currentCursorOpacity;b.fillRect(e.left+e.leftOffset,e.top+e.topOffset,this.cursorWidth/
this.scaleX,c);b.restore()},renderSelection:function(e,b){var f=this.ctx;f.save();f.fillStyle=this.selectionColor;for(var a=this.get2DCursorLocation(),c=a.lineIndex,a=a.charIndex,d=this.text.split(this._reNewline),g=c,k=this.selectionStart;k<this.selectionEnd;k++)if("\n"===e[k])b.leftOffset=0,b.topOffset+=this._getHeightOfLine(f,c),c++,a=0;else if(k!==this.text.length){var h=this._getWidthOfChar(f,e[k],c,a),m=this._getLineLeftOffset(this._getWidthOfLine(f,c,d))||0;c===g&&(m=0);f.fillRect(b.left+b.leftOffset+
m,b.top+b.topOffset,h,this._getHeightOfLine(f,c));b.leftOffset+=h;a++}f.restore()},_renderChars:function(e,b,f,a,c,d){if(this.isEmptyStyles())return this._renderCharsFast(e,b,f,a,c);this.skipTextAlign=!0;a-="center"===this.textAlign?this.width/2:"right"===this.textAlign?this.width:0;var g=this.text.split(this._reNewline),k=this._getWidthOfLine(b,d,g),g=this._getHeightOfLine(b,d,g),k=this._getLineLeftOffset(k);f=f.split("");a+=k||0;b.save();for(var k=0,h=f.length;k<h;k++)this._renderChar(e,b,d,k,f[k],
a,c,g);b.restore()},_renderCharsFast:function(e,b,f,a,c){this.skipTextAlign=!1;"fillText"===e&&this.fill&&this.callSuper("_renderChars",e,b,f,a,c);"strokeText"===e&&this.stroke&&this.callSuper("_renderChars",e,b,f,a,c)},_renderChar:function(e,b,f,a,c,d,g,k){var h;if(this.styles&&this.styles[f]&&(h=this.styles[f][a])){var m=h.stroke||this.stroke,n=h.fill||this.fill;b.save();e=this._applyCharStylesGetWidth(b,c,f,a,h);f=this._getHeightOfChar(b,c,f,a);n&&b.fillText(c,d,g);m&&b.strokeText(c,d,g);this._renderCharDecoration(b,
h,d,g,e,k,f);b.restore();b.translate(e,0)}else{if("strokeText"===e&&this.stroke)b[e](c,d,g);if("fillText"===e&&this.fill)b[e](c,d,g);e=this._applyCharStylesGetWidth(b,c,f,a);this._renderCharDecoration(b,null,d,g,e,k);b.translate(b.measureText(c).width,0)}},_renderCharDecoration:function(e,b,f,a,c,d,g){var k=b?b.textDecoration||this.textDecoration:this.textDecoration;b=(b?b.fontSize:null)||this.fontSize;k&&(-1<k.indexOf("underline")&&this._renderCharDecorationAtOffset(e,f,a+this.fontSize/this._fontSizeFraction,
c,0,this.fontSize/20),-1<k.indexOf("line-through")&&this._renderCharDecorationAtOffset(e,f,a+this.fontSize/this._fontSizeFraction,c,g/2,b/20),-1<k.indexOf("overline")&&this._renderCharDecorationAtOffset(e,f,a,c,d-this.fontSize/this._fontSizeFraction,this.fontSize/20))},_renderCharDecorationAtOffset:function(e,b,f,a,c,d){e.fillRect(b,f-c,a,d)},_renderTextLine:function(e,b,f,a,c,d){c+=this.fontSize/4;this.callSuper("_renderTextLine",e,b,f,a,c,d)},_renderTextDecoration:function(e,b){if(this.isEmptyStyles())return this.callSuper("_renderTextDecoration",
e,b)},_renderTextLinesBackground:function(e,b){if(this.textBackgroundColor||this.styles){e.save();this.textBackgroundColor&&(e.fillStyle=this.textBackgroundColor);for(var f=0,a=this.fontSize/this._fontSizeFraction,c=0,d=b.length;c<d;c++){var g=this._getHeightOfLine(e,c,b);if(""!==b[c]){var k=this._getWidthOfLine(e,c,b),h=this._getLineLeftOffset(k);this.textBackgroundColor&&(e.fillStyle=this.textBackgroundColor,e.fillRect(this._getLeftOffset()+h,this._getTopOffset()+f+a,k,g));if(this.styles[c])for(var k=
0,m=b[c].length;k<m;k++)if(this.styles[c]&&this.styles[c][k]&&this.styles[c][k].textBackgroundColor){var n=b[c][k];e.fillStyle=this.styles[c][k].textBackgroundColor;e.fillRect(this._getLeftOffset()+h+this._getWidthOfCharsAt(e,c,k,b),this._getTopOffset()+f+a,this._getWidthOfChar(e,n,c,k,b)+1,g)}}f+=g}e.restore()}},_getCacheProp:function(e,b){return e+b.fontFamily+b.fontSize+b.fontWeight+b.fontStyle+b.shadow},_applyCharStylesGetWidth:function(e,b,f,a,c){f=(f=c||this.styles[f]&&this.styles[f][a])?g(f):
{};this._applyFontStyles(f);a=this._getCacheProp(b,f);if(this.isEmptyStyles()&&this._charWidthsCache[a]&&this.caching)return this._charWidthsCache[a];"string"===typeof f.shadow&&(f.shadow=new fabric.Shadow(f.shadow));c=f.fill||this.fill;e.fillStyle=c.toLive?c.toLive(e):c;f.stroke&&(e.strokeStyle=f.stroke&&f.stroke.toLive?f.stroke.toLive(e):f.stroke);e.lineWidth=f.strokeWidth||this.strokeWidth;e.font=this._getFontDeclaration.call(f);this._setShadow.call(f,e);if(!this.caching)return e.measureText(b).width;
this._charWidthsCache[a]||(this._charWidthsCache[a]=e.measureText(b).width);return this._charWidthsCache[a]},_applyFontStyles:function(e){e.fontFamily||(e.fontFamily=this.fontFamily);e.fontSize||(e.fontSize=this.fontSize);e.fontWeight||(e.fontWeight=this.fontWeight);e.fontStyle||(e.fontStyle=this.fontStyle)},_getWidthOfChar:function(e,b,f,a){e.save();b=this._applyCharStylesGetWidth(e,b,f,a);e.restore();return b},_getHeightOfChar:function(e,b,f,a){return this.styles[f]&&this.styles[f][a]?this.styles[f][a].fontSize||
this.fontSize:this.fontSize},_getWidthOfCharAt:function(e,b,f,a){a=a||this.text.split(this._reNewline);a=a[b].split("")[f];return this._getWidthOfChar(e,a,b,f)},_getHeightOfCharAt:function(e,b,f,a){a=a||this.text.split(this._reNewline);a=a[b].split("")[f];return this._getHeightOfChar(e,a,b,f)},_getWidthOfCharsAt:function(e,b,f,a){for(var c=0,d=0;d<f;d++)c+=this._getWidthOfCharAt(e,b,d,a);return c},_getWidthOfLine:function(e,b,f){return this._getWidthOfCharsAt(e,b,f[b].length,f)},_getTextWidth:function(e,
b){if(this.isEmptyStyles())return this.callSuper("_getTextWidth",e,b);for(var f=this._getWidthOfLine(e,0,b),a=1,c=b.length;a<c;a++){var d=this._getWidthOfLine(e,a,b);d>f&&(f=d)}return f},_getHeightOfLine:function(e,b,f){f=f||this.text.split(this._reNewline);var a=this._getHeightOfChar(e,f[b][0],b,0);f=f[b].split("");for(var c=1,d=f.length;c<d;c++){var g=this._getHeightOfChar(e,f[c],b,c);g>a&&(a=g)}return a*this.lineHeight},_getTextHeight:function(e,b){for(var f=0,a=0,c=b.length;a<c;a++)f+=this._getHeightOfLine(e,
a,b);return f},_getTopOffset:function(){return fabric.Text.prototype._getTopOffset.call(this)-this.fontSize/this._fontSizeFraction},_renderTextBoxBackground:function(e){this.backgroundColor&&(e.save(),e.fillStyle=this.backgroundColor,e.fillRect(this._getLeftOffset(),this._getTopOffset()+this.fontSize/this._fontSizeFraction,this.width,this.height),e.restore())},toObject:function(e){return fabric.util.object.extend(this.callSuper("toObject",e),{styles:g(this.styles)})}});fabric.IText.fromObject=function(e){return new fabric.IText(e.text,
g(e))};fabric.IText.instances=[]})();
(function(){var g=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initKeyHandlers();this.initCursorSelectionHandlers();this.initDoubleClickSimulation();this.initHiddenTextarea()},initSelectedHandler:function(){this.on("selected",function(){var e=this;setTimeout(function(){e.selected=!0},100);this._hasCanvasHandlers||(this._initCanvasHandlers(),this._hasCanvasHandlers=!0)})},_initCanvasHandlers:function(){var e=this;this.canvas.on("selection:cleared",
function(b){b.e&&e.canvas.containsPoint(b.e,e)||e.exitEditing()});this.canvas.on("mouse:up",function(){this.getObjects("i-text").forEach(function(b){b.__isMousedown=!1})});this.canvas.on("object:selected",function(){fabric.IText.prototype.exitEditingOnOthers.call(e)})},_tick:function(){var e=this;this._abortCursorAnimation||this.animate("_currentCursorOpacity",1,{duration:this.cursorDuration,onComplete:function(){e._onTickComplete()},onChange:function(){e.canvas&&e.canvas.renderAll()},abort:function(){return e._abortCursorAnimation}})},
_onTickComplete:function(){if(!this._abortCursorAnimation){var e=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1);this._cursorTimeout1=setTimeout(function(){e.animate("_currentCursorOpacity",0,{duration:this.cursorDuration/2,onComplete:function(){e._tick()},onChange:function(){e.canvas&&e.canvas.renderAll()},abort:function(){return e._abortCursorAnimation}})},100)}},initDelayedCursor:function(){var e=this;this._cursorTimeout2&&clearTimeout(this._cursorTimeout2);this._cursorTimeout2=setTimeout(function(){e._abortCursorAnimation=
!1;e._tick()},this.cursorDelay)},abortCursorAnimation:function(){this._abortCursorAnimation=!0;clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=0;this.canvas&&this.canvas.renderAll();var e=this;setTimeout(function(){e._abortCursorAnimation=!1},10)},selectAll:function(){this.selectionStart=0;this.selectionEnd=this.text.length},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(e){var b=
0,f=e-1;if(this._reSpace.test(this.text.charAt(f)))for(;this._reSpace.test(this.text.charAt(f));)b++,f--;for(;/\S/.test(this.text.charAt(f))&&-1<f;)b++,f--;return e-b},findWordBoundaryRight:function(e){var b=0,f=e;if(this._reSpace.test(this.text.charAt(f)))for(;this._reSpace.test(this.text.charAt(f));)b++,f++;for(;/\S/.test(this.text.charAt(f))&&f<this.text.length;)b++,f++;return e+b},findLineBoundaryLeft:function(e){for(var b=0,f=e-1;!/\n/.test(this.text.charAt(f))&&-1<f;)b++,f--;return e-b},findLineBoundaryRight:function(e){for(var b=
0,f=e;!/\n/.test(this.text.charAt(f))&&f<this.text.length;)b++,f++;return e+b},getNumNewLinesInSelectedText:function(){for(var e=0,b=0,f=this.getSelectedText().split(""),a=f.length;b<a;b++)"\n"===f[b]&&e++;return e},searchWordBoundary:function(e,b){for(var f=e,a=this.text.charAt(f),c=/[ \n\.,;!\?\-]/;!c.test(a)&&0<f&&f<this.text.length;)f+=b,a=this.text.charAt(f);c.test(a)&&"\n"!==a&&(f+=1===b?0:1);return f},selectWord:function(e){var b=this.searchWordBoundary(e,-1);e=this.searchWordBoundary(e,1);
this.setSelectionStart(b);this.setSelectionEnd(e)},selectLine:function(e){var b=this.findLineBoundaryLeft(e);e=this.findLineBoundaryRight(e);this.setSelectionStart(b);this.setSelectionEnd(e)},enterEditing:function(){if(!this.isEditing&&this.editable)return this.exitEditingOnOthers(),this.isEditing=!0,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.canvas&&this.canvas.renderAll(),this.fire("editing:entered"),this.canvas&&this.canvas.fire("text:editing:entered",
{target:this}),this},exitEditingOnOthers:function(){fabric.IText.instances.forEach(function(e){e!==this&&e.exitEditing()},this)},_setEditingProps:function(){this.hoverCursor="text";this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text");this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=!1;this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){this.hiddenTextarea&&(this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,
this.hiddenTextarea.focus())},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,
this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){this.isEditing=this.selected=!1;this.selectable=!0;this.selectionEnd=this.selectionStart;this.hiddenTextarea&&this.hiddenTextarea.blur();this.abortCursorAnimation();this._restoreEditingProps();this._currentCursorOpacity=0;this.fire("editing:exited");this.canvas&&
this.canvas.fire("text:editing:exited",{target:this});return this},_removeExtraneousStyles:function(){var e=this.text.split(this._reNewline),b;for(b in this.styles)e[b]||delete this.styles[b]},_removeCharsFromTo:function(e,b){for(var f=b;f!==e;){var a=this.get2DCursorLocation(f).charIndex;f--;(a=this.get2DCursorLocation(f).charIndex>a)?this.removeStyleObject(a,f+1):this.removeStyleObject(0===this.get2DCursorLocation(f).charIndex,f)}this.text=this.text.slice(0,e)+this.text.slice(b)},insertChars:function(e){var b=
"\n"===this.text.slice(this.selectionStart,this.selectionStart+1);this.text=this.text.slice(0,this.selectionStart)+e+this.text.slice(this.selectionEnd);this.selectionStart===this.selectionEnd?this.insertStyleObjects(e,b,this.copiedStyles):1<this.selectionEnd-this.selectionStart&&console.log("replacing MORE than 1 char");this.selectionEnd=this.selectionStart+=e.length;this.canvas&&this.canvas.renderAll().renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",
{target:this})},insertNewlineStyleObject:function(e,b,f){this.shiftLineStyles(e,1);this.styles[e+1]||(this.styles[e+1]={});var a=this.styles[e][b-1],c={};if(f)c[0]=g(a);else for(var d in this.styles[e])parseInt(d,10)>=b&&(c[parseInt(d,10)-b]=this.styles[e][d],delete this.styles[e][d]);this.styles[e+1]=c},insertCharStyleObject:function(e,b,f){var a=this.styles[e],c=g(a);0!==b||f||(b=1);for(var d in c){var l=parseInt(d,10);l>=b&&(a[l+1]=c[l])}this.styles[e][b]=f||g(a[b-1])},insertStyleObjects:function(e,
b,f){if(!this.isEmptyStyles()){var a=this.get2DCursorLocation(),c=a.lineIndex,a=a.charIndex;this.styles[c]||(this.styles[c]={});"\n"===e?this.insertNewlineStyleObject(c,a,b):f?this._insertStyles(f):this.insertCharStyleObject(c,a)}},_insertStyles:function(e){for(var b=0,f=e.length;b<f;b++){var a=this.get2DCursorLocation(this.selectionStart+b);this.insertCharStyleObject(a.lineIndex,a.charIndex,e[b])}},shiftLineStyles:function(e,b){var f=g(this.styles),a;for(a in this.styles){var c=parseInt(a,10);c>
e&&(this.styles[c+b]=f[c])}},removeStyleObject:function(e,b){var f=this.get2DCursorLocation(b),a=f.lineIndex,f=f.charIndex;if(e){var c=this.text.split(this._reNewline)[a-1],c=c?c.length:0;this.styles[a-1]||(this.styles[a-1]={});for(f in this.styles[a])this.styles[a-1][parseInt(f,10)+c]=this.styles[a][f];this.shiftLineStyles(a,-1)}else{(a=this.styles[a])&&delete a[f+(this.selectionStart===this.selectionEnd?-1:0)];var d=g(a);for(c in d){var l=parseInt(c,10);l>=f&&0!==l&&(a[l-1]=d[l],delete a[l])}}},
insertNewline:function(){this.insertChars("\n")}})})();
fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date;this.__lastLastClickTime=+new Date;this.lastPointer={};this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(g){this.__newClickTime=+new Date;var e=this.canvas.getPointer(g.e);this.isTripleClick(e)?(this.fire("tripleclick",g),this._stopEvent(g.e)):this.isDoubleClick(e)&&(this.fire("dblclick",g),this._stopEvent(g.e));this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=
this.__newClickTime;this.__lastPointer=e},isDoubleClick:function(g){return 500>this.__newClickTime-this.__lastClickTime&&this.__lastPointer.x===g.x&&this.__lastPointer.y===g.y},isTripleClick:function(g){return 500>this.__newClickTime-this.__lastClickTime&&500>this.__lastClickTime-this.__lastLastClickTime&&this.__lastPointer.x===g.x&&this.__lastPointer.y===g.y},_stopEvent:function(g){g.preventDefault&&g.preventDefault();g.stopPropagation&&g.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler();
this.initMousedownHandler();this.initMousemoveHandler();this.initMouseupHandler();this.initClicks()},initClicks:function(){this.on("dblclick",function(g){this.selectWord(this.getSelectionStartFromPointer(g.e))});this.on("tripleclick",function(g){this.selectLine(this.getSelectionStartFromPointer(g.e))})},initMousedownHandler:function(){this.on("mousedown",function(g){var e=this.canvas.getPointer(g.e);this.__mousedownX=e.x;this.__mousedownY=e.y;this.__isMousedown=!0;this.hiddenTextarea&&this.canvas&&
this.canvas.wrapperEl.appendChild(this.hiddenTextarea);this.isEditing&&(this.setCursorByClick(g.e),this.__selectionStartOnMouseDown=this.selectionStart)})},initMousemoveHandler:function(){this.on("mousemove",function(g){this.__isMousedown&&this.isEditing&&(g=this.getSelectionStartFromPointer(g.e),g>=this.__selectionStartOnMouseDown?(this.setSelectionStart(this.__selectionStartOnMouseDown),this.setSelectionEnd(g)):(this.setSelectionStart(g),this.setSelectionEnd(this.__selectionStartOnMouseDown)))})},
_isObjectMoved:function(g){g=this.canvas.getPointer(g);return this.__mousedownX!==g.x||this.__mousedownY!==g.y},initMouseupHandler:function(){this.on("mouseup",function(g){this.__isMousedown=!1;this._isObjectMoved(g.e)||this.selected&&this.enterEditing()})},setCursorByClick:function(g){var e=this.getSelectionStartFromPointer(g);g.shiftKey?e<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(e)):this.setSelectionEnd(e):(this.setSelectionStart(e),this.setSelectionEnd(e))},
_getLocalRotatedPointer:function(g){var e=this.canvas.getPointer(g),e=new fabric.Point(e.x,e.y),b=new fabric.Point(this.left,this.top),e=fabric.util.rotatePoint(e,b,fabric.util.degreesToRadians(-this.angle));return this.getLocalPointer(g,e)},getSelectionStartFromPointer:function(g){g=this._getLocalRotatedPointer(g);for(var e=this.text.split(this._reNewline),b=0,f=0,a=0,c=0,d=0,l=e.length;d<l;d++){a+=this._getHeightOfLine(this.ctx,d)*this.scaleY;b=this._getWidthOfLine(this.ctx,d,e);f=this._getLineLeftOffset(b);
this.flipX&&(e[d]=e[d].split("").reverse().join(""));for(var k=0,h=e[d].length;k<h;k++){var m=e[d][k],b=f,f=f+this._getWidthOfChar(this.ctx,m,d,this.flipX?h-k:k)*this.scaleX;if(a<=g.y||f<=g.x)c++;else return this._getNewSelectionStartFromOffset(g,b,f,c+d,h)}}return this.text.length},_getNewSelectionStartFromOffset:function(g,e,b,f,a){g=f+(b-g.x>g.x-e?0:1);this.flipX&&(g=a-g);g>this.text.length&&(g=this.text.length);return g}});
fabric.util.object.extend(fabric.IText.prototype,{initKeyHandlers:function(){fabric.util.addListener(fabric.document,"keydown",this.onKeyDown.bind(this));fabric.util.addListener(fabric.document,"keypress",this.onKeyPress.bind(this))},initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.style.cssText="position: absolute; top: 0; left: -9999px";fabric.document.body.appendChild(this.hiddenTextarea)},
_keysMap:{8:"removeChars",13:"insertNewline",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",67:"copy",86:"paste",88:"cut"},onKeyDown:function(g){if(this.isEditing){if(g.keyCode in this._keysMap)this[this._keysMap[g.keyCode]](g);else if(g.keyCode in this._ctrlKeysMap&&(g.ctrlKey||g.metaKey))this[this._ctrlKeysMap[g.keyCode]](g);else return;g.preventDefault();g.stopPropagation();this.canvas&&this.canvas.renderAll()}},forwardDelete:function(g){this.selectionStart===
this.selectionEnd&&this.moveCursorRight(g);this.removeChars(g)},copy:function(){this.copiedText=this.getSelectedText();this.copiedStyles=this.getSelectionStyles(this.selectionStart,this.selectionEnd)},paste:function(){this.copiedText&&this.insertChars(this.copiedText)},cut:function(g){this.copy();this.removeChars(g)},onKeyPress:function(g){!this.isEditing||g.metaKey||g.ctrlKey||8===g.keyCode||13===g.keyCode||(this.insertChars(String.fromCharCode(g.which)),g.preventDefault(),g.stopPropagation())},
getDownCursorOffset:function(g,e){var b=e?this.selectionEnd:this.selectionStart,f=this.text.split(this._reNewline),a=this.text.slice(0,b),c=this.text.slice(b),d=a.slice(a.lastIndexOf("\n")+1),a=c.match(/(.*)\n?/)[1],c=(c.match(/.*\n(.*)\n?/)||{})[1]||"",l=this.get2DCursorLocation(b);if(l.lineIndex===f.length-1||g.metaKey)return this.text.length-b;for(var b=this._getWidthOfLine(this.ctx,l.lineIndex,f),k=this._getLineLeftOffset(b),h=l.lineIndex,m=0,n=d.length;m<n;m++)b=d[m],k+=this._getWidthOfChar(this.ctx,
b,h,m);f=this._getIndexOnNextLine(l,c,k,f);return a.length+1+f},_getIndexOnNextLine:function(g,e,b,f){g=g.lineIndex+1;f=this._getWidthOfLine(this.ctx,g,f);var a=this._getLineLeftOffset(f),c=0,d;f=0;for(var l=e.length;f<l;f++){var k=this._getWidthOfChar(this.ctx,e[f],g,f),a=a+k;if(a>b){d=!0;g=a;a=Math.abs(a-k-b);c=Math.abs(g-b)<a?f+1:f;break}}d||(c=e.length);return c},moveCursorDown:function(g){this.abortCursorAnimation();this._currentCursorOpacity=1;var e=this.getDownCursorOffset(g,"right"===this._selectionDirection);
g.shiftKey?this.moveCursorDownWithShift(e):this.moveCursorDownWithoutShift(e);this.initDelayedCursor()},moveCursorDownWithoutShift:function(g){this._selectionDirection="right";this.selectionStart+=g;this.selectionStart>this.text.length&&(this.selectionStart=this.text.length);this.selectionEnd=this.selectionStart},moveCursorDownWithShift:function(g){"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?(this.selectionStart+=g,this._selectionDirection="left"):(this._selectionDirection=
"right",this.selectionEnd+=g,this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length))},getUpCursorOffset:function(g,e){var b=e?this.selectionEnd:this.selectionStart,f=this.get2DCursorLocation(b);if(0===f.lineIndex||g.metaKey)return b;var a=this.text.slice(0,b),b=a.slice(a.lastIndexOf("\n")+1),a=(a.match(/\n?(.*)\n.*$/)||{})[1]||"",c=this.text.split(this._reNewline),d;d=this._getWidthOfLine(this.ctx,f.lineIndex,c);for(var l=this._getLineLeftOffset(d),k=f.lineIndex,h=0,m=b.length;h<
m;h++)d=b[h],l+=this._getWidthOfChar(this.ctx,d,k,h);f=this._getIndexOnPrevLine(f,a,l,c);return a.length-f+b.length},_getIndexOnPrevLine:function(g,e,b,f){g=g.lineIndex-1;f=this._getWidthOfLine(this.ctx,g,f);var a=this._getLineLeftOffset(f),c=0,d;f=0;for(var l=e.length;f<l;f++){var k=this._getWidthOfChar(this.ctx,e[f],g,f),a=a+k;if(a>b){d=!0;g=a;a=Math.abs(a-k-b);c=Math.abs(g-b)<a?f:f-1;break}}d||(c=e.length-1);return c},moveCursorUp:function(g){this.abortCursorAnimation();this._currentCursorOpacity=
1;var e=this.getUpCursorOffset(g,"right"===this._selectionDirection);g.shiftKey?this.moveCursorUpWithShift(e):this.moveCursorUpWithoutShift(e);this.initDelayedCursor()},moveCursorUpWithShift:function(g){this.selectionStart!==this.selectionEnd&&"right"===this._selectionDirection?(this.selectionEnd-=g,this._selectionDirection="right"):(this.selectionStart-=g,0>this.selectionStart&&(this.selectionStart=0),this._selectionDirection="left")},moveCursorUpWithoutShift:function(g){this.selectionStart===this.selectionEnd&&
(this.selectionStart-=g);0>this.selectionStart&&(this.selectionStart=0);this.selectionEnd=this.selectionStart;this._selectionDirection="left"},moveCursorLeft:function(g){if(0!==this.selectionStart||0!==this.selectionEnd)this.abortCursorAnimation(),this._currentCursorOpacity=1,g.shiftKey?this.moveCursorLeftWithShift(g):this.moveCursorLeftWithoutShift(g),this.initDelayedCursor()},_move:function(g,e,b){this[e]=g.altKey?this["findWordBoundary"+b](this[e]):g.metaKey?this["findLineBoundary"+b](this[e]):
this[e]+("Left"===b?-1:1)},_moveLeft:function(g,e){this._move(g,e,"Left")},_moveRight:function(g,e){this._move(g,e,"Right")},moveCursorLeftWithoutShift:function(g){this._selectionDirection="left";this.selectionEnd===this.selectionStart&&this._moveLeft(g,"selectionStart");this.selectionEnd=this.selectionStart},moveCursorLeftWithShift:function(g){"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(g,"selectionEnd"):(this._selectionDirection="left",this._moveLeft(g,
"selectionStart"),"\n"===this.text.charAt(this.selectionStart)&&this.selectionStart--,0>this.selectionStart&&(this.selectionStart=0))},moveCursorRight:function(g){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||(this.abortCursorAnimation(),this._currentCursorOpacity=1,g.shiftKey?this.moveCursorRightWithShift(g):this.moveCursorRightWithoutShift(g),this.initDelayedCursor())},moveCursorRightWithShift:function(g){"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?
this._moveRight(g,"selectionStart"):(this._selectionDirection="right",this._moveRight(g,"selectionEnd"),"\n"===this.text.charAt(this.selectionEnd-1)&&this.selectionEnd++,this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length))},moveCursorRightWithoutShift:function(g){this._selectionDirection="right";this.selectionStart===this.selectionEnd?(this._moveRight(g,"selectionStart"),this.selectionEnd=this.selectionStart):(this.selectionEnd+=this.getNumNewLinesInSelectedText(),this.selectionEnd>
this.text.length&&(this.selectionEnd=this.text.length),this.selectionStart=this.selectionEnd)},removeChars:function(g){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(g):this._removeCharsFromTo(this.selectionStart,this.selectionEnd);this.selectionEnd=this.selectionStart;this._removeExtraneousStyles();this.canvas&&this.canvas.renderAll().renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(g){0!==
this.selectionStart&&(g.metaKey?(g=this.findLineBoundaryLeft(this.selectionStart),this._removeCharsFromTo(g,this.selectionStart),this.selectionStart=g):g.altKey?(g=this.findWordBoundaryLeft(this.selectionStart),this._removeCharsFromTo(g,this.selectionStart),this.selectionStart=g):(g="\n"===this.text.slice(this.selectionStart-1,this.selectionStart),this.removeStyleObject(g),this.selectionStart--,this.text=this.text.slice(0,this.selectionStart)+this.text.slice(this.selectionStart+1)))}});
fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(g,e,b,f,a,c){this.styles[e]?this._setSVGTextLineChars(g,e,b,f,a,c):this.callSuper("_setSVGTextLineText",g,e,b,f,a)},_setSVGTextLineChars:function(g,e,b,f,a,c){f=0===e||this.useNative?"y":"dy";g=g.split("");a=0;for(var d=this._getSVGLineLeftOffset(e),l=this._getSVGLineTopOffset(e),k=this._getHeightOfLine(this.ctx,e),h=0,m=g.length;h<m;h++){var n=this.styles[e][h]||{};b.push(this._createTextCharSpan(g[h],n,d,l,f,a));var p=
this._getWidthOfChar(this.ctx,g[h],e,h);n.textBackgroundColor&&c.push(this._createTextCharBg(n,d,l,k,p,a));a+=p}},_getSVGLineLeftOffset:function(g){return this._boundaries&&this._boundaries[g]?fabric.util.toFixed(this._boundaries[g].left,2):0},_getSVGLineTopOffset:function(g){for(var e=0,b=0;b<=g;b++)e+=this._getHeightOfLine(this.ctx,b);return e-this.height/2},_createTextCharBg:function(g,e,b,f,a,c){return['<rect fill="',g.textBackgroundColor,'" transform="translate(',-this.width/2," ",-this.height+
f,')" x="',e+c,'" y="',b+f,'" width="',a,'" height="',f,'"></rect>'].join("")},_createTextCharSpan:function(g,e,b,f,a,c){var d=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text"},e));return['<tspan x="',b+c,'" ',a,'="',f,'" ',e.fontFamily?'font-family="'+e.fontFamily.replace(/"/g,"'")+'" ':"",e.fontSize?'font-size="'+e.fontSize+'" ':"",e.fontStyle?'font-style="'+e.fontStyle+'" ':"",e.fontWeight?'font-weight="'+e.fontWeight+'" ':"",e.textDecoration?
'text-decoration="'+e.textDecoration+'" ':"",'style="',d,'">',fabric.util.string.escapeXml(g),"</tspan>"].join("")}});
(function(){function g(b,d,e){var g=f.parse(b);g.port||(g.port=0===g.protocol.indexOf("https:")?443:80);b=(443===g.port?c:a).request({hostname:g.hostname,port:g.port,path:g.path,method:"GET"},function(a){var b="";d&&a.setEncoding(d);a.on("end",function(){e(b)});a.on("data",function(c){200===a.statusCode&&(b+=c)})});b.on("error",function(a){a.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+g.hostname+":"+g.port):fabric.log(a.message)});b.end()}function e(a,b){require("fs").readFile(a,
function(a,c){if(a)throw fabric.log(a),a;b(c)})}if("undefined"===typeof document||"undefined"===typeof window){var b=(new require("xmldom")).DOMParser,f=require("url"),a=require("http"),c=require("https"),d=require("canvas"),l=require("canvas").Image;fabric.util.loadImage=function(a,b,c){var d=function(d){f.src=new Buffer(d,"binary");f._src=a;b&&b.call(c,f)},f=new l;a&&(a instanceof Buffer||0===a.indexOf("data"))?(f.src=f._src=a,b&&b.call(c,f)):a&&0!==a.indexOf("http")?e(a,d):a?g(a,"binary",d):b&&
b.call(c,a)};fabric.loadSVGFromURL=function(a,b,c){a=a.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();0!==a.indexOf("http")?e(a,function(a){fabric.loadSVGFromString(a,b,c)}):g(a,"",function(a){fabric.loadSVGFromString(a,b,c)})};fabric.loadSVGFromString=function(a,c,d){a=(new b).parseFromString(a);fabric.parseSVGDocument(a.documentElement,function(a,b){c&&c(a,b)},d)};fabric.util.getScript=function(a,b){g(a,"",function(a){eval(a);b&&b()})};fabric.Image.fromObject=function(a,b){fabric.util.loadImage(a.src,
function(c){var d=new fabric.Image(c);d._initConfig(a);d._initFilters(a,function(a){d.filters=a||[];b&&b(d)})})};fabric.createCanvasForNode=function(a,b){var c=fabric.document.createElement("canvas"),e=new d(a||600,b||600);c.style={};c.width=e.width;c.height=e.height;c=new (fabric.Canvas||fabric.StaticCanvas)(c);c.contextContainer=e.getContext("2d");c.nodeCanvas=e;c.Font=d.Font;return c};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};fabric.StaticCanvas.prototype.createJPEGStream=
function(a){return this.nodeCanvas.createJPEGStream(a)};var k=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(a){k.call(this,a);this.nodeCanvas.width=a;return this};fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);var h=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(a){h.call(this,a);this.nodeCanvas.height=a;return this};fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}})();
